"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

Object.defineProperty(exports, "__esModule", { value: true });
var commander = require("commander");
var path = require("path");
var Default_1 = require("../options/presets/Default");
var BooleanSanitizer_1 = require("./sanitizers/BooleanSanitizer");
var SourceMapModeSanitizer_1 = require("./sanitizers/SourceMapModeSanitizer");
var StringArrayEncodingSanitizer_1 = require("./sanitizers/StringArrayEncodingSanitizer");
var CLIUtils_1 = require("./utils/CLIUtils");
var JavaScriptObfuscator_1 = require("../JavaScriptObfuscator");

var JavaScriptObfuscatorCLI = function () {
    function JavaScriptObfuscatorCLI(argv) {
        _classCallCheck(this, JavaScriptObfuscatorCLI);

        this.sourceCode = '';
        this.rawArguments = argv;
        this.arguments = this.rawArguments.slice(2);
        this.commands = new commander.Command();
    }

    _createClass(JavaScriptObfuscatorCLI, [{
        key: "run",
        value: function run() {
            this.configureCommands();
            this.configureHelp();
            if (!this.arguments.length || this.arguments.indexOf('--help') !== -1) {
                this.commands.outputHelp();
                return;
            }
            this.inputPath = this.arguments[0];
            CLIUtils_1.CLIUtils.validateInputPath(this.inputPath);
            this.getData();
            this.processData();
        }
    }, {
        key: "buildOptions",
        value: function buildOptions() {
            var inputOptions = {};
            var availableOptions = Object.keys(Default_1.DEFAULT_PRESET);
            for (var option in this.commands) {
                if (!this.commands.hasOwnProperty(option)) {
                    continue;
                }
                if (!(availableOptions.indexOf(option) !== -1)) {
                    continue;
                }
                inputOptions[option] = this.commands[option];
            }
            return Object.assign({}, Default_1.DEFAULT_PRESET, inputOptions);
        }
    }, {
        key: "configureCommands",
        value: function configureCommands() {
            this.commands.version(CLIUtils_1.CLIUtils.getPackageConfig().version, '-v, --version').usage('<inputPath> [options]').option('-o, --output <path>', 'Output path for obfuscated code').option('--compact <boolean>', 'Disable one line output code compacting', BooleanSanitizer_1.BooleanSanitizer).option('--controlFlowFlattening <boolean>', 'Enables control flow flattening', BooleanSanitizer_1.BooleanSanitizer).option('--controlFlowFlatteningThreshold <number>', 'The probability that the control flow flattening transformation will be applied to the node', parseFloat).option('--deadCodeInjection <boolean>', 'Enables dead code injection', BooleanSanitizer_1.BooleanSanitizer).option('--deadCodeInjectionThreshold <number>', 'The probability that the dead code injection transformation will be applied to the node', parseFloat).option('--debugProtection <boolean>', 'Disable browser Debug panel (can cause DevTools enabled browser freeze)', BooleanSanitizer_1.BooleanSanitizer).option('--debugProtectionInterval <boolean>', 'Disable browser Debug panel even after page was loaded (can cause DevTools enabled browser freeze)', BooleanSanitizer_1.BooleanSanitizer).option('--disableConsoleOutput <boolean>', 'Allow console.log, console.info, console.error and console.warn messages output into browser console', BooleanSanitizer_1.BooleanSanitizer).option('--domainLock <list>', 'Blocks the execution of the code in domains that do not match the passed RegExp patterns (comma separated)', function (value) {
                return value.split(',');
            }).option('--mangle <boolean>', 'Enables mangling of variable names', BooleanSanitizer_1.BooleanSanitizer).option('--reservedNames <list>', 'Disable obfuscation of variable names, function names and names of function parameters that match the passed RegExp patterns (comma separated)', function (value) {
                return value.split(',');
            }).option('--rotateStringArray <boolean>', 'Disable rotation of unicode array values during obfuscation', BooleanSanitizer_1.BooleanSanitizer).option('--seed <number>', 'Sets seed for random generator. This is useful for creating repeatable results.', parseFloat).option('--selfDefending <boolean>', 'Disables self-defending for obfuscated code', BooleanSanitizer_1.BooleanSanitizer).option('--sourceMap <boolean>', 'Enables source map generation', BooleanSanitizer_1.BooleanSanitizer).option('--sourceMapBaseUrl <string>', 'Sets base url to the source map import url when `--sourceMapMode=separate`').option('--sourceMapFileName <string>', 'Sets file name for output source map when `--sourceMapMode=separate`').option('--sourceMapMode <string> [inline, separate]', 'Specify source map output mode', SourceMapModeSanitizer_1.SourceMapModeSanitizer).option('--stringArray <boolean>', 'Disables gathering of all literal strings into an array and replacing every literal string with an array call', BooleanSanitizer_1.BooleanSanitizer).option('--stringArrayEncoding <boolean|string> [true, false, base64, rc4]', 'Encodes all strings in strings array using base64 or rc4 (this option can slow down your code speed', StringArrayEncodingSanitizer_1.StringArrayEncodingSanitizer).option('--stringArrayThreshold <number>', 'The probability that the literal string will be inserted into stringArray (Default: 0.8, Min: 0, Max: 1)', parseFloat).option('--unicodeEscapeSequence <boolean>', 'Allows to enable/disable string conversion to unicode escape sequence', BooleanSanitizer_1.BooleanSanitizer).parse(this.rawArguments);
        }
    }, {
        key: "configureHelp",
        value: function configureHelp() {
            this.commands.on('--help', function () {
                console.log('  Examples:\n');
                console.log('    %> javascript-obfuscator in.js --compact true --selfDefending false');
                console.log('    %> javascript-obfuscator in.js --output out.js --compact true --selfDefending false');
                console.log('');
            });
        }
    }, {
        key: "getData",
        value: function getData() {
            this.sourceCode = CLIUtils_1.CLIUtils.readFile(this.inputPath);
        }
    }, {
        key: "processData",
        value: function processData() {
            var options = this.buildOptions();
            var outputCodePath = CLIUtils_1.CLIUtils.getOutputCodePath(this.commands.output, this.inputPath);
            if (options.sourceMap) {
                this.processDataWithSourceMap(outputCodePath, options);
            } else {
                this.processDataWithoutSourceMap(outputCodePath, options);
            }
        }
    }, {
        key: "processDataWithoutSourceMap",
        value: function processDataWithoutSourceMap(outputCodePath, options) {
            var obfuscatedCode = JavaScriptObfuscator_1.JavaScriptObfuscator.obfuscate(this.sourceCode, options).getObfuscatedCode();
            CLIUtils_1.CLIUtils.writeFile(outputCodePath, obfuscatedCode);
        }
    }, {
        key: "processDataWithSourceMap",
        value: function processDataWithSourceMap(outputCodePath, options) {
            var outputSourceMapPath = CLIUtils_1.CLIUtils.getOutputSourceMapPath(outputCodePath, options.sourceMapFileName || '');
            options = Object.assign({}, options, { sourceMapFileName: path.basename(outputSourceMapPath) });
            var obfuscationResult = JavaScriptObfuscator_1.JavaScriptObfuscator.obfuscate(this.sourceCode, options);
            CLIUtils_1.CLIUtils.writeFile(outputCodePath, obfuscationResult.getObfuscatedCode());
            if (options.sourceMapMode === 'separate' && obfuscationResult.getSourceMap()) {
                CLIUtils_1.CLIUtils.writeFile(outputSourceMapPath, obfuscationResult.getSourceMap());
            }
        }
    }]);

    return JavaScriptObfuscatorCLI;
}();

exports.JavaScriptObfuscatorCLI = JavaScriptObfuscatorCLI;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSmF2YVNjcmlwdE9iZnVzY2F0b3JDTEkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY2xpL0phdmFTY3JpcHRPYmZ1c2NhdG9yQ0xJLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQSx3QkFBdUM7QUFDdkMsbUJBQTZCO0FBTTdCLHdCQUE0RDtBQUU1RCxpQ0FBaUU7QUFDakUsdUNBQTZFO0FBQzdFLDZDQUF5RjtBQUV6Rix5QkFBNEM7QUFDNUMscUNBQStELEFBRS9EOzs7QUE2QkkscUNBQWEsQUFBYzs7O0FBTG5CLGFBQVUsYUFBVyxBQUFFLEFBQUM7QUFNNUIsQUFBSSxhQUFDLEFBQVksZUFBRyxBQUFJLEFBQUM7QUFDekIsQUFBSSxhQUFDLEFBQVMsWUFBRyxBQUFJLEtBQUMsQUFBWSxhQUFDLEFBQUssTUFBQyxBQUFDLEFBQUMsQUFBQztBQUU1QyxBQUFJLGFBQUMsQUFBUSxBQUE4QixXQUFDLElBQUksQUFBUyxVQUFDLEFBQU8sQUFBRSxBQUFDLEFBQUMsQUFDekU7QUFBQyxBQUVNLEFBQUc7Ozs7O0FBQ04sQUFBSSxpQkFBQyxBQUFpQixBQUFFLEFBQUM7QUFDekIsQUFBSSxpQkFBQyxBQUFhLEFBQUUsQUFBQztBQUVyQixBQUFFLEFBQUMsZ0JBQUMsQ0FBQyxBQUFJLEtBQUMsQUFBUyxVQUFDLEFBQU0sVUFBSSxBQUFJLEtBQUMsQUFBUyxVQUFDLEFBQVEsUUFBQyxBQUFRLEFBQUMsQUFBQyxrQkFBQyxBQUFDO0FBQzlELEFBQUkscUJBQUMsQUFBUSxTQUFDLEFBQVUsQUFBRSxBQUFDO0FBRTNCLEFBQU0sQUFBQyxBQUNYO0FBQUM7QUFFRCxBQUFJLGlCQUFDLEFBQVMsWUFBRyxBQUFJLEtBQUMsQUFBUyxVQUFDLEFBQUMsQUFBQyxBQUFDO0FBQ25DLHVCQUFRLFNBQUMsQUFBaUIsa0JBQUMsQUFBSSxLQUFDLEFBQVMsQUFBQyxBQUFDO0FBRTNDLEFBQUksaUJBQUMsQUFBTyxBQUFFLEFBQUM7QUFDZixBQUFJLGlCQUFDLEFBQVcsQUFBRSxBQUFDLEFBQ3ZCO0FBQUMsQUFLTyxBQUFZOzs7O0FBQ2hCLGdCQUFNLEFBQVksZUFBa0IsQUFBRSxBQUFDO0FBQ3ZDLGdCQUFNLEFBQWdCLG1CQUFhLEFBQU0sT0FBQyxBQUFJLEtBQUMsVUFBYyxBQUFDLEFBQUM7QUFFL0QsQUFBRyxBQUFDLGlCQUFDLElBQU0sQUFBTSxVQUFJLEFBQUksS0FBQyxBQUFRLEFBQUMsVUFBQyxBQUFDO0FBQ2pDLEFBQUUsQUFBQyxvQkFBQyxDQUFDLEFBQUksS0FBQyxBQUFRLFNBQUMsQUFBYyxlQUFDLEFBQU0sQUFBQyxBQUFDLFNBQUMsQUFBQztBQUN4QyxBQUFRLEFBQUMsQUFDYjtBQUFDO0FBRUQsQUFBRSxBQUFDLG9CQUFDLEVBQUMsQUFBZ0IsaUJBQUMsQUFBUSxRQUFDLEFBQU0sQUFBQyxBQUFDLGlCQUFDLEFBQUM7QUFDckMsQUFBUSxBQUFDLEFBQ2I7QUFBQztBQUVLLEFBQWEsNkJBQUMsQUFBTSxBQUFDLFVBQVMsQUFBSSxLQUFDLEFBQVMsU0FBQyxBQUFNLEFBQUMsQUFBQyxBQUMvRDtBQUFDO0FBRUQsQUFBTSxxQ0FDQyxVQUFjLGdCQUNkLEFBQVksQUFDakIsQUFDTjtBQUFDLEFBRU8sQUFBaUI7Ozs7QUFDckIsQUFBSSxpQkFBQyxBQUFRLFNBQ1IsQUFBTyxRQUFDLFdBQVEsU0FBQyxBQUFnQixBQUFFLG1CQUFDLEFBQU8sU0FBRSxBQUFlLEFBQUMsaUJBQzdELEFBQUssTUFBQyxBQUF1QixBQUFDLHlCQUM5QixBQUFNLE9BQ0gsQUFBcUIsdUJBQ3JCLEFBQWlDLEFBQ3BDLG1DQUNBLEFBQU0sT0FDSCxBQUFxQix1QkFDckIsQUFBeUMsMkNBQ3pDLG1CQUFnQixBQUNuQixrQkFDQSxBQUFNLE9BQ0gsQUFBbUMscUNBQ25DLEFBQWlDLG1DQUNqQyxtQkFBZ0IsQUFDbkIsa0JBQ0EsQUFBTSxPQUNILEFBQTJDLDZDQUMzQyxBQUE2RiwrRkFDN0YsQUFBVSxBQUNiLFlBQ0EsQUFBTSxPQUNILEFBQStCLGlDQUMvQixBQUE2QiwrQkFDN0IsbUJBQWdCLEFBQ25CLGtCQUNBLEFBQU0sT0FDSCxBQUF1Qyx5Q0FDdkMsQUFBeUYsMkZBQ3pGLEFBQVUsQUFDYixZQUNBLEFBQU0sT0FDSCxBQUE2QiwrQkFDN0IsQUFBeUUsMkVBQ3pFLG1CQUFnQixBQUNuQixrQkFDQSxBQUFNLE9BQ0gsQUFBcUMsdUNBQ3JDLEFBQW9HLHNHQUNwRyxtQkFBZ0IsQUFDbkIsa0JBQ0EsQUFBTSxPQUNILEFBQWtDLG9DQUNsQyxBQUFzRyx3R0FDdEcsbUJBQWdCLEFBQ25CLGtCQUNBLEFBQU0sT0FDSCxBQUFxQix1QkFDckIsQUFBNEcsd0hBQzNHLEFBQWE7QUFBZCx1QkFBbUIsQUFBSyxNQUFDLEFBQUssTUFBQyxBQUFHLEFBQUMsQUFDdEM7ZUFDQSxBQUFNLE9BQ0gsQUFBb0Isc0JBQUUsQUFBb0Msc0NBQzFELG1CQUFnQixBQUNuQixrQkFDQSxBQUFNLE9BQ0gsQUFBd0IsMEJBQ3hCLEFBQWdKLDRKQUMvSSxBQUFhO0FBQWQsdUJBQW1CLEFBQUssTUFBQyxBQUFLLE1BQUMsQUFBRyxBQUFDLEFBQ3RDO2VBQ0EsQUFBTSxPQUNILEFBQStCLGlDQUFFLEFBQTZELCtEQUM5RixtQkFBZ0IsQUFDbkIsa0JBQ0EsQUFBTSxPQUNILEFBQWlCLG1CQUNqQixBQUFpRixtRkFDakYsQUFBVSxBQUNiLFlBQ0EsQUFBTSxPQUNILEFBQTJCLDZCQUMzQixBQUE2QywrQ0FDN0MsbUJBQWdCLEFBQ25CLGtCQUNBLEFBQU0sT0FDSCxBQUF1Qix5QkFDdkIsQUFBK0IsaUNBQy9CLG1CQUFnQixBQUNuQixrQkFDQSxBQUFNLE9BQ0gsQUFBNkIsK0JBQzdCLEFBQTRFLEFBQy9FLDhFQUNBLEFBQU0sT0FDSCxBQUE4QixnQ0FDOUIsQUFBc0UsQUFDekUsd0VBQ0EsQUFBTSxPQUNILEFBQTZDLCtDQUM3QyxBQUFnQyxrQ0FDaEMseUJBQXNCLEFBQ3pCLHdCQUNBLEFBQU0sT0FDSCxBQUF5QiwyQkFDekIsQUFBK0csaUhBQy9HLG1CQUFnQixBQUNuQixrQkFDQSxBQUFNLE9BQ0gsQUFBbUUscUVBQ25FLEFBQXFHLHVHQUNyRywrQkFBNEIsQUFDL0IsOEJBQ0EsQUFBTSxPQUNILEFBQWlDLG1DQUNqQyxBQUEwRyw0R0FDMUcsQUFBVSxBQUNiLFlBQ0EsQUFBTSxPQUNILEFBQW1DLHFDQUNuQyxBQUF1RSx5RUFDdkUsbUJBQWdCLEFBQ25CLGtCQUNBLEFBQUssTUFBQyxBQUFJLEtBQUMsQUFBWSxBQUFDLEFBQUMsQUFDbEM7QUFBQyxBQUVPLEFBQWE7Ozs7QUFDakIsQUFBSSxpQkFBQyxBQUFRLFNBQUMsQUFBRSxHQUFDLEFBQVEsVUFBRTtBQUN2QixBQUFPLHdCQUFDLEFBQUcsSUFBQyxBQUFlLEFBQUMsQUFBQztBQUM3QixBQUFPLHdCQUFDLEFBQUcsSUFBQyxBQUF5RSxBQUFDLEFBQUM7QUFDdkYsQUFBTyx3QkFBQyxBQUFHLElBQUMsQUFBeUYsQUFBQyxBQUFDO0FBQ3ZHLEFBQU8sd0JBQUMsQUFBRyxJQUFDLEFBQUUsQUFBQyxBQUFDLEFBQ3BCO0FBQUMsQUFBQyxBQUFDLEFBQ1A7QUFBQyxBQUVPLEFBQU87Ozs7QUFDWCxBQUFJLGlCQUFDLEFBQVUsYUFBRyxXQUFRLFNBQUMsQUFBUSxTQUFDLEFBQUksS0FBQyxBQUFTLEFBQUMsQUFBQyxBQUN4RDtBQUFDLEFBRU8sQUFBVzs7OztBQUNmLGdCQUFNLEFBQU8sVUFBa0IsQUFBSSxLQUFDLEFBQVksQUFBRSxBQUFDO0FBQ25ELGdCQUFNLEFBQWMsaUJBQVcsV0FBUSxTQUFDLEFBQWlCLGtCQUFPLEFBQUksS0FBQyxBQUFTLFNBQUMsQUFBTSxRQUFFLEFBQUksS0FBQyxBQUFTLEFBQUMsQUFBQztBQUV2RyxBQUFFLEFBQUMsZ0JBQUMsQUFBTyxRQUFDLEFBQVMsQUFBQyxXQUFDLEFBQUM7QUFDcEIsQUFBSSxxQkFBQyxBQUF3Qix5QkFBQyxBQUFjLGdCQUFFLEFBQU8sQUFBQyxBQUFDLEFBQzNEO0FBQUMsQUFBQyxBQUFJLG1CQUFDLEFBQUM7QUFDSixBQUFJLHFCQUFDLEFBQTJCLDRCQUFDLEFBQWMsZ0JBQUUsQUFBTyxBQUFDLEFBQUMsQUFDOUQ7QUFBQyxBQUNMO0FBQUMsQUFNTyxBQUEyQjs7O29EQUFFLEFBQXNCLGdCQUFFLEFBQXNCO0FBQy9FLGdCQUFNLEFBQWMsaUJBQVcsdUJBQW9CLHFCQUFDLEFBQVMsVUFBQyxBQUFJLEtBQUMsQUFBVSxZQUFFLEFBQU8sQUFBQyxTQUFDLEFBQWlCLEFBQUUsQUFBQztBQUU1Ryx1QkFBUSxTQUFDLEFBQVMsVUFBQyxBQUFjLGdCQUFFLEFBQWMsQUFBQyxBQUFDLEFBQ3ZEO0FBQUMsQUFNTyxBQUF3Qjs7O2lEQUFFLEFBQXNCLGdCQUFFLEFBQXNCO0FBQzVFLGdCQUFNLEFBQW1CLHNCQUFXLFdBQVEsU0FBQyxBQUFzQix1QkFDL0QsQUFBYyxnQkFDZCxBQUFPLFFBQUMsQUFBaUIscUJBQUksQUFBRSxBQUNsQyxBQUFDO0FBRUYsQUFBTyx3Q0FDQSxBQUFPLFdBQ1YsQUFBaUIsbUJBQUUsQUFBSSxLQUFDLEFBQVEsU0FBQyxBQUFtQixBQUFDLEFBQ3hELEFBQUM7QUFFRixnQkFBTSxBQUFpQixvQkFBdUIsdUJBQW9CLHFCQUFDLEFBQVMsVUFBQyxBQUFJLEtBQUMsQUFBVSxZQUFFLEFBQU8sQUFBQyxBQUFDO0FBRXZHLHVCQUFRLFNBQUMsQUFBUyxVQUFDLEFBQWMsZ0JBQUUsQUFBaUIsa0JBQUMsQUFBaUIsQUFBRSxBQUFDLEFBQUM7QUFFMUUsQUFBRSxBQUFDLGdCQUFDLEFBQU8sUUFBQyxBQUFhLGtCQUFLLEFBQVUsY0FBSSxBQUFpQixrQkFBQyxBQUFZLEFBQUUsQUFBQyxnQkFBQyxBQUFDO0FBQzNFLDJCQUFRLFNBQUMsQUFBUyxVQUFDLEFBQW1CLHFCQUFFLEFBQWlCLGtCQUFDLEFBQVksQUFBRSxBQUFDLEFBQUMsQUFDOUU7QUFBQyxBQUNMO0FBQUMsQUFDSjs7Ozs7O0FBNVBELGtDQTRQQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGNvbW1hbmRlciBmcm9tICdjb21tYW5kZXInO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcblxuaW1wb3J0IHsgVElucHV0T3B0aW9ucyB9IGZyb20gJy4uL3R5cGVzL29wdGlvbnMvVElucHV0T3B0aW9ucyc7XG5cbmltcG9ydCB7IElPYmZ1c2NhdGlvblJlc3VsdCB9IGZyb20gJy4uL2ludGVyZmFjZXMvSU9iZnVzY2F0aW9uUmVzdWx0JztcblxuaW1wb3J0IHsgREVGQVVMVF9QUkVTRVQgfSBmcm9tICcuLi9vcHRpb25zL3ByZXNldHMvRGVmYXVsdCc7XG5cbmltcG9ydCB7IEJvb2xlYW5TYW5pdGl6ZXIgfSBmcm9tICcuL3Nhbml0aXplcnMvQm9vbGVhblNhbml0aXplcic7XG5pbXBvcnQgeyBTb3VyY2VNYXBNb2RlU2FuaXRpemVyIH0gZnJvbSAnLi9zYW5pdGl6ZXJzL1NvdXJjZU1hcE1vZGVTYW5pdGl6ZXInO1xuaW1wb3J0IHsgU3RyaW5nQXJyYXlFbmNvZGluZ1Nhbml0aXplciB9IGZyb20gJy4vc2FuaXRpemVycy9TdHJpbmdBcnJheUVuY29kaW5nU2FuaXRpemVyJztcblxuaW1wb3J0IHsgQ0xJVXRpbHMgfSBmcm9tICcuL3V0aWxzL0NMSVV0aWxzJztcbmltcG9ydCB7IEphdmFTY3JpcHRPYmZ1c2NhdG9yIH0gZnJvbSAnLi4vSmF2YVNjcmlwdE9iZnVzY2F0b3InO1xuXG5leHBvcnQgY2xhc3MgSmF2YVNjcmlwdE9iZnVzY2F0b3JDTEkge1xuICAgIC8qKlxuICAgICAqIEB0eXBlIHtzdHJpbmdbXX1cbiAgICAgKi9cbiAgICBwcml2YXRlIHJlYWRvbmx5IGFyZ3VtZW50czogc3RyaW5nW107XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7c3RyaW5nW119XG4gICAgICovXG4gICAgcHJpdmF0ZSByZWFkb25seSByYXdBcmd1bWVudHM6IHN0cmluZ1tdO1xuXG4gICAgLyoqXG4gICAgICogQHR5cGUge2NvbW1hbmRlci5Db21tYW5kZXJTdGF0aWN9XG4gICAgICovXG4gICAgcHJpdmF0ZSBjb21tYW5kczogY29tbWFuZGVyLkNvbW1hbmRlclN0YXRpYztcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICovXG4gICAgcHJpdmF0ZSBpbnB1dFBhdGg6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICovXG4gICAgcHJpdmF0ZSBzb3VyY2VDb2RlOiBzdHJpbmcgPSAnJztcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nW119IGFyZ3ZcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvciAoYXJndjogc3RyaW5nW10pIHtcbiAgICAgICAgdGhpcy5yYXdBcmd1bWVudHMgPSBhcmd2O1xuICAgICAgICB0aGlzLmFyZ3VtZW50cyA9IHRoaXMucmF3QXJndW1lbnRzLnNsaWNlKDIpO1xuXG4gICAgICAgIHRoaXMuY29tbWFuZHMgPSA8Y29tbWFuZGVyLkNvbW1hbmRlclN0YXRpYz4obmV3IGNvbW1hbmRlci5Db21tYW5kKCkpO1xuICAgIH1cblxuICAgIHB1YmxpYyBydW4gKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmNvbmZpZ3VyZUNvbW1hbmRzKCk7XG4gICAgICAgIHRoaXMuY29uZmlndXJlSGVscCgpO1xuXG4gICAgICAgIGlmICghdGhpcy5hcmd1bWVudHMubGVuZ3RoIHx8IHRoaXMuYXJndW1lbnRzLmluY2x1ZGVzKCctLWhlbHAnKSkge1xuICAgICAgICAgICAgdGhpcy5jb21tYW5kcy5vdXRwdXRIZWxwKCk7XG5cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuaW5wdXRQYXRoID0gdGhpcy5hcmd1bWVudHNbMF07XG4gICAgICAgIENMSVV0aWxzLnZhbGlkYXRlSW5wdXRQYXRoKHRoaXMuaW5wdXRQYXRoKTtcblxuICAgICAgICB0aGlzLmdldERhdGEoKTtcbiAgICAgICAgdGhpcy5wcm9jZXNzRGF0YSgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIHtUSW5wdXRPcHRpb25zfVxuICAgICAqL1xuICAgIHByaXZhdGUgYnVpbGRPcHRpb25zICgpOiBUSW5wdXRPcHRpb25zIHtcbiAgICAgICAgY29uc3QgaW5wdXRPcHRpb25zOiBUSW5wdXRPcHRpb25zID0ge307XG4gICAgICAgIGNvbnN0IGF2YWlsYWJsZU9wdGlvbnM6IHN0cmluZ1tdID0gT2JqZWN0LmtleXMoREVGQVVMVF9QUkVTRVQpO1xuXG4gICAgICAgIGZvciAoY29uc3Qgb3B0aW9uIGluIHRoaXMuY29tbWFuZHMpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5jb21tYW5kcy5oYXNPd25Qcm9wZXJ0eShvcHRpb24pKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghYXZhaWxhYmxlT3B0aW9ucy5pbmNsdWRlcyhvcHRpb24pKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICg8YW55PmlucHV0T3B0aW9ucylbb3B0aW9uXSA9ICg8YW55PnRoaXMuY29tbWFuZHMpW29wdGlvbl07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLi4uREVGQVVMVF9QUkVTRVQsXG4gICAgICAgICAgICAuLi5pbnB1dE9wdGlvbnNcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNvbmZpZ3VyZUNvbW1hbmRzICgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5jb21tYW5kc1xuICAgICAgICAgICAgLnZlcnNpb24oQ0xJVXRpbHMuZ2V0UGFja2FnZUNvbmZpZygpLnZlcnNpb24sICctdiwgLS12ZXJzaW9uJylcbiAgICAgICAgICAgIC51c2FnZSgnPGlucHV0UGF0aD4gW29wdGlvbnNdJylcbiAgICAgICAgICAgIC5vcHRpb24oXG4gICAgICAgICAgICAgICAgJy1vLCAtLW91dHB1dCA8cGF0aD4nLFxuICAgICAgICAgICAgICAgICdPdXRwdXQgcGF0aCBmb3Igb2JmdXNjYXRlZCBjb2RlJ1xuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLm9wdGlvbihcbiAgICAgICAgICAgICAgICAnLS1jb21wYWN0IDxib29sZWFuPicsXG4gICAgICAgICAgICAgICAgJ0Rpc2FibGUgb25lIGxpbmUgb3V0cHV0IGNvZGUgY29tcGFjdGluZycsXG4gICAgICAgICAgICAgICAgQm9vbGVhblNhbml0aXplclxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLm9wdGlvbihcbiAgICAgICAgICAgICAgICAnLS1jb250cm9sRmxvd0ZsYXR0ZW5pbmcgPGJvb2xlYW4+JyxcbiAgICAgICAgICAgICAgICAnRW5hYmxlcyBjb250cm9sIGZsb3cgZmxhdHRlbmluZycsXG4gICAgICAgICAgICAgICAgQm9vbGVhblNhbml0aXplclxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLm9wdGlvbihcbiAgICAgICAgICAgICAgICAnLS1jb250cm9sRmxvd0ZsYXR0ZW5pbmdUaHJlc2hvbGQgPG51bWJlcj4nLFxuICAgICAgICAgICAgICAgICdUaGUgcHJvYmFiaWxpdHkgdGhhdCB0aGUgY29udHJvbCBmbG93IGZsYXR0ZW5pbmcgdHJhbnNmb3JtYXRpb24gd2lsbCBiZSBhcHBsaWVkIHRvIHRoZSBub2RlJyxcbiAgICAgICAgICAgICAgICBwYXJzZUZsb2F0XG4gICAgICAgICAgICApXG4gICAgICAgICAgICAub3B0aW9uKFxuICAgICAgICAgICAgICAgICctLWRlYWRDb2RlSW5qZWN0aW9uIDxib29sZWFuPicsXG4gICAgICAgICAgICAgICAgJ0VuYWJsZXMgZGVhZCBjb2RlIGluamVjdGlvbicsXG4gICAgICAgICAgICAgICAgQm9vbGVhblNhbml0aXplclxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLm9wdGlvbihcbiAgICAgICAgICAgICAgICAnLS1kZWFkQ29kZUluamVjdGlvblRocmVzaG9sZCA8bnVtYmVyPicsXG4gICAgICAgICAgICAgICAgJ1RoZSBwcm9iYWJpbGl0eSB0aGF0IHRoZSBkZWFkIGNvZGUgaW5qZWN0aW9uIHRyYW5zZm9ybWF0aW9uIHdpbGwgYmUgYXBwbGllZCB0byB0aGUgbm9kZScsXG4gICAgICAgICAgICAgICAgcGFyc2VGbG9hdFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLm9wdGlvbihcbiAgICAgICAgICAgICAgICAnLS1kZWJ1Z1Byb3RlY3Rpb24gPGJvb2xlYW4+JyxcbiAgICAgICAgICAgICAgICAnRGlzYWJsZSBicm93c2VyIERlYnVnIHBhbmVsIChjYW4gY2F1c2UgRGV2VG9vbHMgZW5hYmxlZCBicm93c2VyIGZyZWV6ZSknLFxuICAgICAgICAgICAgICAgIEJvb2xlYW5TYW5pdGl6ZXJcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5vcHRpb24oXG4gICAgICAgICAgICAgICAgJy0tZGVidWdQcm90ZWN0aW9uSW50ZXJ2YWwgPGJvb2xlYW4+JyxcbiAgICAgICAgICAgICAgICAnRGlzYWJsZSBicm93c2VyIERlYnVnIHBhbmVsIGV2ZW4gYWZ0ZXIgcGFnZSB3YXMgbG9hZGVkIChjYW4gY2F1c2UgRGV2VG9vbHMgZW5hYmxlZCBicm93c2VyIGZyZWV6ZSknLFxuICAgICAgICAgICAgICAgIEJvb2xlYW5TYW5pdGl6ZXJcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5vcHRpb24oXG4gICAgICAgICAgICAgICAgJy0tZGlzYWJsZUNvbnNvbGVPdXRwdXQgPGJvb2xlYW4+JyxcbiAgICAgICAgICAgICAgICAnQWxsb3cgY29uc29sZS5sb2csIGNvbnNvbGUuaW5mbywgY29uc29sZS5lcnJvciBhbmQgY29uc29sZS53YXJuIG1lc3NhZ2VzIG91dHB1dCBpbnRvIGJyb3dzZXIgY29uc29sZScsXG4gICAgICAgICAgICAgICAgQm9vbGVhblNhbml0aXplclxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLm9wdGlvbihcbiAgICAgICAgICAgICAgICAnLS1kb21haW5Mb2NrIDxsaXN0PicsXG4gICAgICAgICAgICAgICAgJ0Jsb2NrcyB0aGUgZXhlY3V0aW9uIG9mIHRoZSBjb2RlIGluIGRvbWFpbnMgdGhhdCBkbyBub3QgbWF0Y2ggdGhlIHBhc3NlZCBSZWdFeHAgcGF0dGVybnMgKGNvbW1hIHNlcGFyYXRlZCknLFxuICAgICAgICAgICAgICAgICh2YWx1ZTogc3RyaW5nKSA9PiB2YWx1ZS5zcGxpdCgnLCcpXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAub3B0aW9uKFxuICAgICAgICAgICAgICAgICctLW1hbmdsZSA8Ym9vbGVhbj4nLCAnRW5hYmxlcyBtYW5nbGluZyBvZiB2YXJpYWJsZSBuYW1lcycsXG4gICAgICAgICAgICAgICAgQm9vbGVhblNhbml0aXplclxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLm9wdGlvbihcbiAgICAgICAgICAgICAgICAnLS1yZXNlcnZlZE5hbWVzIDxsaXN0PicsXG4gICAgICAgICAgICAgICAgJ0Rpc2FibGUgb2JmdXNjYXRpb24gb2YgdmFyaWFibGUgbmFtZXMsIGZ1bmN0aW9uIG5hbWVzIGFuZCBuYW1lcyBvZiBmdW5jdGlvbiBwYXJhbWV0ZXJzIHRoYXQgbWF0Y2ggdGhlIHBhc3NlZCBSZWdFeHAgcGF0dGVybnMgKGNvbW1hIHNlcGFyYXRlZCknLFxuICAgICAgICAgICAgICAgICh2YWx1ZTogc3RyaW5nKSA9PiB2YWx1ZS5zcGxpdCgnLCcpXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAub3B0aW9uKFxuICAgICAgICAgICAgICAgICctLXJvdGF0ZVN0cmluZ0FycmF5IDxib29sZWFuPicsICdEaXNhYmxlIHJvdGF0aW9uIG9mIHVuaWNvZGUgYXJyYXkgdmFsdWVzIGR1cmluZyBvYmZ1c2NhdGlvbicsXG4gICAgICAgICAgICAgICAgQm9vbGVhblNhbml0aXplclxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLm9wdGlvbihcbiAgICAgICAgICAgICAgICAnLS1zZWVkIDxudW1iZXI+JyxcbiAgICAgICAgICAgICAgICAnU2V0cyBzZWVkIGZvciByYW5kb20gZ2VuZXJhdG9yLiBUaGlzIGlzIHVzZWZ1bCBmb3IgY3JlYXRpbmcgcmVwZWF0YWJsZSByZXN1bHRzLicsXG4gICAgICAgICAgICAgICAgcGFyc2VGbG9hdFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLm9wdGlvbihcbiAgICAgICAgICAgICAgICAnLS1zZWxmRGVmZW5kaW5nIDxib29sZWFuPicsXG4gICAgICAgICAgICAgICAgJ0Rpc2FibGVzIHNlbGYtZGVmZW5kaW5nIGZvciBvYmZ1c2NhdGVkIGNvZGUnLFxuICAgICAgICAgICAgICAgIEJvb2xlYW5TYW5pdGl6ZXJcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5vcHRpb24oXG4gICAgICAgICAgICAgICAgJy0tc291cmNlTWFwIDxib29sZWFuPicsXG4gICAgICAgICAgICAgICAgJ0VuYWJsZXMgc291cmNlIG1hcCBnZW5lcmF0aW9uJyxcbiAgICAgICAgICAgICAgICBCb29sZWFuU2FuaXRpemVyXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAub3B0aW9uKFxuICAgICAgICAgICAgICAgICctLXNvdXJjZU1hcEJhc2VVcmwgPHN0cmluZz4nLFxuICAgICAgICAgICAgICAgICdTZXRzIGJhc2UgdXJsIHRvIHRoZSBzb3VyY2UgbWFwIGltcG9ydCB1cmwgd2hlbiBgLS1zb3VyY2VNYXBNb2RlPXNlcGFyYXRlYCdcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5vcHRpb24oXG4gICAgICAgICAgICAgICAgJy0tc291cmNlTWFwRmlsZU5hbWUgPHN0cmluZz4nLFxuICAgICAgICAgICAgICAgICdTZXRzIGZpbGUgbmFtZSBmb3Igb3V0cHV0IHNvdXJjZSBtYXAgd2hlbiBgLS1zb3VyY2VNYXBNb2RlPXNlcGFyYXRlYCdcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5vcHRpb24oXG4gICAgICAgICAgICAgICAgJy0tc291cmNlTWFwTW9kZSA8c3RyaW5nPiBbaW5saW5lLCBzZXBhcmF0ZV0nLFxuICAgICAgICAgICAgICAgICdTcGVjaWZ5IHNvdXJjZSBtYXAgb3V0cHV0IG1vZGUnLFxuICAgICAgICAgICAgICAgIFNvdXJjZU1hcE1vZGVTYW5pdGl6ZXJcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5vcHRpb24oXG4gICAgICAgICAgICAgICAgJy0tc3RyaW5nQXJyYXkgPGJvb2xlYW4+JyxcbiAgICAgICAgICAgICAgICAnRGlzYWJsZXMgZ2F0aGVyaW5nIG9mIGFsbCBsaXRlcmFsIHN0cmluZ3MgaW50byBhbiBhcnJheSBhbmQgcmVwbGFjaW5nIGV2ZXJ5IGxpdGVyYWwgc3RyaW5nIHdpdGggYW4gYXJyYXkgY2FsbCcsXG4gICAgICAgICAgICAgICAgQm9vbGVhblNhbml0aXplclxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLm9wdGlvbihcbiAgICAgICAgICAgICAgICAnLS1zdHJpbmdBcnJheUVuY29kaW5nIDxib29sZWFufHN0cmluZz4gW3RydWUsIGZhbHNlLCBiYXNlNjQsIHJjNF0nLFxuICAgICAgICAgICAgICAgICdFbmNvZGVzIGFsbCBzdHJpbmdzIGluIHN0cmluZ3MgYXJyYXkgdXNpbmcgYmFzZTY0IG9yIHJjNCAodGhpcyBvcHRpb24gY2FuIHNsb3cgZG93biB5b3VyIGNvZGUgc3BlZWQnLFxuICAgICAgICAgICAgICAgIFN0cmluZ0FycmF5RW5jb2RpbmdTYW5pdGl6ZXJcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5vcHRpb24oXG4gICAgICAgICAgICAgICAgJy0tc3RyaW5nQXJyYXlUaHJlc2hvbGQgPG51bWJlcj4nLFxuICAgICAgICAgICAgICAgICdUaGUgcHJvYmFiaWxpdHkgdGhhdCB0aGUgbGl0ZXJhbCBzdHJpbmcgd2lsbCBiZSBpbnNlcnRlZCBpbnRvIHN0cmluZ0FycmF5IChEZWZhdWx0OiAwLjgsIE1pbjogMCwgTWF4OiAxKScsXG4gICAgICAgICAgICAgICAgcGFyc2VGbG9hdFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLm9wdGlvbihcbiAgICAgICAgICAgICAgICAnLS11bmljb2RlRXNjYXBlU2VxdWVuY2UgPGJvb2xlYW4+JyxcbiAgICAgICAgICAgICAgICAnQWxsb3dzIHRvIGVuYWJsZS9kaXNhYmxlIHN0cmluZyBjb252ZXJzaW9uIHRvIHVuaWNvZGUgZXNjYXBlIHNlcXVlbmNlJyxcbiAgICAgICAgICAgICAgICBCb29sZWFuU2FuaXRpemVyXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAucGFyc2UodGhpcy5yYXdBcmd1bWVudHMpO1xuICAgIH1cblxuICAgIHByaXZhdGUgY29uZmlndXJlSGVscCAoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuY29tbWFuZHMub24oJy0taGVscCcsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCcgIEV4YW1wbGVzOlxcbicpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJyAgICAlPiBqYXZhc2NyaXB0LW9iZnVzY2F0b3IgaW4uanMgLS1jb21wYWN0IHRydWUgLS1zZWxmRGVmZW5kaW5nIGZhbHNlJyk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnICAgICU+IGphdmFzY3JpcHQtb2JmdXNjYXRvciBpbi5qcyAtLW91dHB1dCBvdXQuanMgLS1jb21wYWN0IHRydWUgLS1zZWxmRGVmZW5kaW5nIGZhbHNlJyk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnJyk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0RGF0YSAoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc291cmNlQ29kZSA9IENMSVV0aWxzLnJlYWRGaWxlKHRoaXMuaW5wdXRQYXRoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHByb2Nlc3NEYXRhICgpOiB2b2lkIHtcbiAgICAgICAgY29uc3Qgb3B0aW9uczogVElucHV0T3B0aW9ucyA9IHRoaXMuYnVpbGRPcHRpb25zKCk7XG4gICAgICAgIGNvbnN0IG91dHB1dENvZGVQYXRoOiBzdHJpbmcgPSBDTElVdGlscy5nZXRPdXRwdXRDb2RlUGF0aCgoPGFueT50aGlzLmNvbW1hbmRzKS5vdXRwdXQsIHRoaXMuaW5wdXRQYXRoKTtcblxuICAgICAgICBpZiAob3B0aW9ucy5zb3VyY2VNYXApIHtcbiAgICAgICAgICAgIHRoaXMucHJvY2Vzc0RhdGFXaXRoU291cmNlTWFwKG91dHB1dENvZGVQYXRoLCBvcHRpb25zKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucHJvY2Vzc0RhdGFXaXRob3V0U291cmNlTWFwKG91dHB1dENvZGVQYXRoLCBvcHRpb25zKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBvdXRwdXRDb2RlUGF0aFxuICAgICAqIEBwYXJhbSB7VElucHV0T3B0aW9uc30gb3B0aW9uc1xuICAgICAqL1xuICAgIHByaXZhdGUgcHJvY2Vzc0RhdGFXaXRob3V0U291cmNlTWFwIChvdXRwdXRDb2RlUGF0aDogc3RyaW5nLCBvcHRpb25zOiBUSW5wdXRPcHRpb25zKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IG9iZnVzY2F0ZWRDb2RlOiBzdHJpbmcgPSBKYXZhU2NyaXB0T2JmdXNjYXRvci5vYmZ1c2NhdGUodGhpcy5zb3VyY2VDb2RlLCBvcHRpb25zKS5nZXRPYmZ1c2NhdGVkQ29kZSgpO1xuXG4gICAgICAgIENMSVV0aWxzLndyaXRlRmlsZShvdXRwdXRDb2RlUGF0aCwgb2JmdXNjYXRlZENvZGUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBvdXRwdXRDb2RlUGF0aFxuICAgICAqIEBwYXJhbSB7VElucHV0T3B0aW9uc30gb3B0aW9uc1xuICAgICAqL1xuICAgIHByaXZhdGUgcHJvY2Vzc0RhdGFXaXRoU291cmNlTWFwIChvdXRwdXRDb2RlUGF0aDogc3RyaW5nLCBvcHRpb25zOiBUSW5wdXRPcHRpb25zKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IG91dHB1dFNvdXJjZU1hcFBhdGg6IHN0cmluZyA9IENMSVV0aWxzLmdldE91dHB1dFNvdXJjZU1hcFBhdGgoXG4gICAgICAgICAgICBvdXRwdXRDb2RlUGF0aCxcbiAgICAgICAgICAgIG9wdGlvbnMuc291cmNlTWFwRmlsZU5hbWUgfHwgJydcbiAgICAgICAgKTtcblxuICAgICAgICBvcHRpb25zID0ge1xuICAgICAgICAgICAgLi4ub3B0aW9ucyxcbiAgICAgICAgICAgIHNvdXJjZU1hcEZpbGVOYW1lOiBwYXRoLmJhc2VuYW1lKG91dHB1dFNvdXJjZU1hcFBhdGgpXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3Qgb2JmdXNjYXRpb25SZXN1bHQ6IElPYmZ1c2NhdGlvblJlc3VsdCA9IEphdmFTY3JpcHRPYmZ1c2NhdG9yLm9iZnVzY2F0ZSh0aGlzLnNvdXJjZUNvZGUsIG9wdGlvbnMpO1xuXG4gICAgICAgIENMSVV0aWxzLndyaXRlRmlsZShvdXRwdXRDb2RlUGF0aCwgb2JmdXNjYXRpb25SZXN1bHQuZ2V0T2JmdXNjYXRlZENvZGUoKSk7XG5cbiAgICAgICAgaWYgKG9wdGlvbnMuc291cmNlTWFwTW9kZSA9PT0gJ3NlcGFyYXRlJyAmJiBvYmZ1c2NhdGlvblJlc3VsdC5nZXRTb3VyY2VNYXAoKSkge1xuICAgICAgICAgICAgQ0xJVXRpbHMud3JpdGVGaWxlKG91dHB1dFNvdXJjZU1hcFBhdGgsIG9iZnVzY2F0aW9uUmVzdWx0LmdldFNvdXJjZU1hcCgpKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==
"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

Object.defineProperty(exports, "__esModule", { value: true });

var NodeAppender = function () {
    function NodeAppender() {
        _classCallCheck(this, NodeAppender);
    }

    _createClass(NodeAppender, null, [{
        key: "appendNode",
        value: function appendNode(blockScopeNode, nodeBodyStatements) {
            if (!NodeAppender.validateBodyStatements(nodeBodyStatements)) {
                nodeBodyStatements = [];
            }
            nodeBodyStatements = NodeAppender.parentizeBodyStatementsBeforeAppend(blockScopeNode, nodeBodyStatements);
            blockScopeNode.body = [].concat(_toConsumableArray(blockScopeNode.body), _toConsumableArray(nodeBodyStatements));
        }
    }, {
        key: "appendNodeToOptimalBlockScope",
        value: function appendNodeToOptimalBlockScope(blockScopeStackTraceData, blockScopeNode, nodeBodyStatements) {
            var index = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;

            var targetBlockScope = void 0;
            if (!blockScopeStackTraceData.length) {
                targetBlockScope = blockScopeNode;
            } else {
                targetBlockScope = NodeAppender.getOptimalBlockScope(blockScopeStackTraceData, index);
            }
            NodeAppender.prependNode(targetBlockScope, nodeBodyStatements);
        }
    }, {
        key: "getOptimalBlockScope",
        value: function getOptimalBlockScope(blockScopeTraceData, index) {
            var deep = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : Infinity;

            var firstCall = blockScopeTraceData[index];
            if (deep <= 0) {
                throw new Error("Invalid `deep` argument value. Value should be bigger then 0.");
            }
            if (deep > 1 && firstCall.stackTrace.length) {
                return NodeAppender.getOptimalBlockScope(firstCall.stackTrace, 0, --deep);
            } else {
                return firstCall.callee;
            }
        }
    }, {
        key: "insertNodeAtIndex",
        value: function insertNodeAtIndex(blockScopeNode, nodeBodyStatements, index) {
            if (!NodeAppender.validateBodyStatements(nodeBodyStatements)) {
                nodeBodyStatements = [];
            }
            nodeBodyStatements = NodeAppender.parentizeBodyStatementsBeforeAppend(blockScopeNode, nodeBodyStatements);
            blockScopeNode.body = [].concat(_toConsumableArray(blockScopeNode.body.slice(0, index)), _toConsumableArray(nodeBodyStatements), _toConsumableArray(blockScopeNode.body.slice(index)));
        }
    }, {
        key: "prependNode",
        value: function prependNode(blockScopeNode, nodeBodyStatements) {
            if (!NodeAppender.validateBodyStatements(nodeBodyStatements)) {
                nodeBodyStatements = [];
            }
            nodeBodyStatements = NodeAppender.parentizeBodyStatementsBeforeAppend(blockScopeNode, nodeBodyStatements);
            blockScopeNode.body = [].concat(_toConsumableArray(nodeBodyStatements), _toConsumableArray(blockScopeNode.body));
        }
    }, {
        key: "parentizeBodyStatementsBeforeAppend",
        value: function parentizeBodyStatementsBeforeAppend(blockScopeNode, nodeBodyStatements) {
            nodeBodyStatements.forEach(function (statement) {
                statement.parentNode = blockScopeNode;
            });
            return nodeBodyStatements;
        }
    }, {
        key: "validateBodyStatements",
        value: function validateBodyStatements(nodeBodyStatements) {
            return nodeBodyStatements.every(function (statementNode) {
                return !!statementNode && statementNode.hasOwnProperty('type');
            });
        }
    }]);

    return NodeAppender;
}();

exports.NodeAppender = NodeAppender;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTm9kZUFwcGVuZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL25vZGUvTm9kZUFwcGVuZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O3NEQXdCQTs7SUFLVyxBQUFNLEFBQUMsQUFBVTs7Ozs7OzttQ0FDcEIsQUFBdUMsZ0JBQ3ZDLEFBQWdDO0FBRWhDLEFBQUUsQUFBQyxnQkFBQyxDQUFDLEFBQVksYUFBQyxBQUFzQix1QkFBQyxBQUFrQixBQUFDLEFBQUMscUJBQUMsQUFBQztBQUMzRCxBQUFrQixxQ0FBRyxBQUFFLEFBQUMsQUFDNUI7QUFBQztBQUVELEFBQWtCLGlDQUFHLEFBQVksYUFBQyxBQUFtQyxvQ0FBQyxBQUFjLGdCQUFFLEFBQWtCLEFBQUMsQUFBQztBQUUxRyxBQUFjLDJCQUFDLEFBQUksQUFBRyxBQUNsQixvQ0FBRyxBQUFjLGVBQUMsQUFBSSxBQUN0QiwwQkFBRyxBQUFrQixBQUN4QixBQUFDLEFBQ047QUFBQyxBQVFNLEFBQU0sQUFBQyxBQUE2Qjs7O3NEQUN2QyxBQUEyQywwQkFDM0MsQUFBdUMsZ0JBQ3ZDLEFBQWdDO2dCQUNoQyw0RUFBZ0IsQUFBQzs7QUFFakIsZ0JBQUksQUFBeUMsQUFBQztBQUU5QyxBQUFFLEFBQUMsZ0JBQUMsQ0FBQyxBQUF3Qix5QkFBQyxBQUFNLEFBQUMsUUFBQyxBQUFDO0FBQ25DLEFBQWdCLG1DQUFHLEFBQWMsQUFBQyxBQUN0QztBQUFDLEFBQUMsQUFBSSxtQkFBQyxBQUFDO0FBQ0osQUFBZ0IsbUNBQUcsQUFBWSxhQUFDLEFBQW9CLHFCQUNoRCxBQUF3QiwwQkFDeEIsQUFBSyxBQUNSLEFBQUMsQUFDTjtBQUFDO0FBRUQsQUFBWSx5QkFBQyxBQUFXLFlBQUMsQUFBZ0Isa0JBQUUsQUFBa0IsQUFBQyxBQUFDLEFBQ25FO0FBQUMsQUFVTSxBQUFNLEFBQUMsQUFBb0I7Ozs2Q0FDOUIsQUFBc0MscUJBQ3RDLEFBQWE7Z0JBQ2IsMkVBQWUsQUFBUTs7QUFFdkIsZ0JBQU0sQUFBUyxZQUFvQixBQUFtQixvQkFBQyxBQUFLLEFBQUMsQUFBQztBQUU5RCxBQUFFLEFBQUMsZ0JBQUMsQUFBSSxRQUFJLEFBQUMsQUFBQyxHQUFDLEFBQUM7QUFDWixzQkFBTSxJQUFJLEFBQUssQUFBQyxBQUFpRSxBQUFDLEFBQUMsQUFDdkY7QUFBQztBQUVELEFBQUUsQUFBQyxnQkFBQyxBQUFJLE9BQUcsQUFBQyxLQUFJLEFBQVMsVUFBQyxBQUFVLFdBQUMsQUFBTSxBQUFDLFFBQUMsQUFBQztBQUMxQyxBQUFNLHVCQUFDLEFBQVksYUFBQyxBQUFvQixxQkFBQyxBQUFTLFVBQUMsQUFBVSxZQUFFLEFBQUMsR0FBRSxFQUFFLEFBQUksQUFBQyxBQUFDLEFBQzlFO0FBQUMsQUFBQyxBQUFJLG1CQUFDLEFBQUM7QUFDSixBQUFNLHVCQUFDLEFBQVMsVUFBQyxBQUFNLEFBQUMsQUFDNUI7QUFBQyxBQUNMO0FBQUMsQUFPTSxBQUFNLEFBQUMsQUFBaUI7OzswQ0FDM0IsQUFBdUMsZ0JBQ3ZDLEFBQWdDLG9CQUNoQyxBQUFhO0FBRWIsQUFBRSxBQUFDLGdCQUFDLENBQUMsQUFBWSxhQUFDLEFBQXNCLHVCQUFDLEFBQWtCLEFBQUMsQUFBQyxxQkFBQyxBQUFDO0FBQzNELEFBQWtCLHFDQUFHLEFBQUUsQUFBQyxBQUM1QjtBQUFDO0FBRUQsQUFBa0IsaUNBQUcsQUFBWSxhQUFDLEFBQW1DLG9DQUFDLEFBQWMsZ0JBQUUsQUFBa0IsQUFBQyxBQUFDO0FBRTFHLEFBQWMsMkJBQUMsQUFBSSxBQUFHLEFBQ2xCLG9DQUFHLEFBQWMsZUFBQyxBQUFJLEtBQUMsQUFBSyxNQUFDLEFBQUMsR0FBRSxBQUFLLEFBQUMsQUFDdEMsNEJBQUcsQUFBa0IsQUFDckIsd0NBQUcsQUFBYyxlQUFDLEFBQUksS0FBQyxBQUFLLE1BQUMsQUFBSyxBQUFDLEFBQ3RDLEFBQUMsQUFDTjtBQUFDLEFBTU0sQUFBTSxBQUFDLEFBQVc7OztvQ0FDckIsQUFBdUMsZ0JBQ3ZDLEFBQWdDO0FBRWhDLEFBQUUsQUFBQyxnQkFBQyxDQUFDLEFBQVksYUFBQyxBQUFzQix1QkFBQyxBQUFrQixBQUFDLEFBQUMscUJBQUMsQUFBQztBQUMzRCxBQUFrQixxQ0FBRyxBQUFFLEFBQUMsQUFDNUI7QUFBQztBQUVELEFBQWtCLGlDQUFHLEFBQVksYUFBQyxBQUFtQyxvQ0FBQyxBQUFjLGdCQUFFLEFBQWtCLEFBQUMsQUFBQztBQUUxRyxBQUFjLDJCQUFDLEFBQUksQUFBRyxBQUNsQixvQ0FBRyxBQUFrQixBQUNyQix3Q0FBRyxBQUFjLGVBQUMsQUFBSSxBQUN6QixBQUFDLEFBQ047QUFBQyxBQU9PLEFBQU0sQUFBQyxBQUFtQzs7OzREQUM5QyxBQUF1QyxnQkFDdkMsQUFBZ0M7QUFFaEMsQUFBa0IsK0JBQUMsQUFBTyxRQUFDLFVBQUMsQUFBcUI7QUFDN0MsQUFBUywwQkFBQyxBQUFVLGFBQUcsQUFBYyxBQUFDLEFBQzFDO0FBQUMsQUFBQyxBQUFDO0FBRUgsQUFBTSxtQkFBQyxBQUFrQixBQUFDLEFBQzlCO0FBQUMsQUFNTyxBQUFNLEFBQUMsQUFBc0I7OzsrQ0FBRSxBQUFnQztBQUNuRSxBQUFNLHNDQUFvQixBQUFLLE1BQUMsVUFBQyxBQUF5QjtBQUN0RCxBQUFNLHVCQUFDLENBQUMsQ0FBQyxBQUFhLGlCQUFJLEFBQWEsY0FBQyxBQUFjLGVBQUMsQUFBTSxBQUFDLEFBQUMsQUFDbkU7QUFBQyxBQUFDLEFBQUMsQUFDUCxhQUhXLEFBQWtCO0FBRzVCLEFBQ0o7Ozs7OztBQTdJRCx1QkE2SUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBFU1RyZWUgZnJvbSAnZXN0cmVlJztcblxuaW1wb3J0IHsgVE5vZGVXaXRoQmxvY2tTdGF0ZW1lbnQgfSBmcm9tICcuLi90eXBlcy9ub2RlL1ROb2RlV2l0aEJsb2NrU3RhdGVtZW50JztcbmltcG9ydCB7IFRTdGF0ZW1lbnQgfSBmcm9tICcuLi90eXBlcy9ub2RlL1RTdGF0ZW1lbnQnO1xuXG5pbXBvcnQgeyBJU3RhY2tUcmFjZURhdGEgfSBmcm9tICcuLi9pbnRlcmZhY2VzL3N0YWNrLXRyYWNlLWFuYWx5emVyL0lTdGFja1RyYWNlRGF0YSc7XG5cbi8qKlxuICogVGhpcyBjbGFzcyBhcHBlbmRzIG5vZGUgaW50byBhIGZpcnN0IGRlZXBlc3QgQmxvY2tTdGF0ZW1lbnQgaW4gb3JkZXIgb2YgZnVuY3Rpb24gY2FsbHNcbiAqXG4gKiBGb3IgZXhhbXBsZTpcbiAqXG4gKiBmdW5jdGlvbiBGb28gKCkge1xuICogICAgIHZhciBiYXogPSBmdW5jdGlvbiAoKSB7XG4gKlxuICogICAgIH1cbiAqXG4gKiAgICAgYmF6KCk7XG4gKiB9XG4gKlxuICogZm9vKCk7XG4gKlxuICogQXBwZW5kcyBub2RlIGludG8gYmxvY2sgc3RhdGVtZW50IG9mIGBiYXpgIGZ1bmN0aW9uIGV4cHJlc3Npb24uXG4gKi9cbmV4cG9ydCBjbGFzcyBOb2RlQXBwZW5kZXIge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7VE5vZGVXaXRoQmxvY2tTdGF0ZW1lbnR9IGJsb2NrU2NvcGVOb2RlXG4gICAgICogQHBhcmFtIHtUU3RhdGVtZW50W119IG5vZGVCb2R5U3RhdGVtZW50c1xuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgYXBwZW5kTm9kZSAoXG4gICAgICAgIGJsb2NrU2NvcGVOb2RlOiBUTm9kZVdpdGhCbG9ja1N0YXRlbWVudCxcbiAgICAgICAgbm9kZUJvZHlTdGF0ZW1lbnRzOiBUU3RhdGVtZW50W11cbiAgICApOiB2b2lkIHtcbiAgICAgICAgaWYgKCFOb2RlQXBwZW5kZXIudmFsaWRhdGVCb2R5U3RhdGVtZW50cyhub2RlQm9keVN0YXRlbWVudHMpKSB7XG4gICAgICAgICAgICBub2RlQm9keVN0YXRlbWVudHMgPSBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIG5vZGVCb2R5U3RhdGVtZW50cyA9IE5vZGVBcHBlbmRlci5wYXJlbnRpemVCb2R5U3RhdGVtZW50c0JlZm9yZUFwcGVuZChibG9ja1Njb3BlTm9kZSwgbm9kZUJvZHlTdGF0ZW1lbnRzKTtcblxuICAgICAgICBibG9ja1Njb3BlTm9kZS5ib2R5ID0gW1xuICAgICAgICAgICAgLi4uYmxvY2tTY29wZU5vZGUuYm9keSxcbiAgICAgICAgICAgIC4uLm5vZGVCb2R5U3RhdGVtZW50c1xuICAgICAgICBdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7SVN0YWNrVHJhY2VEYXRhW119IGJsb2NrU2NvcGVTdGFja1RyYWNlRGF0YVxuICAgICAqIEBwYXJhbSB7VE5vZGVXaXRoQmxvY2tTdGF0ZW1lbnR9IGJsb2NrU2NvcGVOb2RlXG4gICAgICogQHBhcmFtIHtUU3RhdGVtZW50W119IG5vZGVCb2R5U3RhdGVtZW50c1xuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleFxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgYXBwZW5kTm9kZVRvT3B0aW1hbEJsb2NrU2NvcGUgKFxuICAgICAgICBibG9ja1Njb3BlU3RhY2tUcmFjZURhdGE6IElTdGFja1RyYWNlRGF0YVtdLFxuICAgICAgICBibG9ja1Njb3BlTm9kZTogVE5vZGVXaXRoQmxvY2tTdGF0ZW1lbnQsXG4gICAgICAgIG5vZGVCb2R5U3RhdGVtZW50czogVFN0YXRlbWVudFtdLFxuICAgICAgICBpbmRleDogbnVtYmVyID0gMFxuICAgICk6IHZvaWQge1xuICAgICAgICBsZXQgdGFyZ2V0QmxvY2tTY29wZTogVE5vZGVXaXRoQmxvY2tTdGF0ZW1lbnQ7XG5cbiAgICAgICAgaWYgKCFibG9ja1Njb3BlU3RhY2tUcmFjZURhdGEubGVuZ3RoKSB7XG4gICAgICAgICAgICB0YXJnZXRCbG9ja1Njb3BlID0gYmxvY2tTY29wZU5vZGU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0YXJnZXRCbG9ja1Njb3BlID0gTm9kZUFwcGVuZGVyLmdldE9wdGltYWxCbG9ja1Njb3BlKFxuICAgICAgICAgICAgICAgIGJsb2NrU2NvcGVTdGFja1RyYWNlRGF0YSxcbiAgICAgICAgICAgICAgICBpbmRleFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIE5vZGVBcHBlbmRlci5wcmVwZW5kTm9kZSh0YXJnZXRCbG9ja1Njb3BlLCBub2RlQm9keVN0YXRlbWVudHMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgZGVlcGVzdCBibG9jayBzY29wZSBub2RlIGF0IGdpdmVuIGRlZXAuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0lTdGFja1RyYWNlRGF0YVtdfSBibG9ja1Njb3BlVHJhY2VEYXRhXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGluZGV4XG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGRlZXBcbiAgICAgKiBAcmV0dXJucyB7QmxvY2tTdGF0ZW1lbnR9XG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBnZXRPcHRpbWFsQmxvY2tTY29wZSAoXG4gICAgICAgIGJsb2NrU2NvcGVUcmFjZURhdGE6IElTdGFja1RyYWNlRGF0YVtdLFxuICAgICAgICBpbmRleDogbnVtYmVyLFxuICAgICAgICBkZWVwOiBudW1iZXIgPSBJbmZpbml0eVxuICAgICk6IEVTVHJlZS5CbG9ja1N0YXRlbWVudCB7XG4gICAgICAgIGNvbnN0IGZpcnN0Q2FsbDogSVN0YWNrVHJhY2VEYXRhID0gYmxvY2tTY29wZVRyYWNlRGF0YVtpbmRleF07XG5cbiAgICAgICAgaWYgKGRlZXAgPD0gMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIFxcYGRlZXBcXGAgYXJndW1lbnQgdmFsdWUuIFZhbHVlIHNob3VsZCBiZSBiaWdnZXIgdGhlbiAwLmApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRlZXAgPiAxICYmIGZpcnN0Q2FsbC5zdGFja1RyYWNlLmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIE5vZGVBcHBlbmRlci5nZXRPcHRpbWFsQmxvY2tTY29wZShmaXJzdENhbGwuc3RhY2tUcmFjZSwgMCwgLS1kZWVwKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmaXJzdENhbGwuY2FsbGVlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtUTm9kZVdpdGhCbG9ja1N0YXRlbWVudH0gYmxvY2tTY29wZU5vZGVcbiAgICAgKiBAcGFyYW0ge1RTdGF0ZW1lbnRbXX0gbm9kZUJvZHlTdGF0ZW1lbnRzXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGluZGV4XG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBpbnNlcnROb2RlQXRJbmRleCAoXG4gICAgICAgIGJsb2NrU2NvcGVOb2RlOiBUTm9kZVdpdGhCbG9ja1N0YXRlbWVudCxcbiAgICAgICAgbm9kZUJvZHlTdGF0ZW1lbnRzOiBUU3RhdGVtZW50W10sXG4gICAgICAgIGluZGV4OiBudW1iZXJcbiAgICApOiB2b2lkIHtcbiAgICAgICAgaWYgKCFOb2RlQXBwZW5kZXIudmFsaWRhdGVCb2R5U3RhdGVtZW50cyhub2RlQm9keVN0YXRlbWVudHMpKSB7XG4gICAgICAgICAgICBub2RlQm9keVN0YXRlbWVudHMgPSBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIG5vZGVCb2R5U3RhdGVtZW50cyA9IE5vZGVBcHBlbmRlci5wYXJlbnRpemVCb2R5U3RhdGVtZW50c0JlZm9yZUFwcGVuZChibG9ja1Njb3BlTm9kZSwgbm9kZUJvZHlTdGF0ZW1lbnRzKTtcblxuICAgICAgICBibG9ja1Njb3BlTm9kZS5ib2R5ID0gW1xuICAgICAgICAgICAgLi4uYmxvY2tTY29wZU5vZGUuYm9keS5zbGljZSgwLCBpbmRleCksXG4gICAgICAgICAgICAuLi5ub2RlQm9keVN0YXRlbWVudHMsXG4gICAgICAgICAgICAuLi5ibG9ja1Njb3BlTm9kZS5ib2R5LnNsaWNlKGluZGV4KVxuICAgICAgICBdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7VE5vZGVXaXRoQmxvY2tTdGF0ZW1lbnR9IGJsb2NrU2NvcGVOb2RlXG4gICAgICogQHBhcmFtIHtUU3RhdGVtZW50W119IG5vZGVCb2R5U3RhdGVtZW50c1xuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgcHJlcGVuZE5vZGUgKFxuICAgICAgICBibG9ja1Njb3BlTm9kZTogVE5vZGVXaXRoQmxvY2tTdGF0ZW1lbnQsXG4gICAgICAgIG5vZGVCb2R5U3RhdGVtZW50czogVFN0YXRlbWVudFtdXG4gICAgKTogdm9pZCB7XG4gICAgICAgIGlmICghTm9kZUFwcGVuZGVyLnZhbGlkYXRlQm9keVN0YXRlbWVudHMobm9kZUJvZHlTdGF0ZW1lbnRzKSkge1xuICAgICAgICAgICAgbm9kZUJvZHlTdGF0ZW1lbnRzID0gW107XG4gICAgICAgIH1cblxuICAgICAgICBub2RlQm9keVN0YXRlbWVudHMgPSBOb2RlQXBwZW5kZXIucGFyZW50aXplQm9keVN0YXRlbWVudHNCZWZvcmVBcHBlbmQoYmxvY2tTY29wZU5vZGUsIG5vZGVCb2R5U3RhdGVtZW50cyk7XG5cbiAgICAgICAgYmxvY2tTY29wZU5vZGUuYm9keSA9IFtcbiAgICAgICAgICAgIC4uLm5vZGVCb2R5U3RhdGVtZW50cyxcbiAgICAgICAgICAgIC4uLmJsb2NrU2NvcGVOb2RlLmJvZHksXG4gICAgICAgIF07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtUTm9kZVdpdGhCbG9ja1N0YXRlbWVudH0gYmxvY2tTY29wZU5vZGVcbiAgICAgKiBAcGFyYW0ge1RTdGF0ZW1lbnRbXX0gbm9kZUJvZHlTdGF0ZW1lbnRzXG4gICAgICogQHJldHVybnMge1RTdGF0ZW1lbnRbXX1cbiAgICAgKi9cbiAgICBwcml2YXRlIHN0YXRpYyBwYXJlbnRpemVCb2R5U3RhdGVtZW50c0JlZm9yZUFwcGVuZCAoXG4gICAgICAgIGJsb2NrU2NvcGVOb2RlOiBUTm9kZVdpdGhCbG9ja1N0YXRlbWVudCxcbiAgICAgICAgbm9kZUJvZHlTdGF0ZW1lbnRzOiBUU3RhdGVtZW50W11cbiAgICApOiBUU3RhdGVtZW50W10ge1xuICAgICAgICBub2RlQm9keVN0YXRlbWVudHMuZm9yRWFjaCgoc3RhdGVtZW50OiBUU3RhdGVtZW50KSA9PiB7XG4gICAgICAgICAgICBzdGF0ZW1lbnQucGFyZW50Tm9kZSA9IGJsb2NrU2NvcGVOb2RlO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gbm9kZUJvZHlTdGF0ZW1lbnRzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7VFN0YXRlbWVudFtdfSBub2RlQm9keVN0YXRlbWVudHNcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBwcml2YXRlIHN0YXRpYyB2YWxpZGF0ZUJvZHlTdGF0ZW1lbnRzIChub2RlQm9keVN0YXRlbWVudHM6IFRTdGF0ZW1lbnRbXSk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gbm9kZUJvZHlTdGF0ZW1lbnRzLmV2ZXJ5KChzdGF0ZW1lbnROb2RlOiBUU3RhdGVtZW50KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gISFzdGF0ZW1lbnROb2RlICYmIHN0YXRlbWVudE5vZGUuaGFzT3duUHJvcGVydHkoJ3R5cGUnKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuIl19
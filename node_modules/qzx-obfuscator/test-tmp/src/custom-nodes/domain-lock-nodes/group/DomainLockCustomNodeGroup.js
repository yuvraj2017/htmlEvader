"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var inversify_1 = require("inversify");
var ServiceIdentifiers_1 = require("../../../container/ServiceIdentifiers");
var Initializable_1 = require("../../../decorators/Initializable");
var CustomNode_1 = require("../../../enums/container/custom-nodes/CustomNode");
var ObfuscationEvent_1 = require("../../../enums/event-emitters/ObfuscationEvent");
var AbstractCustomNodeGroup_1 = require("../../AbstractCustomNodeGroup");
var NodeAppender_1 = require("../../../node/NodeAppender");
var DomainLockCustomNodeGroup = function (_AbstractCustomNodeGr) {
    _inherits(DomainLockCustomNodeGroup, _AbstractCustomNodeGr);

    function DomainLockCustomNodeGroup(customNodeFactory, obfuscationEventEmitter, randomGenerator, options) {
        _classCallCheck(this, DomainLockCustomNodeGroup);

        var _this = _possibleConstructorReturn(this, (DomainLockCustomNodeGroup.__proto__ || Object.getPrototypeOf(DomainLockCustomNodeGroup)).call(this, randomGenerator, options));

        _this.appendEvent = ObfuscationEvent_1.ObfuscationEvent.BeforeObfuscation;
        _this.customNodeFactory = customNodeFactory;
        _this.obfuscationEventEmitter = obfuscationEventEmitter;
        return _this;
    }

    _createClass(DomainLockCustomNodeGroup, [{
        key: "appendCustomNodes",
        value: function appendCustomNodes(blockScopeNode, stackTraceData) {
            var randomStackTraceIndex = this.getRandomStackTraceIndex(stackTraceData.length);
            this.appendCustomNodeIfExist(CustomNode_1.CustomNode.DomainLockNode, function (customNode) {
                NodeAppender_1.NodeAppender.appendNodeToOptimalBlockScope(stackTraceData, blockScopeNode, customNode.getNode(), randomStackTraceIndex);
            });
            this.appendCustomNodeIfExist(CustomNode_1.CustomNode.NodeCallsControllerFunctionNode, function (customNode) {
                var targetBlockScope = void 0;
                if (stackTraceData.length) {
                    targetBlockScope = NodeAppender_1.NodeAppender.getOptimalBlockScope(stackTraceData, randomStackTraceIndex, 1);
                } else {
                    targetBlockScope = blockScopeNode;
                }
                NodeAppender_1.NodeAppender.prependNode(targetBlockScope, customNode.getNode());
            });
        }
    }, {
        key: "initialize",
        value: function initialize() {
            this.customNodes = new Map();
            if (!this.options.domainLock.length) {
                return;
            }
            var callsControllerFunctionName = this.randomGenerator.getRandomVariableName(6);
            var domainLockNode = this.customNodeFactory(CustomNode_1.CustomNode.DomainLockNode);
            var nodeCallsControllerFunctionNode = this.customNodeFactory(CustomNode_1.CustomNode.NodeCallsControllerFunctionNode);
            domainLockNode.initialize(callsControllerFunctionName);
            nodeCallsControllerFunctionNode.initialize(this.appendEvent, callsControllerFunctionName);
            this.customNodes.set(CustomNode_1.CustomNode.DomainLockNode, domainLockNode);
            this.customNodes.set(CustomNode_1.CustomNode.NodeCallsControllerFunctionNode, nodeCallsControllerFunctionNode);
        }
    }]);

    return DomainLockCustomNodeGroup;
}(AbstractCustomNodeGroup_1.AbstractCustomNodeGroup);
tslib_1.__decorate([Initializable_1.initializable(), tslib_1.__metadata("design:type", Map)], DomainLockCustomNodeGroup.prototype, "customNodes", void 0);
DomainLockCustomNodeGroup = tslib_1.__decorate([inversify_1.injectable(), tslib_1.__param(0, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.Factory__ICustomNode)), tslib_1.__param(1, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.IObfuscationEventEmitter)), tslib_1.__param(2, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.IRandomGenerator)), tslib_1.__param(3, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.IOptions)), tslib_1.__metadata("design:paramtypes", [Function, Object, Object, Object])], DomainLockCustomNodeGroup);
exports.DomainLockCustomNodeGroup = DomainLockCustomNodeGroup;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRG9tYWluTG9ja0N1c3RvbU5vZGVHcm91cC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9jdXN0b20tbm9kZXMvZG9tYWluLWxvY2stbm9kZXMvZ3JvdXAvRG9tYWluTG9ja0N1c3RvbU5vZGVHcm91cC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQSwwQkFBK0M7QUFDL0MsbUNBQTJFO0FBVzNFLDhCQUFrRTtBQUVsRSwyQkFBOEU7QUFDOUUsaUNBQWtGO0FBRWxGLHdDQUF3RTtBQUN4RSw2QkFBMEQ7QUFHMUQ7QUFBQSxBQUFhLEFBQXlCLEFBQUM7O0FBNEJuQyx1Q0FDcUQsQUFBcUMsbUJBQ2pDLEFBQWlELHlCQUN6RCxBQUFpQyxpQkFDekMsQUFBaUI7QUFFdEQsQUFBSzs7MEpBQUMsQUFBZSxpQkFBRSxBQUFPLEFBQUMsQUFBQzs7QUE5QmpCLGNBQVcsY0FBcUIsbUJBQWdCLGlCQUFDLEFBQWlCLEFBQUM7QUFnQ2xGLEFBQUksY0FBQyxBQUFpQixvQkFBRyxBQUFpQixBQUFDO0FBQzNDLEFBQUksY0FBQyxBQUF1QiwwQkFBRyxBQUF1QixBQUFDLEFBQzNEOztBQUFDLEFBTU0sQUFBaUI7Ozs7MENBQUUsQUFBdUMsZ0JBQUUsQUFBaUM7QUFDaEcsZ0JBQU0sQUFBcUIsd0JBQVcsQUFBSSxLQUFDLEFBQXdCLHlCQUFDLEFBQWMsZUFBQyxBQUFNLEFBQUMsQUFBQztBQUczRixBQUFJLGlCQUFDLEFBQXVCLHdCQUFDLGFBQVUsV0FBQyxBQUFjLGdCQUFFLFVBQUMsQUFBdUI7QUFDNUUsK0JBQVksYUFBQyxBQUE2Qiw4QkFDdEMsQUFBYyxnQkFDZCxBQUFjLGdCQUNkLEFBQVUsV0FBQyxBQUFPLEFBQUUsV0FDcEIsQUFBcUIsQUFDeEIsQUFBQyxBQUNOO0FBQUMsQUFBQyxBQUFDO0FBR0gsQUFBSSxpQkFBQyxBQUF1Qix3QkFBQyxhQUFVLFdBQUMsQUFBK0IsaUNBQUUsVUFBQyxBQUF1QjtBQUM3RixvQkFBSSxBQUF5QyxBQUFDO0FBRTlDLEFBQUUsQUFBQyxvQkFBQyxBQUFjLGVBQUMsQUFBTSxBQUFDLFFBQUMsQUFBQztBQUN4QixBQUFnQix1Q0FBRyxlQUFZLGFBQUMsQUFBb0IscUJBQUMsQUFBYyxnQkFBRSxBQUFxQix1QkFBRSxBQUFDLEFBQUMsQUFBQyxBQUNuRztBQUFDLEFBQUMsQUFBSSx1QkFBQyxBQUFDO0FBQ0osQUFBZ0IsdUNBQUcsQUFBYyxBQUFDLEFBQ3RDO0FBQUM7QUFFRCwrQkFBWSxhQUFDLEFBQVcsWUFBQyxBQUFnQixrQkFBRSxBQUFVLFdBQUMsQUFBTyxBQUFFLEFBQUMsQUFBQyxBQUNyRTtBQUFDLEFBQUMsQUFBQyxBQUNQO0FBQUMsQUFFTSxBQUFVOzs7O0FBQ2IsQUFBSSxpQkFBQyxBQUFXLGNBQUcsSUFBSSxBQUFHLEFBQTRCLEFBQUM7QUFFdkQsQUFBRSxBQUFDLGdCQUFDLENBQUMsQUFBSSxLQUFDLEFBQU8sUUFBQyxBQUFVLFdBQUMsQUFBTSxBQUFDLFFBQUMsQUFBQztBQUNsQyxBQUFNLEFBQUMsQUFDWDtBQUFDO0FBRUQsZ0JBQU0sQUFBMkIsOEJBQVcsQUFBSSxLQUFDLEFBQWUsZ0JBQUMsQUFBcUIsc0JBQUMsQUFBQyxBQUFDLEFBQUM7QUFFMUYsZ0JBQU0sQUFBYyxpQkFBZ0IsQUFBSSxLQUFDLEFBQWlCLGtCQUFDLGFBQVUsV0FBQyxBQUFjLEFBQUMsQUFBQztBQUN0RixnQkFBTSxBQUErQixrQ0FBZ0IsQUFBSSxLQUFDLEFBQWlCLGtCQUFDLGFBQVUsV0FBQyxBQUErQixBQUFDLEFBQUM7QUFFeEgsQUFBYywyQkFBQyxBQUFVLFdBQUMsQUFBMkIsQUFBQyxBQUFDO0FBQ3ZELEFBQStCLDRDQUFDLEFBQVUsV0FBQyxBQUFJLEtBQUMsQUFBVyxhQUFFLEFBQTJCLEFBQUMsQUFBQztBQUUxRixBQUFJLGlCQUFDLEFBQVcsWUFBQyxBQUFHLElBQUMsYUFBVSxXQUFDLEFBQWMsZ0JBQUUsQUFBYyxBQUFDLEFBQUM7QUFDaEUsQUFBSSxpQkFBQyxBQUFXLFlBQUMsQUFBRyxJQUFDLGFBQVUsV0FBQyxBQUErQixpQ0FBRSxBQUErQixBQUFDLEFBQUMsQUFDdEc7QUFBQyxBQUNKOzs7O0VBekY4QywwQkFBdUI7QUFVbEUsb0JBREMsZ0JBQWEsQUFBRSxtREFDTyxBQUFHLGdFQUEyQjtBQVY1QyxBQUF5QixnREFEckMsWUFBVSxBQUFFLGNBOEJKLG1CQUFBLFlBQU0sT0FBQyxxQkFBa0IsbUJBQUMsQUFBb0IsQUFBQyx3QkFDL0MsbUJBQUEsWUFBTSxPQUFDLHFCQUFrQixtQkFBQyxBQUF3QixBQUFDLDRCQUNuRCxtQkFBQSxZQUFNLE9BQUMscUJBQWtCLG1CQUFDLEFBQWdCLEFBQUMsb0JBQzNDLG1CQUFBLFlBQU0sT0FBQyxxQkFBa0IsbUJBQUMsQUFBUSxBQUFDLDBGQWhDL0IsQUFBeUIsQUF5RnJDO0FBekZZLG9DQUF5QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGluamVjdGFibGUsIGluamVjdCB9IGZyb20gJ2ludmVyc2lmeSc7XG5pbXBvcnQgeyBTZXJ2aWNlSWRlbnRpZmllcnMgfSBmcm9tICcuLi8uLi8uLi9jb250YWluZXIvU2VydmljZUlkZW50aWZpZXJzJztcblxuaW1wb3J0IHsgVEN1c3RvbU5vZGVGYWN0b3J5IH0gZnJvbSAnLi4vLi4vLi4vdHlwZXMvY29udGFpbmVyL2N1c3RvbS1ub2Rlcy9UQ3VzdG9tTm9kZUZhY3RvcnknO1xuaW1wb3J0IHsgVE5vZGVXaXRoQmxvY2tTdGF0ZW1lbnQgfSBmcm9tICcuLi8uLi8uLi90eXBlcy9ub2RlL1ROb2RlV2l0aEJsb2NrU3RhdGVtZW50JztcblxuaW1wb3J0IHsgSUN1c3RvbU5vZGUgfSBmcm9tICcuLi8uLi8uLi9pbnRlcmZhY2VzL2N1c3RvbS1ub2Rlcy9JQ3VzdG9tTm9kZSc7XG5pbXBvcnQgeyBJT2JmdXNjYXRpb25FdmVudEVtaXR0ZXIgfSBmcm9tICcuLi8uLi8uLi9pbnRlcmZhY2VzL2V2ZW50LWVtaXR0ZXJzL0lPYmZ1c2NhdGlvbkV2ZW50RW1pdHRlcic7XG5pbXBvcnQgeyBJT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uL2ludGVyZmFjZXMvb3B0aW9ucy9JT3B0aW9ucyc7XG5pbXBvcnQgeyBJUmFuZG9tR2VuZXJhdG9yIH0gZnJvbSAnLi4vLi4vLi4vaW50ZXJmYWNlcy91dGlscy9JUmFuZG9tR2VuZXJhdG9yJztcbmltcG9ydCB7IElTdGFja1RyYWNlRGF0YSB9IGZyb20gJy4uLy4uLy4uL2ludGVyZmFjZXMvc3RhY2stdHJhY2UtYW5hbHl6ZXIvSVN0YWNrVHJhY2VEYXRhJztcblxuaW1wb3J0IHsgaW5pdGlhbGl6YWJsZSB9IGZyb20gJy4uLy4uLy4uL2RlY29yYXRvcnMvSW5pdGlhbGl6YWJsZSc7XG5cbmltcG9ydCB7IEN1c3RvbU5vZGUgfSBmcm9tICcuLi8uLi8uLi9lbnVtcy9jb250YWluZXIvY3VzdG9tLW5vZGVzL0N1c3RvbU5vZGUnO1xuaW1wb3J0IHsgT2JmdXNjYXRpb25FdmVudCB9IGZyb20gJy4uLy4uLy4uL2VudW1zL2V2ZW50LWVtaXR0ZXJzL09iZnVzY2F0aW9uRXZlbnQnO1xuXG5pbXBvcnQgeyBBYnN0cmFjdEN1c3RvbU5vZGVHcm91cCB9IGZyb20gJy4uLy4uL0Fic3RyYWN0Q3VzdG9tTm9kZUdyb3VwJztcbmltcG9ydCB7IE5vZGVBcHBlbmRlciB9IGZyb20gJy4uLy4uLy4uL25vZGUvTm9kZUFwcGVuZGVyJztcblxuQGluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIERvbWFpbkxvY2tDdXN0b21Ob2RlR3JvdXAgZXh0ZW5kcyBBYnN0cmFjdEN1c3RvbU5vZGVHcm91cCB7XG4gICAgLyoqXG4gICAgICogQHR5cGUge09iZnVzY2F0aW9uRXZlbnR9XG4gICAgICovXG4gICAgcHJvdGVjdGVkIHJlYWRvbmx5IGFwcGVuZEV2ZW50OiBPYmZ1c2NhdGlvbkV2ZW50ID0gT2JmdXNjYXRpb25FdmVudC5CZWZvcmVPYmZ1c2NhdGlvbjtcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtNYXA8Q3VzdG9tTm9kZSwgSUN1c3RvbU5vZGU+fVxuICAgICAqL1xuICAgIEBpbml0aWFsaXphYmxlKClcbiAgICBwcm90ZWN0ZWQgY3VzdG9tTm9kZXM6IE1hcCA8Q3VzdG9tTm9kZSwgSUN1c3RvbU5vZGU+O1xuXG4gICAgLyoqXG4gICAgICogQHR5cGUge1RDdXN0b21Ob2RlRmFjdG9yeX1cbiAgICAgKi9cbiAgICBwcml2YXRlIHJlYWRvbmx5IGN1c3RvbU5vZGVGYWN0b3J5OiBUQ3VzdG9tTm9kZUZhY3Rvcnk7XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7SU9iZnVzY2F0aW9uRXZlbnRFbWl0dGVyfVxuICAgICAqL1xuICAgIHByaXZhdGUgcmVhZG9ubHkgb2JmdXNjYXRpb25FdmVudEVtaXR0ZXI6IElPYmZ1c2NhdGlvbkV2ZW50RW1pdHRlcjtcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7VEN1c3RvbU5vZGVGYWN0b3J5fSBjdXN0b21Ob2RlRmFjdG9yeVxuICAgICAqIEBwYXJhbSB7SU9iZnVzY2F0aW9uRXZlbnRFbWl0dGVyfSBvYmZ1c2NhdGlvbkV2ZW50RW1pdHRlclxuICAgICAqIEBwYXJhbSB7SVJhbmRvbUdlbmVyYXRvcn0gcmFuZG9tR2VuZXJhdG9yXG4gICAgICogQHBhcmFtIHtJT3B0aW9uc30gb3B0aW9uc1xuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yIChcbiAgICAgICAgQGluamVjdChTZXJ2aWNlSWRlbnRpZmllcnMuRmFjdG9yeV9fSUN1c3RvbU5vZGUpIGN1c3RvbU5vZGVGYWN0b3J5OiBUQ3VzdG9tTm9kZUZhY3RvcnksXG4gICAgICAgIEBpbmplY3QoU2VydmljZUlkZW50aWZpZXJzLklPYmZ1c2NhdGlvbkV2ZW50RW1pdHRlcikgb2JmdXNjYXRpb25FdmVudEVtaXR0ZXI6IElPYmZ1c2NhdGlvbkV2ZW50RW1pdHRlcixcbiAgICAgICAgQGluamVjdChTZXJ2aWNlSWRlbnRpZmllcnMuSVJhbmRvbUdlbmVyYXRvcikgcmFuZG9tR2VuZXJhdG9yOiBJUmFuZG9tR2VuZXJhdG9yLFxuICAgICAgICBAaW5qZWN0KFNlcnZpY2VJZGVudGlmaWVycy5JT3B0aW9ucykgb3B0aW9uczogSU9wdGlvbnNcbiAgICApIHtcbiAgICAgICAgc3VwZXIocmFuZG9tR2VuZXJhdG9yLCBvcHRpb25zKTtcblxuICAgICAgICB0aGlzLmN1c3RvbU5vZGVGYWN0b3J5ID0gY3VzdG9tTm9kZUZhY3Rvcnk7XG4gICAgICAgIHRoaXMub2JmdXNjYXRpb25FdmVudEVtaXR0ZXIgPSBvYmZ1c2NhdGlvbkV2ZW50RW1pdHRlcjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge1ROb2RlV2l0aEJsb2NrU3RhdGVtZW50fSBibG9ja1Njb3BlTm9kZVxuICAgICAqIEBwYXJhbSB7SVN0YWNrVHJhY2VEYXRhW119IHN0YWNrVHJhY2VEYXRhXG4gICAgICovXG4gICAgcHVibGljIGFwcGVuZEN1c3RvbU5vZGVzIChibG9ja1Njb3BlTm9kZTogVE5vZGVXaXRoQmxvY2tTdGF0ZW1lbnQsIHN0YWNrVHJhY2VEYXRhOiBJU3RhY2tUcmFjZURhdGFbXSk6IHZvaWQge1xuICAgICAgICBjb25zdCByYW5kb21TdGFja1RyYWNlSW5kZXg6IG51bWJlciA9IHRoaXMuZ2V0UmFuZG9tU3RhY2tUcmFjZUluZGV4KHN0YWNrVHJhY2VEYXRhLmxlbmd0aCk7XG5cbiAgICAgICAgLy8gZG9tYWluTG9ja05vZGUgYXBwZW5kXG4gICAgICAgIHRoaXMuYXBwZW5kQ3VzdG9tTm9kZUlmRXhpc3QoQ3VzdG9tTm9kZS5Eb21haW5Mb2NrTm9kZSwgKGN1c3RvbU5vZGU6IElDdXN0b21Ob2RlKSA9PiB7XG4gICAgICAgICAgICBOb2RlQXBwZW5kZXIuYXBwZW5kTm9kZVRvT3B0aW1hbEJsb2NrU2NvcGUoXG4gICAgICAgICAgICAgICAgc3RhY2tUcmFjZURhdGEsXG4gICAgICAgICAgICAgICAgYmxvY2tTY29wZU5vZGUsXG4gICAgICAgICAgICAgICAgY3VzdG9tTm9kZS5nZXROb2RlKCksXG4gICAgICAgICAgICAgICAgcmFuZG9tU3RhY2tUcmFjZUluZGV4XG4gICAgICAgICAgICApO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBub2RlQ2FsbHNDb250cm9sbGVyRnVuY3Rpb25Ob2RlIGFwcGVuZFxuICAgICAgICB0aGlzLmFwcGVuZEN1c3RvbU5vZGVJZkV4aXN0KEN1c3RvbU5vZGUuTm9kZUNhbGxzQ29udHJvbGxlckZ1bmN0aW9uTm9kZSwgKGN1c3RvbU5vZGU6IElDdXN0b21Ob2RlKSA9PiB7XG4gICAgICAgICAgICBsZXQgdGFyZ2V0QmxvY2tTY29wZTogVE5vZGVXaXRoQmxvY2tTdGF0ZW1lbnQ7XG5cbiAgICAgICAgICAgIGlmIChzdGFja1RyYWNlRGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRCbG9ja1Njb3BlID0gTm9kZUFwcGVuZGVyLmdldE9wdGltYWxCbG9ja1Njb3BlKHN0YWNrVHJhY2VEYXRhLCByYW5kb21TdGFja1RyYWNlSW5kZXgsIDEpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRCbG9ja1Njb3BlID0gYmxvY2tTY29wZU5vZGU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIE5vZGVBcHBlbmRlci5wcmVwZW5kTm9kZSh0YXJnZXRCbG9ja1Njb3BlLCBjdXN0b21Ob2RlLmdldE5vZGUoKSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBpbml0aWFsaXplICgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5jdXN0b21Ob2RlcyA9IG5ldyBNYXAgPEN1c3RvbU5vZGUsIElDdXN0b21Ob2RlPigpO1xuXG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zLmRvbWFpbkxvY2subGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjYWxsc0NvbnRyb2xsZXJGdW5jdGlvbk5hbWU6IHN0cmluZyA9IHRoaXMucmFuZG9tR2VuZXJhdG9yLmdldFJhbmRvbVZhcmlhYmxlTmFtZSg2KTtcblxuICAgICAgICBjb25zdCBkb21haW5Mb2NrTm9kZTogSUN1c3RvbU5vZGUgPSB0aGlzLmN1c3RvbU5vZGVGYWN0b3J5KEN1c3RvbU5vZGUuRG9tYWluTG9ja05vZGUpO1xuICAgICAgICBjb25zdCBub2RlQ2FsbHNDb250cm9sbGVyRnVuY3Rpb25Ob2RlOiBJQ3VzdG9tTm9kZSA9IHRoaXMuY3VzdG9tTm9kZUZhY3RvcnkoQ3VzdG9tTm9kZS5Ob2RlQ2FsbHNDb250cm9sbGVyRnVuY3Rpb25Ob2RlKTtcblxuICAgICAgICBkb21haW5Mb2NrTm9kZS5pbml0aWFsaXplKGNhbGxzQ29udHJvbGxlckZ1bmN0aW9uTmFtZSk7XG4gICAgICAgIG5vZGVDYWxsc0NvbnRyb2xsZXJGdW5jdGlvbk5vZGUuaW5pdGlhbGl6ZSh0aGlzLmFwcGVuZEV2ZW50LCBjYWxsc0NvbnRyb2xsZXJGdW5jdGlvbk5hbWUpO1xuXG4gICAgICAgIHRoaXMuY3VzdG9tTm9kZXMuc2V0KEN1c3RvbU5vZGUuRG9tYWluTG9ja05vZGUsIGRvbWFpbkxvY2tOb2RlKTtcbiAgICAgICAgdGhpcy5jdXN0b21Ob2Rlcy5zZXQoQ3VzdG9tTm9kZS5Ob2RlQ2FsbHNDb250cm9sbGVyRnVuY3Rpb25Ob2RlLCBub2RlQ2FsbHNDb250cm9sbGVyRnVuY3Rpb25Ob2RlKTtcbiAgICB9XG59XG4iXX0=
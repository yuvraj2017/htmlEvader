"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var inversify_1 = require("inversify");
var ServiceIdentifiers_1 = require("../../container/ServiceIdentifiers");
var format = require("string-template");
var Initializable_1 = require("../../decorators/Initializable");
var NoCustomNodes_1 = require("../../options/presets/NoCustomNodes");
var SelfDefendingTemplate_1 = require("../../templates/custom-nodes/self-defending-nodes/self-defending-unicode-node/SelfDefendingTemplate");
var AbstractCustomNode_1 = require("../AbstractCustomNode");
var JavaScriptObfuscator_1 = require("../../JavaScriptObfuscator");
var NodeUtils_1 = require("../../node/NodeUtils");
var SelfDefendingUnicodeNode = function (_AbstractCustomNode_) {
    _inherits(SelfDefendingUnicodeNode, _AbstractCustomNode_);

    function SelfDefendingUnicodeNode(randomGenerator, escapeSequenceEncoder, options) {
        _classCallCheck(this, SelfDefendingUnicodeNode);

        var _this = _possibleConstructorReturn(this, (SelfDefendingUnicodeNode.__proto__ || Object.getPrototypeOf(SelfDefendingUnicodeNode)).call(this, options));

        _this.randomGenerator = randomGenerator;
        _this.escapeSequenceEncoder = escapeSequenceEncoder;
        return _this;
    }

    _createClass(SelfDefendingUnicodeNode, [{
        key: "initialize",
        value: function initialize(callsControllerFunctionName) {
            this.callsControllerFunctionName = callsControllerFunctionName;
        }
    }, {
        key: "getNodeStructure",
        value: function getNodeStructure() {
            return NodeUtils_1.NodeUtils.convertCodeToStructure(this.getTemplate());
        }
    }, {
        key: "getTemplate",
        value: function getTemplate() {
            return JavaScriptObfuscator_1.JavaScriptObfuscator.obfuscate(format(SelfDefendingTemplate_1.SelfDefendingTemplate(this.escapeSequenceEncoder), {
                selfDefendingFunctionName: this.randomGenerator.getRandomVariableName(6),
                singleNodeCallControllerFunctionName: this.callsControllerFunctionName
            }), Object.assign({}, NoCustomNodes_1.NO_CUSTOM_NODES_PRESET, { seed: this.options.seed, unicodeEscapeSequence: true })).getObfuscatedCode();
        }
    }]);

    return SelfDefendingUnicodeNode;
}(AbstractCustomNode_1.AbstractCustomNode);
tslib_1.__decorate([Initializable_1.initializable(), tslib_1.__metadata("design:type", String)], SelfDefendingUnicodeNode.prototype, "callsControllerFunctionName", void 0);
SelfDefendingUnicodeNode = tslib_1.__decorate([inversify_1.injectable(), tslib_1.__param(0, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.IRandomGenerator)), tslib_1.__param(1, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.IEscapeSequenceEncoder)), tslib_1.__param(2, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.IOptions)), tslib_1.__metadata("design:paramtypes", [Object, Object, Object])], SelfDefendingUnicodeNode);
exports.SelfDefendingUnicodeNode = SelfDefendingUnicodeNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2VsZkRlZmVuZGluZ1VuaWNvZGVOb2RlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2N1c3RvbS1ub2Rlcy9zZWxmLWRlZmVuZGluZy1ub2Rlcy9TZWxmRGVmZW5kaW5nVW5pY29kZU5vZGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQUEsMEJBQStDO0FBQy9DLG1DQUF3RTtBQUV4RSxxQkFBMEM7QUFRMUMsOEJBQStEO0FBRS9ELDhCQUE2RTtBQUU3RSxzQ0FBNEk7QUFFNUksbUNBQTJEO0FBQzNELHFDQUFrRTtBQUNsRSwwQkFBaUQ7QUFHakQ7QUFBQSxBQUFhLEFBQXdCLEFBQUM7O0FBc0JsQyxzQ0FDaUQsQUFBaUMsaUJBQzNCLEFBQTZDLHVCQUMzRCxBQUFpQjtBQUV0RCxBQUFLOzt3SkFBQyxBQUFPLEFBQUMsQUFBQzs7QUFFZixBQUFJLGNBQUMsQUFBZSxrQkFBRyxBQUFlLEFBQUM7QUFDdkMsQUFBSSxjQUFDLEFBQXFCLHdCQUFHLEFBQXFCLEFBQUMsQUFDdkQ7O0FBQUMsQUFLTSxBQUFVOzs7O21DQUFFLEFBQW1DO0FBQ2xELEFBQUksaUJBQUMsQUFBMkIsOEJBQUcsQUFBMkIsQUFBQyxBQUNuRTtBQUFDLEFBS1MsQUFBZ0I7Ozs7QUFDdEIsQUFBTSxtQkFBQyxZQUFTLFVBQUMsQUFBc0IsdUJBQUMsQUFBSSxLQUFDLEFBQVcsQUFBRSxBQUFDLEFBQUMsQUFDaEU7QUFBQyxBQUtTLEFBQVc7Ozs7QUFDakIsQUFBTSwwQ0FBcUIscUJBQUMsQUFBUyxpQkFDMUIsd0JBQXFCLHNCQUFDLEFBQUksS0FBQyxBQUFxQixBQUFDO0FBQ3BELEFBQXlCLDJDQUFFLEFBQUksS0FBQyxBQUFlLGdCQUFDLEFBQXFCLHNCQUFDLEFBQUMsQUFBQztBQUN4RSxBQUFvQyxzREFBRSxBQUFJLEtBQUMsQUFBMkIsQUFDekUsQUFBQztBQUh3RCxhQUExRCxBQUFNLENBREgsb0JBTUksZ0JBQXNCLDBCQUN6QixBQUFJLE1BQUUsQUFBSSxLQUFDLEFBQU8sUUFBQyxBQUFJLE1BQ3ZCLEFBQXFCLHVCQUFFLEFBQUksQUFFbEMsU0FBQyxBQUFpQixBQUFFLEFBQUMsQUFDMUI7QUFBQyxBQUNKOzs7O0VBL0Q2QyxxQkFBa0I7QUFVNUQsb0JBREMsZ0JBQWEsQUFBRSxxSUFDNEI7QUFWbkMsQUFBd0IsK0NBRHBDLFlBQVUsQUFBRSxjQXdCSixtQkFBQSxZQUFNLE9BQUMscUJBQWtCLG1CQUFDLEFBQWdCLEFBQUMsb0JBQzNDLG1CQUFBLFlBQU0sT0FBQyxxQkFBa0IsbUJBQUMsQUFBc0IsQUFBQywwQkFDakQsbUJBQUEsWUFBTSxPQUFDLHFCQUFrQixtQkFBQyxBQUFRLEFBQUMsZ0ZBekIvQixBQUF3QixBQStEcEM7QUEvRFksbUNBQXdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaW5qZWN0YWJsZSwgaW5qZWN0IH0gZnJvbSAnaW52ZXJzaWZ5JztcbmltcG9ydCB7IFNlcnZpY2VJZGVudGlmaWVycyB9IGZyb20gJy4uLy4uL2NvbnRhaW5lci9TZXJ2aWNlSWRlbnRpZmllcnMnO1xuXG5pbXBvcnQgKiBhcyBmb3JtYXQgZnJvbSAnc3RyaW5nLXRlbXBsYXRlJztcblxuaW1wb3J0IHsgVFN0YXRlbWVudCB9IGZyb20gJy4uLy4uL3R5cGVzL25vZGUvVFN0YXRlbWVudCc7XG5cbmltcG9ydCB7IElFc2NhcGVTZXF1ZW5jZUVuY29kZXIgfSBmcm9tICcuLi8uLi9pbnRlcmZhY2VzL3V0aWxzL0lFc2NhcGVTZXF1ZW5jZUVuY29kZXInO1xuaW1wb3J0IHsgSU9wdGlvbnMgfSBmcm9tICcuLi8uLi9pbnRlcmZhY2VzL29wdGlvbnMvSU9wdGlvbnMnO1xuaW1wb3J0IHsgSVJhbmRvbUdlbmVyYXRvciB9IGZyb20gJy4uLy4uL2ludGVyZmFjZXMvdXRpbHMvSVJhbmRvbUdlbmVyYXRvcic7XG5cbmltcG9ydCB7IGluaXRpYWxpemFibGUgfSBmcm9tICcuLi8uLi9kZWNvcmF0b3JzL0luaXRpYWxpemFibGUnO1xuXG5pbXBvcnQgeyBOT19DVVNUT01fTk9ERVNfUFJFU0VUIH0gZnJvbSAnLi4vLi4vb3B0aW9ucy9wcmVzZXRzL05vQ3VzdG9tTm9kZXMnO1xuXG5pbXBvcnQgeyBTZWxmRGVmZW5kaW5nVGVtcGxhdGUgfSBmcm9tICcuLi8uLi90ZW1wbGF0ZXMvY3VzdG9tLW5vZGVzL3NlbGYtZGVmZW5kaW5nLW5vZGVzL3NlbGYtZGVmZW5kaW5nLXVuaWNvZGUtbm9kZS9TZWxmRGVmZW5kaW5nVGVtcGxhdGUnO1xuXG5pbXBvcnQgeyBBYnN0cmFjdEN1c3RvbU5vZGUgfSBmcm9tICcuLi9BYnN0cmFjdEN1c3RvbU5vZGUnO1xuaW1wb3J0IHsgSmF2YVNjcmlwdE9iZnVzY2F0b3IgfSBmcm9tICcuLi8uLi9KYXZhU2NyaXB0T2JmdXNjYXRvcic7XG5pbXBvcnQgeyBOb2RlVXRpbHMgfSBmcm9tICcuLi8uLi9ub2RlL05vZGVVdGlscyc7XG5cbkBpbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBTZWxmRGVmZW5kaW5nVW5pY29kZU5vZGUgZXh0ZW5kcyBBYnN0cmFjdEN1c3RvbU5vZGUge1xuICAgIC8qKlxuICAgICAqIEB0eXBlIHtJRXNjYXBlU2VxdWVuY2VFbmNvZGVyfVxuICAgICAqL1xuICAgIHByaXZhdGUgcmVhZG9ubHkgZXNjYXBlU2VxdWVuY2VFbmNvZGVyOiBJRXNjYXBlU2VxdWVuY2VFbmNvZGVyO1xuXG4gICAgLyoqXG4gICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgKi9cbiAgICBAaW5pdGlhbGl6YWJsZSgpXG4gICAgcHJpdmF0ZSBjYWxsc0NvbnRyb2xsZXJGdW5jdGlvbk5hbWU6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtJUmFuZG9tR2VuZXJhdG9yfVxuICAgICAqL1xuICAgIHByaXZhdGUgcmVhZG9ubHkgcmFuZG9tR2VuZXJhdG9yOiBJUmFuZG9tR2VuZXJhdG9yO1xuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtJUmFuZG9tR2VuZXJhdG9yfSByYW5kb21HZW5lcmF0b3JcbiAgICAgKiBAcGFyYW0ge0lFc2NhcGVTZXF1ZW5jZUVuY29kZXJ9IGVzY2FwZVNlcXVlbmNlRW5jb2RlclxuICAgICAqIEBwYXJhbSB7SU9wdGlvbnN9IG9wdGlvbnNcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvciAoXG4gICAgICAgIEBpbmplY3QoU2VydmljZUlkZW50aWZpZXJzLklSYW5kb21HZW5lcmF0b3IpIHJhbmRvbUdlbmVyYXRvcjogSVJhbmRvbUdlbmVyYXRvcixcbiAgICAgICAgQGluamVjdChTZXJ2aWNlSWRlbnRpZmllcnMuSUVzY2FwZVNlcXVlbmNlRW5jb2RlcikgZXNjYXBlU2VxdWVuY2VFbmNvZGVyOiBJRXNjYXBlU2VxdWVuY2VFbmNvZGVyLFxuICAgICAgICBAaW5qZWN0KFNlcnZpY2VJZGVudGlmaWVycy5JT3B0aW9ucykgb3B0aW9uczogSU9wdGlvbnNcbiAgICApIHtcbiAgICAgICAgc3VwZXIob3B0aW9ucyk7XG5cbiAgICAgICAgdGhpcy5yYW5kb21HZW5lcmF0b3IgPSByYW5kb21HZW5lcmF0b3I7XG4gICAgICAgIHRoaXMuZXNjYXBlU2VxdWVuY2VFbmNvZGVyID0gZXNjYXBlU2VxdWVuY2VFbmNvZGVyO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBjYWxsc0NvbnRyb2xsZXJGdW5jdGlvbk5hbWVcbiAgICAgKi9cbiAgICBwdWJsaWMgaW5pdGlhbGl6ZSAoY2FsbHNDb250cm9sbGVyRnVuY3Rpb25OYW1lOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5jYWxsc0NvbnRyb2xsZXJGdW5jdGlvbk5hbWUgPSBjYWxsc0NvbnRyb2xsZXJGdW5jdGlvbk5hbWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHJldHVybnMge1RTdGF0ZW1lbnRbXX1cbiAgICAgKi9cbiAgICBwcm90ZWN0ZWQgZ2V0Tm9kZVN0cnVjdHVyZSAoKTogVFN0YXRlbWVudFtdIHtcbiAgICAgICAgcmV0dXJuIE5vZGVVdGlscy5jb252ZXJ0Q29kZVRvU3RydWN0dXJlKHRoaXMuZ2V0VGVtcGxhdGUoKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHJldHVybnMge3N0cmluZ31cbiAgICAgKi9cbiAgICBwcm90ZWN0ZWQgZ2V0VGVtcGxhdGUgKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBKYXZhU2NyaXB0T2JmdXNjYXRvci5vYmZ1c2NhdGUoXG4gICAgICAgICAgICBmb3JtYXQoU2VsZkRlZmVuZGluZ1RlbXBsYXRlKHRoaXMuZXNjYXBlU2VxdWVuY2VFbmNvZGVyKSwge1xuICAgICAgICAgICAgICAgIHNlbGZEZWZlbmRpbmdGdW5jdGlvbk5hbWU6IHRoaXMucmFuZG9tR2VuZXJhdG9yLmdldFJhbmRvbVZhcmlhYmxlTmFtZSg2KSxcbiAgICAgICAgICAgICAgICBzaW5nbGVOb2RlQ2FsbENvbnRyb2xsZXJGdW5jdGlvbk5hbWU6IHRoaXMuY2FsbHNDb250cm9sbGVyRnVuY3Rpb25OYW1lXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAuLi5OT19DVVNUT01fTk9ERVNfUFJFU0VULFxuICAgICAgICAgICAgICAgIHNlZWQ6IHRoaXMub3B0aW9ucy5zZWVkLFxuICAgICAgICAgICAgICAgIHVuaWNvZGVFc2NhcGVTZXF1ZW5jZTogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICApLmdldE9iZnVzY2F0ZWRDb2RlKCk7XG4gICAgfVxufVxuIl19
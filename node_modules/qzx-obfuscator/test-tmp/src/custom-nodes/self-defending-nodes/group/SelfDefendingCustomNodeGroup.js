"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var inversify_1 = require("inversify");
var ServiceIdentifiers_1 = require("../../../container/ServiceIdentifiers");
var Initializable_1 = require("../../../decorators/Initializable");
var CustomNode_1 = require("../../../enums/container/custom-nodes/CustomNode");
var ObfuscationEvent_1 = require("../../../enums/event-emitters/ObfuscationEvent");
var AbstractCustomNodeGroup_1 = require("../../AbstractCustomNodeGroup");
var NodeAppender_1 = require("../../../node/NodeAppender");
var SelfDefendingCustomNodeGroup = function (_AbstractCustomNodeGr) {
    _inherits(SelfDefendingCustomNodeGroup, _AbstractCustomNodeGr);

    function SelfDefendingCustomNodeGroup(customNodeFactory, obfuscationEventEmitter, randomGenerator, options) {
        _classCallCheck(this, SelfDefendingCustomNodeGroup);

        var _this = _possibleConstructorReturn(this, (SelfDefendingCustomNodeGroup.__proto__ || Object.getPrototypeOf(SelfDefendingCustomNodeGroup)).call(this, randomGenerator, options));

        _this.appendEvent = ObfuscationEvent_1.ObfuscationEvent.AfterObfuscation;
        _this.customNodeFactory = customNodeFactory;
        _this.obfuscationEventEmitter = obfuscationEventEmitter;
        return _this;
    }

    _createClass(SelfDefendingCustomNodeGroup, [{
        key: "appendCustomNodes",
        value: function appendCustomNodes(blockScopeNode, stackTraceData) {
            var randomStackTraceIndex = this.getRandomStackTraceIndex(stackTraceData.length);
            this.appendCustomNodeIfExist(CustomNode_1.CustomNode.SelfDefendingUnicodeNode, function (customNode) {
                NodeAppender_1.NodeAppender.appendNodeToOptimalBlockScope(stackTraceData, blockScopeNode, customNode.getNode(), randomStackTraceIndex);
            });
            this.appendCustomNodeIfExist(CustomNode_1.CustomNode.NodeCallsControllerFunctionNode, function (customNode) {
                var targetBlockScope = void 0;
                if (stackTraceData.length) {
                    targetBlockScope = NodeAppender_1.NodeAppender.getOptimalBlockScope(stackTraceData, randomStackTraceIndex, 1);
                } else {
                    targetBlockScope = blockScopeNode;
                }
                NodeAppender_1.NodeAppender.prependNode(targetBlockScope, customNode.getNode());
            });
        }
    }, {
        key: "initialize",
        value: function initialize() {
            this.customNodes = new Map();
            if (!this.options.selfDefending) {
                return;
            }
            var callsControllerFunctionName = this.randomGenerator.getRandomVariableName(6);
            var selfDefendingUnicodeNode = this.customNodeFactory(CustomNode_1.CustomNode.SelfDefendingUnicodeNode);
            var nodeCallsControllerFunctionNode = this.customNodeFactory(CustomNode_1.CustomNode.NodeCallsControllerFunctionNode);
            selfDefendingUnicodeNode.initialize(callsControllerFunctionName);
            nodeCallsControllerFunctionNode.initialize(this.appendEvent, callsControllerFunctionName);
            this.customNodes.set(CustomNode_1.CustomNode.SelfDefendingUnicodeNode, selfDefendingUnicodeNode);
            this.customNodes.set(CustomNode_1.CustomNode.NodeCallsControllerFunctionNode, nodeCallsControllerFunctionNode);
        }
    }]);

    return SelfDefendingCustomNodeGroup;
}(AbstractCustomNodeGroup_1.AbstractCustomNodeGroup);
tslib_1.__decorate([Initializable_1.initializable(), tslib_1.__metadata("design:type", Map)], SelfDefendingCustomNodeGroup.prototype, "customNodes", void 0);
SelfDefendingCustomNodeGroup = tslib_1.__decorate([inversify_1.injectable(), tslib_1.__param(0, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.Factory__ICustomNode)), tslib_1.__param(1, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.IObfuscationEventEmitter)), tslib_1.__param(2, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.IRandomGenerator)), tslib_1.__param(3, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.IOptions)), tslib_1.__metadata("design:paramtypes", [Function, Object, Object, Object])], SelfDefendingCustomNodeGroup);
exports.SelfDefendingCustomNodeGroup = SelfDefendingCustomNodeGroup;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2VsZkRlZmVuZGluZ0N1c3RvbU5vZGVHcm91cC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9jdXN0b20tbm9kZXMvc2VsZi1kZWZlbmRpbmctbm9kZXMvZ3JvdXAvU2VsZkRlZmVuZGluZ0N1c3RvbU5vZGVHcm91cC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQSwwQkFBK0M7QUFDL0MsbUNBQTJFO0FBVzNFLDhCQUFrRTtBQUVsRSwyQkFBOEU7QUFDOUUsaUNBQWtGO0FBRWxGLHdDQUF3RTtBQUN4RSw2QkFBMEQ7QUFHMUQ7QUFBQSxBQUFhLEFBQTRCLEFBQUM7O0FBNEJ0QywwQ0FDcUQsQUFBcUMsbUJBQ2pDLEFBQWlELHlCQUN6RCxBQUFpQyxpQkFDekMsQUFBaUI7QUFFdEQsQUFBSzs7Z0tBQUMsQUFBZSxpQkFBRSxBQUFPLEFBQUMsQUFBQzs7QUE5QjFCLGNBQVcsY0FBcUIsbUJBQWdCLGlCQUFDLEFBQWdCLEFBQUM7QUFnQ3hFLEFBQUksY0FBQyxBQUFpQixvQkFBRyxBQUFpQixBQUFDO0FBQzNDLEFBQUksY0FBQyxBQUF1QiwwQkFBRyxBQUF1QixBQUFDLEFBQzNEOztBQUFDLEFBTU0sQUFBaUI7Ozs7MENBQUUsQUFBdUMsZ0JBQUUsQUFBaUM7QUFDaEcsZ0JBQU0sQUFBcUIsd0JBQVcsQUFBSSxLQUFDLEFBQXdCLHlCQUFDLEFBQWMsZUFBQyxBQUFNLEFBQUMsQUFBQztBQUczRixBQUFJLGlCQUFDLEFBQXVCLHdCQUFDLGFBQVUsV0FBQyxBQUF3QiwwQkFBRSxVQUFDLEFBQXVCO0FBQ3RGLCtCQUFZLGFBQUMsQUFBNkIsOEJBQ3RDLEFBQWMsZ0JBQ2QsQUFBYyxnQkFDZCxBQUFVLFdBQUMsQUFBTyxBQUFFLFdBQ3BCLEFBQXFCLEFBQ3hCLEFBQUMsQUFDTjtBQUFDLEFBQUMsQUFBQztBQUdILEFBQUksaUJBQUMsQUFBdUIsd0JBQUMsYUFBVSxXQUFDLEFBQStCLGlDQUFFLFVBQUMsQUFBdUI7QUFDN0Ysb0JBQUksQUFBeUMsQUFBQztBQUU5QyxBQUFFLEFBQUMsb0JBQUMsQUFBYyxlQUFDLEFBQU0sQUFBQyxRQUFDLEFBQUM7QUFDeEIsQUFBZ0IsdUNBQUcsZUFBWSxhQUFDLEFBQW9CLHFCQUFDLEFBQWMsZ0JBQUUsQUFBcUIsdUJBQUUsQUFBQyxBQUFDLEFBQUMsQUFDbkc7QUFBQyxBQUFDLEFBQUksdUJBQUMsQUFBQztBQUNKLEFBQWdCLHVDQUFHLEFBQWMsQUFBQyxBQUN0QztBQUFDO0FBRUQsK0JBQVksYUFBQyxBQUFXLFlBQUMsQUFBZ0Isa0JBQUUsQUFBVSxXQUFDLEFBQU8sQUFBRSxBQUFDLEFBQUMsQUFDckU7QUFBQyxBQUFDLEFBQUMsQUFDUDtBQUFDLEFBRU0sQUFBVTs7OztBQUNiLEFBQUksaUJBQUMsQUFBVyxjQUFHLElBQUksQUFBRyxBQUE0QixBQUFDO0FBRXZELEFBQUUsQUFBQyxnQkFBQyxDQUFDLEFBQUksS0FBQyxBQUFPLFFBQUMsQUFBYSxBQUFDLGVBQUMsQUFBQztBQUM5QixBQUFNLEFBQUMsQUFDWDtBQUFDO0FBRUQsZ0JBQU0sQUFBMkIsOEJBQVcsQUFBSSxLQUFDLEFBQWUsZ0JBQUMsQUFBcUIsc0JBQUMsQUFBQyxBQUFDLEFBQUM7QUFFMUYsZ0JBQU0sQUFBd0IsMkJBQWdCLEFBQUksS0FBQyxBQUFpQixrQkFBQyxhQUFVLFdBQUMsQUFBd0IsQUFBQyxBQUFDO0FBQzFHLGdCQUFNLEFBQStCLGtDQUFnQixBQUFJLEtBQUMsQUFBaUIsa0JBQUMsYUFBVSxXQUFDLEFBQStCLEFBQUMsQUFBQztBQUV4SCxBQUF3QixxQ0FBQyxBQUFVLFdBQUMsQUFBMkIsQUFBQyxBQUFDO0FBQ2pFLEFBQStCLDRDQUFDLEFBQVUsV0FBQyxBQUFJLEtBQUMsQUFBVyxhQUFFLEFBQTJCLEFBQUMsQUFBQztBQUUxRixBQUFJLGlCQUFDLEFBQVcsWUFBQyxBQUFHLElBQUMsYUFBVSxXQUFDLEFBQXdCLDBCQUFFLEFBQXdCLEFBQUMsQUFBQztBQUNwRixBQUFJLGlCQUFDLEFBQVcsWUFBQyxBQUFHLElBQUMsYUFBVSxXQUFDLEFBQStCLGlDQUFFLEFBQStCLEFBQUMsQUFBQyxBQUN0RztBQUFDLEFBQ0o7Ozs7RUF6RmlELDBCQUF1QjtBQVVyRSxvQkFEQyxnQkFBYSxBQUFFLG1EQUNPLEFBQUcsbUVBQTJCO0FBVjVDLEFBQTRCLG1EQUR4QyxZQUFVLEFBQUUsY0E4QkosbUJBQUEsWUFBTSxPQUFDLHFCQUFrQixtQkFBQyxBQUFvQixBQUFDLHdCQUMvQyxtQkFBQSxZQUFNLE9BQUMscUJBQWtCLG1CQUFDLEFBQXdCLEFBQUMsNEJBQ25ELG1CQUFBLFlBQU0sT0FBQyxxQkFBa0IsbUJBQUMsQUFBZ0IsQUFBQyxvQkFDM0MsbUJBQUEsWUFBTSxPQUFDLHFCQUFrQixtQkFBQyxBQUFRLEFBQUMsMEZBaEMvQixBQUE0QixBQXlGeEM7QUF6RlksdUNBQTRCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaW5qZWN0YWJsZSwgaW5qZWN0IH0gZnJvbSAnaW52ZXJzaWZ5JztcbmltcG9ydCB7IFNlcnZpY2VJZGVudGlmaWVycyB9IGZyb20gJy4uLy4uLy4uL2NvbnRhaW5lci9TZXJ2aWNlSWRlbnRpZmllcnMnO1xuXG5pbXBvcnQgeyBUQ3VzdG9tTm9kZUZhY3RvcnkgfSBmcm9tICcuLi8uLi8uLi90eXBlcy9jb250YWluZXIvY3VzdG9tLW5vZGVzL1RDdXN0b21Ob2RlRmFjdG9yeSc7XG5pbXBvcnQgeyBUTm9kZVdpdGhCbG9ja1N0YXRlbWVudCB9IGZyb20gJy4uLy4uLy4uL3R5cGVzL25vZGUvVE5vZGVXaXRoQmxvY2tTdGF0ZW1lbnQnO1xuXG5pbXBvcnQgeyBJQ3VzdG9tTm9kZSB9IGZyb20gJy4uLy4uLy4uL2ludGVyZmFjZXMvY3VzdG9tLW5vZGVzL0lDdXN0b21Ob2RlJztcbmltcG9ydCB7IElPYmZ1c2NhdGlvbkV2ZW50RW1pdHRlciB9IGZyb20gJy4uLy4uLy4uL2ludGVyZmFjZXMvZXZlbnQtZW1pdHRlcnMvSU9iZnVzY2F0aW9uRXZlbnRFbWl0dGVyJztcbmltcG9ydCB7IElPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vaW50ZXJmYWNlcy9vcHRpb25zL0lPcHRpb25zJztcbmltcG9ydCB7IElSYW5kb21HZW5lcmF0b3IgfSBmcm9tICcuLi8uLi8uLi9pbnRlcmZhY2VzL3V0aWxzL0lSYW5kb21HZW5lcmF0b3InO1xuaW1wb3J0IHsgSVN0YWNrVHJhY2VEYXRhIH0gZnJvbSAnLi4vLi4vLi4vaW50ZXJmYWNlcy9zdGFjay10cmFjZS1hbmFseXplci9JU3RhY2tUcmFjZURhdGEnO1xuXG5pbXBvcnQgeyBpbml0aWFsaXphYmxlIH0gZnJvbSAnLi4vLi4vLi4vZGVjb3JhdG9ycy9Jbml0aWFsaXphYmxlJztcblxuaW1wb3J0IHsgQ3VzdG9tTm9kZSB9IGZyb20gJy4uLy4uLy4uL2VudW1zL2NvbnRhaW5lci9jdXN0b20tbm9kZXMvQ3VzdG9tTm9kZSc7XG5pbXBvcnQgeyBPYmZ1c2NhdGlvbkV2ZW50IH0gZnJvbSAnLi4vLi4vLi4vZW51bXMvZXZlbnQtZW1pdHRlcnMvT2JmdXNjYXRpb25FdmVudCc7XG5cbmltcG9ydCB7IEFic3RyYWN0Q3VzdG9tTm9kZUdyb3VwIH0gZnJvbSAnLi4vLi4vQWJzdHJhY3RDdXN0b21Ob2RlR3JvdXAnO1xuaW1wb3J0IHsgTm9kZUFwcGVuZGVyIH0gZnJvbSAnLi4vLi4vLi4vbm9kZS9Ob2RlQXBwZW5kZXInO1xuXG5AaW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgU2VsZkRlZmVuZGluZ0N1c3RvbU5vZGVHcm91cCBleHRlbmRzIEFic3RyYWN0Q3VzdG9tTm9kZUdyb3VwIHtcbiAgICAvKipcbiAgICAgKiBAdHlwZSB7T2JmdXNjYXRpb25FdmVudH1cbiAgICAgKi9cbiAgICBwcm90ZWN0ZWQgYXBwZW5kRXZlbnQ6IE9iZnVzY2F0aW9uRXZlbnQgPSBPYmZ1c2NhdGlvbkV2ZW50LkFmdGVyT2JmdXNjYXRpb247XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7TWFwPEN1c3RvbU5vZGUsIElDdXN0b21Ob2RlPn1cbiAgICAgKi9cbiAgICBAaW5pdGlhbGl6YWJsZSgpXG4gICAgcHJvdGVjdGVkIGN1c3RvbU5vZGVzOiBNYXAgPEN1c3RvbU5vZGUsIElDdXN0b21Ob2RlPjtcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtUQ3VzdG9tTm9kZUZhY3Rvcnl9XG4gICAgICovXG4gICAgcHJpdmF0ZSByZWFkb25seSBjdXN0b21Ob2RlRmFjdG9yeTogVEN1c3RvbU5vZGVGYWN0b3J5O1xuXG4gICAgLyoqXG4gICAgICogQHR5cGUge0lPYmZ1c2NhdGlvbkV2ZW50RW1pdHRlcn1cbiAgICAgKi9cbiAgICBwcml2YXRlIHJlYWRvbmx5IG9iZnVzY2F0aW9uRXZlbnRFbWl0dGVyOiBJT2JmdXNjYXRpb25FdmVudEVtaXR0ZXI7XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge1RDdXN0b21Ob2RlRmFjdG9yeX0gY3VzdG9tTm9kZUZhY3RvcnlcbiAgICAgKiBAcGFyYW0ge0lPYmZ1c2NhdGlvbkV2ZW50RW1pdHRlcn0gb2JmdXNjYXRpb25FdmVudEVtaXR0ZXJcbiAgICAgKiBAcGFyYW0ge0lSYW5kb21HZW5lcmF0b3J9IHJhbmRvbUdlbmVyYXRvclxuICAgICAqIEBwYXJhbSB7SU9wdGlvbnN9IG9wdGlvbnNcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvciAoXG4gICAgICAgIEBpbmplY3QoU2VydmljZUlkZW50aWZpZXJzLkZhY3RvcnlfX0lDdXN0b21Ob2RlKSBjdXN0b21Ob2RlRmFjdG9yeTogVEN1c3RvbU5vZGVGYWN0b3J5LFxuICAgICAgICBAaW5qZWN0KFNlcnZpY2VJZGVudGlmaWVycy5JT2JmdXNjYXRpb25FdmVudEVtaXR0ZXIpIG9iZnVzY2F0aW9uRXZlbnRFbWl0dGVyOiBJT2JmdXNjYXRpb25FdmVudEVtaXR0ZXIsXG4gICAgICAgIEBpbmplY3QoU2VydmljZUlkZW50aWZpZXJzLklSYW5kb21HZW5lcmF0b3IpIHJhbmRvbUdlbmVyYXRvcjogSVJhbmRvbUdlbmVyYXRvcixcbiAgICAgICAgQGluamVjdChTZXJ2aWNlSWRlbnRpZmllcnMuSU9wdGlvbnMpIG9wdGlvbnM6IElPcHRpb25zXG4gICAgKSB7XG4gICAgICAgIHN1cGVyKHJhbmRvbUdlbmVyYXRvciwgb3B0aW9ucyk7XG5cbiAgICAgICAgdGhpcy5jdXN0b21Ob2RlRmFjdG9yeSA9IGN1c3RvbU5vZGVGYWN0b3J5O1xuICAgICAgICB0aGlzLm9iZnVzY2F0aW9uRXZlbnRFbWl0dGVyID0gb2JmdXNjYXRpb25FdmVudEVtaXR0ZXI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtUTm9kZVdpdGhCbG9ja1N0YXRlbWVudH0gYmxvY2tTY29wZU5vZGVcbiAgICAgKiBAcGFyYW0ge0lTdGFja1RyYWNlRGF0YVtdfSBzdGFja1RyYWNlRGF0YVxuICAgICAqL1xuICAgIHB1YmxpYyBhcHBlbmRDdXN0b21Ob2RlcyAoYmxvY2tTY29wZU5vZGU6IFROb2RlV2l0aEJsb2NrU3RhdGVtZW50LCBzdGFja1RyYWNlRGF0YTogSVN0YWNrVHJhY2VEYXRhW10pOiB2b2lkIHtcbiAgICAgICAgY29uc3QgcmFuZG9tU3RhY2tUcmFjZUluZGV4OiBudW1iZXIgPSB0aGlzLmdldFJhbmRvbVN0YWNrVHJhY2VJbmRleChzdGFja1RyYWNlRGF0YS5sZW5ndGgpO1xuXG4gICAgICAgIC8vIHNlbGZEZWZlbmRpbmdVbmljb2RlTm9kZSBhcHBlbmRcbiAgICAgICAgdGhpcy5hcHBlbmRDdXN0b21Ob2RlSWZFeGlzdChDdXN0b21Ob2RlLlNlbGZEZWZlbmRpbmdVbmljb2RlTm9kZSwgKGN1c3RvbU5vZGU6IElDdXN0b21Ob2RlKSA9PiB7XG4gICAgICAgICAgICBOb2RlQXBwZW5kZXIuYXBwZW5kTm9kZVRvT3B0aW1hbEJsb2NrU2NvcGUoXG4gICAgICAgICAgICAgICAgc3RhY2tUcmFjZURhdGEsXG4gICAgICAgICAgICAgICAgYmxvY2tTY29wZU5vZGUsXG4gICAgICAgICAgICAgICAgY3VzdG9tTm9kZS5nZXROb2RlKCksXG4gICAgICAgICAgICAgICAgcmFuZG9tU3RhY2tUcmFjZUluZGV4XG4gICAgICAgICAgICApO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBub2RlQ2FsbHNDb250cm9sbGVyRnVuY3Rpb25Ob2RlIGFwcGVuZFxuICAgICAgICB0aGlzLmFwcGVuZEN1c3RvbU5vZGVJZkV4aXN0KEN1c3RvbU5vZGUuTm9kZUNhbGxzQ29udHJvbGxlckZ1bmN0aW9uTm9kZSwgKGN1c3RvbU5vZGU6IElDdXN0b21Ob2RlKSA9PiB7XG4gICAgICAgICAgICBsZXQgdGFyZ2V0QmxvY2tTY29wZTogVE5vZGVXaXRoQmxvY2tTdGF0ZW1lbnQ7XG5cbiAgICAgICAgICAgIGlmIChzdGFja1RyYWNlRGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRCbG9ja1Njb3BlID0gTm9kZUFwcGVuZGVyLmdldE9wdGltYWxCbG9ja1Njb3BlKHN0YWNrVHJhY2VEYXRhLCByYW5kb21TdGFja1RyYWNlSW5kZXgsIDEpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRCbG9ja1Njb3BlID0gYmxvY2tTY29wZU5vZGU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIE5vZGVBcHBlbmRlci5wcmVwZW5kTm9kZSh0YXJnZXRCbG9ja1Njb3BlLCBjdXN0b21Ob2RlLmdldE5vZGUoKSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBpbml0aWFsaXplICgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5jdXN0b21Ob2RlcyA9IG5ldyBNYXAgPEN1c3RvbU5vZGUsIElDdXN0b21Ob2RlPigpO1xuXG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zLnNlbGZEZWZlbmRpbmcpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNhbGxzQ29udHJvbGxlckZ1bmN0aW9uTmFtZTogc3RyaW5nID0gdGhpcy5yYW5kb21HZW5lcmF0b3IuZ2V0UmFuZG9tVmFyaWFibGVOYW1lKDYpO1xuXG4gICAgICAgIGNvbnN0IHNlbGZEZWZlbmRpbmdVbmljb2RlTm9kZTogSUN1c3RvbU5vZGUgPSB0aGlzLmN1c3RvbU5vZGVGYWN0b3J5KEN1c3RvbU5vZGUuU2VsZkRlZmVuZGluZ1VuaWNvZGVOb2RlKTtcbiAgICAgICAgY29uc3Qgbm9kZUNhbGxzQ29udHJvbGxlckZ1bmN0aW9uTm9kZTogSUN1c3RvbU5vZGUgPSB0aGlzLmN1c3RvbU5vZGVGYWN0b3J5KEN1c3RvbU5vZGUuTm9kZUNhbGxzQ29udHJvbGxlckZ1bmN0aW9uTm9kZSk7XG5cbiAgICAgICAgc2VsZkRlZmVuZGluZ1VuaWNvZGVOb2RlLmluaXRpYWxpemUoY2FsbHNDb250cm9sbGVyRnVuY3Rpb25OYW1lKTtcbiAgICAgICAgbm9kZUNhbGxzQ29udHJvbGxlckZ1bmN0aW9uTm9kZS5pbml0aWFsaXplKHRoaXMuYXBwZW5kRXZlbnQsIGNhbGxzQ29udHJvbGxlckZ1bmN0aW9uTmFtZSk7XG5cbiAgICAgICAgdGhpcy5jdXN0b21Ob2Rlcy5zZXQoQ3VzdG9tTm9kZS5TZWxmRGVmZW5kaW5nVW5pY29kZU5vZGUsIHNlbGZEZWZlbmRpbmdVbmljb2RlTm9kZSk7XG4gICAgICAgIHRoaXMuY3VzdG9tTm9kZXMuc2V0KEN1c3RvbU5vZGUuTm9kZUNhbGxzQ29udHJvbGxlckZ1bmN0aW9uTm9kZSwgbm9kZUNhbGxzQ29udHJvbGxlckZ1bmN0aW9uTm9kZSk7XG4gICAgfVxufVxuIl19
"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var inversify_1 = require("inversify");
var ServiceIdentifiers_1 = require("../../../container/ServiceIdentifiers");
var Initializable_1 = require("../../../decorators/Initializable");
var CustomNode_1 = require("../../../enums/container/custom-nodes/CustomNode");
var ObfuscationEvent_1 = require("../../../enums/event-emitters/ObfuscationEvent");
var AbstractCustomNodeGroup_1 = require("../../AbstractCustomNodeGroup");
var NodeAppender_1 = require("../../../node/NodeAppender");
var DebugProtectionCustomNodeGroup = function (_AbstractCustomNodeGr) {
    _inherits(DebugProtectionCustomNodeGroup, _AbstractCustomNodeGr);

    function DebugProtectionCustomNodeGroup(customNodeFactory, obfuscationEventEmitter, randomGenerator, options) {
        _classCallCheck(this, DebugProtectionCustomNodeGroup);

        var _this = _possibleConstructorReturn(this, (DebugProtectionCustomNodeGroup.__proto__ || Object.getPrototypeOf(DebugProtectionCustomNodeGroup)).call(this, randomGenerator, options));

        _this.appendEvent = ObfuscationEvent_1.ObfuscationEvent.BeforeObfuscation;
        _this.customNodeFactory = customNodeFactory;
        _this.obfuscationEventEmitter = obfuscationEventEmitter;
        return _this;
    }

    _createClass(DebugProtectionCustomNodeGroup, [{
        key: "appendCustomNodes",
        value: function appendCustomNodes(blockScopeNode, stackTraceData) {
            var _this2 = this;

            this.appendCustomNodeIfExist(CustomNode_1.CustomNode.DebugProtectionFunctionNode, function (customNode) {
                NodeAppender_1.NodeAppender.appendNode(blockScopeNode, customNode.getNode());
            });
            this.appendCustomNodeIfExist(CustomNode_1.CustomNode.DebugProtectionFunctionCallNode, function (customNode) {
                NodeAppender_1.NodeAppender.appendNode(blockScopeNode, customNode.getNode());
            });
            this.appendCustomNodeIfExist(CustomNode_1.CustomNode.DebugProtectionFunctionIntervalNode, function (customNode) {
                var programBodyLength = blockScopeNode.body.length;
                var randomIndex = _this2.randomGenerator.getRandomInteger(0, programBodyLength);
                NodeAppender_1.NodeAppender.insertNodeAtIndex(blockScopeNode, customNode.getNode(), randomIndex);
            });
        }
    }, {
        key: "initialize",
        value: function initialize() {
            this.customNodes = new Map();
            if (!this.options.debugProtection) {
                return;
            }
            var debugProtectionFunctionName = this.randomGenerator.getRandomVariableName(6);
            var debugProtectionFunctionNode = this.customNodeFactory(CustomNode_1.CustomNode.DebugProtectionFunctionNode);
            var debugProtectionFunctionCallNode = this.customNodeFactory(CustomNode_1.CustomNode.DebugProtectionFunctionCallNode);
            var debugProtectionFunctionIntervalNode = this.customNodeFactory(CustomNode_1.CustomNode.DebugProtectionFunctionIntervalNode);
            debugProtectionFunctionNode.initialize(debugProtectionFunctionName);
            debugProtectionFunctionCallNode.initialize(debugProtectionFunctionName);
            debugProtectionFunctionIntervalNode.initialize(debugProtectionFunctionName);
            this.customNodes.set(CustomNode_1.CustomNode.DebugProtectionFunctionNode, debugProtectionFunctionNode);
            this.customNodes.set(CustomNode_1.CustomNode.DebugProtectionFunctionCallNode, debugProtectionFunctionCallNode);
            if (this.options.debugProtectionInterval) {
                this.customNodes.set(CustomNode_1.CustomNode.DebugProtectionFunctionIntervalNode, debugProtectionFunctionIntervalNode);
            }
        }
    }]);

    return DebugProtectionCustomNodeGroup;
}(AbstractCustomNodeGroup_1.AbstractCustomNodeGroup);
tslib_1.__decorate([Initializable_1.initializable(), tslib_1.__metadata("design:type", Map)], DebugProtectionCustomNodeGroup.prototype, "customNodes", void 0);
DebugProtectionCustomNodeGroup = tslib_1.__decorate([inversify_1.injectable(), tslib_1.__param(0, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.Factory__ICustomNode)), tslib_1.__param(1, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.IObfuscationEventEmitter)), tslib_1.__param(2, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.IRandomGenerator)), tslib_1.__param(3, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.IOptions)), tslib_1.__metadata("design:paramtypes", [Function, Object, Object, Object])], DebugProtectionCustomNodeGroup);
exports.DebugProtectionCustomNodeGroup = DebugProtectionCustomNodeGroup;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRGVidWdQcm90ZWN0aW9uQ3VzdG9tTm9kZUdyb3VwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2N1c3RvbS1ub2Rlcy9kZWJ1Zy1wcm90ZWN0aW9uLW5vZGVzL2dyb3VwL0RlYnVnUHJvdGVjdGlvbkN1c3RvbU5vZGVHcm91cC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQSwwQkFBK0M7QUFDL0MsbUNBQTJFO0FBVzNFLDhCQUFrRTtBQUVsRSwyQkFBOEU7QUFDOUUsaUNBQWtGO0FBRWxGLHdDQUF3RTtBQUN4RSw2QkFBMEQ7QUFHMUQ7QUFBQSxBQUFhLEFBQThCLEFBQUM7O0FBNEJ4Qyw0Q0FDcUQsQUFBcUMsbUJBQ2pDLEFBQWlELHlCQUN6RCxBQUFpQyxpQkFDekMsQUFBaUI7QUFFdEQsQUFBSzs7b0tBQUMsQUFBZSxpQkFBRSxBQUFPLEFBQUMsQUFBQzs7QUE5QmpCLGNBQVcsY0FBcUIsbUJBQWdCLGlCQUFDLEFBQWlCLEFBQUM7QUFnQ2xGLEFBQUksY0FBQyxBQUFpQixvQkFBRyxBQUFpQixBQUFDO0FBQzNDLEFBQUksY0FBQyxBQUF1QiwwQkFBRyxBQUF1QixBQUFDLEFBQzNEOztBQUFDLEFBTU0sQUFBaUI7Ozs7MENBQUUsQUFBdUMsZ0JBQUUsQUFBaUM7OztBQUVoRyxBQUFJLGlCQUFDLEFBQXVCLHdCQUFDLGFBQVUsV0FBQyxBQUEyQiw2QkFBRSxVQUFDLEFBQXVCO0FBQ3pGLCtCQUFZLGFBQUMsQUFBVSxXQUFDLEFBQWMsZ0JBQUUsQUFBVSxXQUFDLEFBQU8sQUFBRSxBQUFDLEFBQUMsQUFDbEU7QUFBQyxBQUFDLEFBQUM7QUFHSCxBQUFJLGlCQUFDLEFBQXVCLHdCQUFDLGFBQVUsV0FBQyxBQUErQixpQ0FBRSxVQUFDLEFBQXVCO0FBQzdGLCtCQUFZLGFBQUMsQUFBVSxXQUFDLEFBQWMsZ0JBQUUsQUFBVSxXQUFDLEFBQU8sQUFBRSxBQUFDLEFBQUMsQUFDbEU7QUFBQyxBQUFDLEFBQUM7QUFHSCxBQUFJLGlCQUFDLEFBQXVCLHdCQUFDLGFBQVUsV0FBQyxBQUFtQyxxQ0FBRSxVQUFDLEFBQXVCO0FBQ2pHLG9CQUFNLEFBQWlCLG9CQUFXLEFBQWMsZUFBQyxBQUFJLEtBQUMsQUFBTSxBQUFDO0FBQzdELG9CQUFNLEFBQVcsY0FBVyxBQUFJLE9BQUMsQUFBZSxnQkFBQyxBQUFnQixpQkFBQyxBQUFDLEdBQUUsQUFBaUIsQUFBQyxBQUFDO0FBRXhGLCtCQUFZLGFBQUMsQUFBaUIsa0JBQUMsQUFBYyxnQkFBRSxBQUFVLFdBQUMsQUFBTyxBQUFFLFdBQUUsQUFBVyxBQUFDLEFBQUMsQUFDdEY7QUFBQyxBQUFDLEFBQUMsQUFDUDtBQUFDLEFBRU0sQUFBVTs7OztBQUNiLEFBQUksaUJBQUMsQUFBVyxjQUFHLElBQUksQUFBRyxBQUE0QixBQUFDO0FBRXZELEFBQUUsQUFBQyxnQkFBQyxDQUFDLEFBQUksS0FBQyxBQUFPLFFBQUMsQUFBZSxBQUFDLGlCQUFDLEFBQUM7QUFDaEMsQUFBTSxBQUFDLEFBQ1g7QUFBQztBQUVELGdCQUFNLEFBQTJCLDhCQUFXLEFBQUksS0FBQyxBQUFlLGdCQUFDLEFBQXFCLHNCQUFDLEFBQUMsQUFBQyxBQUFDO0FBRTFGLGdCQUFNLEFBQTJCLDhCQUFnQixBQUFJLEtBQUMsQUFBaUIsa0JBQUMsYUFBVSxXQUFDLEFBQTJCLEFBQUMsQUFBQztBQUNoSCxnQkFBTSxBQUErQixrQ0FBZ0IsQUFBSSxLQUFDLEFBQWlCLGtCQUFDLGFBQVUsV0FBQyxBQUErQixBQUFDLEFBQUM7QUFDeEgsZ0JBQU0sQUFBbUMsc0NBQWdCLEFBQUksS0FBQyxBQUFpQixrQkFBQyxhQUFVLFdBQUMsQUFBbUMsQUFBQyxBQUFDO0FBRWhJLEFBQTJCLHdDQUFDLEFBQVUsV0FBQyxBQUEyQixBQUFDLEFBQUM7QUFDcEUsQUFBK0IsNENBQUMsQUFBVSxXQUFDLEFBQTJCLEFBQUMsQUFBQztBQUN4RSxBQUFtQyxnREFBQyxBQUFVLFdBQUMsQUFBMkIsQUFBQyxBQUFDO0FBRTVFLEFBQUksaUJBQUMsQUFBVyxZQUFDLEFBQUcsSUFBQyxhQUFVLFdBQUMsQUFBMkIsNkJBQUUsQUFBMkIsQUFBQyxBQUFDO0FBQzFGLEFBQUksaUJBQUMsQUFBVyxZQUFDLEFBQUcsSUFBQyxhQUFVLFdBQUMsQUFBK0IsaUNBQUUsQUFBK0IsQUFBQyxBQUFDO0FBRWxHLEFBQUUsQUFBQyxnQkFBQyxBQUFJLEtBQUMsQUFBTyxRQUFDLEFBQXVCLEFBQUMseUJBQUMsQUFBQztBQUN2QyxBQUFJLHFCQUFDLEFBQVcsWUFBQyxBQUFHLElBQUMsYUFBVSxXQUFDLEFBQW1DLHFDQUFFLEFBQW1DLEFBQUMsQUFBQyxBQUM5RztBQUFDLEFBQ0w7QUFBQyxBQUNKOzs7O0VBeEZtRCwwQkFBdUI7QUFVdkUsb0JBREMsZ0JBQWEsQUFBRSxtREFDTyxBQUFHLHFFQUEyQjtBQVY1QyxBQUE4QixxREFEMUMsWUFBVSxBQUFFLGNBOEJKLG1CQUFBLFlBQU0sT0FBQyxxQkFBa0IsbUJBQUMsQUFBb0IsQUFBQyx3QkFDL0MsbUJBQUEsWUFBTSxPQUFDLHFCQUFrQixtQkFBQyxBQUF3QixBQUFDLDRCQUNuRCxtQkFBQSxZQUFNLE9BQUMscUJBQWtCLG1CQUFDLEFBQWdCLEFBQUMsb0JBQzNDLG1CQUFBLFlBQU0sT0FBQyxxQkFBa0IsbUJBQUMsQUFBUSxBQUFDLDBGQWhDL0IsQUFBOEIsQUF3RjFDO0FBeEZZLHlDQUE4QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGluamVjdGFibGUsIGluamVjdCB9IGZyb20gJ2ludmVyc2lmeSc7XG5pbXBvcnQgeyBTZXJ2aWNlSWRlbnRpZmllcnMgfSBmcm9tICcuLi8uLi8uLi9jb250YWluZXIvU2VydmljZUlkZW50aWZpZXJzJztcblxuaW1wb3J0IHsgVEN1c3RvbU5vZGVGYWN0b3J5IH0gZnJvbSAnLi4vLi4vLi4vdHlwZXMvY29udGFpbmVyL2N1c3RvbS1ub2Rlcy9UQ3VzdG9tTm9kZUZhY3RvcnknO1xuaW1wb3J0IHsgVE5vZGVXaXRoQmxvY2tTdGF0ZW1lbnQgfSBmcm9tICcuLi8uLi8uLi90eXBlcy9ub2RlL1ROb2RlV2l0aEJsb2NrU3RhdGVtZW50JztcblxuaW1wb3J0IHsgSUN1c3RvbU5vZGUgfSBmcm9tICcuLi8uLi8uLi9pbnRlcmZhY2VzL2N1c3RvbS1ub2Rlcy9JQ3VzdG9tTm9kZSc7XG5pbXBvcnQgeyBJT2JmdXNjYXRpb25FdmVudEVtaXR0ZXIgfSBmcm9tICcuLi8uLi8uLi9pbnRlcmZhY2VzL2V2ZW50LWVtaXR0ZXJzL0lPYmZ1c2NhdGlvbkV2ZW50RW1pdHRlcic7XG5pbXBvcnQgeyBJT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uL2ludGVyZmFjZXMvb3B0aW9ucy9JT3B0aW9ucyc7XG5pbXBvcnQgeyBJUmFuZG9tR2VuZXJhdG9yIH0gZnJvbSAnLi4vLi4vLi4vaW50ZXJmYWNlcy91dGlscy9JUmFuZG9tR2VuZXJhdG9yJztcbmltcG9ydCB7IElTdGFja1RyYWNlRGF0YSB9IGZyb20gJy4uLy4uLy4uL2ludGVyZmFjZXMvc3RhY2stdHJhY2UtYW5hbHl6ZXIvSVN0YWNrVHJhY2VEYXRhJztcblxuaW1wb3J0IHsgaW5pdGlhbGl6YWJsZSB9IGZyb20gJy4uLy4uLy4uL2RlY29yYXRvcnMvSW5pdGlhbGl6YWJsZSc7XG5cbmltcG9ydCB7IEN1c3RvbU5vZGUgfSBmcm9tICcuLi8uLi8uLi9lbnVtcy9jb250YWluZXIvY3VzdG9tLW5vZGVzL0N1c3RvbU5vZGUnO1xuaW1wb3J0IHsgT2JmdXNjYXRpb25FdmVudCB9IGZyb20gJy4uLy4uLy4uL2VudW1zL2V2ZW50LWVtaXR0ZXJzL09iZnVzY2F0aW9uRXZlbnQnO1xuXG5pbXBvcnQgeyBBYnN0cmFjdEN1c3RvbU5vZGVHcm91cCB9IGZyb20gJy4uLy4uL0Fic3RyYWN0Q3VzdG9tTm9kZUdyb3VwJztcbmltcG9ydCB7IE5vZGVBcHBlbmRlciB9IGZyb20gJy4uLy4uLy4uL25vZGUvTm9kZUFwcGVuZGVyJztcblxuQGluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIERlYnVnUHJvdGVjdGlvbkN1c3RvbU5vZGVHcm91cCBleHRlbmRzIEFic3RyYWN0Q3VzdG9tTm9kZUdyb3VwIHtcbiAgICAvKipcbiAgICAgKiBAdHlwZSB7T2JmdXNjYXRpb25FdmVudH1cbiAgICAgKi9cbiAgICBwcm90ZWN0ZWQgcmVhZG9ubHkgYXBwZW5kRXZlbnQ6IE9iZnVzY2F0aW9uRXZlbnQgPSBPYmZ1c2NhdGlvbkV2ZW50LkJlZm9yZU9iZnVzY2F0aW9uO1xuXG4gICAgLyoqXG4gICAgICogQHR5cGUge01hcDxDdXN0b21Ob2RlLCBJQ3VzdG9tTm9kZT59XG4gICAgICovXG4gICAgQGluaXRpYWxpemFibGUoKVxuICAgIHByb3RlY3RlZCBjdXN0b21Ob2RlczogTWFwIDxDdXN0b21Ob2RlLCBJQ3VzdG9tTm9kZT47XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7VEN1c3RvbU5vZGVGYWN0b3J5fVxuICAgICAqL1xuICAgIHByaXZhdGUgcmVhZG9ubHkgY3VzdG9tTm9kZUZhY3Rvcnk6IFRDdXN0b21Ob2RlRmFjdG9yeTtcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtJT2JmdXNjYXRpb25FdmVudEVtaXR0ZXJ9XG4gICAgICovXG4gICAgcHJpdmF0ZSByZWFkb25seSBvYmZ1c2NhdGlvbkV2ZW50RW1pdHRlcjogSU9iZnVzY2F0aW9uRXZlbnRFbWl0dGVyO1xuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtUQ3VzdG9tTm9kZUZhY3Rvcnl9IGN1c3RvbU5vZGVGYWN0b3J5XG4gICAgICogQHBhcmFtIHtJT2JmdXNjYXRpb25FdmVudEVtaXR0ZXJ9IG9iZnVzY2F0aW9uRXZlbnRFbWl0dGVyXG4gICAgICogQHBhcmFtIHtJUmFuZG9tR2VuZXJhdG9yfSByYW5kb21HZW5lcmF0b3JcbiAgICAgKiBAcGFyYW0ge0lPcHRpb25zfSBvcHRpb25zXG4gICAgICovXG4gICAgY29uc3RydWN0b3IgKFxuICAgICAgICBAaW5qZWN0KFNlcnZpY2VJZGVudGlmaWVycy5GYWN0b3J5X19JQ3VzdG9tTm9kZSkgY3VzdG9tTm9kZUZhY3Rvcnk6IFRDdXN0b21Ob2RlRmFjdG9yeSxcbiAgICAgICAgQGluamVjdChTZXJ2aWNlSWRlbnRpZmllcnMuSU9iZnVzY2F0aW9uRXZlbnRFbWl0dGVyKSBvYmZ1c2NhdGlvbkV2ZW50RW1pdHRlcjogSU9iZnVzY2F0aW9uRXZlbnRFbWl0dGVyLFxuICAgICAgICBAaW5qZWN0KFNlcnZpY2VJZGVudGlmaWVycy5JUmFuZG9tR2VuZXJhdG9yKSByYW5kb21HZW5lcmF0b3I6IElSYW5kb21HZW5lcmF0b3IsXG4gICAgICAgIEBpbmplY3QoU2VydmljZUlkZW50aWZpZXJzLklPcHRpb25zKSBvcHRpb25zOiBJT3B0aW9uc1xuICAgICkge1xuICAgICAgICBzdXBlcihyYW5kb21HZW5lcmF0b3IsIG9wdGlvbnMpO1xuXG4gICAgICAgIHRoaXMuY3VzdG9tTm9kZUZhY3RvcnkgPSBjdXN0b21Ob2RlRmFjdG9yeTtcbiAgICAgICAgdGhpcy5vYmZ1c2NhdGlvbkV2ZW50RW1pdHRlciA9IG9iZnVzY2F0aW9uRXZlbnRFbWl0dGVyO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7VE5vZGVXaXRoQmxvY2tTdGF0ZW1lbnR9IGJsb2NrU2NvcGVOb2RlXG4gICAgICogQHBhcmFtIHtJU3RhY2tUcmFjZURhdGFbXX0gc3RhY2tUcmFjZURhdGFcbiAgICAgKi9cbiAgICBwdWJsaWMgYXBwZW5kQ3VzdG9tTm9kZXMgKGJsb2NrU2NvcGVOb2RlOiBUTm9kZVdpdGhCbG9ja1N0YXRlbWVudCwgc3RhY2tUcmFjZURhdGE6IElTdGFja1RyYWNlRGF0YVtdKTogdm9pZCB7XG4gICAgICAgIC8vIGRlYnVnUHJvdGVjdGlvbkZ1bmN0aW9uTm9kZSBhcHBlbmRcbiAgICAgICAgdGhpcy5hcHBlbmRDdXN0b21Ob2RlSWZFeGlzdChDdXN0b21Ob2RlLkRlYnVnUHJvdGVjdGlvbkZ1bmN0aW9uTm9kZSwgKGN1c3RvbU5vZGU6IElDdXN0b21Ob2RlKSA9PiB7XG4gICAgICAgICAgICBOb2RlQXBwZW5kZXIuYXBwZW5kTm9kZShibG9ja1Njb3BlTm9kZSwgY3VzdG9tTm9kZS5nZXROb2RlKCkpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBkZWJ1Z1Byb3RlY3Rpb25GdW5jdGlvbkNhbGxOb2RlIGFwcGVuZFxuICAgICAgICB0aGlzLmFwcGVuZEN1c3RvbU5vZGVJZkV4aXN0KEN1c3RvbU5vZGUuRGVidWdQcm90ZWN0aW9uRnVuY3Rpb25DYWxsTm9kZSwgKGN1c3RvbU5vZGU6IElDdXN0b21Ob2RlKSA9PiB7XG4gICAgICAgICAgICBOb2RlQXBwZW5kZXIuYXBwZW5kTm9kZShibG9ja1Njb3BlTm9kZSwgY3VzdG9tTm9kZS5nZXROb2RlKCkpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBkZWJ1Z1Byb3RlY3Rpb25GdW5jdGlvbkludGVydmFsTm9kZSBhcHBlbmRcbiAgICAgICAgdGhpcy5hcHBlbmRDdXN0b21Ob2RlSWZFeGlzdChDdXN0b21Ob2RlLkRlYnVnUHJvdGVjdGlvbkZ1bmN0aW9uSW50ZXJ2YWxOb2RlLCAoY3VzdG9tTm9kZTogSUN1c3RvbU5vZGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHByb2dyYW1Cb2R5TGVuZ3RoOiBudW1iZXIgPSBibG9ja1Njb3BlTm9kZS5ib2R5Lmxlbmd0aDtcbiAgICAgICAgICAgIGNvbnN0IHJhbmRvbUluZGV4OiBudW1iZXIgPSB0aGlzLnJhbmRvbUdlbmVyYXRvci5nZXRSYW5kb21JbnRlZ2VyKDAsIHByb2dyYW1Cb2R5TGVuZ3RoKTtcblxuICAgICAgICAgICAgTm9kZUFwcGVuZGVyLmluc2VydE5vZGVBdEluZGV4KGJsb2NrU2NvcGVOb2RlLCBjdXN0b21Ob2RlLmdldE5vZGUoKSwgcmFuZG9tSW5kZXgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgaW5pdGlhbGl6ZSAoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuY3VzdG9tTm9kZXMgPSBuZXcgTWFwIDxDdXN0b21Ob2RlLCBJQ3VzdG9tTm9kZT4oKTtcblxuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5kZWJ1Z1Byb3RlY3Rpb24pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGRlYnVnUHJvdGVjdGlvbkZ1bmN0aW9uTmFtZTogc3RyaW5nID0gdGhpcy5yYW5kb21HZW5lcmF0b3IuZ2V0UmFuZG9tVmFyaWFibGVOYW1lKDYpO1xuXG4gICAgICAgIGNvbnN0IGRlYnVnUHJvdGVjdGlvbkZ1bmN0aW9uTm9kZTogSUN1c3RvbU5vZGUgPSB0aGlzLmN1c3RvbU5vZGVGYWN0b3J5KEN1c3RvbU5vZGUuRGVidWdQcm90ZWN0aW9uRnVuY3Rpb25Ob2RlKTtcbiAgICAgICAgY29uc3QgZGVidWdQcm90ZWN0aW9uRnVuY3Rpb25DYWxsTm9kZTogSUN1c3RvbU5vZGUgPSB0aGlzLmN1c3RvbU5vZGVGYWN0b3J5KEN1c3RvbU5vZGUuRGVidWdQcm90ZWN0aW9uRnVuY3Rpb25DYWxsTm9kZSk7XG4gICAgICAgIGNvbnN0IGRlYnVnUHJvdGVjdGlvbkZ1bmN0aW9uSW50ZXJ2YWxOb2RlOiBJQ3VzdG9tTm9kZSA9IHRoaXMuY3VzdG9tTm9kZUZhY3RvcnkoQ3VzdG9tTm9kZS5EZWJ1Z1Byb3RlY3Rpb25GdW5jdGlvbkludGVydmFsTm9kZSk7XG5cbiAgICAgICAgZGVidWdQcm90ZWN0aW9uRnVuY3Rpb25Ob2RlLmluaXRpYWxpemUoZGVidWdQcm90ZWN0aW9uRnVuY3Rpb25OYW1lKTtcbiAgICAgICAgZGVidWdQcm90ZWN0aW9uRnVuY3Rpb25DYWxsTm9kZS5pbml0aWFsaXplKGRlYnVnUHJvdGVjdGlvbkZ1bmN0aW9uTmFtZSk7XG4gICAgICAgIGRlYnVnUHJvdGVjdGlvbkZ1bmN0aW9uSW50ZXJ2YWxOb2RlLmluaXRpYWxpemUoZGVidWdQcm90ZWN0aW9uRnVuY3Rpb25OYW1lKTtcblxuICAgICAgICB0aGlzLmN1c3RvbU5vZGVzLnNldChDdXN0b21Ob2RlLkRlYnVnUHJvdGVjdGlvbkZ1bmN0aW9uTm9kZSwgZGVidWdQcm90ZWN0aW9uRnVuY3Rpb25Ob2RlKTtcbiAgICAgICAgdGhpcy5jdXN0b21Ob2Rlcy5zZXQoQ3VzdG9tTm9kZS5EZWJ1Z1Byb3RlY3Rpb25GdW5jdGlvbkNhbGxOb2RlLCBkZWJ1Z1Byb3RlY3Rpb25GdW5jdGlvbkNhbGxOb2RlKTtcblxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmRlYnVnUHJvdGVjdGlvbkludGVydmFsKSB7XG4gICAgICAgICAgICB0aGlzLmN1c3RvbU5vZGVzLnNldChDdXN0b21Ob2RlLkRlYnVnUHJvdGVjdGlvbkZ1bmN0aW9uSW50ZXJ2YWxOb2RlLCBkZWJ1Z1Byb3RlY3Rpb25GdW5jdGlvbkludGVydmFsTm9kZSk7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=
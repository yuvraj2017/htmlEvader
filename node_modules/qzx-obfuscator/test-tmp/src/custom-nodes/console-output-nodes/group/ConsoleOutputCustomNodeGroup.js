"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var inversify_1 = require("inversify");
var ServiceIdentifiers_1 = require("../../../container/ServiceIdentifiers");
var Initializable_1 = require("../../../decorators/Initializable");
var CustomNode_1 = require("../../../enums/container/custom-nodes/CustomNode");
var ObfuscationEvent_1 = require("../../../enums/event-emitters/ObfuscationEvent");
var AbstractCustomNodeGroup_1 = require("../../AbstractCustomNodeGroup");
var NodeAppender_1 = require("../../../node/NodeAppender");
var ConsoleOutputCustomNodeGroup = function (_AbstractCustomNodeGr) {
    _inherits(ConsoleOutputCustomNodeGroup, _AbstractCustomNodeGr);

    function ConsoleOutputCustomNodeGroup(customNodeFactory, obfuscationEventEmitter, randomGenerator, options) {
        _classCallCheck(this, ConsoleOutputCustomNodeGroup);

        var _this = _possibleConstructorReturn(this, (ConsoleOutputCustomNodeGroup.__proto__ || Object.getPrototypeOf(ConsoleOutputCustomNodeGroup)).call(this, randomGenerator, options));

        _this.appendEvent = ObfuscationEvent_1.ObfuscationEvent.BeforeObfuscation;
        _this.customNodeFactory = customNodeFactory;
        _this.obfuscationEventEmitter = obfuscationEventEmitter;
        return _this;
    }

    _createClass(ConsoleOutputCustomNodeGroup, [{
        key: "appendCustomNodes",
        value: function appendCustomNodes(blockScopeNode, stackTraceData) {
            var randomStackTraceIndex = this.getRandomStackTraceIndex(stackTraceData.length);
            this.appendCustomNodeIfExist(CustomNode_1.CustomNode.ConsoleOutputDisableExpressionNode, function (customNode) {
                NodeAppender_1.NodeAppender.appendNodeToOptimalBlockScope(stackTraceData, blockScopeNode, customNode.getNode(), randomStackTraceIndex);
            });
            this.appendCustomNodeIfExist(CustomNode_1.CustomNode.NodeCallsControllerFunctionNode, function (customNode) {
                var targetBlockScope = void 0;
                if (stackTraceData.length) {
                    targetBlockScope = NodeAppender_1.NodeAppender.getOptimalBlockScope(stackTraceData, randomStackTraceIndex, 1);
                } else {
                    targetBlockScope = blockScopeNode;
                }
                NodeAppender_1.NodeAppender.prependNode(targetBlockScope, customNode.getNode());
            });
        }
    }, {
        key: "initialize",
        value: function initialize() {
            this.customNodes = new Map();
            if (!this.options.disableConsoleOutput) {
                return;
            }
            var callsControllerFunctionName = this.randomGenerator.getRandomVariableName(6);
            var consoleOutputDisableExpressionNode = this.customNodeFactory(CustomNode_1.CustomNode.ConsoleOutputDisableExpressionNode);
            var nodeCallsControllerFunctionNode = this.customNodeFactory(CustomNode_1.CustomNode.NodeCallsControllerFunctionNode);
            consoleOutputDisableExpressionNode.initialize(callsControllerFunctionName);
            nodeCallsControllerFunctionNode.initialize(this.appendEvent, callsControllerFunctionName);
            this.customNodes.set(CustomNode_1.CustomNode.ConsoleOutputDisableExpressionNode, consoleOutputDisableExpressionNode);
            this.customNodes.set(CustomNode_1.CustomNode.NodeCallsControllerFunctionNode, nodeCallsControllerFunctionNode);
        }
    }]);

    return ConsoleOutputCustomNodeGroup;
}(AbstractCustomNodeGroup_1.AbstractCustomNodeGroup);
tslib_1.__decorate([Initializable_1.initializable(), tslib_1.__metadata("design:type", Map)], ConsoleOutputCustomNodeGroup.prototype, "customNodes", void 0);
ConsoleOutputCustomNodeGroup = tslib_1.__decorate([inversify_1.injectable(), tslib_1.__param(0, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.Factory__ICustomNode)), tslib_1.__param(1, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.IObfuscationEventEmitter)), tslib_1.__param(2, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.IRandomGenerator)), tslib_1.__param(3, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.IOptions)), tslib_1.__metadata("design:paramtypes", [Function, Object, Object, Object])], ConsoleOutputCustomNodeGroup);
exports.ConsoleOutputCustomNodeGroup = ConsoleOutputCustomNodeGroup;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29uc29sZU91dHB1dEN1c3RvbU5vZGVHcm91cC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9jdXN0b20tbm9kZXMvY29uc29sZS1vdXRwdXQtbm9kZXMvZ3JvdXAvQ29uc29sZU91dHB1dEN1c3RvbU5vZGVHcm91cC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQSwwQkFBK0M7QUFDL0MsbUNBQTJFO0FBVzNFLDhCQUFrRTtBQUVsRSwyQkFBOEU7QUFDOUUsaUNBQWtGO0FBRWxGLHdDQUF3RTtBQUN4RSw2QkFBMEQ7QUFHMUQ7QUFBQSxBQUFhLEFBQTRCLEFBQUM7O0FBNEJ0QywwQ0FDcUQsQUFBcUMsbUJBQ2pDLEFBQWlELHlCQUN6RCxBQUFpQyxpQkFDekMsQUFBaUI7QUFFdEQsQUFBSzs7Z0tBQUMsQUFBZSxpQkFBRSxBQUFPLEFBQUMsQUFBQzs7QUE5QmpCLGNBQVcsY0FBcUIsbUJBQWdCLGlCQUFDLEFBQWlCLEFBQUM7QUFnQ2xGLEFBQUksY0FBQyxBQUFpQixvQkFBRyxBQUFpQixBQUFDO0FBQzNDLEFBQUksY0FBQyxBQUF1QiwwQkFBRyxBQUF1QixBQUFDLEFBQzNEOztBQUFDLEFBTU0sQUFBaUI7Ozs7MENBQUUsQUFBdUMsZ0JBQUUsQUFBaUM7QUFDaEcsZ0JBQU0sQUFBcUIsd0JBQVcsQUFBSSxLQUFDLEFBQXdCLHlCQUFDLEFBQWMsZUFBQyxBQUFNLEFBQUMsQUFBQztBQUczRixBQUFJLGlCQUFDLEFBQXVCLHdCQUFDLGFBQVUsV0FBQyxBQUFrQyxvQ0FBRSxVQUFDLEFBQXVCO0FBQ2hHLCtCQUFZLGFBQUMsQUFBNkIsOEJBQ3RDLEFBQWMsZ0JBQ2QsQUFBYyxnQkFDZCxBQUFVLFdBQUMsQUFBTyxBQUFFLFdBQ3BCLEFBQXFCLEFBQ3hCLEFBQUMsQUFDTjtBQUFDLEFBQUMsQUFBQztBQUdILEFBQUksaUJBQUMsQUFBdUIsd0JBQUMsYUFBVSxXQUFDLEFBQStCLGlDQUFFLFVBQUMsQUFBdUI7QUFDN0Ysb0JBQUksQUFBeUMsQUFBQztBQUU5QyxBQUFFLEFBQUMsb0JBQUMsQUFBYyxlQUFDLEFBQU0sQUFBQyxRQUFDLEFBQUM7QUFDeEIsQUFBZ0IsdUNBQUcsZUFBWSxhQUFDLEFBQW9CLHFCQUFDLEFBQWMsZ0JBQUUsQUFBcUIsdUJBQUUsQUFBQyxBQUFDLEFBQUMsQUFDbkc7QUFBQyxBQUFDLEFBQUksdUJBQUMsQUFBQztBQUNKLEFBQWdCLHVDQUFHLEFBQWMsQUFBQyxBQUN0QztBQUFDO0FBRUQsK0JBQVksYUFBQyxBQUFXLFlBQUMsQUFBZ0Isa0JBQUUsQUFBVSxXQUFDLEFBQU8sQUFBRSxBQUFDLEFBQUMsQUFDckU7QUFBQyxBQUFDLEFBQUMsQUFDUDtBQUFDLEFBRU0sQUFBVTs7OztBQUNiLEFBQUksaUJBQUMsQUFBVyxjQUFHLElBQUksQUFBRyxBQUE0QixBQUFDO0FBRXZELEFBQUUsQUFBQyxnQkFBQyxDQUFDLEFBQUksS0FBQyxBQUFPLFFBQUMsQUFBb0IsQUFBQyxzQkFBQyxBQUFDO0FBQ3JDLEFBQU0sQUFBQyxBQUNYO0FBQUM7QUFFRCxnQkFBTSxBQUEyQiw4QkFBVyxBQUFJLEtBQUMsQUFBZSxnQkFBQyxBQUFxQixzQkFBQyxBQUFDLEFBQUMsQUFBQztBQUUxRixnQkFBTSxBQUFrQyxxQ0FBZ0IsQUFBSSxLQUFDLEFBQWlCLGtCQUFDLGFBQVUsV0FBQyxBQUFrQyxBQUFDLEFBQUM7QUFDOUgsZ0JBQU0sQUFBK0Isa0NBQWdCLEFBQUksS0FBQyxBQUFpQixrQkFBQyxhQUFVLFdBQUMsQUFBK0IsQUFBQyxBQUFDO0FBRXhILEFBQWtDLCtDQUFDLEFBQVUsV0FBQyxBQUEyQixBQUFDLEFBQUM7QUFDM0UsQUFBK0IsNENBQUMsQUFBVSxXQUFDLEFBQUksS0FBQyxBQUFXLGFBQUUsQUFBMkIsQUFBQyxBQUFDO0FBRTFGLEFBQUksaUJBQUMsQUFBVyxZQUFDLEFBQUcsSUFBQyxhQUFVLFdBQUMsQUFBa0Msb0NBQUUsQUFBa0MsQUFBQyxBQUFDO0FBQ3hHLEFBQUksaUJBQUMsQUFBVyxZQUFDLEFBQUcsSUFBQyxhQUFVLFdBQUMsQUFBK0IsaUNBQUUsQUFBK0IsQUFBQyxBQUFDLEFBQ3RHO0FBQUMsQUFDSjs7OztFQXpGaUQsMEJBQXVCO0FBVXJFLG9CQURDLGdCQUFhLEFBQUUsbURBQ08sQUFBRyxtRUFBMkI7QUFWNUMsQUFBNEIsbURBRHhDLFlBQVUsQUFBRSxjQThCSixtQkFBQSxZQUFNLE9BQUMscUJBQWtCLG1CQUFDLEFBQW9CLEFBQUMsd0JBQy9DLG1CQUFBLFlBQU0sT0FBQyxxQkFBa0IsbUJBQUMsQUFBd0IsQUFBQyw0QkFDbkQsbUJBQUEsWUFBTSxPQUFDLHFCQUFrQixtQkFBQyxBQUFnQixBQUFDLG9CQUMzQyxtQkFBQSxZQUFNLE9BQUMscUJBQWtCLG1CQUFDLEFBQVEsQUFBQywwRkFoQy9CLEFBQTRCLEFBeUZ4QztBQXpGWSx1Q0FBNEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpbmplY3RhYmxlLCBpbmplY3QgfSBmcm9tICdpbnZlcnNpZnknO1xuaW1wb3J0IHsgU2VydmljZUlkZW50aWZpZXJzIH0gZnJvbSAnLi4vLi4vLi4vY29udGFpbmVyL1NlcnZpY2VJZGVudGlmaWVycyc7XG5cbmltcG9ydCB7IFRDdXN0b21Ob2RlRmFjdG9yeSB9IGZyb20gJy4uLy4uLy4uL3R5cGVzL2NvbnRhaW5lci9jdXN0b20tbm9kZXMvVEN1c3RvbU5vZGVGYWN0b3J5JztcbmltcG9ydCB7IFROb2RlV2l0aEJsb2NrU3RhdGVtZW50IH0gZnJvbSAnLi4vLi4vLi4vdHlwZXMvbm9kZS9UTm9kZVdpdGhCbG9ja1N0YXRlbWVudCc7XG5cbmltcG9ydCB7IElDdXN0b21Ob2RlIH0gZnJvbSAnLi4vLi4vLi4vaW50ZXJmYWNlcy9jdXN0b20tbm9kZXMvSUN1c3RvbU5vZGUnO1xuaW1wb3J0IHsgSU9iZnVzY2F0aW9uRXZlbnRFbWl0dGVyIH0gZnJvbSAnLi4vLi4vLi4vaW50ZXJmYWNlcy9ldmVudC1lbWl0dGVycy9JT2JmdXNjYXRpb25FdmVudEVtaXR0ZXInO1xuaW1wb3J0IHsgSU9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi9pbnRlcmZhY2VzL29wdGlvbnMvSU9wdGlvbnMnO1xuaW1wb3J0IHsgSVJhbmRvbUdlbmVyYXRvciB9IGZyb20gJy4uLy4uLy4uL2ludGVyZmFjZXMvdXRpbHMvSVJhbmRvbUdlbmVyYXRvcic7XG5pbXBvcnQgeyBJU3RhY2tUcmFjZURhdGEgfSBmcm9tICcuLi8uLi8uLi9pbnRlcmZhY2VzL3N0YWNrLXRyYWNlLWFuYWx5emVyL0lTdGFja1RyYWNlRGF0YSc7XG5cbmltcG9ydCB7IGluaXRpYWxpemFibGUgfSBmcm9tICcuLi8uLi8uLi9kZWNvcmF0b3JzL0luaXRpYWxpemFibGUnO1xuXG5pbXBvcnQgeyBDdXN0b21Ob2RlIH0gZnJvbSAnLi4vLi4vLi4vZW51bXMvY29udGFpbmVyL2N1c3RvbS1ub2Rlcy9DdXN0b21Ob2RlJztcbmltcG9ydCB7IE9iZnVzY2F0aW9uRXZlbnQgfSBmcm9tICcuLi8uLi8uLi9lbnVtcy9ldmVudC1lbWl0dGVycy9PYmZ1c2NhdGlvbkV2ZW50JztcblxuaW1wb3J0IHsgQWJzdHJhY3RDdXN0b21Ob2RlR3JvdXAgfSBmcm9tICcuLi8uLi9BYnN0cmFjdEN1c3RvbU5vZGVHcm91cCc7XG5pbXBvcnQgeyBOb2RlQXBwZW5kZXIgfSBmcm9tICcuLi8uLi8uLi9ub2RlL05vZGVBcHBlbmRlcic7XG5cbkBpbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBDb25zb2xlT3V0cHV0Q3VzdG9tTm9kZUdyb3VwIGV4dGVuZHMgQWJzdHJhY3RDdXN0b21Ob2RlR3JvdXAge1xuICAgIC8qKlxuICAgICAqIEB0eXBlIHtPYmZ1c2NhdGlvbkV2ZW50fVxuICAgICAqL1xuICAgIHByb3RlY3RlZCByZWFkb25seSBhcHBlbmRFdmVudDogT2JmdXNjYXRpb25FdmVudCA9IE9iZnVzY2F0aW9uRXZlbnQuQmVmb3JlT2JmdXNjYXRpb247XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7TWFwPEN1c3RvbU5vZGUsIElDdXN0b21Ob2RlPn1cbiAgICAgKi9cbiAgICBAaW5pdGlhbGl6YWJsZSgpXG4gICAgcHJvdGVjdGVkIGN1c3RvbU5vZGVzOiBNYXAgPEN1c3RvbU5vZGUsIElDdXN0b21Ob2RlPjtcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtUQ3VzdG9tTm9kZUZhY3Rvcnl9XG4gICAgICovXG4gICAgcHJpdmF0ZSByZWFkb25seSBjdXN0b21Ob2RlRmFjdG9yeTogVEN1c3RvbU5vZGVGYWN0b3J5O1xuXG4gICAgLyoqXG4gICAgICogQHR5cGUge0lPYmZ1c2NhdGlvbkV2ZW50RW1pdHRlcn1cbiAgICAgKi9cbiAgICBwcml2YXRlIHJlYWRvbmx5IG9iZnVzY2F0aW9uRXZlbnRFbWl0dGVyOiBJT2JmdXNjYXRpb25FdmVudEVtaXR0ZXI7XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge1RDdXN0b21Ob2RlRmFjdG9yeX0gY3VzdG9tTm9kZUZhY3RvcnlcbiAgICAgKiBAcGFyYW0ge0lPYmZ1c2NhdGlvbkV2ZW50RW1pdHRlcn0gb2JmdXNjYXRpb25FdmVudEVtaXR0ZXJcbiAgICAgKiBAcGFyYW0ge0lSYW5kb21HZW5lcmF0b3J9IHJhbmRvbUdlbmVyYXRvclxuICAgICAqIEBwYXJhbSB7SU9wdGlvbnN9IG9wdGlvbnNcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvciAoXG4gICAgICAgIEBpbmplY3QoU2VydmljZUlkZW50aWZpZXJzLkZhY3RvcnlfX0lDdXN0b21Ob2RlKSBjdXN0b21Ob2RlRmFjdG9yeTogVEN1c3RvbU5vZGVGYWN0b3J5LFxuICAgICAgICBAaW5qZWN0KFNlcnZpY2VJZGVudGlmaWVycy5JT2JmdXNjYXRpb25FdmVudEVtaXR0ZXIpIG9iZnVzY2F0aW9uRXZlbnRFbWl0dGVyOiBJT2JmdXNjYXRpb25FdmVudEVtaXR0ZXIsXG4gICAgICAgIEBpbmplY3QoU2VydmljZUlkZW50aWZpZXJzLklSYW5kb21HZW5lcmF0b3IpIHJhbmRvbUdlbmVyYXRvcjogSVJhbmRvbUdlbmVyYXRvcixcbiAgICAgICAgQGluamVjdChTZXJ2aWNlSWRlbnRpZmllcnMuSU9wdGlvbnMpIG9wdGlvbnM6IElPcHRpb25zXG4gICAgKSB7XG4gICAgICAgIHN1cGVyKHJhbmRvbUdlbmVyYXRvciwgb3B0aW9ucyk7XG5cbiAgICAgICAgdGhpcy5jdXN0b21Ob2RlRmFjdG9yeSA9IGN1c3RvbU5vZGVGYWN0b3J5O1xuICAgICAgICB0aGlzLm9iZnVzY2F0aW9uRXZlbnRFbWl0dGVyID0gb2JmdXNjYXRpb25FdmVudEVtaXR0ZXI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtUTm9kZVdpdGhCbG9ja1N0YXRlbWVudH0gYmxvY2tTY29wZU5vZGVcbiAgICAgKiBAcGFyYW0ge0lTdGFja1RyYWNlRGF0YVtdfSBzdGFja1RyYWNlRGF0YVxuICAgICAqL1xuICAgIHB1YmxpYyBhcHBlbmRDdXN0b21Ob2RlcyAoYmxvY2tTY29wZU5vZGU6IFROb2RlV2l0aEJsb2NrU3RhdGVtZW50LCBzdGFja1RyYWNlRGF0YTogSVN0YWNrVHJhY2VEYXRhW10pOiB2b2lkIHtcbiAgICAgICAgY29uc3QgcmFuZG9tU3RhY2tUcmFjZUluZGV4OiBudW1iZXIgPSB0aGlzLmdldFJhbmRvbVN0YWNrVHJhY2VJbmRleChzdGFja1RyYWNlRGF0YS5sZW5ndGgpO1xuXG4gICAgICAgIC8vIGNvbnNvbGVPdXRwdXREaXNhYmxlRXhwcmVzc2lvbk5vZGUgYXBwZW5kXG4gICAgICAgIHRoaXMuYXBwZW5kQ3VzdG9tTm9kZUlmRXhpc3QoQ3VzdG9tTm9kZS5Db25zb2xlT3V0cHV0RGlzYWJsZUV4cHJlc3Npb25Ob2RlLCAoY3VzdG9tTm9kZTogSUN1c3RvbU5vZGUpID0+IHtcbiAgICAgICAgICAgIE5vZGVBcHBlbmRlci5hcHBlbmROb2RlVG9PcHRpbWFsQmxvY2tTY29wZShcbiAgICAgICAgICAgICAgICBzdGFja1RyYWNlRGF0YSxcbiAgICAgICAgICAgICAgICBibG9ja1Njb3BlTm9kZSxcbiAgICAgICAgICAgICAgICBjdXN0b21Ob2RlLmdldE5vZGUoKSxcbiAgICAgICAgICAgICAgICByYW5kb21TdGFja1RyYWNlSW5kZXhcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIG5vZGVDYWxsc0NvbnRyb2xsZXJGdW5jdGlvbk5vZGUgYXBwZW5kXG4gICAgICAgIHRoaXMuYXBwZW5kQ3VzdG9tTm9kZUlmRXhpc3QoQ3VzdG9tTm9kZS5Ob2RlQ2FsbHNDb250cm9sbGVyRnVuY3Rpb25Ob2RlLCAoY3VzdG9tTm9kZTogSUN1c3RvbU5vZGUpID0+IHtcbiAgICAgICAgICAgIGxldCB0YXJnZXRCbG9ja1Njb3BlOiBUTm9kZVdpdGhCbG9ja1N0YXRlbWVudDtcblxuICAgICAgICAgICAgaWYgKHN0YWNrVHJhY2VEYXRhLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHRhcmdldEJsb2NrU2NvcGUgPSBOb2RlQXBwZW5kZXIuZ2V0T3B0aW1hbEJsb2NrU2NvcGUoc3RhY2tUcmFjZURhdGEsIHJhbmRvbVN0YWNrVHJhY2VJbmRleCwgMSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRhcmdldEJsb2NrU2NvcGUgPSBibG9ja1Njb3BlTm9kZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgTm9kZUFwcGVuZGVyLnByZXBlbmROb2RlKHRhcmdldEJsb2NrU2NvcGUsIGN1c3RvbU5vZGUuZ2V0Tm9kZSgpKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIGluaXRpYWxpemUgKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmN1c3RvbU5vZGVzID0gbmV3IE1hcCA8Q3VzdG9tTm9kZSwgSUN1c3RvbU5vZGU+KCk7XG5cbiAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuZGlzYWJsZUNvbnNvbGVPdXRwdXQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNhbGxzQ29udHJvbGxlckZ1bmN0aW9uTmFtZTogc3RyaW5nID0gdGhpcy5yYW5kb21HZW5lcmF0b3IuZ2V0UmFuZG9tVmFyaWFibGVOYW1lKDYpO1xuXG4gICAgICAgIGNvbnN0IGNvbnNvbGVPdXRwdXREaXNhYmxlRXhwcmVzc2lvbk5vZGU6IElDdXN0b21Ob2RlID0gdGhpcy5jdXN0b21Ob2RlRmFjdG9yeShDdXN0b21Ob2RlLkNvbnNvbGVPdXRwdXREaXNhYmxlRXhwcmVzc2lvbk5vZGUpO1xuICAgICAgICBjb25zdCBub2RlQ2FsbHNDb250cm9sbGVyRnVuY3Rpb25Ob2RlOiBJQ3VzdG9tTm9kZSA9IHRoaXMuY3VzdG9tTm9kZUZhY3RvcnkoQ3VzdG9tTm9kZS5Ob2RlQ2FsbHNDb250cm9sbGVyRnVuY3Rpb25Ob2RlKTtcblxuICAgICAgICBjb25zb2xlT3V0cHV0RGlzYWJsZUV4cHJlc3Npb25Ob2RlLmluaXRpYWxpemUoY2FsbHNDb250cm9sbGVyRnVuY3Rpb25OYW1lKTtcbiAgICAgICAgbm9kZUNhbGxzQ29udHJvbGxlckZ1bmN0aW9uTm9kZS5pbml0aWFsaXplKHRoaXMuYXBwZW5kRXZlbnQsIGNhbGxzQ29udHJvbGxlckZ1bmN0aW9uTmFtZSk7XG5cbiAgICAgICAgdGhpcy5jdXN0b21Ob2Rlcy5zZXQoQ3VzdG9tTm9kZS5Db25zb2xlT3V0cHV0RGlzYWJsZUV4cHJlc3Npb25Ob2RlLCBjb25zb2xlT3V0cHV0RGlzYWJsZUV4cHJlc3Npb25Ob2RlKTtcbiAgICAgICAgdGhpcy5jdXN0b21Ob2Rlcy5zZXQoQ3VzdG9tTm9kZS5Ob2RlQ2FsbHNDb250cm9sbGVyRnVuY3Rpb25Ob2RlLCBub2RlQ2FsbHNDb250cm9sbGVyRnVuY3Rpb25Ob2RlKTtcbiAgICB9XG59XG4iXX0=
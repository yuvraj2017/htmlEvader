"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var inversify_1 = require("inversify");
var ServiceIdentifiers_1 = require("../../../container/ServiceIdentifiers");
var Initializable_1 = require("../../../decorators/Initializable");
var CustomNode_1 = require("../../../enums/container/custom-nodes/CustomNode");
var ObfuscationEvent_1 = require("../../../enums/event-emitters/ObfuscationEvent");
var AbstractCustomNodeGroup_1 = require("../../AbstractCustomNodeGroup");
var NodeAppender_1 = require("../../../node/NodeAppender");
var Utils_1 = require("../../../utils/Utils");
var StringArrayCustomNodeGroup = function (_AbstractCustomNodeGr) {
    _inherits(StringArrayCustomNodeGroup, _AbstractCustomNodeGr);

    function StringArrayCustomNodeGroup(customNodeFactory, obfuscationEventEmitter, randomGenerator, stringArrayStorage, options) {
        _classCallCheck(this, StringArrayCustomNodeGroup);

        var _this = _possibleConstructorReturn(this, (StringArrayCustomNodeGroup.__proto__ || Object.getPrototypeOf(StringArrayCustomNodeGroup)).call(this, randomGenerator, options));

        _this.appendEvent = ObfuscationEvent_1.ObfuscationEvent.AfterObfuscation;
        _this.customNodeFactory = customNodeFactory;
        _this.obfuscationEventEmitter = obfuscationEventEmitter;
        _this.stringArrayStorage = stringArrayStorage;
        return _this;
    }

    _createClass(StringArrayCustomNodeGroup, [{
        key: "appendCustomNodes",
        value: function appendCustomNodes(blockScopeNode, stackTraceData) {
            if (!this.stringArrayStorage.getLength()) {
                return;
            }
            this.appendCustomNodeIfExist(CustomNode_1.CustomNode.StringArrayNode, function (customNode) {
                NodeAppender_1.NodeAppender.prependNode(blockScopeNode, customNode.getNode());
            });
            this.appendCustomNodeIfExist(CustomNode_1.CustomNode.StringArrayCallsWrapper, function (customNode) {
                NodeAppender_1.NodeAppender.insertNodeAtIndex(blockScopeNode, customNode.getNode(), 1);
            });
            this.appendCustomNodeIfExist(CustomNode_1.CustomNode.StringArrayRotateFunctionNode, function (customNode) {
                NodeAppender_1.NodeAppender.insertNodeAtIndex(blockScopeNode, customNode.getNode(), 1);
            });
        }
    }, {
        key: "initialize",
        value: function initialize() {
            this.customNodes = new Map();
            if (!this.options.stringArray) {
                return;
            }
            var stringArrayNode = this.customNodeFactory(CustomNode_1.CustomNode.StringArrayNode);
            var stringArrayCallsWrapper = this.customNodeFactory(CustomNode_1.CustomNode.StringArrayCallsWrapper);
            var stringArrayRotateFunctionNode = this.customNodeFactory(CustomNode_1.CustomNode.StringArrayRotateFunctionNode);
            var stringArrayStorageId = this.stringArrayStorage.getStorageId();
            var stringArrayName = "_" + Utils_1.Utils.hexadecimalPrefix + stringArrayStorageId;
            var stringArrayCallsWrapperName = "_" + Utils_1.Utils.hexadecimalPrefix + Utils_1.Utils.stringRotate(stringArrayStorageId, 1);
            var stringArrayRotateValue = void 0;
            if (this.options.rotateStringArray) {
                stringArrayRotateValue = this.randomGenerator.getRandomInteger(100, 500);
            } else {
                stringArrayRotateValue = 0;
            }
            stringArrayNode.initialize(this.stringArrayStorage, stringArrayName, stringArrayRotateValue);
            stringArrayCallsWrapper.initialize(this.stringArrayStorage, stringArrayName, stringArrayCallsWrapperName);
            stringArrayRotateFunctionNode.initialize(this.stringArrayStorage, stringArrayName, stringArrayRotateValue);
            this.customNodes.set(CustomNode_1.CustomNode.StringArrayNode, stringArrayNode);
            this.customNodes.set(CustomNode_1.CustomNode.StringArrayCallsWrapper, stringArrayCallsWrapper);
            if (this.options.rotateStringArray) {
                this.customNodes.set(CustomNode_1.CustomNode.StringArrayRotateFunctionNode, stringArrayRotateFunctionNode);
            }
        }
    }]);

    return StringArrayCustomNodeGroup;
}(AbstractCustomNodeGroup_1.AbstractCustomNodeGroup);
tslib_1.__decorate([Initializable_1.initializable(), tslib_1.__metadata("design:type", Map)], StringArrayCustomNodeGroup.prototype, "customNodes", void 0);
tslib_1.__decorate([Initializable_1.initializable(), tslib_1.__metadata("design:type", Object)], StringArrayCustomNodeGroup.prototype, "stringArrayStorage", void 0);
StringArrayCustomNodeGroup = tslib_1.__decorate([inversify_1.injectable(), tslib_1.__param(0, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.Factory__ICustomNode)), tslib_1.__param(1, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.IObfuscationEventEmitter)), tslib_1.__param(2, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.IRandomGenerator)), tslib_1.__param(3, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.TStringArrayStorage)), tslib_1.__param(4, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.IOptions)), tslib_1.__metadata("design:paramtypes", [Function, Object, Object, Object, Object])], StringArrayCustomNodeGroup);
exports.StringArrayCustomNodeGroup = StringArrayCustomNodeGroup;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3RyaW5nQXJyYXlDdXN0b21Ob2RlR3JvdXAuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvY3VzdG9tLW5vZGVzL3N0cmluZy1hcnJheS1ub2Rlcy9ncm91cC9TdHJpbmdBcnJheUN1c3RvbU5vZGVHcm91cC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQSwwQkFBK0M7QUFDL0MsbUNBQTJFO0FBWTNFLDhCQUFrRTtBQUVsRSwyQkFBOEU7QUFDOUUsaUNBQWtGO0FBRWxGLHdDQUF3RTtBQUN4RSw2QkFBMEQ7QUFDMUQsc0JBQTZDO0FBRzdDO0FBQUEsQUFBYSxBQUEwQixBQUFDOztBQW1DcEMsd0NBQ3FELEFBQXFDLG1CQUNqQyxBQUFpRCx5QkFDekQsQUFBaUMsaUJBQzlCLEFBQW9DLG9CQUMvQyxBQUFpQjtBQUV0RCxBQUFLOzs0SkFBQyxBQUFlLGlCQUFFLEFBQU8sQUFBQyxBQUFDOztBQXRDMUIsY0FBVyxjQUFxQixtQkFBZ0IsaUJBQUMsQUFBZ0IsQUFBQztBQXdDeEUsQUFBSSxjQUFDLEFBQWlCLG9CQUFHLEFBQWlCLEFBQUM7QUFDM0MsQUFBSSxjQUFDLEFBQXVCLDBCQUFHLEFBQXVCLEFBQUM7QUFDdkQsQUFBSSxjQUFDLEFBQWtCLHFCQUFHLEFBQWtCLEFBQUMsQUFDakQ7O0FBQUMsQUFNTSxBQUFpQjs7OzswQ0FBRSxBQUF1QyxnQkFBRSxBQUFpQztBQUNoRyxBQUFFLEFBQUMsZ0JBQUMsQ0FBQyxBQUFJLEtBQUMsQUFBa0IsbUJBQUMsQUFBUyxBQUFFLEFBQUMsYUFBQyxBQUFDO0FBQ3ZDLEFBQU0sQUFBQyxBQUNYO0FBQUM7QUFHRCxBQUFJLGlCQUFDLEFBQXVCLHdCQUFDLGFBQVUsV0FBQyxBQUFlLGlCQUFFLFVBQUMsQUFBdUI7QUFDN0UsK0JBQVksYUFBQyxBQUFXLFlBQUMsQUFBYyxnQkFBRSxBQUFVLFdBQUMsQUFBTyxBQUFFLEFBQUMsQUFBQyxBQUNuRTtBQUFD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LDhIQUM4QjtBQTFCckMsQUFBMEIsaURBRHRDLFlBQVUsQUFBRSxjQXFDSixtQkFBQSxZQUFNLE9BQUMscUJBQWtCLG1CQUFDLEFBQW9CLEFBQUMsd0JBQy9DLG1CQUFBLFlBQU0sT0FBQyxxQkFBa0IsbUJBQUMsQUFBd0IsQUFBQyw0QkFDbkQsbUJBQUEsWUFBTSxPQUFDLHFCQUFrQixtQkFBQyxBQUFnQixBQUFDLG9CQUMzQyxtQkFBQSxZQUFNLE9BQUMscUJBQWtCLG1CQUFDLEFBQW1CLEFBQUMsdUJBQzlDLG1CQUFBLFlBQU0sT0FBQyxxQkFBa0IsbUJBQUMsQUFBUSxBQUFDLGtHQXhDL0IsQUFBMEIsQUE2R3RDO0FBN0dZLHFDQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGluamVjdGFibGUsIGluamVjdCB9IGZyb20gJ2ludmVyc2lmeSc7XG5pbXBvcnQgeyBTZXJ2aWNlSWRlbnRpZmllcnMgfSBmcm9tICcuLi8uLi8uLi9jb250YWluZXIvU2VydmljZUlkZW50aWZpZXJzJztcblxuaW1wb3J0IHsgVEN1c3RvbU5vZGVGYWN0b3J5IH0gZnJvbSAnLi4vLi4vLi4vdHlwZXMvY29udGFpbmVyL2N1c3RvbS1ub2Rlcy9UQ3VzdG9tTm9kZUZhY3RvcnknO1xuaW1wb3J0IHsgVE5vZGVXaXRoQmxvY2tTdGF0ZW1lbnQgfSBmcm9tICcuLi8uLi8uLi90eXBlcy9ub2RlL1ROb2RlV2l0aEJsb2NrU3RhdGVtZW50JztcblxuaW1wb3J0IHsgSUN1c3RvbU5vZGUgfSBmcm9tICcuLi8uLi8uLi9pbnRlcmZhY2VzL2N1c3RvbS1ub2Rlcy9JQ3VzdG9tTm9kZSc7XG5pbXBvcnQgeyBJT2JmdXNjYXRpb25FdmVudEVtaXR0ZXIgfSBmcm9tICcuLi8uLi8uLi9pbnRlcmZhY2VzL2V2ZW50LWVtaXR0ZXJzL0lPYmZ1c2NhdGlvbkV2ZW50RW1pdHRlcic7XG5pbXBvcnQgeyBJT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uL2ludGVyZmFjZXMvb3B0aW9ucy9JT3B0aW9ucyc7XG5pbXBvcnQgeyBJUmFuZG9tR2VuZXJhdG9yIH0gZnJvbSAnLi4vLi4vLi4vaW50ZXJmYWNlcy91dGlscy9JUmFuZG9tR2VuZXJhdG9yJztcbmltcG9ydCB7IElTdGFja1RyYWNlRGF0YSB9IGZyb20gJy4uLy4uLy4uL2ludGVyZmFjZXMvc3RhY2stdHJhY2UtYW5hbHl6ZXIvSVN0YWNrVHJhY2VEYXRhJztcbmltcG9ydCB7IElTdG9yYWdlIH0gZnJvbSAnLi4vLi4vLi4vaW50ZXJmYWNlcy9zdG9yYWdlcy9JU3RvcmFnZSc7XG5cbmltcG9ydCB7IGluaXRpYWxpemFibGUgfSBmcm9tICcuLi8uLi8uLi9kZWNvcmF0b3JzL0luaXRpYWxpemFibGUnO1xuXG5pbXBvcnQgeyBDdXN0b21Ob2RlIH0gZnJvbSAnLi4vLi4vLi4vZW51bXMvY29udGFpbmVyL2N1c3RvbS1ub2Rlcy9DdXN0b21Ob2RlJztcbmltcG9ydCB7IE9iZnVzY2F0aW9uRXZlbnQgfSBmcm9tICcuLi8uLi8uLi9lbnVtcy9ldmVudC1lbWl0dGVycy9PYmZ1c2NhdGlvbkV2ZW50JztcblxuaW1wb3J0IHsgQWJzdHJhY3RDdXN0b21Ob2RlR3JvdXAgfSBmcm9tICcuLi8uLi9BYnN0cmFjdEN1c3RvbU5vZGVHcm91cCc7XG5pbXBvcnQgeyBOb2RlQXBwZW5kZXIgfSBmcm9tICcuLi8uLi8uLi9ub2RlL05vZGVBcHBlbmRlcic7XG5pbXBvcnQgeyBVdGlscyB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL1V0aWxzJztcblxuQGluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFN0cmluZ0FycmF5Q3VzdG9tTm9kZUdyb3VwIGV4dGVuZHMgQWJzdHJhY3RDdXN0b21Ob2RlR3JvdXAge1xuICAgIC8qKlxuICAgICAqIEB0eXBlIHtPYmZ1c2NhdGlvbkV2ZW50fVxuICAgICAqL1xuICAgIHByb3RlY3RlZCBhcHBlbmRFdmVudDogT2JmdXNjYXRpb25FdmVudCA9IE9iZnVzY2F0aW9uRXZlbnQuQWZ0ZXJPYmZ1c2NhdGlvbjtcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtNYXA8Q3VzdG9tTm9kZSwgSUN1c3RvbU5vZGU+fVxuICAgICAqL1xuICAgIEBpbml0aWFsaXphYmxlKClcbiAgICBwcm90ZWN0ZWQgY3VzdG9tTm9kZXM6IE1hcCA8Q3VzdG9tTm9kZSwgSUN1c3RvbU5vZGU+O1xuXG4gICAgLyoqXG4gICAgICogQHR5cGUge1RDdXN0b21Ob2RlRmFjdG9yeX1cbiAgICAgKi9cbiAgICBwcml2YXRlIHJlYWRvbmx5IGN1c3RvbU5vZGVGYWN0b3J5OiBUQ3VzdG9tTm9kZUZhY3Rvcnk7XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7SU9iZnVzY2F0aW9uRXZlbnRFbWl0dGVyfVxuICAgICAqL1xuICAgIHByaXZhdGUgcmVhZG9ubHkgb2JmdXNjYXRpb25FdmVudEVtaXR0ZXI6IElPYmZ1c2NhdGlvbkV2ZW50RW1pdHRlcjtcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtJU3RvcmFnZSA8c3RyaW5nPn1cbiAgICAgKi9cbiAgICBAaW5pdGlhbGl6YWJsZSgpXG4gICAgcHJpdmF0ZSBzdHJpbmdBcnJheVN0b3JhZ2U6IElTdG9yYWdlIDxzdHJpbmc+O1xuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtUQ3VzdG9tTm9kZUZhY3Rvcnl9IGN1c3RvbU5vZGVGYWN0b3J5XG4gICAgICogQHBhcmFtIHtJT2JmdXNjYXRpb25FdmVudEVtaXR0ZXJ9IG9iZnVzY2F0aW9uRXZlbnRFbWl0dGVyXG4gICAgICogQHBhcmFtIHtJUmFuZG9tR2VuZXJhdG9yfSByYW5kb21HZW5lcmF0b3JcbiAgICAgKiBAcGFyYW0ge0lTdG9yYWdlPHN0cmluZz59IHN0cmluZ0FycmF5U3RvcmFnZVxuICAgICAqIEBwYXJhbSB7SU9wdGlvbnN9IG9wdGlvbnNcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvciAoXG4gICAgICAgIEBpbmplY3QoU2VydmljZUlkZW50aWZpZXJzLkZhY3RvcnlfX0lDdXN0b21Ob2RlKSBjdXN0b21Ob2RlRmFjdG9yeTogVEN1c3RvbU5vZGVGYWN0b3J5LFxuICAgICAgICBAaW5qZWN0KFNlcnZpY2VJZGVudGlmaWVycy5JT2JmdXNjYXRpb25FdmVudEVtaXR0ZXIpIG9iZnVzY2F0aW9uRXZlbnRFbWl0dGVyOiBJT2JmdXNjYXRpb25FdmVudEVtaXR0ZXIsXG4gICAgICAgIEBpbmplY3QoU2VydmljZUlkZW50aWZpZXJzLklSYW5kb21HZW5lcmF0b3IpIHJhbmRvbUdlbmVyYXRvcjogSVJhbmRvbUdlbmVyYXRvcixcbiAgICAgICAgQGluamVjdChTZXJ2aWNlSWRlbnRpZmllcnMuVFN0cmluZ0FycmF5U3RvcmFnZSkgc3RyaW5nQXJyYXlTdG9yYWdlOiBJU3RvcmFnZTxzdHJpbmc+LFxuICAgICAgICBAaW5qZWN0KFNlcnZpY2VJZGVudGlmaWVycy5JT3B0aW9ucykgb3B0aW9uczogSU9wdGlvbnNcbiAgICApIHtcbiAgICAgICAgc3VwZXIocmFuZG9tR2VuZXJhdG9yLCBvcHRpb25zKTtcblxuICAgICAgICB0aGlzLmN1c3RvbU5vZGVGYWN0b3J5ID0gY3VzdG9tTm9kZUZhY3Rvcnk7XG4gICAgICAgIHRoaXMub2JmdXNjYXRpb25FdmVudEVtaXR0ZXIgPSBvYmZ1c2NhdGlvbkV2ZW50RW1pdHRlcjtcbiAgICAgICAgdGhpcy5zdHJpbmdBcnJheVN0b3JhZ2UgPSBzdHJpbmdBcnJheVN0b3JhZ2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtUTm9kZVdpdGhCbG9ja1N0YXRlbWVudH0gYmxvY2tTY29wZU5vZGVcbiAgICAgKiBAcGFyYW0ge0lTdGFja1RyYWNlRGF0YVtdfSBzdGFja1RyYWNlRGF0YVxuICAgICAqL1xuICAgIHB1YmxpYyBhcHBlbmRDdXN0b21Ob2RlcyAoYmxvY2tTY29wZU5vZGU6IFROb2RlV2l0aEJsb2NrU3RhdGVtZW50LCBzdGFja1RyYWNlRGF0YTogSVN0YWNrVHJhY2VEYXRhW10pOiB2b2lkIHtcbiAgICAgICAgaWYgKCF0aGlzLnN0cmluZ0FycmF5U3RvcmFnZS5nZXRMZW5ndGgoKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gc3RyaW5nQXJyYXlOb2RlIGFwcGVuZFxuICAgICAgICB0aGlzLmFwcGVuZEN1c3RvbU5vZGVJZkV4aXN0KEN1c3RvbU5vZGUuU3RyaW5nQXJyYXlOb2RlLCAoY3VzdG9tTm9kZTogSUN1c3RvbU5vZGUpID0+IHtcbiAgICAgICAgICAgIE5vZGVBcHBlbmRlci5wcmVwZW5kTm9kZShibG9ja1Njb3BlTm9kZSwgY3VzdG9tTm9kZS5nZXROb2RlKCkpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBzdHJpbmdBcnJheUNhbGxzV3JhcHBlciBhcHBlbmRcbiAgICAgICAgdGhpcy5hcHBlbmRDdXN0b21Ob2RlSWZFeGlzdChDdXN0b21Ob2RlLlN0cmluZ0FycmF5Q2FsbHNXcmFwcGVyLCAoY3VzdG9tTm9kZTogSUN1c3RvbU5vZGUpID0+IHtcbiAgICAgICAgICAgIE5vZGVBcHBlbmRlci5pbnNlcnROb2RlQXRJbmRleChibG9ja1Njb3BlTm9kZSwgY3VzdG9tTm9kZS5nZXROb2RlKCksIDEpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBzdHJpbmdBcnJheVJvdGF0ZUZ1bmN0aW9uTm9kZSBhcHBlbmRcbiAgICAgICAgdGhpcy5hcHBlbmRDdXN0b21Ob2RlSWZFeGlzdChDdXN0b21Ob2RlLlN0cmluZ0FycmF5Um90YXRlRnVuY3Rpb25Ob2RlLCAoY3VzdG9tTm9kZTogSUN1c3RvbU5vZGUpID0+IHtcbiAgICAgICAgICAgIE5vZGVBcHBlbmRlci5pbnNlcnROb2RlQXRJbmRleChibG9ja1Njb3BlTm9kZSwgY3VzdG9tTm9kZS5nZXROb2RlKCksIDEpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgaW5pdGlhbGl6ZSAoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuY3VzdG9tTm9kZXMgPSBuZXcgTWFwIDxDdXN0b21Ob2RlLCBJQ3VzdG9tTm9kZT4oKTtcblxuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5zdHJpbmdBcnJheSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc3RyaW5nQXJyYXlOb2RlOiBJQ3VzdG9tTm9kZSA9IHRoaXMuY3VzdG9tTm9kZUZhY3RvcnkoQ3VzdG9tTm9kZS5TdHJpbmdBcnJheU5vZGUpO1xuICAgICAgICBjb25zdCBzdHJpbmdBcnJheUNhbGxzV3JhcHBlcjogSUN1c3RvbU5vZGUgPSB0aGlzLmN1c3RvbU5vZGVGYWN0b3J5KEN1c3RvbU5vZGUuU3RyaW5nQXJyYXlDYWxsc1dyYXBwZXIpO1xuICAgICAgICBjb25zdCBzdHJpbmdBcnJheVJvdGF0ZUZ1bmN0aW9uTm9kZTogSUN1c3RvbU5vZGUgPSB0aGlzLmN1c3RvbU5vZGVGYWN0b3J5KEN1c3RvbU5vZGUuU3RyaW5nQXJyYXlSb3RhdGVGdW5jdGlvbk5vZGUpO1xuXG4gICAgICAgIGNvbnN0IHN0cmluZ0FycmF5U3RvcmFnZUlkOiBzdHJpbmcgPSB0aGlzLnN0cmluZ0FycmF5U3RvcmFnZS5nZXRTdG9yYWdlSWQoKTtcblxuICAgICAgICBjb25zdCBzdHJpbmdBcnJheU5hbWU6IHN0cmluZyA9IGBfJHtVdGlscy5oZXhhZGVjaW1hbFByZWZpeH0ke3N0cmluZ0FycmF5U3RvcmFnZUlkfWA7XG4gICAgICAgIGNvbnN0IHN0cmluZ0FycmF5Q2FsbHNXcmFwcGVyTmFtZTogc3RyaW5nID0gYF8ke1V0aWxzLmhleGFkZWNpbWFsUHJlZml4fSR7VXRpbHMuc3RyaW5nUm90YXRlKHN0cmluZ0FycmF5U3RvcmFnZUlkLCAxKX1gO1xuXG4gICAgICAgIGxldCBzdHJpbmdBcnJheVJvdGF0ZVZhbHVlOiBudW1iZXI7XG5cbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5yb3RhdGVTdHJpbmdBcnJheSkge1xuICAgICAgICAgICAgc3RyaW5nQXJyYXlSb3RhdGVWYWx1ZSA9IHRoaXMucmFuZG9tR2VuZXJhdG9yLmdldFJhbmRvbUludGVnZXIoMTAwLCA1MDApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3RyaW5nQXJyYXlSb3RhdGVWYWx1ZSA9IDA7XG4gICAgICAgIH1cblxuICAgICAgICBzdHJpbmdBcnJheU5vZGUuaW5pdGlhbGl6ZSh0aGlzLnN0cmluZ0FycmF5U3RvcmFnZSwgc3RyaW5nQXJyYXlOYW1lLCBzdHJpbmdBcnJheVJvdGF0ZVZhbHVlKTtcbiAgICAgICAgc3RyaW5nQXJyYXlDYWxsc1dyYXBwZXIuaW5pdGlhbGl6ZSh0aGlzLnN0cmluZ0FycmF5U3RvcmFnZSwgc3RyaW5nQXJyYXlOYW1lLCBzdHJpbmdBcnJheUNhbGxzV3JhcHBlck5hbWUpO1xuICAgICAgICBzdHJpbmdBcnJheVJvdGF0ZUZ1bmN0aW9uTm9kZS5pbml0aWFsaXplKHRoaXMuc3RyaW5nQXJyYXlTdG9yYWdlLCBzdHJpbmdBcnJheU5hbWUsIHN0cmluZ0FycmF5Um90YXRlVmFsdWUpO1xuXG4gICAgICAgIHRoaXMuY3VzdG9tTm9kZXMuc2V0KEN1c3RvbU5vZGUuU3RyaW5nQXJyYXlOb2RlLCBzdHJpbmdBcnJheU5vZGUpO1xuICAgICAgICB0aGlzLmN1c3RvbU5vZGVzLnNldChDdXN0b21Ob2RlLlN0cmluZ0FycmF5Q2FsbHNXcmFwcGVyLCBzdHJpbmdBcnJheUNhbGxzV3JhcHBlcik7XG5cbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5yb3RhdGVTdHJpbmdBcnJheSkge1xuICAgICAgICAgICAgdGhpcy5jdXN0b21Ob2Rlcy5zZXQoQ3VzdG9tTm9kZS5TdHJpbmdBcnJheVJvdGF0ZUZ1bmN0aW9uTm9kZSwgc3RyaW5nQXJyYXlSb3RhdGVGdW5jdGlvbk5vZGUpO1xuICAgICAgICB9XG4gICAgfVxufVxuIl19
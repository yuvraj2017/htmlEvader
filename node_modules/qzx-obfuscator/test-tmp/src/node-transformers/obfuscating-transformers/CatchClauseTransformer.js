"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var inversify_1 = require("inversify");
var ServiceIdentifiers_1 = require("../../container/ServiceIdentifiers");
var estraverse = require("estraverse");
var IdentifierObfuscatingReplacer_1 = require("../../enums/container/node-transformers/IdentifierObfuscatingReplacer");
var AbstractNodeTransformer_1 = require("../AbstractNodeTransformer");
var Node_1 = require("../../node/Node");
var CatchClauseTransformer = function (_AbstractNodeTransfor) {
    _inherits(CatchClauseTransformer, _AbstractNodeTransfor);

    function CatchClauseTransformer(identifierObfuscatingReplacerFactory, randomGenerator, options) {
        _classCallCheck(this, CatchClauseTransformer);

        var _this = _possibleConstructorReturn(this, (CatchClauseTransformer.__proto__ || Object.getPrototypeOf(CatchClauseTransformer)).call(this, randomGenerator, options));

        _this.identifierObfuscatingReplacer = identifierObfuscatingReplacerFactory(IdentifierObfuscatingReplacer_1.IdentifierObfuscatingReplacer.BaseIdentifierObfuscatingReplacer);
        return _this;
    }

    _createClass(CatchClauseTransformer, [{
        key: "getVisitor",
        value: function getVisitor() {
            var _this2 = this;

            return {
                enter: function enter(node, parentNode) {
                    if (Node_1.Node.isCatchClauseNode(node)) {
                        return _this2.transformNode(node, parentNode);
                    }
                }
            };
        }
    }, {
        key: "transformNode",
        value: function transformNode(catchClauseNode, parentNode) {
            var nodeIdentifier = this.nodeIdentifier++;
            this.storeCatchClauseParam(catchClauseNode, nodeIdentifier);
            this.replaceCatchClauseParam(catchClauseNode, nodeIdentifier);
            return catchClauseNode;
        }
    }, {
        key: "storeCatchClauseParam",
        value: function storeCatchClauseParam(catchClauseNode, nodeIdentifier) {
            if (Node_1.Node.isIdentifierNode(catchClauseNode.param)) {
                this.identifierObfuscatingReplacer.storeNames(catchClauseNode.param.name, nodeIdentifier);
            }
        }
    }, {
        key: "replaceCatchClauseParam",
        value: function replaceCatchClauseParam(catchClauseNode, nodeIdentifier) {
            var _this3 = this;

            estraverse.replace(catchClauseNode, {
                enter: function enter(node, parentNode) {
                    if (Node_1.Node.isReplaceableIdentifierNode(node, parentNode)) {
                        var newIdentifier = _this3.identifierObfuscatingReplacer.replace(node.name, nodeIdentifier);
                        var newIdentifierName = newIdentifier.name;
                        if (node.name !== newIdentifierName) {
                            node.name = newIdentifierName;
                            node.obfuscatedNode = true;
                        }
                    }
                }
            });
        }
    }]);

    return CatchClauseTransformer;
}(AbstractNodeTransformer_1.AbstractNodeTransformer);
CatchClauseTransformer = tslib_1.__decorate([inversify_1.injectable(), tslib_1.__param(0, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.Factory__IIdentifierObfuscatingReplacer)), tslib_1.__param(1, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.IRandomGenerator)), tslib_1.__param(2, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.IOptions)), tslib_1.__metadata("design:paramtypes", [Function, Object, Object])], CatchClauseTransformer);
exports.CatchClauseTransformer = CatchClauseTransformer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ2F0Y2hDbGF1c2VUcmFuc2Zvcm1lci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9ub2RlLXRyYW5zZm9ybWVycy9vYmZ1c2NhdGluZy10cmFuc2Zvcm1lcnMvQ2F0Y2hDbGF1c2VUcmFuc2Zvcm1lci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQSwwQkFBK0M7QUFDL0MsbUNBQXdFO0FBRXhFLHlCQUF5QztBQVV6Qyw4Q0FBc0g7QUFFdEgsd0NBQXFFO0FBQ3JFLHFCQUF1QztBQVd2QztBQUFBLEFBQWEsQUFBc0IsQUFBQzs7QUFXaEMsb0NBRVEsQUFBMkUsc0NBQ2xDLEFBQWlDLGlCQUN6QyxBQUFpQjtBQUV0RCxBQUFLOztvSkFBQyxBQUFlLGlCQUFFLEFBQU8sQUFBQyxBQUFDOztBQUVoQyxBQUFJLGNBQUMsQUFBNkIsZ0NBQUcsQUFBb0MscUNBQ3JFLGdDQUE2Qiw4QkFBQyxBQUFpQyxBQUNsRSxBQUFDLEFBQ047O0FBQUMsQUFLTSxBQUFVOzs7Ozs7O0FBQ2IsQUFBTTtBQUNGLEFBQUssdUJBQUUsZUFBQyxBQUFpQixNQUFFLEFBQXVCO0FBQzlDLEFBQUUsQUFBQyx3QkFBQyxPQUFJLEtBQUMsQUFBaUIsa0JBQUMsQUFBSSxBQUFDLEFBQUMsT0FBQyxBQUFDO0FBQy9CLEFBQU0sK0JBQUMsQUFBSSxPQUFDLEFBQWEsY0FBQyxBQUFJLE1BQUUsQUFBVSxBQUFDLEFBQUMsQUFDaEQ7QUFBQyxBQUNMO0FBQUMsQUFDSixBQUFDLEFBQ047QUFQVztBQU9WLEFBT00sQUFBYTs7O3NDQUFFLEFBQW1DLGlCQUFFLEFBQXVCO0FBQzlFLGdCQUFNLEFBQWMsaUJBQVcsQUFBSSxLQUFDLEFBQWMsQUFBRSxBQUFDO0FBRXJELEFBQUksaUJBQUMsQUFBcUIsc0JBQUMsQUFBZSxpQkFBRSxBQUFjLEFBQUMsQUFBQztBQUM1RCxBQUFJLGlCQUFDLEFBQXVCLHdCQUFDLEFBQWUsaUJBQUUsQUFBYyxBQUFDLEFBQUM7QUFFOUQsQUFBTSxtQkFBQyxBQUFlLEFBQUMsQUFDM0I7QUFBQyxBQU1PLEFBQXFCOzs7OENBQUUsQUFBbUMsaUJBQUUsQUFBc0I7QUFDdEYsQUFBRSxBQUFDLGdCQUFDLE9BQUksS0FBQyxBQUFnQixpQkFBQyxBQUFlLGdCQUFDLEFBQUssQUFBQyxBQUFDLFFBQUMsQUFBQztBQUMvQyxBQUFJLHFCQUFDLEFBQTZCLDhCQUFDLEFBQVUsV0FBQyxBQUFlLGdCQUFDLEFBQUssTUFBQyxBQUFJLE1BQUUsQUFBYyxBQUFDLEFBQUMsQUFDOUY7QUFBQyxBQUNMO0FBQUMsQUFNTyxBQUF1Qjs7O2dEQUFFLEFBQW1DLGlCQUFFLEFBQXNCOzs7QUFDeEYsQUFBVSx1QkFBQyxBQUFPLFFBQUMsQUFBZTtBQUM5QixBQUFLLHVCQUFFLGVBQUMsQUFBaUIsTUFBRSxBQUF1QjtBQUM5QyxBQUFFLEFBQUMsd0JBQUMsT0FBSSxLQUFDLEFBQTJCLDRCQUFDLEFBQUksTUFBRSxBQUFVLEFBQUMsQUFBQyxhQUFDLEFBQUM7QUFDckQsNEJBQU0sQUFBYSxnQkFBc0IsQUFBSSxPQUFDLEFBQTZCLDhCQUFDLEFBQU8sUUFBQyxBQUFJLEtBQUMsQUFBSSxNQUFFLEFBQWMsQUFBQyxBQUFDO0FBQy9HLDRCQUFNLEFBQWlCLG9CQUFXLEFBQWEsY0FBQyxBQUFJLEFBQUM7QUFFckQsQUFBRSxBQUFDLDRCQUFDLEFBQUksS0FBQyxBQUFJLFNBQUssQUFBaUIsQUFBQyxtQkFBQyxBQUFDO0FBQ2xDLEFBQUksaUNBQUMsQUFBSSxPQUFHLEFBQWlCLEFBQUM7QUFDOUIsQUFBSSxpQ0FBQyxBQUFjLGlCQUFHLEFBQUksQUFBQyxBQUMvQjtBQUFDLEFBQ0w7QUFBQyxBQUNMO0FBQUMsQUFDSixBQUFDLEFBQUMsQUFDUDtBQWJ3QztBQWF2QyxBQUNKOzs7O0VBaEYyQywwQkFBdUI7QUFBdEQsQUFBc0IsNkNBRGxDLFlBQVUsQUFBRSxjQWFKLG1CQUFBLFlBQU0sT0FBQyxxQkFBa0IsbUJBQUMsQUFBdUMsQUFBQywyQ0FFbEUsbUJBQUEsWUFBTSxPQUFDLHFCQUFrQixtQkFBQyxBQUFnQixBQUFDLG9CQUMzQyxtQkFBQSxZQUFNLE9BQUMscUJBQWtCLG1CQUFDLEFBQVEsQUFBQyxrRkFmL0IsQUFBc0IsQUFnRmxDO0FBaEZZLGlDQUFzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGluamVjdGFibGUsIGluamVjdCB9IGZyb20gJ2ludmVyc2lmeSc7XG5pbXBvcnQgeyBTZXJ2aWNlSWRlbnRpZmllcnMgfSBmcm9tICcuLi8uLi9jb250YWluZXIvU2VydmljZUlkZW50aWZpZXJzJztcblxuaW1wb3J0ICogYXMgZXN0cmF2ZXJzZSBmcm9tICdlc3RyYXZlcnNlJztcbmltcG9ydCAqIGFzIEVTVHJlZSBmcm9tICdlc3RyZWUnO1xuXG5pbXBvcnQgeyBUSWRlbnRpZmllck9iZnVzY2F0aW5nUmVwbGFjZXJGYWN0b3J5IH0gZnJvbSAnLi4vLi4vdHlwZXMvY29udGFpbmVyL25vZGUtdHJhbnNmb3JtZXJzL1RJZGVudGlmaWVyT2JmdXNjYXRpbmdSZXBsYWNlckZhY3RvcnknO1xuXG5pbXBvcnQgeyBJSWRlbnRpZmllck9iZnVzY2F0aW5nUmVwbGFjZXIgfSBmcm9tICcuLi8uLi9pbnRlcmZhY2VzL25vZGUtdHJhbnNmb3JtZXJzL29iZnVzY2F0aW5nLXRyYW5zZm9ybWVycy9JSWRlbnRpZmllck9iZnVzY2F0aW5nUmVwbGFjZXInO1xuaW1wb3J0IHsgSU9wdGlvbnMgfSBmcm9tICcuLi8uLi9pbnRlcmZhY2VzL29wdGlvbnMvSU9wdGlvbnMnO1xuaW1wb3J0IHsgSVJhbmRvbUdlbmVyYXRvciB9IGZyb20gJy4uLy4uL2ludGVyZmFjZXMvdXRpbHMvSVJhbmRvbUdlbmVyYXRvcic7XG5pbXBvcnQgeyBJVmlzaXRvciB9IGZyb20gJy4uLy4uL2ludGVyZmFjZXMvSVZpc2l0b3InO1xuXG5pbXBvcnQgeyBJZGVudGlmaWVyT2JmdXNjYXRpbmdSZXBsYWNlciB9IGZyb20gJy4uLy4uL2VudW1zL2NvbnRhaW5lci9ub2RlLXRyYW5zZm9ybWVycy9JZGVudGlmaWVyT2JmdXNjYXRpbmdSZXBsYWNlcic7XG5cbmltcG9ydCB7IEFic3RyYWN0Tm9kZVRyYW5zZm9ybWVyIH0gZnJvbSAnLi4vQWJzdHJhY3ROb2RlVHJhbnNmb3JtZXInO1xuaW1wb3J0IHsgTm9kZSB9IGZyb20gJy4uLy4uL25vZGUvTm9kZSc7XG5cbi8qKlxuICogcmVwbGFjZXM6XG4gKiAgICAgdHJ5IHt9IGNhdGNoIChlKSB7IGNvbnNvbGUubG9nKGUpOyB9O1xuICpcbiAqIG9uOlxuICogICAgIHRyeSB7fSBjYXRjaCAoXzB4MTJkNDVmKSB7IGNvbnNvbGUubG9nKF8weDEyZDQ1Zik7IH07XG4gKlxuICovXG5AaW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgQ2F0Y2hDbGF1c2VUcmFuc2Zvcm1lciBleHRlbmRzIEFic3RyYWN0Tm9kZVRyYW5zZm9ybWVyIHtcbiAgICAvKipcbiAgICAgKiBAdHlwZSB7SUlkZW50aWZpZXJPYmZ1c2NhdGluZ1JlcGxhY2VyfVxuICAgICAqL1xuICAgIHByaXZhdGUgcmVhZG9ubHkgaWRlbnRpZmllck9iZnVzY2F0aW5nUmVwbGFjZXI6IElJZGVudGlmaWVyT2JmdXNjYXRpbmdSZXBsYWNlcjtcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7VElkZW50aWZpZXJPYmZ1c2NhdGluZ1JlcGxhY2VyRmFjdG9yeX0gaWRlbnRpZmllck9iZnVzY2F0aW5nUmVwbGFjZXJGYWN0b3J5XG4gICAgICogQHBhcmFtIHtJUmFuZG9tR2VuZXJhdG9yfSByYW5kb21HZW5lcmF0b3JcbiAgICAgKiBAcGFyYW0ge0lPcHRpb25zfSBvcHRpb25zXG4gICAgICovXG4gICAgY29uc3RydWN0b3IgKFxuICAgICAgICBAaW5qZWN0KFNlcnZpY2VJZGVudGlmaWVycy5GYWN0b3J5X19JSWRlbnRpZmllck9iZnVzY2F0aW5nUmVwbGFjZXIpXG4gICAgICAgICAgICBpZGVudGlmaWVyT2JmdXNjYXRpbmdSZXBsYWNlckZhY3Rvcnk6IFRJZGVudGlmaWVyT2JmdXNjYXRpbmdSZXBsYWNlckZhY3RvcnksXG4gICAgICAgIEBpbmplY3QoU2VydmljZUlkZW50aWZpZXJzLklSYW5kb21HZW5lcmF0b3IpIHJhbmRvbUdlbmVyYXRvcjogSVJhbmRvbUdlbmVyYXRvcixcbiAgICAgICAgQGluamVjdChTZXJ2aWNlSWRlbnRpZmllcnMuSU9wdGlvbnMpIG9wdGlvbnM6IElPcHRpb25zXG4gICAgKSB7XG4gICAgICAgIHN1cGVyKHJhbmRvbUdlbmVyYXRvciwgb3B0aW9ucyk7XG5cbiAgICAgICAgdGhpcy5pZGVudGlmaWVyT2JmdXNjYXRpbmdSZXBsYWNlciA9IGlkZW50aWZpZXJPYmZ1c2NhdGluZ1JlcGxhY2VyRmFjdG9yeShcbiAgICAgICAgICAgIElkZW50aWZpZXJPYmZ1c2NhdGluZ1JlcGxhY2VyLkJhc2VJZGVudGlmaWVyT2JmdXNjYXRpbmdSZXBsYWNlclxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEByZXR1cm4ge0lWaXNpdG9yfVxuICAgICAqL1xuICAgIHB1YmxpYyBnZXRWaXNpdG9yICgpOiBJVmlzaXRvciB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBlbnRlcjogKG5vZGU6IEVTVHJlZS5Ob2RlLCBwYXJlbnROb2RlOiBFU1RyZWUuTm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChOb2RlLmlzQ2F0Y2hDbGF1c2VOb2RlKG5vZGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRyYW5zZm9ybU5vZGUobm9kZSwgcGFyZW50Tm9kZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7Q2F0Y2hDbGF1c2V9IGNhdGNoQ2xhdXNlTm9kZVxuICAgICAqIEBwYXJhbSB7Tm9kZX0gcGFyZW50Tm9kZVxuICAgICAqIEByZXR1cm5zIHtOb2RlfVxuICAgICAqL1xuICAgIHB1YmxpYyB0cmFuc2Zvcm1Ob2RlIChjYXRjaENsYXVzZU5vZGU6IEVTVHJlZS5DYXRjaENsYXVzZSwgcGFyZW50Tm9kZTogRVNUcmVlLk5vZGUpOiBFU1RyZWUuTm9kZSB7XG4gICAgICAgIGNvbnN0IG5vZGVJZGVudGlmaWVyOiBudW1iZXIgPSB0aGlzLm5vZGVJZGVudGlmaWVyKys7XG5cbiAgICAgICAgdGhpcy5zdG9yZUNhdGNoQ2xhdXNlUGFyYW0oY2F0Y2hDbGF1c2VOb2RlLCBub2RlSWRlbnRpZmllcik7XG4gICAgICAgIHRoaXMucmVwbGFjZUNhdGNoQ2xhdXNlUGFyYW0oY2F0Y2hDbGF1c2VOb2RlLCBub2RlSWRlbnRpZmllcik7XG5cbiAgICAgICAgcmV0dXJuIGNhdGNoQ2xhdXNlTm9kZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge0NhdGNoQ2xhdXNlfSBjYXRjaENsYXVzZU5vZGVcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gbm9kZUlkZW50aWZpZXJcbiAgICAgKi9cbiAgICBwcml2YXRlIHN0b3JlQ2F0Y2hDbGF1c2VQYXJhbSAoY2F0Y2hDbGF1c2VOb2RlOiBFU1RyZWUuQ2F0Y2hDbGF1c2UsIG5vZGVJZGVudGlmaWVyOiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgaWYgKE5vZGUuaXNJZGVudGlmaWVyTm9kZShjYXRjaENsYXVzZU5vZGUucGFyYW0pKSB7XG4gICAgICAgICAgICB0aGlzLmlkZW50aWZpZXJPYmZ1c2NhdGluZ1JlcGxhY2VyLnN0b3JlTmFtZXMoY2F0Y2hDbGF1c2VOb2RlLnBhcmFtLm5hbWUsIG5vZGVJZGVudGlmaWVyKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7Q2F0Y2hDbGF1c2V9IGNhdGNoQ2xhdXNlTm9kZVxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBub2RlSWRlbnRpZmllclxuICAgICAqL1xuICAgIHByaXZhdGUgcmVwbGFjZUNhdGNoQ2xhdXNlUGFyYW0gKGNhdGNoQ2xhdXNlTm9kZTogRVNUcmVlLkNhdGNoQ2xhdXNlLCBub2RlSWRlbnRpZmllcjogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIGVzdHJhdmVyc2UucmVwbGFjZShjYXRjaENsYXVzZU5vZGUsIHtcbiAgICAgICAgICAgIGVudGVyOiAobm9kZTogRVNUcmVlLk5vZGUsIHBhcmVudE5vZGU6IEVTVHJlZS5Ob2RlKTogYW55ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoTm9kZS5pc1JlcGxhY2VhYmxlSWRlbnRpZmllck5vZGUobm9kZSwgcGFyZW50Tm9kZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3SWRlbnRpZmllcjogRVNUcmVlLklkZW50aWZpZXIgPSB0aGlzLmlkZW50aWZpZXJPYmZ1c2NhdGluZ1JlcGxhY2VyLnJlcGxhY2Uobm9kZS5uYW1lLCBub2RlSWRlbnRpZmllcik7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld0lkZW50aWZpZXJOYW1lOiBzdHJpbmcgPSBuZXdJZGVudGlmaWVyLm5hbWU7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUubmFtZSAhPT0gbmV3SWRlbnRpZmllck5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUubmFtZSA9IG5ld0lkZW50aWZpZXJOYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5vYmZ1c2NhdGVkTm9kZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbiJdfQ==
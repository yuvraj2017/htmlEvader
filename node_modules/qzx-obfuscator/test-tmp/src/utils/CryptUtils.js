"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var inversify_1 = require("inversify");
var ServiceIdentifiers_1 = require("../container/ServiceIdentifiers");
var RandomGenerator_1 = require("./RandomGenerator");
var Utils_1 = require("./Utils");
var CryptUtils = function () {
    function CryptUtils(randomGenerator) {
        _classCallCheck(this, CryptUtils);

        this.randomGenerator = randomGenerator;
    }

    _createClass(CryptUtils, [{
        key: "btoa",
        value: function btoa(string) {
            var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
            var output = '';
            string = encodeURIComponent(string).replace(/%([0-9A-F]{2})/g, function (match, p1) {
                return String.fromCharCode(parseInt("" + Utils_1.Utils.hexadecimalPrefix + p1));
            });
            for (var block, charCode, idx = 0, map = chars; string.charAt(idx | 0) || (map = '=', idx % 1); output += map.charAt(63 & block >> 8 - idx % 1 * 8)) {
                charCode = string.charCodeAt(idx += 3 / 4);
                if (charCode > 0xFF) {
                    throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");
                }
                block = block << 8 | charCode;
            }
            return output;
        }
    }, {
        key: "hideString",
        value: function hideString(str, length) {
            var _this = this;

            var escapeRegExp = function escapeRegExp(s) {
                return s.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
            };
            var randomMerge = function randomMerge(s1, s2) {
                var i1 = -1,
                    i2 = -1,
                    result = '';
                while (i1 < s1.length || i2 < s2.length) {
                    if (_this.randomGenerator.getMathRandom() < 0.5 && i2 < s2.length) {
                        result += s2.charAt(++i2);
                    } else {
                        result += s1.charAt(++i1);
                    }
                }
                return result;
            };
            var randomString = this.randomGenerator.getRandomGenerator().string({
                length: length,
                pool: RandomGenerator_1.RandomGenerator.randomGeneratorPool
            });
            var randomStringDiff = randomString.replace(new RegExp("[" + escapeRegExp(str) + "]", 'g'), '');
            var randomStringDiffArray = randomStringDiff.split('');
            this.randomGenerator.getRandomGenerator().shuffle(randomStringDiffArray);
            randomStringDiff = randomStringDiffArray.join('');
            return [randomMerge(str, randomStringDiff), randomStringDiff];
        }
    }, {
        key: "rc4",
        value: function rc4(string, key) {
            var s = [],
                j = 0,
                x = void 0,
                result = '';
            for (var i = 0; i < 256; i++) {
                s[i] = i;
            }
            for (i = 0; i < 256; i++) {
                j = (j + s[i] + key.charCodeAt(i % key.length)) % 256;
                x = s[i];
                s[i] = s[j];
                s[j] = x;
            }
            i = 0;
            j = 0;
            for (var y = 0; y < string.length; y++) {
                i = (i + 1) % 256;
                j = (j + s[i]) % 256;
                x = s[i];
                s[i] = s[j];
                s[j] = x;
                result += String.fromCharCode(string.charCodeAt(y) ^ s[(s[i] + s[j]) % 256]);
            }
            return result;
        }
    }]);

    return CryptUtils;
}();
CryptUtils = tslib_1.__decorate([inversify_1.injectable(), tslib_1.__param(0, inversify_1.inject(ServiceIdentifiers_1.ServiceIdentifiers.IRandomGenerator)), tslib_1.__metadata("design:paramtypes", [Object])], CryptUtils);
exports.CryptUtils = CryptUtils;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ3J5cHRVdGlscy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy91dGlscy9DcnlwdFV0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUEsMEJBQStDO0FBQy9DLG1DQUFxRTtBQUtyRSxnQ0FBb0Q7QUFDcEQsc0JBQWdDO0FBR2hDO0FBU0ksd0JBQ2lELEFBQWlDOzs7QUFFOUUsQUFBSSxhQUFDLEFBQWUsa0JBQUcsQUFBZSxBQUFDLEFBQzNDO0FBQUMsQUFPTSxBQUFJOztBQXBCZixBQUFhLEFBQVU7OzZCQW9CTixBQUFjO0FBQ3ZCLGdCQUFNLEFBQUssUUFBVyxBQUFtRSxBQUFDO0FBRTFGLGdCQUFJLEFBQU0sU0FBVyxBQUFFLEFBQUM7QUFFeEIsQUFBTSx3Q0FBc0IsQUFBTSxBQUFDLFFBQUMsQUFBTyxRQUFDLEFBQWlCLG1CQUFFLFVBQUMsQUFBSyxPQUFFLEFBQUU7QUFDckUsQUFBTSx1QkFBQyxBQUFNLE9BQUMsQUFBWSxhQUFDLEFBQVEsQUFBQyxjQUFHLFFBQUssTUFBQyxBQUFpQixvQkFBRyxBQUFFLEFBQUUsQUFBQyxBQUFDLEFBQUMsQUFDNUU7QUFBQyxBQUFDLEFBQUMsYUFGTSxBQUFrQjtBQUkzQixBQUFHLEFBQUMsaUJBQ0EsSUFBSSxBQUF5QixPQUFFLEFBQWdCLFVBQUUsQUFBRyxNQUFXLEFBQUMsR0FBRSxBQUFHLE1BQVcsQUFBSyxPQUNyRixBQUFNLE9BQUMsQUFBTSxPQUFDLEFBQUcsTUFBRyxBQUFDLEFBQUMsQUFBSSxPQUFDLEFBQUcsTUFBRyxBQUFHLEtBQUUsQUFBRyxNQUFHLEFBQUMsQUFBQyxJQUM5QyxBQUFNLFVBQUksQUFBRyxJQUFDLEFBQU0sT0FBQyxBQUFFLEtBQUcsQUFBSyxTQUFJLEFBQUMsSUFBRyxBQUFHLE1BQUcsQUFBQyxJQUFHLEFBQUMsQUFBQyxJQUNyRCxBQUFDO0FBQ0MsQUFBUSwyQkFBRyxBQUFNLE9BQUMsQUFBVSxXQUFDLEFBQUcsT0FBSSxB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LFlBQU0sT0FBQyxxQkFBa0IsbUJBQUMsQUFBZ0IsQUFBQyx3RUFWdkMsQUFBVSxBQWtJdEI7QUFsSVkscUJBQVUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpbmplY3RhYmxlLCBpbmplY3QgfSBmcm9tICdpbnZlcnNpZnknO1xuaW1wb3J0IHsgU2VydmljZUlkZW50aWZpZXJzIH0gZnJvbSAnLi4vY29udGFpbmVyL1NlcnZpY2VJZGVudGlmaWVycyc7XG5cbmltcG9ydCB7IElDcnlwdFV0aWxzIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy91dGlscy9JQ3J5cHRVdGlscyc7XG5pbXBvcnQgeyBJUmFuZG9tR2VuZXJhdG9yIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy91dGlscy9JUmFuZG9tR2VuZXJhdG9yJztcblxuaW1wb3J0IHsgUmFuZG9tR2VuZXJhdG9yIH0gZnJvbSAnLi9SYW5kb21HZW5lcmF0b3InO1xuaW1wb3J0IHsgVXRpbHMgfSBmcm9tICcuL1V0aWxzJztcblxuQGluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIENyeXB0VXRpbHMgaW1wbGVtZW50cyBJQ3J5cHRVdGlscyB7XG4gICAgLyoqXG4gICAgICogQHR5cGUge0lSYW5kb21HZW5lcmF0b3J9XG4gICAgICovXG4gICAgcHJpdmF0ZSByZWFkb25seSByYW5kb21HZW5lcmF0b3I6IElSYW5kb21HZW5lcmF0b3I7XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge0lSYW5kb21HZW5lcmF0b3J9IHJhbmRvbUdlbmVyYXRvclxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yIChcbiAgICAgICAgQGluamVjdChTZXJ2aWNlSWRlbnRpZmllcnMuSVJhbmRvbUdlbmVyYXRvcikgcmFuZG9tR2VuZXJhdG9yOiBJUmFuZG9tR2VuZXJhdG9yXG4gICAgKSB7XG4gICAgICAgIHRoaXMucmFuZG9tR2VuZXJhdG9yID0gcmFuZG9tR2VuZXJhdG9yO1xuICAgIH1cblxuICAgIC8qIHRzbGludDpkaXNhYmxlICovXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHN0cmluZ1xuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9XG4gICAgICovXG4gICAgcHVibGljIGJ0b2EgKHN0cmluZzogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgY29uc3QgY2hhcnM6IHN0cmluZyA9ICdBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvPSc7XG5cbiAgICAgICAgbGV0IG91dHB1dDogc3RyaW5nID0gJyc7XG5cbiAgICAgICAgc3RyaW5nID0gZW5jb2RlVVJJQ29tcG9uZW50KHN0cmluZykucmVwbGFjZSgvJShbMC05QS1GXXsyfSkvZywgKG1hdGNoLCBwMSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUocGFyc2VJbnQoYCR7VXRpbHMuaGV4YWRlY2ltYWxQcmVmaXh9JHtwMX1gKSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGZvciAoXG4gICAgICAgICAgICBsZXQgYmxvY2s6IG51bWJlciB8IHVuZGVmaW5lZCwgY2hhckNvZGU6IG51bWJlciwgaWR4OiBudW1iZXIgPSAwLCBtYXA6IHN0cmluZyA9IGNoYXJzO1xuICAgICAgICAgICAgc3RyaW5nLmNoYXJBdChpZHggfCAwKSB8fCAobWFwID0gJz0nLCBpZHggJSAxKTtcbiAgICAgICAgICAgIG91dHB1dCArPSBtYXAuY2hhckF0KDYzICYgYmxvY2sgPj4gOCAtIGlkeCAlIDEgKiA4KVxuICAgICAgICApIHtcbiAgICAgICAgICAgIGNoYXJDb2RlID0gc3RyaW5nLmNoYXJDb2RlQXQoaWR4ICs9IDMvNCk7XG5cbiAgICAgICAgICAgIGlmIChjaGFyQ29kZSA+IDB4RkYpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCInYnRvYScgZmFpbGVkOiBUaGUgc3RyaW5nIHRvIGJlIGVuY29kZWQgY29udGFpbnMgY2hhcmFjdGVycyBvdXRzaWRlIG9mIHRoZSBMYXRpbjEgcmFuZ2UuXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBibG9jayA9IDxudW1iZXI+YmxvY2sgPDwgOCB8IGNoYXJDb2RlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICB9XG4gICAgLyogdHNsaW50OmVuYWJsZSAqL1xuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHN0clxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBsZW5ndGhcbiAgICAgKiBAcmV0dXJucyB7W3N0cmluZyAsIHN0cmluZ119XG4gICAgICovXG4gICAgcHVibGljIGhpZGVTdHJpbmcgKHN0cjogc3RyaW5nLCBsZW5ndGg6IG51bWJlcik6IFtzdHJpbmcsIHN0cmluZ10ge1xuICAgICAgICBjb25zdCBlc2NhcGVSZWdFeHA6IChzOiBzdHJpbmcpID0+IHN0cmluZyA9IChzOiBzdHJpbmcpID0+XG4gICAgICAgICAgICBzLnJlcGxhY2UoL1stXFwvXFxcXF4kKis/LigpfFtcXF17fV0vZywgJ1xcXFwkJicpO1xuXG4gICAgICAgIGNvbnN0IHJhbmRvbU1lcmdlOiAoczE6IHN0cmluZywgczI6IHN0cmluZykgPT4gc3RyaW5nID0gKHMxOiBzdHJpbmcsIHMyOiBzdHJpbmcpOiBzdHJpbmcgPT4ge1xuICAgICAgICAgICAgbGV0IGkxOiBudW1iZXIgPSAtMSxcbiAgICAgICAgICAgICAgICBpMjogbnVtYmVyID0gLTEsXG4gICAgICAgICAgICAgICAgcmVzdWx0OiBzdHJpbmcgPSAnJztcblxuICAgICAgICAgICAgd2hpbGUgKGkxIDwgczEubGVuZ3RoIHx8IGkyIDwgczIubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucmFuZG9tR2VuZXJhdG9yLmdldE1hdGhSYW5kb20oKSA8IDAuNSAmJiBpMiA8IHMyLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gczIuY2hhckF0KCsraTIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBzMS5jaGFyQXQoKytpMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJhbmRvbVN0cmluZzogc3RyaW5nID0gdGhpcy5yYW5kb21HZW5lcmF0b3IuZ2V0UmFuZG9tR2VuZXJhdG9yKCkuc3RyaW5nKHtcbiAgICAgICAgICAgIGxlbmd0aDogbGVuZ3RoLFxuICAgICAgICAgICAgcG9vbDogUmFuZG9tR2VuZXJhdG9yLnJhbmRvbUdlbmVyYXRvclBvb2xcbiAgICAgICAgfSk7XG5cbiAgICAgICAgbGV0IHJhbmRvbVN0cmluZ0RpZmY6IHN0cmluZyA9IHJhbmRvbVN0cmluZy5yZXBsYWNlKFxuICAgICAgICAgICAgbmV3IFJlZ0V4cChgWyR7ZXNjYXBlUmVnRXhwKHN0cil9XWAsICdnJyksXG4gICAgICAgICAgICAnJyk7XG5cbiAgICAgICAgY29uc3QgcmFuZG9tU3RyaW5nRGlmZkFycmF5OiBzdHJpbmdbXSA9IHJhbmRvbVN0cmluZ0RpZmYuc3BsaXQoJycpO1xuXG4gICAgICAgIHRoaXMucmFuZG9tR2VuZXJhdG9yLmdldFJhbmRvbUdlbmVyYXRvcigpLnNodWZmbGUocmFuZG9tU3RyaW5nRGlmZkFycmF5KTtcbiAgICAgICAgcmFuZG9tU3RyaW5nRGlmZiA9IHJhbmRvbVN0cmluZ0RpZmZBcnJheS5qb2luKCcnKTtcblxuICAgICAgICByZXR1cm4gW3JhbmRvbU1lcmdlKHN0ciwgcmFuZG9tU3RyaW5nRGlmZiksIHJhbmRvbVN0cmluZ0RpZmZdO1xuICAgIH1cblxuICAgIC8qIHRzbGludDpkaXNhYmxlICovXG4gICAgLyoqXG4gICAgICogUkM0IHN5bW1ldHJpYyBjaXBoZXIgZW5jcnlwdGlvbi9kZWNyeXB0aW9uXG4gICAgICogaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vZmFyaGFkaS8yMTg1MTk3XG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc3RyaW5nXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGtleVxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9XG4gICAgICovXG4gICAgcHVibGljIHJjNCAoc3RyaW5nOiBzdHJpbmcsIGtleTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IHM6IG51bWJlcltdID0gW10sXG4gICAgICAgICAgICBqOiBudW1iZXIgPSAwLFxuICAgICAgICAgICAgeDogbnVtYmVyLFxuICAgICAgICAgICAgcmVzdWx0OiBzdHJpbmcgPSAnJztcblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDI1NjsgaSsrKSB7XG4gICAgICAgICAgICBzW2ldID0gaTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCAyNTY7IGkrKykge1xuICAgICAgICAgICAgaiA9IChqICsgc1tpXSArIGtleS5jaGFyQ29kZUF0KGkgJSBrZXkubGVuZ3RoKSkgJSAyNTY7XG4gICAgICAgICAgICB4ID0gc1tpXTtcbiAgICAgICAgICAgIHNbaV0gPSBzW2pdO1xuICAgICAgICAgICAgc1tqXSA9IHg7XG4gICAgICAgIH1cblxuICAgICAgICBpID0gMDtcbiAgICAgICAgaiA9IDA7XG5cbiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBzdHJpbmcubGVuZ3RoOyB5KyspIHtcbiAgICAgICAgICAgIGkgPSAoaSArIDEpICUgMjU2O1xuICAgICAgICAgICAgaiA9IChqICsgc1tpXSkgJSAyNTY7XG4gICAgICAgICAgICB4ID0gc1tpXTtcbiAgICAgICAgICAgIHNbaV0gPSBzW2pdO1xuICAgICAgICAgICAgc1tqXSA9IHg7XG4gICAgICAgICAgICByZXN1bHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShzdHJpbmcuY2hhckNvZGVBdCh5KSBeIHNbKHNbaV0gKyBzW2pdKSAlIDI1Nl0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgLyogdHNsaW50OmVuYWJsZSAqL1xufVxuIl19
"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var format = require("string-template");
var chai_1 = require("chai");
var ServiceIdentifiers_1 = require("../../../../../src/container/ServiceIdentifiers");
var AtobTemplate_1 = require("../../../../../src/templates/custom-nodes/AtobTemplate");
var Rc4Template_1 = require("../../../../../src/templates/custom-nodes/Rc4Template");
var StringArrayBase64DecodeNodeTemplate_1 = require("../../../../../src/templates/custom-nodes/string-array-nodes/string-array-calls-wrapper/StringArrayBase64DecodeNodeTemplate");
var StringArrayCallsWrapperTemplate_1 = require("../../../../../src/templates/custom-nodes/string-array-nodes/string-array-calls-wrapper/StringArrayCallsWrapperTemplate");
var StringArrayRC4DecodeNodeTemplate_1 = require("../../../../../src/templates/custom-nodes/string-array-nodes/string-array-calls-wrapper/StringArrayRC4DecodeNodeTemplate");
var InversifyContainerFacade_1 = require("../../../../../src/container/InversifyContainerFacade");
describe('StringArrayCallsWrapperNodeTemplate (): string', function () {
    var stringArrayName = 'stringArrayName';
    var stringArrayCallsWrapperName = 'stringArrayCallsWrapperName';
    var cryptUtils = void 0;
    before(function () {
        var inversifyContainerFacade = new InversifyContainerFacade_1.InversifyContainerFacade();
        inversifyContainerFacade.load('', {});
        cryptUtils = inversifyContainerFacade.get(ServiceIdentifiers_1.ServiceIdentifiers.ICryptUtils);
    });
    describe('variant #1: `base64` encoding', function () {
        var atobDecodeNodeTemplate = format(StringArrayBase64DecodeNodeTemplate_1.StringArrayBase64DecodeNodeTemplate(), {
            atobPolyfill: AtobTemplate_1.AtobTemplate(),
            selfDefendingCode: '',
            stringArrayCallsWrapperName: stringArrayCallsWrapperName
        });
        var index = '0x0';
        var expectedDecodedValue = 'test1';
        var decodedValue = void 0;
        before(function () {
            var stringArrayCallsWrapperTemplate = format(StringArrayCallsWrapperTemplate_1.StringArrayCallsWrapperTemplate(), {
                decodeNodeTemplate: atobDecodeNodeTemplate,
                stringArrayCallsWrapperName: stringArrayCallsWrapperName,
                stringArrayName: stringArrayName
            });
            decodedValue = Function("\n                var " + stringArrayName + " = ['" + cryptUtils.btoa('test1') + "'];\n            \n                " + stringArrayCallsWrapperTemplate + "\n                \n                return " + stringArrayCallsWrapperName + "(" + index + ");\n            ")();
        });
        it('should correctly return decoded value', function () {
            chai_1.assert.deepEqual(decodedValue, expectedDecodedValue);
        });
    });
    describe('variant #2: `rc4` encoding', function () {
        var rc4DecodeNodeTemplate = format(StringArrayRC4DecodeNodeTemplate_1.StringArrayRc4DecodeNodeTemplate(), {
            atobPolyfill: AtobTemplate_1.AtobTemplate(),
            rc4Polyfill: Rc4Template_1.Rc4Template(),
            selfDefendingCode: '',
            stringArrayCallsWrapperName: stringArrayCallsWrapperName
        });
        var index = '0x0';
        var key = 'key';
        var expectedDecodedValue = 'test1';
        var decodedValue = void 0;
        before(function () {
            var stringArrayCallsWrapperTemplate = format(StringArrayCallsWrapperTemplate_1.StringArrayCallsWrapperTemplate(), {
                decodeNodeTemplate: rc4DecodeNodeTemplate,
                stringArrayCallsWrapperName: stringArrayCallsWrapperName,
                stringArrayName: stringArrayName
            });
            decodedValue = Function("\n                var " + stringArrayName + " = ['" + cryptUtils.btoa(cryptUtils.rc4('test1', key)) + "'];\n            \n                " + stringArrayCallsWrapperTemplate + "\n                \n                return " + stringArrayCallsWrapperName + "('" + index + "', '" + key + "');\n            ")();
        });
        it('should correctly return decoded value', function () {
            chai_1.assert.deepEqual(decodedValue, expectedDecodedValue);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3RyaW5nQXJyYXlDYWxsc1dyYXBwZXJOb2RlVGVtcGxhdGUuc3BlYy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Rlc3QvZnVuY3Rpb25hbC10ZXN0cy90ZW1wbGF0ZXMvY3VzdG9tLW5vZGVzL3N0cmluZy1hcnJheS1ub2Rlcy9TdHJpbmdBcnJheUNhbGxzV3JhcHBlck5vZGVUZW1wbGF0ZS5zcGVjLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLHFCQUEwQztBQUUxQyxxQkFBOEI7QUFFOUIsbUNBQXFGO0FBS3JGLDZCQUFzRjtBQUN0Riw0QkFBb0Y7QUFDcEYsb0RBQWtMO0FBQ2xMLGdEQUEwSztBQUMxSyxpREFBNEs7QUFFNUsseUNBQWlHO0FBRWpHLEFBQVEsU0FBQyxBQUFnRCxrREFBRTtBQUN2RCxRQUFNLEFBQWUsa0JBQVcsQUFBaUIsQUFBQztBQUNsRCxRQUFNLEFBQTJCLDhCQUFXLEFBQTZCLEFBQUM7QUFFMUUsUUFBSSxBQUF1QixBQUFDO0FBRTVCLEFBQU0sV0FBQztBQUNILFlBQU0sQUFBd0IsMkJBQThCLElBQUksMkJBQXdCLEFBQUUsQUFBQztBQUUzRixBQUF3QixpQ0FBQyxBQUFJLEtBQUMsQUFBRSxJQUFFLEFBQUUsQUFBQyxBQUFDO0FBQ3RDLEFBQVUscUJBQUcsQUFBd0IseUJBQUMsQUFBRyxJQUFjLHFCQUFrQixtQkFBQyxBQUFXLEFBQUMsQUFBQyxBQUMzRjtBQUFDLEFBQUMsQUFBQztBQUVILEFBQVEsYUFBQyxBQUErQixpQ0FBRTtBQUN0QyxZQUFNLEFBQXNCLGdDQUFrQixzQ0FBbUMsQUFBRTtBQUMvRSxBQUFZLDBCQUFFLGVBQVksQUFBRTtBQUM1QixBQUFpQiwrQkFBRSxBQUFFO0FBQ3JCLEFBQTJCLEFBQzlCLEFBQUMsQUFBQztBQUprRixTQUE5QyxBQUFNO0FBSzdDLFlBQU0sQUFBSyxRQUFXLEFBQUssQUFBQztBQUM1QixZQUFNLEFBQW9CLHVCQUFXLEFBQU8sQUFBQztBQUU3QyxZQUFJLEFBQW9CLEFBQUM7QUFFekIsQUFBTSxlQUFDO0FBQ0gsZ0JBQU0sQUFBK0IseUNBQWtCLGtDQUErQixBQUFFO0FBQ3BGLEFBQWtCLG9DQUFFLEFBQXNCO0FBQzFDLEFBQTJCO0FBQzNCLEFBQWUsQUFDbEIsQUFBQyxBQUFDO0FBSnVGLGFBQTFDLEFBQU07QUFNdEQsQUFBWSwyQkFBRyxBQUFRLEFBQUMsb0NBQ2QsQUFBZSw0QkFBUSxBQUFVLFdBQUMsQUFBSSxLQUFDLEFBQU8sQUFBQyxtREFFbkQsQUFBK0Isa0ZBRXhCLEFBQTJCLG9DQUFJLEFBQUssQUFDaEQsQUFBQyxBQUFFLEFBQUMsQUFDVDtBQUFDLEFBQUMsQUFBQztBQUVILEFBQUUsV0FBQyxBQUF1Qyx5Q0FBRTtBQUN4QyxtQkFBTSxPQUFDLEFBQVMsVUFBQyxBQUFZLGNBQUUsQUFBb0IsQUFBQyxBQUFDLEFBQ3pEO0FBQUMsQUFBQyxBQUFDLEFBQ1A7QUFBQyxBQUFDLEFBQUM7QUFFSCxBQUFRLGFBQUMsQUFBNEIsOEJBQUU7QUFDbkMsWUFBTSxBQUFxQiwrQkFBa0IsbUNBQWdDLEFBQUU7QUFDM0UsQUFBWSwwQkFBRSxlQUFZLEFBQUU7QUFDNUIsQUFBVyx5QkFBRSxjQUFXLEFBQUU7QUFDMUIsQUFBaUIsK0JBQUUsQUFBRTtBQUNyQixBQUEyQixBQUM5QixBQUFDLEFBQUM7QUFMOEUsU0FBM0MsQUFBTTtBQU01QyxZQUFNLEFBQUssUUFBVyxBQUFLLEFBQUM7QUFDNUIsWUFBTSxBQUFHLE1BQVcsQUFBSyxBQUFDO0FBQzFCLFlBQU0sQUFBb0IsdUJBQVcsQUFBTyxBQUFDO0FBRTdDLFlBQUksQUFBb0IsQUFBQztBQUV6QixBQUFNLGVBQUM7QUFDSCxnQkFBTSxBQUErQix5Q0FBa0Isa0NBQStCLEFBQUU7QUFDcEYsQUFBa0Isb0NBQUUsQUFBcUI7QUFDekMsQUFBMkI7QUFDM0IsQUFBZSxBQUNsQixBQUFDLEFBQUM7QUFKdUYsYUFBMUMsQUFBTTtBQU10RCxBQUFZLDJCQUFHLEFBQVEsQUFBQyxvQ0FDZCxBQUFlLDRCQUFRLEFBQVUsV0FBQyxBQUFJLEtBQUMsQUFBVSxXQUFDLEFBQUcsSUFBQyxBQUFPLFNBQUUsQUFBRyxBQUFDLEFBQUMsZ0RBRXhFLEFBQStCLGtGQUV4QixBQUEyQixxQ0FBSyxBQUFLLGlCQUFPLEFBQUcsQUFDM0QsQUFBQyxBQUFFLEFBQUMsQUFDVDtBQUFDLEFBQUMsQUFBQztBQUVILEFBQUUsV0FBQyxBQUF1Qyx5Q0FBRTtBQUN4QyxtQkFBTSxPQUFDLEFBQVMsVUFBQyxBQUFZLGNBQUUsQUFBb0IsQUFBQyxBQUFDLEFBQ3pEO0FBQUMsQUFBQyxBQUFDLEFBQ1A7QUFBQyxBQUFDLEFBQUMsQUFDUDtBQUFDLEFBQUMsQUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGZvcm1hdCBmcm9tICdzdHJpbmctdGVtcGxhdGUnO1xuXG5pbXBvcnQgeyBhc3NlcnQgfSBmcm9tICdjaGFpJztcblxuaW1wb3J0IHsgU2VydmljZUlkZW50aWZpZXJzIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vc3JjL2NvbnRhaW5lci9TZXJ2aWNlSWRlbnRpZmllcnMnO1xuXG5pbXBvcnQgeyBJQ3J5cHRVdGlscyB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL3NyYy9pbnRlcmZhY2VzL3V0aWxzL0lDcnlwdFV0aWxzJztcbmltcG9ydCB7IElJbnZlcnNpZnlDb250YWluZXJGYWNhZGUgfSBmcm9tICcuLi8uLi8uLi8uLi8uLi9zcmMvaW50ZXJmYWNlcy9jb250YWluZXIvSUludmVyc2lmeUNvbnRhaW5lckZhY2FkZSc7XG5cbmltcG9ydCB7IEF0b2JUZW1wbGF0ZSB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL3NyYy90ZW1wbGF0ZXMvY3VzdG9tLW5vZGVzL0F0b2JUZW1wbGF0ZSc7XG5pbXBvcnQgeyBSYzRUZW1wbGF0ZSB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL3NyYy90ZW1wbGF0ZXMvY3VzdG9tLW5vZGVzL1JjNFRlbXBsYXRlJztcbmltcG9ydCB7IFN0cmluZ0FycmF5QmFzZTY0RGVjb2RlTm9kZVRlbXBsYXRlIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vc3JjL3RlbXBsYXRlcy9jdXN0b20tbm9kZXMvc3RyaW5nLWFycmF5LW5vZGVzL3N0cmluZy1hcnJheS1jYWxscy13cmFwcGVyL1N0cmluZ0FycmF5QmFzZTY0RGVjb2RlTm9kZVRlbXBsYXRlJztcbmltcG9ydCB7IFN0cmluZ0FycmF5Q2FsbHNXcmFwcGVyVGVtcGxhdGUgfSBmcm9tICcuLi8uLi8uLi8uLi8uLi9zcmMvdGVtcGxhdGVzL2N1c3RvbS1ub2Rlcy9zdHJpbmctYXJyYXktbm9kZXMvc3RyaW5nLWFycmF5LWNhbGxzLXdyYXBwZXIvU3RyaW5nQXJyYXlDYWxsc1dyYXBwZXJUZW1wbGF0ZSc7XG5pbXBvcnQgeyBTdHJpbmdBcnJheVJjNERlY29kZU5vZGVUZW1wbGF0ZSB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL3NyYy90ZW1wbGF0ZXMvY3VzdG9tLW5vZGVzL3N0cmluZy1hcnJheS1ub2Rlcy9zdHJpbmctYXJyYXktY2FsbHMtd3JhcHBlci9TdHJpbmdBcnJheVJDNERlY29kZU5vZGVUZW1wbGF0ZSc7XG5cbmltcG9ydCB7IEludmVyc2lmeUNvbnRhaW5lckZhY2FkZSB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL3NyYy9jb250YWluZXIvSW52ZXJzaWZ5Q29udGFpbmVyRmFjYWRlJztcblxuZGVzY3JpYmUoJ1N0cmluZ0FycmF5Q2FsbHNXcmFwcGVyTm9kZVRlbXBsYXRlICgpOiBzdHJpbmcnLCAoKSA9PiB7XG4gICAgY29uc3Qgc3RyaW5nQXJyYXlOYW1lOiBzdHJpbmcgPSAnc3RyaW5nQXJyYXlOYW1lJztcbiAgICBjb25zdCBzdHJpbmdBcnJheUNhbGxzV3JhcHBlck5hbWU6IHN0cmluZyA9ICdzdHJpbmdBcnJheUNhbGxzV3JhcHBlck5hbWUnO1xuXG4gICAgbGV0IGNyeXB0VXRpbHM6IElDcnlwdFV0aWxzO1xuXG4gICAgYmVmb3JlKCgpID0+IHtcbiAgICAgICAgY29uc3QgaW52ZXJzaWZ5Q29udGFpbmVyRmFjYWRlOiBJSW52ZXJzaWZ5Q29udGFpbmVyRmFjYWRlID0gbmV3IEludmVyc2lmeUNvbnRhaW5lckZhY2FkZSgpO1xuXG4gICAgICAgIGludmVyc2lmeUNvbnRhaW5lckZhY2FkZS5sb2FkKCcnLCB7fSk7XG4gICAgICAgIGNyeXB0VXRpbHMgPSBpbnZlcnNpZnlDb250YWluZXJGYWNhZGUuZ2V0PElDcnlwdFV0aWxzPihTZXJ2aWNlSWRlbnRpZmllcnMuSUNyeXB0VXRpbHMpO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3ZhcmlhbnQgIzE6IGBiYXNlNjRgIGVuY29kaW5nJywgKCkgPT4ge1xuICAgICAgICBjb25zdCBhdG9iRGVjb2RlTm9kZVRlbXBsYXRlOiBzdHJpbmcgPSBmb3JtYXQoU3RyaW5nQXJyYXlCYXNlNjREZWNvZGVOb2RlVGVtcGxhdGUoKSwge1xuICAgICAgICAgICAgYXRvYlBvbHlmaWxsOiBBdG9iVGVtcGxhdGUoKSxcbiAgICAgICAgICAgIHNlbGZEZWZlbmRpbmdDb2RlOiAnJyxcbiAgICAgICAgICAgIHN0cmluZ0FycmF5Q2FsbHNXcmFwcGVyTmFtZVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgaW5kZXg6IHN0cmluZyA9ICcweDAnO1xuICAgICAgICBjb25zdCBleHBlY3RlZERlY29kZWRWYWx1ZTogc3RyaW5nID0gJ3Rlc3QxJztcblxuICAgICAgICBsZXQgZGVjb2RlZFZhbHVlOiBzdHJpbmc7XG5cbiAgICAgICAgYmVmb3JlKCgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHN0cmluZ0FycmF5Q2FsbHNXcmFwcGVyVGVtcGxhdGU6IHN0cmluZyA9IGZvcm1hdChTdHJpbmdBcnJheUNhbGxzV3JhcHBlclRlbXBsYXRlKCksIHtcbiAgICAgICAgICAgICAgICBkZWNvZGVOb2RlVGVtcGxhdGU6IGF0b2JEZWNvZGVOb2RlVGVtcGxhdGUsXG4gICAgICAgICAgICAgICAgc3RyaW5nQXJyYXlDYWxsc1dyYXBwZXJOYW1lLFxuICAgICAgICAgICAgICAgIHN0cmluZ0FycmF5TmFtZVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGRlY29kZWRWYWx1ZSA9IEZ1bmN0aW9uKGBcbiAgICAgICAgICAgICAgICB2YXIgJHtzdHJpbmdBcnJheU5hbWV9ID0gWycke2NyeXB0VXRpbHMuYnRvYSgndGVzdDEnKX0nXTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICR7c3RyaW5nQXJyYXlDYWxsc1dyYXBwZXJUZW1wbGF0ZX1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICByZXR1cm4gJHtzdHJpbmdBcnJheUNhbGxzV3JhcHBlck5hbWV9KCR7aW5kZXh9KTtcbiAgICAgICAgICAgIGApKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgY29ycmVjdGx5IHJldHVybiBkZWNvZGVkIHZhbHVlJywgKCkgPT4ge1xuICAgICAgICAgICAgYXNzZXJ0LmRlZXBFcXVhbChkZWNvZGVkVmFsdWUsIGV4cGVjdGVkRGVjb2RlZFZhbHVlKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgndmFyaWFudCAjMjogYHJjNGAgZW5jb2RpbmcnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJjNERlY29kZU5vZGVUZW1wbGF0ZTogc3RyaW5nID0gZm9ybWF0KFN0cmluZ0FycmF5UmM0RGVjb2RlTm9kZVRlbXBsYXRlKCksIHtcbiAgICAgICAgICAgIGF0b2JQb2x5ZmlsbDogQXRvYlRlbXBsYXRlKCksXG4gICAgICAgICAgICByYzRQb2x5ZmlsbDogUmM0VGVtcGxhdGUoKSxcbiAgICAgICAgICAgIHNlbGZEZWZlbmRpbmdDb2RlOiAnJyxcbiAgICAgICAgICAgIHN0cmluZ0FycmF5Q2FsbHNXcmFwcGVyTmFtZVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgaW5kZXg6IHN0cmluZyA9ICcweDAnO1xuICAgICAgICBjb25zdCBrZXk6IHN0cmluZyA9ICdrZXknO1xuICAgICAgICBjb25zdCBleHBlY3RlZERlY29kZWRWYWx1ZTogc3RyaW5nID0gJ3Rlc3QxJztcblxuICAgICAgICBsZXQgZGVjb2RlZFZhbHVlOiBzdHJpbmc7XG5cbiAgICAgICAgYmVmb3JlKCgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHN0cmluZ0FycmF5Q2FsbHNXcmFwcGVyVGVtcGxhdGU6IHN0cmluZyA9IGZvcm1hdChTdHJpbmdBcnJheUNhbGxzV3JhcHBlclRlbXBsYXRlKCksIHtcbiAgICAgICAgICAgICAgICBkZWNvZGVOb2RlVGVtcGxhdGU6IHJjNERlY29kZU5vZGVUZW1wbGF0ZSxcbiAgICAgICAgICAgICAgICBzdHJpbmdBcnJheUNhbGxzV3JhcHBlck5hbWUsXG4gICAgICAgICAgICAgICAgc3RyaW5nQXJyYXlOYW1lXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZGVjb2RlZFZhbHVlID0gRnVuY3Rpb24oYFxuICAgICAgICAgICAgICAgIHZhciAke3N0cmluZ0FycmF5TmFtZX0gPSBbJyR7Y3J5cHRVdGlscy5idG9hKGNyeXB0VXRpbHMucmM0KCd0ZXN0MScsIGtleSkpfSddO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgJHtzdHJpbmdBcnJheUNhbGxzV3JhcHBlclRlbXBsYXRlfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHJldHVybiAke3N0cmluZ0FycmF5Q2FsbHNXcmFwcGVyTmFtZX0oJyR7aW5kZXh9JywgJyR7a2V5fScpO1xuICAgICAgICAgICAgYCkoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBjb3JyZWN0bHkgcmV0dXJuIGRlY29kZWQgdmFsdWUnLCAoKSA9PiB7XG4gICAgICAgICAgICBhc3NlcnQuZGVlcEVxdWFsKGRlY29kZWRWYWx1ZSwgZXhwZWN0ZWREZWNvZGVkVmFsdWUpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuIl19
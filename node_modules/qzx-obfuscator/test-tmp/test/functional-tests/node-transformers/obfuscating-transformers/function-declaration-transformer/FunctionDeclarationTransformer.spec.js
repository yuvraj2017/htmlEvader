"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var chai_1 = require("chai");
var NoCustomNodes_1 = require("../../../../../src/options/presets/NoCustomNodes");
var getRegExpMatch_1 = require("../../../../helpers/getRegExpMatch");
var readFileAsString_1 = require("../../../../helpers/readFileAsString");
var JavaScriptObfuscator_1 = require("../../../../../src/JavaScriptObfuscator");
describe('FunctionDeclarationTransformer', function () {
    describe('transformation of `functionDeclaration` node names', function () {
        describe('variant #1: `functionDeclaration` parent block scope is not a `ProgramNode`', function () {
            var functionNameIdentifierRegExp = /function *(_0x[a-f0-9]{4,6}) *\(\) *\{/;
            var functionCallIdentifierRegExp = /(_0x[a-f0-9]{4,6}) *\( *\);/;
            var obfuscatedCode = void 0,
                functionNameIdentifier = void 0,
                functionCallIdentifier = void 0;
            before(function () {
                var code = readFileAsString_1.readFileAsString(__dirname + '/fixtures/input.js');
                var obfuscationResult = JavaScriptObfuscator_1.JavaScriptObfuscator.obfuscate(code, Object.assign({}, NoCustomNodes_1.NO_CUSTOM_NODES_PRESET));
                obfuscatedCode = obfuscationResult.getObfuscatedCode();
                functionNameIdentifier = getRegExpMatch_1.getRegExpMatch(obfuscatedCode, functionNameIdentifierRegExp);
                functionCallIdentifier = getRegExpMatch_1.getRegExpMatch(obfuscatedCode, functionCallIdentifierRegExp);
            });
            it('should transform function name', function () {
                chai_1.assert.equal(functionNameIdentifier, functionCallIdentifier);
            });
        });
        describe('variant #2: `functionDeclaration` parent block scope is a `ProgramNode`', function () {
            var functionNameIdentifierRegExp = /function *foo *\(\) *\{/;
            var functionCallIdentifierRegExp = /foo *\( *\);/;
            var obfuscatedCode = void 0;
            before(function () {
                var code = readFileAsString_1.readFileAsString(__dirname + '/fixtures/input.js');
                var obfuscationResult = JavaScriptObfuscator_1.JavaScriptObfuscator.obfuscate(code, Object.assign({}, NoCustomNodes_1.NO_CUSTOM_NODES_PRESET));
                obfuscatedCode = obfuscationResult.getObfuscatedCode();
            });
            it('match #1: shouldn\'t transform function name', function () {
                chai_1.assert.match(obfuscatedCode, functionNameIdentifierRegExp);
            });
            it('match #2: shouldn\'t transform function name', function () {
                chai_1.assert.match(obfuscatedCode, functionCallIdentifierRegExp);
            });
        });
        describe('variant #3: generator `functionDeclaration`', function () {
            var functionNameIdentifierRegExp = /function *\* *(_0x[a-f0-9]{4,6}) *\(\) *\{/;
            var functionCallIdentifierRegExp = /let *_0x[a-f0-9]{4,6} *= *(_0x[a-f0-9]{4,6}) *\( *\);/;
            var obfuscatedCode = void 0,
                functionNameIdentifier = void 0,
                functionCallIdentifier = void 0;
            before(function () {
                var code = readFileAsString_1.readFileAsString(__dirname + '/fixtures/generator-function.js');
                var obfuscationResult = JavaScriptObfuscator_1.JavaScriptObfuscator.obfuscate(code, Object.assign({}, NoCustomNodes_1.NO_CUSTOM_NODES_PRESET));
                obfuscatedCode = obfuscationResult.getObfuscatedCode();
                functionNameIdentifier = getRegExpMatch_1.getRegExpMatch(obfuscatedCode, functionNameIdentifierRegExp);
                functionCallIdentifier = getRegExpMatch_1.getRegExpMatch(obfuscatedCode, functionCallIdentifierRegExp);
            });
            it('should transform generator function name', function () {
                chai_1.assert.equal(functionNameIdentifier, functionCallIdentifier);
            });
        });
        describe('variant #4: async `functionDeclaration`', function () {
            var functionNameIdentifierRegExp = /async *function *(_0x[a-f0-9]{4,6}) *\(\) *\{/;
            var functionCallIdentifierRegExp = /await *(_0x[a-f0-9]{4,6}) *\( *\);/;
            var obfuscatedCode = void 0,
                functionNameIdentifier = void 0,
                functionCallIdentifier = void 0;
            before(function () {
                var code = readFileAsString_1.readFileAsString(__dirname + '/fixtures/async-function.js');
                var obfuscationResult = JavaScriptObfuscator_1.JavaScriptObfuscator.obfuscate(code, Object.assign({}, NoCustomNodes_1.NO_CUSTOM_NODES_PRESET));
                obfuscatedCode = obfuscationResult.getObfuscatedCode();
                functionNameIdentifier = getRegExpMatch_1.getRegExpMatch(obfuscatedCode, functionNameIdentifierRegExp);
                functionCallIdentifier = getRegExpMatch_1.getRegExpMatch(obfuscatedCode, functionCallIdentifierRegExp);
            });
            it('should transform async function name', function () {
                chai_1.assert.equal(functionNameIdentifier, functionCallIdentifier);
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRnVuY3Rpb25EZWNsYXJhdGlvblRyYW5zZm9ybWVyLnNwZWMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi90ZXN0L2Z1bmN0aW9uYWwtdGVzdHMvbm9kZS10cmFuc2Zvcm1lcnMvb2JmdXNjYXRpbmctdHJhbnNmb3JtZXJzL2Z1bmN0aW9uLWRlY2xhcmF0aW9uLXRyYW5zZm9ybWVyL0Z1bmN0aW9uRGVjbGFyYXRpb25UcmFuc2Zvcm1lci5zcGVjLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLHFCQUE4QjtBQUk5Qiw4QkFBMEY7QUFFMUYsK0JBQW9FO0FBQ3BFLGlDQUF3RTtBQUV4RSxxQ0FBK0U7QUFFL0UsQUFBUSxTQUFDLEFBQWdDLGtDQUFFO0FBQ3ZDLEFBQVEsYUFBQyxBQUFvRCxzREFBRTtBQUMzRCxBQUFRLGlCQUFDLEFBQTZFLCtFQUFFO0FBQ3BGLGdCQUFNLEFBQTRCLCtCQUFXLEFBQXdDLEFBQUM7QUFDdEYsZ0JBQU0sQUFBNEIsK0JBQVcsQUFBNkIsQUFBQztBQUUzRSxnQkFBSSxBQUFzQjtnQkFDdEIsQUFBOEI7Z0JBQzlCLEFBQThCLEFBQUM7QUFFbkMsQUFBTSxtQkFBQztBQUNILG9CQUFNLEFBQUksT0FBVyxtQkFBZ0IsaUJBQUMsQUFBUyxZQUFHLEFBQW9CLEFBQUMsQUFBQztBQUN4RSxvQkFBTSxBQUFpQixvQkFBdUIsdUJBQW9CLHFCQUFDLEFBQVMsVUFDeEUsQUFBSSx3QkFFRyxnQkFBc0IsQUFFaEMsQUFBQztBQUVGLEFBQWMsaUNBQUcsQUFBaUIsa0JBQUMsQUFBaUIsQUFBRSxBQUFDO0FBQ3ZELEFBQXNCLHlDQUFHLGlCQUFjLGVBQUMsQUFBYyxnQkFBRSxBQUE0QixBQUFDLEFBQUM7QUFDdEYsQUFBc0IseUNBQUcsaUJBQWMsZUFBQyxBQUFjLGdCQUFFLEFBQTRCLEFBQUMsQUFBQyxBQUMxRjtBQUFDLEFBQUMsQUFBQztBQUVILEFBQUUsZUFBQyxBQUFnQyxrQ0FBRTtB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d0JBQUUsQUFBc0IsQUFBQyxBQUFDLEFBQ2pFO0FBQUMsQUFBQyxBQUFDLEFBQ1A7QUFBQyxBQUFDLEFBQUMsQUFDUDtBQUFDLEFBQUMsQUFBQyxBQUNQO0FBQUMsQUFBQyxBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYXNzZXJ0IH0gZnJvbSAnY2hhaSc7XG5cbmltcG9ydCB7IElPYmZ1c2NhdGlvblJlc3VsdCB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL3NyYy9pbnRlcmZhY2VzL0lPYmZ1c2NhdGlvblJlc3VsdCc7XG5cbmltcG9ydCB7IE5PX0NVU1RPTV9OT0RFU19QUkVTRVQgfSBmcm9tICcuLi8uLi8uLi8uLi8uLi9zcmMvb3B0aW9ucy9wcmVzZXRzL05vQ3VzdG9tTm9kZXMnO1xuXG5pbXBvcnQgeyBnZXRSZWdFeHBNYXRjaCB9IGZyb20gJy4uLy4uLy4uLy4uL2hlbHBlcnMvZ2V0UmVnRXhwTWF0Y2gnO1xuaW1wb3J0IHsgcmVhZEZpbGVBc1N0cmluZyB9IGZyb20gJy4uLy4uLy4uLy4uL2hlbHBlcnMvcmVhZEZpbGVBc1N0cmluZyc7XG5cbmltcG9ydCB7IEphdmFTY3JpcHRPYmZ1c2NhdG9yIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vc3JjL0phdmFTY3JpcHRPYmZ1c2NhdG9yJztcblxuZGVzY3JpYmUoJ0Z1bmN0aW9uRGVjbGFyYXRpb25UcmFuc2Zvcm1lcicsICgpID0+IHtcbiAgICBkZXNjcmliZSgndHJhbnNmb3JtYXRpb24gb2YgYGZ1bmN0aW9uRGVjbGFyYXRpb25gIG5vZGUgbmFtZXMnLCAoKSA9PiB7XG4gICAgICAgIGRlc2NyaWJlKCd2YXJpYW50ICMxOiBgZnVuY3Rpb25EZWNsYXJhdGlvbmAgcGFyZW50IGJsb2NrIHNjb3BlIGlzIG5vdCBhIGBQcm9ncmFtTm9kZWAnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBmdW5jdGlvbk5hbWVJZGVudGlmaWVyUmVnRXhwOiBSZWdFeHAgPSAvZnVuY3Rpb24gKihfMHhbYS1mMC05XXs0LDZ9KSAqXFwoXFwpICpcXHsvO1xuICAgICAgICAgICAgY29uc3QgZnVuY3Rpb25DYWxsSWRlbnRpZmllclJlZ0V4cDogUmVnRXhwID0gLyhfMHhbYS1mMC05XXs0LDZ9KSAqXFwoICpcXCk7LztcblxuICAgICAgICAgICAgbGV0IG9iZnVzY2F0ZWRDb2RlOiBzdHJpbmcsXG4gICAgICAgICAgICAgICAgZnVuY3Rpb25OYW1lSWRlbnRpZmllcjogc3RyaW5nLFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uQ2FsbElkZW50aWZpZXI6IHN0cmluZztcblxuICAgICAgICAgICAgYmVmb3JlKCgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb2RlOiBzdHJpbmcgPSByZWFkRmlsZUFzU3RyaW5nKF9fZGlybmFtZSArICcvZml4dHVyZXMvaW5wdXQuanMnKTtcbiAgICAgICAgICAgICAgICBjb25zdCBvYmZ1c2NhdGlvblJlc3VsdDogSU9iZnVzY2F0aW9uUmVzdWx0ID0gSmF2YVNjcmlwdE9iZnVzY2F0b3Iub2JmdXNjYXRlKFxuICAgICAgICAgICAgICAgICAgICBjb2RlLFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5OT19DVVNUT01fTk9ERVNfUFJFU0VUXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgb2JmdXNjYXRlZENvZGUgPSBvYmZ1c2NhdGlvblJlc3VsdC5nZXRPYmZ1c2NhdGVkQ29kZSgpO1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uTmFtZUlkZW50aWZpZXIgPSBnZXRSZWdFeHBNYXRjaChvYmZ1c2NhdGVkQ29kZSwgZnVuY3Rpb25OYW1lSWRlbnRpZmllclJlZ0V4cCk7XG4gICAgICAgICAgICAgICAgZnVuY3Rpb25DYWxsSWRlbnRpZmllciA9IGdldFJlZ0V4cE1hdGNoKG9iZnVzY2F0ZWRDb2RlLCBmdW5jdGlvbkNhbGxJZGVudGlmaWVyUmVnRXhwKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpdCgnc2hvdWxkIHRyYW5zZm9ybSBmdW5jdGlvbiBuYW1lJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGFzc2VydC5lcXVhbChmdW5jdGlvbk5hbWVJZGVudGlmaWVyLCBmdW5jdGlvbkNhbGxJZGVudGlmaWVyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBkZXNjcmliZSgndmFyaWFudCAjMjogYGZ1bmN0aW9uRGVjbGFyYXRpb25gIHBhcmVudCBibG9jayBzY29wZSBpcyBhIGBQcm9ncmFtTm9kZWAnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBmdW5jdGlvbk5hbWVJZGVudGlmaWVyUmVnRXhwOiBSZWdFeHAgPSAvZnVuY3Rpb24gKmZvbyAqXFwoXFwpICpcXHsvO1xuICAgICAgICAgICAgY29uc3QgZnVuY3Rpb25DYWxsSWRlbnRpZmllclJlZ0V4cDogUmVnRXhwID0gL2ZvbyAqXFwoICpcXCk7LztcblxuICAgICAgICAgICAgbGV0IG9iZnVzY2F0ZWRDb2RlOiBzdHJpbmc7XG5cbiAgICAgICAgICAgIGJlZm9yZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29kZTogc3RyaW5nID0gcmVhZEZpbGVBc1N0cmluZyhfX2Rpcm5hbWUgKyAnL2ZpeHR1cmVzL2lucHV0LmpzJyk7XG4gICAgICAgICAgICAgICAgY29uc3Qgb2JmdXNjYXRpb25SZXN1bHQ6IElPYmZ1c2NhdGlvblJlc3VsdCA9IEphdmFTY3JpcHRPYmZ1c2NhdG9yLm9iZnVzY2F0ZShcbiAgICAgICAgICAgICAgICAgICAgY29kZSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4uTk9fQ1VTVE9NX05PREVTX1BSRVNFVFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgIG9iZnVzY2F0ZWRDb2RlID0gb2JmdXNjYXRpb25SZXN1bHQuZ2V0T2JmdXNjYXRlZENvZGUoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpdCgnbWF0Y2ggIzE6IHNob3VsZG5cXCd0IHRyYW5zZm9ybSBmdW5jdGlvbiBuYW1lJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGFzc2VydC5tYXRjaChvYmZ1c2NhdGVkQ29kZSwgZnVuY3Rpb25OYW1lSWRlbnRpZmllclJlZ0V4cCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaXQoJ21hdGNoICMyOiBzaG91bGRuXFwndCB0cmFuc2Zvcm0gZnVuY3Rpb24gbmFtZScsICgpID0+IHtcbiAgICAgICAgICAgICAgICBhc3NlcnQubWF0Y2gob2JmdXNjYXRlZENvZGUsIGZ1bmN0aW9uQ2FsbElkZW50aWZpZXJSZWdFeHApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRlc2NyaWJlKCd2YXJpYW50ICMzOiBnZW5lcmF0b3IgYGZ1bmN0aW9uRGVjbGFyYXRpb25gJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZnVuY3Rpb25OYW1lSWRlbnRpZmllclJlZ0V4cDogUmVnRXhwID0gL2Z1bmN0aW9uICpcXCogKihfMHhbYS1mMC05XXs0LDZ9KSAqXFwoXFwpICpcXHsvO1xuICAgICAgICAgICAgY29uc3QgZnVuY3Rpb25DYWxsSWRlbnRpZmllclJlZ0V4cDogUmVnRXhwID0gL2xldCAqXzB4W2EtZjAtOV17NCw2fSAqPSAqKF8weFthLWYwLTldezQsNn0pICpcXCggKlxcKTsvO1xuXG4gICAgICAgICAgICBsZXQgb2JmdXNjYXRlZENvZGU6IHN0cmluZyxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbk5hbWVJZGVudGlmaWVyOiBzdHJpbmcsXG4gICAgICAgICAgICAgICAgZnVuY3Rpb25DYWxsSWRlbnRpZmllcjogc3RyaW5nO1xuXG4gICAgICAgICAgICBiZWZvcmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvZGU6IHN0cmluZyA9IHJlYWRGaWxlQXNTdHJpbmcoX19kaXJuYW1lICsgJy9maXh0dXJlcy9nZW5lcmF0b3ItZnVuY3Rpb24uanMnKTtcbiAgICAgICAgICAgICAgICBjb25zdCBvYmZ1c2NhdGlvblJlc3VsdDogSU9iZnVzY2F0aW9uUmVzdWx0ID0gSmF2YVNjcmlwdE9iZnVzY2F0b3Iub2JmdXNjYXRlKFxuICAgICAgICAgICAgICAgICAgICBjb2RlLFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5OT19DVVNUT01fTk9ERVNfUFJFU0VUXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgb2JmdXNjYXRlZENvZGUgPSBvYmZ1c2NhdGlvblJlc3VsdC5nZXRPYmZ1c2NhdGVkQ29kZSgpO1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uTmFtZUlkZW50aWZpZXIgPSBnZXRSZWdFeHBNYXRjaChvYmZ1c2NhdGVkQ29kZSwgZnVuY3Rpb25OYW1lSWRlbnRpZmllclJlZ0V4cCk7XG4gICAgICAgICAgICAgICAgZnVuY3Rpb25DYWxsSWRlbnRpZmllciA9IGdldFJlZ0V4cE1hdGNoKG9iZnVzY2F0ZWRDb2RlLCBmdW5jdGlvbkNhbGxJZGVudGlmaWVyUmVnRXhwKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpdCgnc2hvdWxkIHRyYW5zZm9ybSBnZW5lcmF0b3IgZnVuY3Rpb24gbmFtZScsICgpID0+IHtcbiAgICAgICAgICAgICAgICBhc3NlcnQuZXF1YWwoZnVuY3Rpb25OYW1lSWRlbnRpZmllciwgZnVuY3Rpb25DYWxsSWRlbnRpZmllcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZGVzY3JpYmUoJ3ZhcmlhbnQgIzQ6IGFzeW5jIGBmdW5jdGlvbkRlY2xhcmF0aW9uYCcsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGZ1bmN0aW9uTmFtZUlkZW50aWZpZXJSZWdFeHA6IFJlZ0V4cCA9IC9hc3luYyAqZnVuY3Rpb24gKihfMHhbYS1mMC05XXs0LDZ9KSAqXFwoXFwpICpcXHsvO1xuICAgICAgICAgICAgY29uc3QgZnVuY3Rpb25DYWxsSWRlbnRpZmllclJlZ0V4cDogUmVnRXhwID0gL2F3YWl0ICooXzB4W2EtZjAtOV17NCw2fSkgKlxcKCAqXFwpOy87XG5cbiAgICAgICAgICAgIGxldCBvYmZ1c2NhdGVkQ29kZTogc3RyaW5nLFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uTmFtZUlkZW50aWZpZXI6IHN0cmluZyxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbkNhbGxJZGVudGlmaWVyOiBzdHJpbmc7XG5cbiAgICAgICAgICAgIGJlZm9yZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29kZTogc3RyaW5nID0gcmVhZEZpbGVBc1N0cmluZyhfX2Rpcm5hbWUgKyAnL2ZpeHR1cmVzL2FzeW5jLWZ1bmN0aW9uLmpzJyk7XG4gICAgICAgICAgICAgICAgY29uc3Qgb2JmdXNjYXRpb25SZXN1bHQ6IElPYmZ1c2NhdGlvblJlc3VsdCA9IEphdmFTY3JpcHRPYmZ1c2NhdG9yLm9iZnVzY2F0ZShcbiAgICAgICAgICAgICAgICAgICAgY29kZSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4uTk9fQ1VTVE9NX05PREVTX1BSRVNFVFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgIG9iZnVzY2F0ZWRDb2RlID0gb2JmdXNjYXRpb25SZXN1bHQuZ2V0T2JmdXNjYXRlZENvZGUoKTtcbiAgICAgICAgICAgICAgICBmdW5jdGlvbk5hbWVJZGVudGlmaWVyID0gZ2V0UmVnRXhwTWF0Y2gob2JmdXNjYXRlZENvZGUsIGZ1bmN0aW9uTmFtZUlkZW50aWZpZXJSZWdFeHApO1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uQ2FsbElkZW50aWZpZXIgPSBnZXRSZWdFeHBNYXRjaChvYmZ1c2NhdGVkQ29kZSwgZnVuY3Rpb25DYWxsSWRlbnRpZmllclJlZ0V4cCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaXQoJ3Nob3VsZCB0cmFuc2Zvcm0gYXN5bmMgZnVuY3Rpb24gbmFtZScsICgpID0+IHtcbiAgICAgICAgICAgICAgICBhc3NlcnQuZXF1YWwoZnVuY3Rpb25OYW1lSWRlbnRpZmllciwgZnVuY3Rpb25DYWxsSWRlbnRpZmllcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcbiJdfQ==
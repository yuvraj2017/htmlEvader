"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var chai_1 = require("chai");
var NoCustomNodes_1 = require("../../../../src/options/presets/NoCustomNodes");
var readFileAsString_1 = require("../../../helpers/readFileAsString");
var JavaScriptObfuscator_1 = require("../../../../src/JavaScriptObfuscator");
describe('DeadCodeInjectionTransformer', function () {
    var variableMatch = '_0x([a-f0-9]){4,6}';
    var hexMatch = '0x[a-f0-9]';
    describe('transformNode (programNode: ESTree.Program, parentNode: ESTree.Node): ESTree.Node', function () {
        this.timeout(100000);
        describe('variant #1 - 5 simple block statements', function () {
            var regExp = new RegExp("if *\\(" + variableMatch + "\\('" + hexMatch + "'\\) *[=|!]== *" + variableMatch + "\\('" + hexMatch + "'\\)\\) *\\{" + ("console\\[" + variableMatch + "\\('" + hexMatch + "'\\)\\]\\(" + variableMatch + "\\('" + hexMatch + "'\\)\\);") + "\\} *else *\\{" + ("console\\[" + variableMatch + "\\('" + hexMatch + "'\\)\\]\\(" + variableMatch + "\\('" + hexMatch + "'\\)\\);") + "\\}", 'g');
            var expectedMatchesLength = 5;
            var matchesLength = 0;
            before(function () {
                var code = readFileAsString_1.readFileAsString(__dirname + '/fixtures/input-1.js');
                var obfuscationResult = JavaScriptObfuscator_1.JavaScriptObfuscator.obfuscate(code, Object.assign({}, NoCustomNodes_1.NO_CUSTOM_NODES_PRESET, { deadCodeInjection: true, deadCodeInjectionThreshold: 1, stringArray: true, stringArrayThreshold: 1 }));
                var obfuscatedCode = obfuscationResult.getObfuscatedCode();
                var matches = obfuscatedCode.match(regExp);
                if (matches) {
                    matchesLength = matches.length;
                }
            });
            it('should replace block statements with condition with original block statements and dead code', function () {
                chai_1.assert.equal(matchesLength, expectedMatchesLength);
            });
        });
        describe('variant #2 - block statements count is less than `5`', function () {
            var regexp = new RegExp("var *" + variableMatch + " *= *function *\\(\\) *\\{" + ("console\\[" + variableMatch + "\\('" + hexMatch + "'\\)\\]\\(" + variableMatch + "\\('" + hexMatch + "'\\)\\);") + "\\};", 'g');
            var expectedMatchesLength = 4;
            var matchesLength = 0;
            before(function () {
                var code = readFileAsString_1.readFileAsString(__dirname + '/fixtures/block-statements-min-count.js');
                var obfuscationResult = JavaScriptObfuscator_1.JavaScriptObfuscator.obfuscate(code, Object.assign({}, NoCustomNodes_1.NO_CUSTOM_NODES_PRESET, { deadCodeInjection: true, deadCodeInjectionThreshold: 1, stringArray: true, stringArrayThreshold: 1 }));
                var obfuscatedCode = obfuscationResult.getObfuscatedCode();
                var matches = obfuscatedCode.match(regexp);
                if (matches) {
                    matchesLength = matches.length;
                }
            });
            it('shouldn\'t add dead code', function () {
                chai_1.assert.equal(matchesLength, expectedMatchesLength);
            });
        });
        describe('variant #3 - deadCodeInjectionThreshold: 0', function () {
            var regexp = new RegExp("var *" + variableMatch + " *= *function *\\(\\) *\\{" + ("console\\[" + variableMatch + "\\('" + hexMatch + "'\\)\\]\\(" + variableMatch + "\\('" + hexMatch + "'\\)\\);") + "\\};", 'g');
            var expectedMatchesLength = 5;
            var matchesLength = 0;
            before(function () {
                var code = readFileAsString_1.readFileAsString(__dirname + '/fixtures/input-1.js');
                var obfuscationResult = JavaScriptObfuscator_1.JavaScriptObfuscator.obfuscate(code, Object.assign({}, NoCustomNodes_1.NO_CUSTOM_NODES_PRESET, { deadCodeInjection: true, deadCodeInjectionThreshold: 0, stringArray: true, stringArrayThreshold: 1 }));
                var obfuscatedCode = obfuscationResult.getObfuscatedCode();
                var matches = obfuscatedCode.match(regexp);
                if (matches) {
                    matchesLength = matches.length;
                }
            });
            it('shouldn\'t add dead code', function () {
                chai_1.assert.equal(matchesLength, expectedMatchesLength);
            });
        });
        describe('variant #4 - break or continue statement in block statement', function () {
            var functionRegExp = new RegExp("var *" + variableMatch + " *= *function *\\(\\) *\\{" + ("console\\[" + variableMatch + "\\('" + hexMatch + "'\\)\\]\\(" + variableMatch + "\\('" + hexMatch + "'\\)\\);") + "\\};", 'g');
            var loopRegExp = new RegExp("for *\\(var *" + variableMatch + " *= *" + hexMatch + "; *" + variableMatch + " *< *" + hexMatch + "; *" + variableMatch + "\\+\\+\\) *\\{" + "(?:continue|break);" + "\\}", 'g');
            var expectedFunctionMatchesLength = 4;
            var expectedLoopMatchesLength = 2;
            var functionMatchesLength = 0,
                loopMatchesLength = 0;
            before(function () {
                var code = readFileAsString_1.readFileAsString(__dirname + '/fixtures/break-continue-statement.js');
                var obfuscationResult = JavaScriptObfuscator_1.JavaScriptObfuscator.obfuscate(code, Object.assign({}, NoCustomNodes_1.NO_CUSTOM_NODES_PRESET, { deadCodeInjection: true, deadCodeInjectionThreshold: 1, stringArray: true, stringArrayThreshold: 1 }));
                var obfuscatedCode = obfuscationResult.getObfuscatedCode();
                var functionMatches = obfuscatedCode.match(functionRegExp);
                var loopMatches = obfuscatedCode.match(loopRegExp);
                if (functionMatches) {
                    functionMatchesLength = functionMatches.length;
                }
                if (loopMatches) {
                    loopMatchesLength = loopMatches.length;
                }
            });
            it('match #1: shouldn\'t add dead code', function () {
                chai_1.assert.equal(functionMatchesLength, expectedFunctionMatchesLength);
            });
            it('match #2: shouldn\'t add dead code', function () {
                chai_1.assert.equal(loopMatchesLength, expectedLoopMatchesLength);
            });
        });
        describe('variant #5 - chance of `IfStatement` variant', function () {
            var samplesCount = 1000;
            var delta = 0.1;
            var expectedDistribution = 0.25;
            var ifMatch = "if *\\(!!\\[\\]\\) *\\{";
            var functionMatch = "var *" + variableMatch + " *= *function *\\(\\) *\\{";
            var match1 = "" + ("if *\\(" + variableMatch + "\\('" + hexMatch + "'\\) *=== *" + variableMatch + "\\('" + hexMatch + "'\\)\\) *\\{") + "console.*" + "\\} *else *\\{" + (variableMatch + ".*") + "\\}" + "";
            var match2 = "" + ("if *\\(" + variableMatch + "\\('" + hexMatch + "'\\) *!== *" + variableMatch + "\\('" + hexMatch + "'\\)\\) *\\{") + "console.*" + "\\} *else *\\{" + (variableMatch + ".*") + "\\}" + "";
            var match3 = "" + ("if *\\(" + variableMatch + "\\('" + hexMatch + "'\\) *=== *" + variableMatch + "\\('" + hexMatch + "'\\)\\) *\\{") + (variableMatch + ".*") + "\\} *else *\\{" + "console.*" + "\\}" + "";
            var match4 = "" + ("if *\\(" + variableMatch + "\\('" + hexMatch + "'\\) *!== *" + variableMatch + "\\('" + hexMatch + "'\\)\\) *\\{") + (variableMatch + ".*") + "\\} *else *\\{" + "console.*" + "\\}" + "";
            var distribution1 = 0,
                distribution2 = 0,
                distribution3 = 0,
                distribution4 = 0;
            before(function () {
                var code = readFileAsString_1.readFileAsString(__dirname + '/fixtures/if-statement-variants-distribution.js');
                var regExp1 = new RegExp("" + ifMatch + functionMatch + match1);
                var regExp2 = new RegExp("" + ifMatch + functionMatch + match2);
                var regExp3 = new RegExp("" + ifMatch + functionMatch + match3);
                var regExp4 = new RegExp("" + ifMatch + functionMatch + match4);
                var count1 = 0;
                var count2 = 0;
                var count3 = 0;
                var count4 = 0;
                for (var i = 0; i < samplesCount; i++) {
                    var obfuscationResult = JavaScriptObfuscator_1.JavaScriptObfuscator.obfuscate(code, Object.assign({}, NoCustomNodes_1.NO_CUSTOM_NODES_PRESET, { deadCodeInjection: true, deadCodeInjectionThreshold: 1, stringArray: true, stringArrayThreshold: 1 }));
                    var obfuscatedCode = obfuscationResult.getObfuscatedCode();
                    if (regExp1.test(obfuscatedCode)) {
                        count1++;
                    } else if (regExp2.test(obfuscatedCode)) {
                        count2++;
                    } else if (regExp3.test(obfuscatedCode)) {
                        count3++;
                    } else if (regExp4.test(obfuscatedCode)) {
                        count4++;
                    }
                }
                distribution1 = count1 / samplesCount;
                distribution2 = count2 / samplesCount;
                distribution3 = count3 / samplesCount;
                distribution4 = count4 / samplesCount;
            });
            it('variant #1: `IfStatement` variant should have distribution close to `0.25`', function () {
                chai_1.assert.closeTo(distribution1, expectedDistribution, delta);
            });
            it('variant #2: `IfStatement` variant should have distribution close to `0.25`', function () {
                chai_1.assert.closeTo(distribution2, expectedDistribution, delta);
            });
            it('variant #3: `IfStatement` variant should have distribution close to `0.25`', function () {
                chai_1.assert.closeTo(distribution3, expectedDistribution, delta);
            });
            it('variant #4: `IfStatement` variant should have distribution close to `0.25`', function () {
                chai_1.assert.closeTo(distribution4, expectedDistribution, delta);
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRGVhZENvZGVJbmplY3Rpb25UcmFuc2Zvcm1lci5zcGVjLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vdGVzdC9mdW5jdGlvbmFsLXRlc3RzL25vZGUtdHJhbnNmb3JtZXJzL2RlYWQtY29kZS1pbmplY3Rpb24tdHJhbnNmb3JtZXJzL0RlYWRDb2RlSW5qZWN0aW9uVHJhbnNmb3JtZXIuc3BlYy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxxQkFBOEI7QUFJOUIsOEJBQXVGO0FBRXZGLGlDQUFxRTtBQUVyRSxxQ0FBNEU7QUFFNUUsQUFBUSxTQUFDLEFBQThCLGdDQUFFO0FBQ3JDLFFBQU0sQUFBYSxnQkFBVyxBQUFvQixBQUFDO0FBQ25ELFFBQU0sQUFBUSxXQUFXLEFBQVksQUFBQztBQUV0QyxBQUFRLGFBQUMsQUFBbUYscUZBQUU7QUFDMUYsQUFBSSxhQUFDLEFBQU8sUUFBQyxBQUFNLEFBQUMsQUFBQztBQUVyQixBQUFRLGlCQUFDLEFBQXdDLDBDQUFFO0FBQy9DLGdCQUFNLEFBQU0sU0FBVyxJQUFJLEFBQU0sT0FDN0IsWUFBVSxBQUFhLHlCQUFPLEFBQVEsK0JBQWtCLEFBQWEseUJBQU8sQUFBUSxBQUFjLEFBQzlGLDRDQUFhLEFBQWEseUJBQU8sQUFBUSwwQkFBYSxBQUFhLHlCQUFPLEFBQVEsQUFBVSxBQUNoRyxBQUFnQixBQUNaLDREQUFhLEFBQWEseUJBQU8sQUFBUSwwQkFBYSxBQUFhLHlCQUFPLEFBQVEsQUFBVSxBQUNoRyxBQUFLLGdDQUNMLEFBQUcsQUFDTixBQUFDO0FBQ0YsZ0JBQU0sQUFBcUIsd0JBQVcsQUFBQyxBQUFDO0FBRXhDLGdCQUFJLEFBQWEsZ0JBQVcsQUFBQyxBQUFDO0FBRTlCLEFBQU0sbUJBQUM7QUFDSCxvQkFBTSxBQUFJLE9BQVcsbUJBQWdCLGlCQUFDLEFBQVMsWUFBRyxBQUFzQixBQUFDLEFBQUM7QUFDMUUsb0JBQU0sQUFBaUIsb0JBQXVCLHVCQUFvQixxQkFB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bXBvcnQgeyBJT2JmdXNjYXRpb25SZXN1bHQgfSBmcm9tICcuLi8uLi8uLi8uLi9zcmMvaW50ZXJmYWNlcy9JT2JmdXNjYXRpb25SZXN1bHQnO1xuXG5pbXBvcnQgeyBOT19DVVNUT01fTk9ERVNfUFJFU0VUIH0gZnJvbSAnLi4vLi4vLi4vLi4vc3JjL29wdGlvbnMvcHJlc2V0cy9Ob0N1c3RvbU5vZGVzJztcblxuaW1wb3J0IHsgcmVhZEZpbGVBc1N0cmluZyB9IGZyb20gJy4uLy4uLy4uL2hlbHBlcnMvcmVhZEZpbGVBc1N0cmluZyc7XG5cbmltcG9ydCB7IEphdmFTY3JpcHRPYmZ1c2NhdG9yIH0gZnJvbSAnLi4vLi4vLi4vLi4vc3JjL0phdmFTY3JpcHRPYmZ1c2NhdG9yJztcblxuZGVzY3JpYmUoJ0RlYWRDb2RlSW5qZWN0aW9uVHJhbnNmb3JtZXInLCAoKSA9PiB7XG4gICAgY29uc3QgdmFyaWFibGVNYXRjaDogc3RyaW5nID0gJ18weChbYS1mMC05XSl7NCw2fSc7XG4gICAgY29uc3QgaGV4TWF0Y2g6IHN0cmluZyA9ICcweFthLWYwLTldJztcblxuICAgIGRlc2NyaWJlKCd0cmFuc2Zvcm1Ob2RlIChwcm9ncmFtTm9kZTogRVNUcmVlLlByb2dyYW0sIHBhcmVudE5vZGU6IEVTVHJlZS5Ob2RlKTogRVNUcmVlLk5vZGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudGltZW91dCgxMDAwMDApO1xuXG4gICAgICAgIGRlc2NyaWJlKCd2YXJpYW50ICMxIC0gNSBzaW1wbGUgYmxvY2sgc3RhdGVtZW50cycsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlZ0V4cDogUmVnRXhwID0gbmV3IFJlZ0V4cChcbiAgICAgICAgICAgICAgICBgaWYgKlxcXFwoJHt2YXJpYWJsZU1hdGNofVxcXFwoJyR7aGV4TWF0Y2h9J1xcXFwpICpbPXwhXT09ICoke3ZhcmlhYmxlTWF0Y2h9XFxcXCgnJHtoZXhNYXRjaH0nXFxcXClcXFxcKSAqXFxcXHtgK1xuICAgICAgICAgICAgICAgICAgICBgY29uc29sZVxcXFxbJHt2YXJpYWJsZU1hdGNofVxcXFwoJyR7aGV4TWF0Y2h9J1xcXFwpXFxcXF1cXFxcKCR7dmFyaWFibGVNYXRjaH1cXFxcKCcke2hleE1hdGNofSdcXFxcKVxcXFwpO2AgK1xuICAgICAgICAgICAgICAgIGBcXFxcfSAqZWxzZSAqXFxcXHtgK1xuICAgICAgICAgICAgICAgICAgICBgY29uc29sZVxcXFxbJHt2YXJpYWJsZU1hdGNofVxcXFwoJyR7aGV4TWF0Y2h9J1xcXFwpXFxcXF1cXFxcKCR7dmFyaWFibGVNYXRjaH1cXFxcKCcke2hleE1hdGNofSdcXFxcKVxcXFwpO2AgK1xuICAgICAgICAgICAgICAgIGBcXFxcfWAsXG4gICAgICAgICAgICAgICAgJ2cnXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY29uc3QgZXhwZWN0ZWRNYXRjaGVzTGVuZ3RoOiBudW1iZXIgPSA1O1xuXG4gICAgICAgICAgICBsZXQgbWF0Y2hlc0xlbmd0aDogbnVtYmVyID0gMDtcblxuICAgICAgICAgICAgYmVmb3JlKCgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb2RlOiBzdHJpbmcgPSByZWFkRmlsZUFzU3RyaW5nKF9fZGlybmFtZSArICcvZml4dHVyZXMvaW5wdXQtMS5qcycpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG9iZnVzY2F0aW9uUmVzdWx0OiBJT2JmdXNjYXRpb25SZXN1bHQgPSBKYXZhU2NyaXB0T2JmdXNjYXRvci5vYmZ1c2NhdGUoXG4gICAgICAgICAgICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLk5PX0NVU1RPTV9OT0RFU19QUkVTRVQsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWFkQ29kZUluamVjdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlYWRDb2RlSW5qZWN0aW9uVGhyZXNob2xkOiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nQXJyYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmdBcnJheVRocmVzaG9sZDogMVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBjb25zdCBvYmZ1c2NhdGVkQ29kZTogc3RyaW5nID0gb2JmdXNjYXRpb25SZXN1bHQuZ2V0T2JmdXNjYXRlZENvZGUoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBtYXRjaGVzOiBSZWdFeHBNYXRjaEFycmF5ID0gPFJlZ0V4cE1hdGNoQXJyYXk+b2JmdXNjYXRlZENvZGUubWF0Y2gocmVnRXhwKTtcblxuICAgICAgICAgICAgICAgIGlmIChtYXRjaGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIG1hdGNoZXNMZW5ndGggPSBtYXRjaGVzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaXQoJ3Nob3VsZCByZXBsYWNlIGJsb2NrIHN0YXRlbWVudHMgd2l0aCBjb25kaXRpb24gd2l0aCBvcmlnaW5hbCBibG9jayBzdGF0ZW1lbnRzIGFuZCBkZWFkIGNvZGUnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKG1hdGNoZXNMZW5ndGgsIGV4cGVjdGVkTWF0Y2hlc0xlbmd0aCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZGVzY3JpYmUoJ3ZhcmlhbnQgIzIgLSBibG9jayBzdGF0ZW1lbnRzIGNvdW50IGlzIGxlc3MgdGhhbiBgNWAnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZWdleHA6IFJlZ0V4cCA9IG5ldyBSZWdFeHAoXG4gICAgICAgICAgICAgICAgYHZhciAqJHt2YXJpYWJsZU1hdGNofSAqPSAqZnVuY3Rpb24gKlxcXFwoXFxcXCkgKlxcXFx7YCArXG4gICAgICAgICAgICAgICAgICAgIGBjb25zb2xlXFxcXFske3ZhcmlhYmxlTWF0Y2h9XFxcXCgnJHtoZXhNYXRjaH0nXFxcXClcXFxcXVxcXFwoJHt2YXJpYWJsZU1hdGNofVxcXFwoJyR7aGV4TWF0Y2h9J1xcXFwpXFxcXCk7YCArXG4gICAgICAgICAgICAgICAgYFxcXFx9O2AsXG4gICAgICAgICAgICAgICAgJ2cnXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY29uc3QgZXhwZWN0ZWRNYXRjaGVzTGVuZ3RoOiBudW1iZXIgPSA0O1xuXG4gICAgICAgICAgICBsZXQgbWF0Y2hlc0xlbmd0aDogbnVtYmVyID0gMDtcblxuICAgICAgICAgICAgYmVmb3JlKCgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb2RlOiBzdHJpbmcgPSByZWFkRmlsZUFzU3RyaW5nKF9fZGlybmFtZSArICcvZml4dHVyZXMvYmxvY2stc3RhdGVtZW50cy1taW4tY291bnQuanMnKTtcbiAgICAgICAgICAgICAgICBjb25zdCBvYmZ1c2NhdGlvblJlc3VsdDogSU9iZnVzY2F0aW9uUmVzdWx0ID0gSmF2YVNjcmlwdE9iZnVzY2F0b3Iub2JmdXNjYXRlKFxuICAgICAgICAgICAgICAgICAgICBjb2RlLFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5OT19DVVNUT01fTk9ERVNfUFJFU0VULFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVhZENvZGVJbmplY3Rpb246IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWFkQ29kZUluamVjdGlvblRocmVzaG9sZDogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZ0FycmF5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nQXJyYXlUaHJlc2hvbGQ6IDFcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgY29uc3Qgb2JmdXNjYXRlZENvZGU6IHN0cmluZyA9IG9iZnVzY2F0aW9uUmVzdWx0LmdldE9iZnVzY2F0ZWRDb2RlKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbWF0Y2hlczogUmVnRXhwTWF0Y2hBcnJheSA9IDxSZWdFeHBNYXRjaEFycmF5Pm9iZnVzY2F0ZWRDb2RlLm1hdGNoKHJlZ2V4cCk7XG5cbiAgICAgICAgICAgICAgICBpZiAobWF0Y2hlcykge1xuICAgICAgICAgICAgICAgICAgICBtYXRjaGVzTGVuZ3RoID0gbWF0Y2hlcy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGl0KCdzaG91bGRuXFwndCBhZGQgZGVhZCBjb2RlJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGFzc2VydC5lcXVhbChtYXRjaGVzTGVuZ3RoLCBleHBlY3RlZE1hdGNoZXNMZW5ndGgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRlc2NyaWJlKCd2YXJpYW50ICMzIC0gZGVhZENvZGVJbmplY3Rpb25UaHJlc2hvbGQ6IDAnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZWdleHA6IFJlZ0V4cCA9IG5ldyBSZWdFeHAoXG4gICAgICAgICAgICAgICAgYHZhciAqJHt2YXJpYWJsZU1hdGNofSAqPSAqZnVuY3Rpb24gKlxcXFwoXFxcXCkgKlxcXFx7YCArXG4gICAgICAgICAgICAgICAgICAgIGBjb25zb2xlXFxcXFske3ZhcmlhYmxlTWF0Y2h9XFxcXCgnJHtoZXhNYXRjaH0nXFxcXClcXFxcXVxcXFwoJHt2YXJpYWJsZU1hdGNofVxcXFwoJyR7aGV4TWF0Y2h9J1xcXFwpXFxcXCk7YCArXG4gICAgICAgICAgICAgICAgYFxcXFx9O2AsXG4gICAgICAgICAgICAgICAgJ2cnXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY29uc3QgZXhwZWN0ZWRNYXRjaGVzTGVuZ3RoOiBudW1iZXIgPSA1O1xuXG4gICAgICAgICAgICBsZXQgbWF0Y2hlc0xlbmd0aDogbnVtYmVyID0gMDtcblxuICAgICAgICAgICAgYmVmb3JlKCgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb2RlOiBzdHJpbmcgPSByZWFkRmlsZUFzU3RyaW5nKF9fZGlybmFtZSArICcvZml4dHVyZXMvaW5wdXQtMS5qcycpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG9iZnVzY2F0aW9uUmVzdWx0OiBJT2JmdXNjYXRpb25SZXN1bHQgPSBKYXZhU2NyaXB0T2JmdXNjYXRvci5vYmZ1c2NhdGUoXG4gICAgICAgICAgICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLk5PX0NVU1RPTV9OT0RFU19QUkVTRVQsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWFkQ29kZUluamVjdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlYWRDb2RlSW5qZWN0aW9uVGhyZXNob2xkOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nQXJyYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmdBcnJheVRocmVzaG9sZDogMVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBjb25zdCBvYmZ1c2NhdGVkQ29kZTogc3RyaW5nID0gb2JmdXNjYXRpb25SZXN1bHQuZ2V0T2JmdXNjYXRlZENvZGUoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBtYXRjaGVzOiBSZWdFeHBNYXRjaEFycmF5ID0gPFJlZ0V4cE1hdGNoQXJyYXk+b2JmdXNjYXRlZENvZGUubWF0Y2gocmVnZXhwKTtcblxuICAgICAgICAgICAgICAgIGlmIChtYXRjaGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIG1hdGNoZXNMZW5ndGggPSBtYXRjaGVzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaXQoJ3Nob3VsZG5cXCd0IGFkZCBkZWFkIGNvZGUnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKG1hdGNoZXNMZW5ndGgsIGV4cGVjdGVkTWF0Y2hlc0xlbmd0aCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZGVzY3JpYmUoJ3ZhcmlhbnQgIzQgLSBicmVhayBvciBjb250aW51ZSBzdGF0ZW1lbnQgaW4gYmxvY2sgc3RhdGVtZW50JywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZnVuY3Rpb25SZWdFeHA6IFJlZ0V4cCA9IG5ldyBSZWdFeHAoXG4gICAgICAgICAgICAgICAgYHZhciAqJHt2YXJpYWJsZU1hdGNofSAqPSAqZnVuY3Rpb24gKlxcXFwoXFxcXCkgKlxcXFx7YCArXG4gICAgICAgICAgICAgICAgICAgIGBjb25zb2xlXFxcXFske3ZhcmlhYmxlTWF0Y2h9XFxcXCgnJHtoZXhNYXRjaH0nXFxcXClcXFxcXVxcXFwoJHt2YXJpYWJsZU1hdGNofVxcXFwoJyR7aGV4TWF0Y2h9J1xcXFwpXFxcXCk7YCArXG4gICAgICAgICAgICAgICAgYFxcXFx9O2AsXG4gICAgICAgICAgICAgICAgJ2cnXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY29uc3QgbG9vcFJlZ0V4cDogUmVnRXhwID0gbmV3IFJlZ0V4cChcbiAgICAgICAgICAgICAgICBgZm9yICpcXFxcKHZhciAqJHt2YXJpYWJsZU1hdGNofSAqPSAqJHtoZXhNYXRjaH07ICoke3ZhcmlhYmxlTWF0Y2h9ICo8ICoke2hleE1hdGNofTsgKiR7dmFyaWFibGVNYXRjaH1cXFxcK1xcXFwrXFxcXCkgKlxcXFx7YCArXG4gICAgICAgICAgICAgICAgICAgIGAoPzpjb250aW51ZXxicmVhayk7YCArXG4gICAgICAgICAgICAgICAgYFxcXFx9YCxcbiAgICAgICAgICAgICAgICAnZydcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBjb25zdCBleHBlY3RlZEZ1bmN0aW9uTWF0Y2hlc0xlbmd0aDogbnVtYmVyID0gNDtcbiAgICAgICAgICAgIGNvbnN0IGV4cGVjdGVkTG9vcE1hdGNoZXNMZW5ndGg6IG51bWJlciA9IDI7XG5cbiAgICAgICAgICAgIGxldCBmdW5jdGlvbk1hdGNoZXNMZW5ndGg6IG51bWJlciA9IDAsXG4gICAgICAgICAgICAgICAgbG9vcE1hdGNoZXNMZW5ndGg6IG51bWJlciA9IDA7XG5cbiAgICAgICAgICAgIGJlZm9yZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29kZTogc3RyaW5nID0gcmVhZEZpbGVBc1N0cmluZyhfX2Rpcm5hbWUgKyAnL2ZpeHR1cmVzL2JyZWFrLWNvbnRpbnVlLXN0YXRlbWVudC5qcycpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG9iZnVzY2F0aW9uUmVzdWx0OiBJT2JmdXNjYXRpb25SZXN1bHQgPSBKYXZhU2NyaXB0T2JmdXNjYXRvci5vYmZ1c2NhdGUoXG4gICAgICAgICAgICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLk5PX0NVU1RPTV9OT0RFU19QUkVTRVQsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWFkQ29kZUluamVjdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlYWRDb2RlSW5qZWN0aW9uVGhyZXNob2xkOiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nQXJyYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmdBcnJheVRocmVzaG9sZDogMVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBjb25zdCBvYmZ1c2NhdGVkQ29kZTogc3RyaW5nID0gb2JmdXNjYXRpb25SZXN1bHQuZ2V0T2JmdXNjYXRlZENvZGUoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBmdW5jdGlvbk1hdGNoZXM6IFJlZ0V4cE1hdGNoQXJyYXkgPSA8UmVnRXhwTWF0Y2hBcnJheT5vYmZ1c2NhdGVkQ29kZS5tYXRjaChmdW5jdGlvblJlZ0V4cCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbG9vcE1hdGNoZXM6IFJlZ0V4cE1hdGNoQXJyYXkgPSA8UmVnRXhwTWF0Y2hBcnJheT5vYmZ1c2NhdGVkQ29kZS5tYXRjaChsb29wUmVnRXhwKTtcblxuICAgICAgICAgICAgICAgIGlmIChmdW5jdGlvbk1hdGNoZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb25NYXRjaGVzTGVuZ3RoID0gZnVuY3Rpb25NYXRjaGVzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAobG9vcE1hdGNoZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9vcE1hdGNoZXNMZW5ndGggPSBsb29wTWF0Y2hlcy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGl0KCdtYXRjaCAjMTogc2hvdWxkblxcJ3QgYWRkIGRlYWQgY29kZScsICgpID0+IHtcbiAgICAgICAgICAgICAgICBhc3NlcnQuZXF1YWwoZnVuY3Rpb25NYXRjaGVzTGVuZ3RoLCBleHBlY3RlZEZ1bmN0aW9uTWF0Y2hlc0xlbmd0aCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaXQoJ21hdGNoICMyOiBzaG91bGRuXFwndCBhZGQgZGVhZCBjb2RlJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGFzc2VydC5lcXVhbChsb29wTWF0Y2hlc0xlbmd0aCwgZXhwZWN0ZWRMb29wTWF0Y2hlc0xlbmd0aCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZGVzY3JpYmUoJ3ZhcmlhbnQgIzUgLSBjaGFuY2Ugb2YgYElmU3RhdGVtZW50YCB2YXJpYW50JywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc2FtcGxlc0NvdW50OiBudW1iZXIgPSAxMDAwO1xuICAgICAgICAgICAgY29uc3QgZGVsdGE6IG51bWJlciA9IDAuMTtcbiAgICAgICAgICAgIGNvbnN0IGV4cGVjdGVkRGlzdHJpYnV0aW9uOiBudW1iZXIgPSAwLjI1O1xuXG4gICAgICAgICAgICBjb25zdCBpZk1hdGNoOiBzdHJpbmcgPSBgaWYgKlxcXFwoISFcXFxcW1xcXFxdXFxcXCkgKlxcXFx7YDtcbiAgICAgICAgICAgIGNvbnN0IGZ1bmN0aW9uTWF0Y2g6IHN0cmluZyA9IGB2YXIgKiR7dmFyaWFibGVNYXRjaH0gKj0gKmZ1bmN0aW9uICpcXFxcKFxcXFwpICpcXFxce2A7XG5cbiAgICAgICAgICAgIGNvbnN0IG1hdGNoMTogc3RyaW5nID0gYGAgK1xuICAgICAgICAgICAgICAgIGBpZiAqXFxcXCgke3ZhcmlhYmxlTWF0Y2h9XFxcXCgnJHtoZXhNYXRjaH0nXFxcXCkgKj09PSAqJHt2YXJpYWJsZU1hdGNofVxcXFwoJyR7aGV4TWF0Y2h9J1xcXFwpXFxcXCkgKlxcXFx7YCArXG4gICAgICAgICAgICAgICAgICAgIGBjb25zb2xlLipgICtcbiAgICAgICAgICAgICAgICBgXFxcXH0gKmVsc2UgKlxcXFx7YCArXG4gICAgICAgICAgICAgICAgICAgIGAke3ZhcmlhYmxlTWF0Y2h9LipgICtcbiAgICAgICAgICAgICAgICBgXFxcXH1gICtcbiAgICAgICAgICAgIGBgO1xuICAgICAgICAgICAgY29uc3QgbWF0Y2gyOiBzdHJpbmcgPSBgYCArXG4gICAgICAgICAgICAgICAgYGlmICpcXFxcKCR7dmFyaWFibGVNYXRjaH1cXFxcKCcke2hleE1hdGNofSdcXFxcKSAqIT09ICoke3ZhcmlhYmxlTWF0Y2h9XFxcXCgnJHtoZXhNYXRjaH0nXFxcXClcXFxcKSAqXFxcXHtgICtcbiAgICAgICAgICAgICAgICAgICAgYGNvbnNvbGUuKmAgK1xuICAgICAgICAgICAgICAgIGBcXFxcfSAqZWxzZSAqXFxcXHtgICtcbiAgICAgICAgICAgICAgICAgICAgYCR7dmFyaWFibGVNYXRjaH0uKmAgK1xuICAgICAgICAgICAgICAgIGBcXFxcfWAgK1xuICAgICAgICAgICAgYGA7XG4gICAgICAgICAgICBjb25zdCBtYXRjaDM6IHN0cmluZyA9IGBgICtcbiAgICAgICAgICAgICAgICBgaWYgKlxcXFwoJHt2YXJpYWJsZU1hdGNofVxcXFwoJyR7aGV4TWF0Y2h9J1xcXFwpICo9PT0gKiR7dmFyaWFibGVNYXRjaH1cXFxcKCcke2hleE1hdGNofSdcXFxcKVxcXFwpICpcXFxce2AgK1xuICAgICAgICAgICAgICAgICAgICBgJHt2YXJpYWJsZU1hdGNofS4qYCArXG4gICAgICAgICAgICAgICAgYFxcXFx9ICplbHNlICpcXFxce2AgK1xuICAgICAgICAgICAgICAgICAgICBgY29uc29sZS4qYCArXG4gICAgICAgICAgICAgICAgYFxcXFx9YCArXG4gICAgICAgICAgICBgYDtcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoNDogc3RyaW5nID0gYGAgK1xuICAgICAgICAgICAgICAgIGBpZiAqXFxcXCgke3ZhcmlhYmxlTWF0Y2h9XFxcXCgnJHtoZXhNYXRjaH0nXFxcXCkgKiE9PSAqJHt2YXJpYWJsZU1hdGNofVxcXFwoJyR7aGV4TWF0Y2h9J1xcXFwpXFxcXCkgKlxcXFx7YCArXG4gICAgICAgICAgICAgICAgICAgIGAke3ZhcmlhYmxlTWF0Y2h9LipgICtcbiAgICAgICAgICAgICAgICBgXFxcXH0gKmVsc2UgKlxcXFx7YCArXG4gICAgICAgICAgICAgICAgICAgIGBjb25zb2xlLipgICtcbiAgICAgICAgICAgICAgICBgXFxcXH1gICtcbiAgICAgICAgICAgIGBgO1xuXG4gICAgICAgICAgICBsZXQgZGlzdHJpYnV0aW9uMTogbnVtYmVyID0gMCxcbiAgICAgICAgICAgICAgICBkaXN0cmlidXRpb24yOiBudW1iZXIgPSAwLFxuICAgICAgICAgICAgICAgIGRpc3RyaWJ1dGlvbjM6IG51bWJlciA9IDAsXG4gICAgICAgICAgICAgICAgZGlzdHJpYnV0aW9uNDogbnVtYmVyID0gMDtcblxuICAgICAgICAgICAgYmVmb3JlKCgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb2RlOiBzdHJpbmcgPSByZWFkRmlsZUFzU3RyaW5nKF9fZGlybmFtZSArICcvZml4dHVyZXMvaWYtc3RhdGVtZW50LXZhcmlhbnRzLWRpc3RyaWJ1dGlvbi5qcycpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgcmVnRXhwMTogUmVnRXhwID0gbmV3IFJlZ0V4cChgJHtpZk1hdGNofSR7ZnVuY3Rpb25NYXRjaH0ke21hdGNoMX1gKTtcbiAgICAgICAgICAgICAgICBjb25zdCByZWdFeHAyOiBSZWdFeHAgPSBuZXcgUmVnRXhwKGAke2lmTWF0Y2h9JHtmdW5jdGlvbk1hdGNofSR7bWF0Y2gyfWApO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlZ0V4cDM6IFJlZ0V4cCA9IG5ldyBSZWdFeHAoYCR7aWZNYXRjaH0ke2Z1bmN0aW9uTWF0Y2h9JHttYXRjaDN9YCk7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVnRXhwNDogUmVnRXhwID0gbmV3IFJlZ0V4cChgJHtpZk1hdGNofSR7ZnVuY3Rpb25NYXRjaH0ke21hdGNoNH1gKTtcblxuICAgICAgICAgICAgICAgIGxldCBjb3VudDE6IG51bWJlciA9IDA7XG4gICAgICAgICAgICAgICAgbGV0IGNvdW50MjogbnVtYmVyID0gMDtcbiAgICAgICAgICAgICAgICBsZXQgY291bnQzOiBudW1iZXIgPSAwO1xuICAgICAgICAgICAgICAgIGxldCBjb3VudDQ6IG51bWJlciA9IDA7XG5cbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNhbXBsZXNDb3VudDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG9iZnVzY2F0aW9uUmVzdWx0OiBJT2JmdXNjYXRpb25SZXN1bHQgPSBKYXZhU2NyaXB0T2JmdXNjYXRvci5vYmZ1c2NhdGUoXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlLFxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLk5PX0NVU1RPTV9OT0RFU19QUkVTRVQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVhZENvZGVJbmplY3Rpb246IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVhZENvZGVJbmplY3Rpb25UaHJlc2hvbGQ6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nQXJyYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nQXJyYXlUaHJlc2hvbGQ6IDFcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2JmdXNjYXRlZENvZGU6IHN0cmluZyA9IG9iZnVzY2F0aW9uUmVzdWx0LmdldE9iZnVzY2F0ZWRDb2RlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlZ0V4cDEudGVzdChvYmZ1c2NhdGVkQ29kZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50MSsrO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlZ0V4cDIudGVzdChvYmZ1c2NhdGVkQ29kZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50MisrO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlZ0V4cDMudGVzdChvYmZ1c2NhdGVkQ29kZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50MysrO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlZ0V4cDQudGVzdChvYmZ1c2NhdGVkQ29kZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50NCsrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZGlzdHJpYnV0aW9uMSA9IGNvdW50MSAvIHNhbXBsZXNDb3VudDtcbiAgICAgICAgICAgICAgICBkaXN0cmlidXRpb24yID0gY291bnQyIC8gc2FtcGxlc0NvdW50O1xuICAgICAgICAgICAgICAgIGRpc3RyaWJ1dGlvbjMgPSBjb3VudDMgLyBzYW1wbGVzQ291bnQ7XG4gICAgICAgICAgICAgICAgZGlzdHJpYnV0aW9uNCA9IGNvdW50NCAvIHNhbXBsZXNDb3VudDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpdCgndmFyaWFudCAjMTogYElmU3RhdGVtZW50YCB2YXJpYW50IHNob3VsZCBoYXZlIGRpc3RyaWJ1dGlvbiBjbG9zZSB0byBgMC4yNWAnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgYXNzZXJ0LmNsb3NlVG8oZGlzdHJpYnV0aW9uMSwgZXhwZWN0ZWREaXN0cmlidXRpb24sIGRlbHRhKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpdCgndmFyaWFudCAjMjogYElmU3RhdGVtZW50YCB2YXJpYW50IHNob3VsZCBoYXZlIGRpc3RyaWJ1dGlvbiBjbG9zZSB0byBgMC4yNWAnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgYXNzZXJ0LmNsb3NlVG8oZGlzdHJpYnV0aW9uMiwgZXhwZWN0ZWREaXN0cmlidXRpb24sIGRlbHRhKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpdCgndmFyaWFudCAjMzogYElmU3RhdGVtZW50YCB2YXJpYW50IHNob3VsZCBoYXZlIGRpc3RyaWJ1dGlvbiBjbG9zZSB0byBgMC4yNWAnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgYXNzZXJ0LmNsb3NlVG8oZGlzdHJpYnV0aW9uMywgZXhwZWN0ZWREaXN0cmlidXRpb24sIGRlbHRhKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpdCgndmFyaWFudCAjNDogYElmU3RhdGVtZW50YCB2YXJpYW50IHNob3VsZCBoYXZlIGRpc3RyaWJ1dGlvbiBjbG9zZSB0byBgMC4yNWAnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgYXNzZXJ0LmNsb3NlVG8oZGlzdHJpYnV0aW9uNCwgZXhwZWN0ZWREaXN0cmlidXRpb24sIGRlbHRhKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuIl19
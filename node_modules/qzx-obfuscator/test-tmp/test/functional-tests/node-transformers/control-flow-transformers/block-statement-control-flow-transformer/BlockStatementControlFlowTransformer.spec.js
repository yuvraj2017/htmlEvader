"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var chai_1 = require("chai");
var NoCustomNodes_1 = require("../../../../../src/options/presets/NoCustomNodes");
var getRegExpMatch_1 = require("../../../../helpers/getRegExpMatch");
var readFileAsString_1 = require("../../../../helpers/readFileAsString");
var JavaScriptObfuscator_1 = require("../../../../../src/JavaScriptObfuscator");
var getStatementRegExp = function getStatementRegExp(hexNumber) {
    return new RegExp("console\\['log'\\]\\(" + hexNumber + "\\);");
};
describe('BlockStatementControlFlowTransformer', function () {
    this.timeout(100000);
    describe('transformNode (blockStatementNode: ESTree.BlockStatement): ESTree.Node', function () {
        describe('variant #1: 5 simple statements', function () {
            var obfuscatedCode = void 0;
            before(function () {
                var code = readFileAsString_1.readFileAsString(__dirname + '/fixtures/input-1.js');
                var obfuscationResult = JavaScriptObfuscator_1.JavaScriptObfuscator.obfuscate(code, Object.assign({}, NoCustomNodes_1.NO_CUSTOM_NODES_PRESET, { controlFlowFlattening: true, controlFlowFlatteningThreshold: 1 }));
                obfuscatedCode = obfuscationResult.getObfuscatedCode();
            });
            describe('`console.log` statements', function () {
                var statementRegExp1 = getStatementRegExp('0x1');
                var statementRegExp2 = getStatementRegExp('0x2');
                var statementRegExp3 = getStatementRegExp('0x3');
                var statementRegExp4 = getStatementRegExp('0x4');
                var statementRegExp5 = getStatementRegExp('0x5');
                it('should save statement', function () {
                    chai_1.assert.match(obfuscatedCode, statementRegExp1);
                });
                it('should save statement', function () {
                    chai_1.assert.match(obfuscatedCode, statementRegExp2);
                });
                it('should save statement', function () {
                    chai_1.assert.match(obfuscatedCode, statementRegExp3);
                });
                it('should save statement', function () {
                    chai_1.assert.match(obfuscatedCode, statementRegExp4);
                });
                it('should save statement', function () {
                    chai_1.assert.match(obfuscatedCode, statementRegExp5);
                });
            });
            describe('block statement statements', function () {
                var switchCaseRegExp = /switch *\(_0x([a-f0-9]){4,6}\[_0x([a-f0-9]){4,6}\+\+\]\) *\{/;
                var switchCaseLengthRegExp = /case *'[0-5]': *console\['log'\]\(0x[0-6]\);/g;
                var expectedSwitchCaseLength = 5;
                var switchCaseLength = void 0;
                before(function () {
                    switchCaseLength = obfuscatedCode.match(switchCaseLengthRegExp).length;
                });
                it('should wrap block statement statements in switch-case structure', function () {
                    chai_1.assert.match(obfuscatedCode, switchCaseRegExp);
                });
                it('each statement should be wrapped by switch-case structure', function () {
                    chai_1.assert.equal(switchCaseLength, expectedSwitchCaseLength);
                });
            });
            describe('switch-case map', function () {
                var switchCaseMapVariableRegExp = /var *_0x(?:[a-f0-9]){4,6} *= *_0x(?:[a-f0-9]){4,6}\['.*'\]\['split'\]\('\|'\)/;
                var switchCaseMapStringRegExp = /var *_0x(?:[a-f0-9]){4,6} *= *\{'.*' *: *'(.*)'\};/;
                var expectedSwitchCasesSequence = ['0', '1', '2', '3', '4'];
                var switchCaseMap = void 0;
                before(function () {
                    var switchCaseMapMatch = getRegExpMatch_1.getRegExpMatch(obfuscatedCode, switchCaseMapStringRegExp);
                    switchCaseMap = switchCaseMapMatch.split('|').sort();
                });
                it('should create switch-case map variable', function () {
                    chai_1.assert.match(obfuscatedCode, switchCaseMapVariableRegExp);
                });
                it('should create valid switch-case map variable with order of switch cases sequence', function () {
                    chai_1.assert.deepEqual(switchCaseMap, expectedSwitchCasesSequence);
                });
            });
        });
        describe('variant #2: 5 simple statements inside while loop without break or continue statement', function () {
            var obfuscatedCode = void 0;
            before(function () {
                var code = readFileAsString_1.readFileAsString(__dirname + '/fixtures/input-2.js');
                var obfuscationResult = JavaScriptObfuscator_1.JavaScriptObfuscator.obfuscate(code, Object.assign({}, NoCustomNodes_1.NO_CUSTOM_NODES_PRESET, { controlFlowFlattening: true, controlFlowFlatteningThreshold: 1, unicodeEscapeSequence: false }));
                obfuscatedCode = obfuscationResult.getObfuscatedCode();
            });
            describe('`console.log` statements', function () {
                var statementRegExp1 = getStatementRegExp('0x1');
                var statementRegExp2 = getStatementRegExp('0x2');
                var statementRegExp3 = getStatementRegExp('0x3');
                var statementRegExp4 = getStatementRegExp('0x4');
                var statementRegExp5 = getStatementRegExp('0x5');
                it('should save statement', function () {
                    chai_1.assert.match(obfuscatedCode, statementRegExp1);
                });
                it('should save statement', function () {
                    chai_1.assert.match(obfuscatedCode, statementRegExp2);
                });
                it('should save statement', function () {
                    chai_1.assert.match(obfuscatedCode, statementRegExp3);
                });
                it('should save statement', function () {
                    chai_1.assert.match(obfuscatedCode, statementRegExp4);
                });
                it('should save statement', function () {
                    chai_1.assert.match(obfuscatedCode, statementRegExp5);
                });
            });
            describe('block statement statements', function () {
                var switchCaseRegExp = /switch *\(_0x([a-f0-9]){4,6}\[_0x([a-f0-9]){4,6}\+\+\]\) *\{/;
                var switchCaseLengthRegExp = /case *'[0-5]': *console\['log'\]\(0x[0-6]\);/g;
                var expectedSwitchCaseLength = 5;
                var switchCaseLength = void 0;
                before(function () {
                    switchCaseLength = obfuscatedCode.match(switchCaseLengthRegExp).length;
                });
                it('should wrap block statement statements in switch-case structure', function () {
                    chai_1.assert.match(obfuscatedCode, switchCaseRegExp);
                });
                it('each statement should be wrapped by switch-case structure', function () {
                    chai_1.assert.equal(switchCaseLength, expectedSwitchCaseLength);
                });
            });
            describe('switch-case map', function () {
                var switchCaseMapVariableRegExp = /var *_0x(?:[a-f0-9]){4,6} *= *_0x(?:[a-f0-9]){4,6}\['.*'\]\['split'\]\('\|'\)/;
                var switchCaseMapStringRegExp = /var *_0x(?:[a-f0-9]){4,6} *= *\{'.*' *: *'(.*)'\};/;
                var expectedSwitchCasesSequence = ['0', '1', '2', '3', '4'];
                var switchCaseMap = void 0;
                before(function () {
                    var switchCaseMapMatch = getRegExpMatch_1.getRegExpMatch(obfuscatedCode, switchCaseMapStringRegExp);
                    switchCaseMap = switchCaseMapMatch.split('|').sort();
                });
                it('should create switch-case map variable', function () {
                    chai_1.assert.match(obfuscatedCode, switchCaseMapVariableRegExp);
                });
                it('should create valid switch-case map variable with order of switch cases sequence', function () {
                    chai_1.assert.deepEqual(switchCaseMap, expectedSwitchCasesSequence);
                });
            });
        });
        describe('variant #3: statements length less then 5 statements', function () {
            var statementRegExp = /^\(function *\( *\) *\{ *console\['log'\]\(0x1\); *\} *\( *\) *\);$/;
            var obfuscatedCode = void 0;
            before(function () {
                var code = readFileAsString_1.readFileAsString(__dirname + '/fixtures/one-statement.js');
                var obfuscationResult = JavaScriptObfuscator_1.JavaScriptObfuscator.obfuscate(code, Object.assign({}, NoCustomNodes_1.NO_CUSTOM_NODES_PRESET, { controlFlowFlattening: true, controlFlowFlatteningThreshold: 1 }));
                obfuscatedCode = obfuscationResult.getObfuscatedCode();
            });
            it('shouldn\'t transform block statement', function () {
                chai_1.assert.match(obfuscatedCode, statementRegExp);
            });
        });
        describe('variant #4: block statement contain variable declaration with `const` kind', function () {
            var statementRegExp = /^\(function *\( *\) *\{ *const *_0x([a-f0-9]){4,6} *= *0x1; *console\['log'\]\(0x1\);/;
            var obfuscatedCode = void 0;
            before(function () {
                var code = readFileAsString_1.readFileAsString(__dirname + '/fixtures/const-declaration.js');
                var obfuscationResult = JavaScriptObfuscator_1.JavaScriptObfuscator.obfuscate(code, Object.assign({}, NoCustomNodes_1.NO_CUSTOM_NODES_PRESET, { controlFlowFlattening: true, controlFlowFlatteningThreshold: 1 }));
                obfuscatedCode = obfuscationResult.getObfuscatedCode();
            });
            it('shouldn\'t transform block statement', function () {
                chai_1.assert.match(obfuscatedCode, statementRegExp);
            });
        });
        describe('variant #5: block statement contain variable declaration with `let` kind', function () {
            var statementRegExp = /^\(function *\( *\) *\{ *let *_0x([a-f0-9]){4,6} *= *0x1; *console\['log'\]\(0x1\);/;
            var obfuscatedCode = void 0;
            before(function () {
                var code = readFileAsString_1.readFileAsString(__dirname + '/fixtures/let-declaration.js');
                var obfuscationResult = JavaScriptObfuscator_1.JavaScriptObfuscator.obfuscate(code, Object.assign({}, NoCustomNodes_1.NO_CUSTOM_NODES_PRESET, { controlFlowFlattening: true, controlFlowFlatteningThreshold: 1 }));
                obfuscatedCode = obfuscationResult.getObfuscatedCode();
            });
            it('shouldn\'t transform block statement', function () {
                chai_1.assert.match(obfuscatedCode, statementRegExp);
            });
        });
        describe('variant #6: block statement contain break statement', function () {
            var statementRegExp = /^\(function *\( *\) *\{ *while *\(!!\[\]\) *\{ *break; *console\['log'\]\(0x1\);/;
            var obfuscatedCode = void 0;
            before(function () {
                var code = readFileAsString_1.readFileAsString(__dirname + '/fixtures/break-statement.js');
                var obfuscationResult = JavaScriptObfuscator_1.JavaScriptObfuscator.obfuscate(code, Object.assign({}, NoCustomNodes_1.NO_CUSTOM_NODES_PRESET, { controlFlowFlattening: true, controlFlowFlatteningThreshold: 1 }));
                obfuscatedCode = obfuscationResult.getObfuscatedCode();
            });
            it('shouldn\'t transform block statement', function () {
                chai_1.assert.match(obfuscatedCode, statementRegExp);
            });
        });
        describe('variant #7: block statement contain continue statement', function () {
            var statementRegExp = /^\(function *\( *\) *\{ *while *\(!!\[\]\) *\{ *continue; *console\['log'\]\(0x1\);/;
            var obfuscatedCode = void 0;
            before(function () {
                var code = readFileAsString_1.readFileAsString(__dirname + '/fixtures/continue-statement.js');
                var obfuscationResult = JavaScriptObfuscator_1.JavaScriptObfuscator.obfuscate(code, Object.assign({}, NoCustomNodes_1.NO_CUSTOM_NODES_PRESET, { controlFlowFlattening: true, controlFlowFlatteningThreshold: 1 }));
                obfuscatedCode = obfuscationResult.getObfuscatedCode();
            });
            it('shouldn\'t transform block statement', function () {
                chai_1.assert.match(obfuscatedCode, statementRegExp);
            });
        });
        describe('variant #8: block statement contain function declaration', function () {
            var statementRegExp = /^\(function *\( *\) *\{ *function *_0x([a-f0-9]){4,6} *\( *\) *\{ *\} *console\['log'\]\(0x1\);/;
            var obfuscatedCode = void 0;
            before(function () {
                var code = readFileAsString_1.readFileAsString(__dirname + '/fixtures/function-declaration.js');
                var obfuscationResult = JavaScriptObfuscator_1.JavaScriptObfuscator.obfuscate(code, Object.assign({}, NoCustomNodes_1.NO_CUSTOM_NODES_PRESET, { controlFlowFlattening: true, controlFlowFlatteningThreshold: 1 }));
                obfuscatedCode = obfuscationResult.getObfuscatedCode();
            });
            it('shouldn\'t transform block statement', function () {
                chai_1.assert.match(obfuscatedCode, statementRegExp);
            });
        });
        describe('variant #9: `controlFlowFlatteningThreshold` chance', function () {
            var samples = 1000;
            var delta = 0.1;
            var controlFlowFlatteningThreshold = 0.5;
            var regExp1 = /switch *\(_0x([a-f0-9]){4,6}\[_0x([a-f0-9]){4,6}\+\+\]\) *\{/g;
            var regExp2 = /\(function *\( *\) *\{ *console\['log'\]\(0x1\);/g;
            var transformedStatementPercentage = void 0,
                untouchedStatementPercentage = void 0;
            before(function () {
                var code = readFileAsString_1.readFileAsString(__dirname + '/fixtures/input-1.js');
                var obfuscationResult = JavaScriptObfuscator_1.JavaScriptObfuscator.obfuscate(code.repeat(samples), Object.assign({}, NoCustomNodes_1.NO_CUSTOM_NODES_PRESET, { controlFlowFlattening: true, controlFlowFlatteningThreshold: controlFlowFlatteningThreshold }));
                var transformedStatementMatchesLength = obfuscationResult.getObfuscatedCode().match(regExp1).length;
                var untouchedStatementMatchesLength = obfuscationResult.getObfuscatedCode().match(regExp2).length;
                transformedStatementPercentage = transformedStatementMatchesLength / samples;
                untouchedStatementPercentage = untouchedStatementMatchesLength / samples;
            });
            it('should transform block statement with `controlFlowFlatteningThreshold` chance', function () {
                chai_1.assert.closeTo(transformedStatementPercentage, controlFlowFlatteningThreshold, delta);
            });
            it('should keep block statement with (1 - `controlFlowFlatteningThreshold`) chance', function () {
                chai_1.assert.closeTo(untouchedStatementPercentage, controlFlowFlatteningThreshold, delta);
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQmxvY2tTdGF0ZW1lbnRDb250cm9sRmxvd1RyYW5zZm9ybWVyLnNwZWMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi90ZXN0L2Z1bmN0aW9uYWwtdGVzdHMvbm9kZS10cmFuc2Zvcm1lcnMvY29udHJvbC1mbG93LXRyYW5zZm9ybWVycy9ibG9jay1zdGF0ZW1lbnQtY29udHJvbC1mbG93LXRyYW5zZm9ybWVyL0Jsb2NrU3RhdGVtZW50Q29udHJvbEZsb3dUcmFuc2Zvcm1lci5zcGVjLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLHFCQUE4QjtBQUk5Qiw4QkFBMEY7QUFFMUYsK0JBQW9FO0FBQ3BFLGlDQUF3RTtBQUV4RSxxQ0FBK0U7QUFNL0UsSUFBTSxBQUFrQixxQkFBa0MsNEJBQUMsQUFBUztBQUNoRSxBQUFNLFdBQUMsSUFBSSxBQUFNLEFBQUMsaUNBQXdCLEFBQVMsQUFBTSxBQUFDLEFBQUMsQUFDL0Q7QUFBQyxBQUFDO0FBRUYsQUFBUSxTQUFDLEFBQXNDLHdDQUFFO0FBQzdDLEFBQUksU0FBQyxBQUFPLFFBQUMsQUFBTSxBQUFDLEFBQUM7QUFFckIsQUFBUSxhQUFDLEFBQXdFLDBFQUFFO0FBQy9FLEFBQVEsaUJBQUMsQUFBaUMsbUNBQUU7QUFDeEMsZ0JBQUksQUFBc0IsQUFBQztBQUUzQixBQUFNLG1CQUFDO0FBQ0gsb0JBQU0sQUFBSSxPQUFXLG1CQUFnQixpQkFBQyxBQUFTLFlBQUcsQUFBc0IsQUFBQyxBQUFDO0FBQzFFLG9CQUFNLEFBQWlCLG9CQUF1Qix1QkFBb0IscUJBQUMsQUFBUyxVQUN4RSxBQUFJLHdCQUVHLGdCQUFzQiwwQkFDekIsQUFBcUIsdUJBQUUsQUFBSSxNQUMzQixBQUE4QixnQ0FBRSxBQUFDLEFBRXhDLEFBQUM7QUFFRixBQUFjLGlDQUFHLEFBQWlCLGtCQUFDLEFBQWlCLEFBQUUsQUFBQyxBQUMzRDtBQUFDLEFBQUMsQUFBQztBQUVILEFBQVEscUJBQUMsQUFBMEIsNEJBQUU7QUFDakMsb0JBQU0sQUFBZ0IsbUJBQVcsQUFBa0IsbUJBQUMsQUFBSyxBQUFDLEFBQUM7QUFDM0Qsb0JBQU0sQUFBZ0IsbUJBQVcsQUFBa0IsbUJBQUMsQUFBSyxBQUFDLEFBQUM7QUFDM0Qsb0JBQU0sQUFBZ0IsbUJBQVcsQUFBa0IsbUJBQUMsQUFBSyxBQUFDLEFBQUM7QUFDM0Qsb0JBQU0sQUFBZ0IsbUJBQVcsQUFBa0IsbUJBQUMsQUFBSyxBQUFDLEFBQUM7QUFDM0Qsb0JBQU0sQUFBZ0IsbUJBQVcsQUFBa0IsbUJBQUMsQUFBSyxBQUFDLEFBQUM7QUFFM0QsQUFBRSxtQkFBQyxBQUF1Qix5QkFBRTtBQUN4QiwyQkFBTSxPQUFDLEFBQUssTUFBQyxBQUFjLGdCQUFFLEFBQWdCLEFBQUMsQUFBQyxBQUNuRDtBQUFDLEFBQUMsQUFBQztBQUVILEFBQUUsbUJBQUMsQUFBdUIseUJBQUU7QUFDeEIsMkJBQU0sT0FBQyxBQUFLLE1BQUMsQUFBYyxnQkFBRSxBQUFnQixBQUFDLEFBQUMsQUFDbkQ7QUFBQyxBQUFDLEFBQUM7QUFFSCxBQUFFLG1CQUFDLEFBQXVCLHlCQUFFO0FBQ3hCLDJCQUFNLE9BQUMsQUFBSyxNQUFDLEFBQWMsZ0JBQUUsQUFBZ0IsQUFBQyxBQUFDLEFBQ25EO0FBQUMsQUFBQyxBQUFDO0FBRUgsQUFBRSxtQkFBQyxBQUF1Qix5QkFBRTtBQUN4QiwyQkFBTSxPQUFDLEFBQUssTUFBQyxBQUFjLGdCQUFFLEFBQWdCLEFBQUMsQUFBQyxBQUNuRDtBQUFDLEFBQUMsQUFBQztBQUVILEFBQUUsbUJBQUMsQUFBdUIseUJBQUU7QUFDeEIsMkJBQU0sT0FBQyxBQUFLLE1BQUMsQUFBYyxnQkFBRSxBQUFnQixBQUFDLEFBQUMsQUFDbkQ7QUFBQyxBQUFDLEFBQUMsQUFDUDtBQUFDLEFBQUMsQUFBQztBQUVILEFBQVEscUJBQUMsQUFBNEIsOEJBQUU7QUFDbkMsb0JBQU0sQUFBZ0IsbUJBQVcsQUFBOEQsQUFBQztBQUNoRyxvQkFBTSxBQUFzQix5QkFBVyxBQUErQyxBQUFDO0FBQ3ZGLG9CQUFNLEFBQXdCLDJCQUFXLEFBQUMsQUFBQztBQUUzQyxvQkFBSSxBQUF3QixBQUFDO0FBRTdCLEFBQU0sdUJBQUM7QUFDSCxBQUFnQix1Q0FBRyxBQUFjLGVBQUMsQUFBSyxNQUFDLEFBQXNCLEFBQUUsd0JBQUMsQUFBTSxBQUFDLEFBQzVFO0FBQUMsQUFBQyxBQUFDO0FBRUgsQUFBRSxtQkFBQyxBQUFpRSxtRUFBRTtBQUNsRSwyQkFBTSxPQUFDLEFBQUssTUFBQyxBQUFjLGdCQUFFLEFBQWdCLEFBQUMsQUFBQyxBQUNuRDtBQUFDLEFBQUMsQUFBQztBQUVILEFBQUUsbUJBQUMsQUFBMkQsNkRBQUU7QUFDNUQsMkJBQU0sT0FBQyxBQUFLLE1BQUMsQUFBZ0Isa0JBQUUsQUFBd0IsQUFBQyxBQUFDLEFBQzdEO0FBQUMsQUFBQyxBQUFDLEFBQ1A7QUFBQyxBQUFDLEFBQUM7QUFFSCxBQUFRLHFCQUFDLEFBQWlCLG1CQUFFO0FBQ3hCLG9CQUFNLEFBQTJCLDhCQUFXLEFBQStFLEFBQUM7QUFDNUgsb0JBQU0sQUFBeUIsNEJBQVcsQUFBb0QsQUFBQztBQUMvRixvQkFBTSxBQUEyQiw4QkFBYSxDQUFDLEFBQUcsS0FBRSxBQUFHLEtBQUUsQUFBRyxLQUFFLEFBQUcsS0FBRSxBQUFHLEFBQUMsQUFBQztBQUV4RSxvQkFBSSxBQUF1QixBQUFDO0FBRTVCLEFBQU0sdUJBQUM7QUFDSCx3QkFBTSxBQUFrQixxQkFBVyxpQkFBYyxlQUFDLEFBQWMsZ0JBQUUsQUFBeUIsQUFBQyxBQUFDO0FBRTdGLEFBQWEsb0NBQUcsQUFBa0IsbUJBQUMsQUFBSyxNQUFDLEFBQUcsQUFBQyxLQUFDLEFBQUksQUFBRSxBQUFDLEFBQ3pEO0FBQUMsQUFBQyxBQUFDO0FBRUgsQUFBRSxtQkFBQyxBQUF3QywwQ0FBRTtBQUN6QywyQkFBTSxPQUFDLEFBQUssTUFBQyxBQUFjLGdCQUFFLEFBQTJCLEFBQUMsQUFBQyxBQUM5RDtBQUFDLEFBQUMsQUFBQztBQUVILEFBQUUsbUJBQUMsQUFBa0Ysb0ZBQUU7QUFDbkYsMkJBQU0sT0FBQyxBQUFTLFVBQUMsQUFBYSxlQUFFLEFBQTJCLEFBQUMsQUFBQyxBQUNqRTtBQUFDLEFBQUMsQUFBQyxBQUNQO0FBQUMsQUFBQyxBQUFDLEFBQ1A7QUFBQyxBQUFDLEFBQUM7QUFFSCxBQUFRLGlCQUFDLEFBQXVGLHlGQUFFO0FBQzlGLGdCQUFJLEFBQXNCLEFBQUM7QUFFM0IsQUFBTSxtQkFBQztBQUNILG9CQUFNLEFBQUksT0FBVyxtQkFBZ0IsaUJBQUMsQUFBUyxZQUFHLEFBQXNCLEFBQUMsQUFBQztBQUMxRSxvQkFBTSxBQUFpQixvQkFBdUIsdUJBQW9CLHFCQUFDLEFBQVMsVUFDeEUsQUFBSSx3QkFFRyxnQkFBc0IsMEJBQ3pCLEFBQXFCLHVCQUFFLEFBQUksTUFDM0IsQUFBOEIsZ0NBQUUsQUFBQyxHQUNqQyxBQUFxQix1QkFBRSxBQUFLLEFBRW5DLEFBQUM7QUFFRixBQUFjLGlDQUFHLEFBQWlCLGtCQUFDLEFBQWlCLEFBQUUsQUFBQyxBQUMzRDtBQUFDLEFBQUMsQUFBQztBQUVILEFBQVEscUJBQUMsQUFBMEIsNEJBQUU7QUFDakMsb0JBQU0sQUFBZ0IsbUJBQVcsQUFBa0IsbUJBQUMsQUFBSyxBQUFDLEFBQUM7QUFDM0Qsb0JBQU0sQUFBZ0IsbUJBQVcsQUFBa0IsbUJBQUMsQUFBSyxBQUFDLEFBQUM7QUFDM0Qsb0JBQU0sQUFBZ0IsbUJBQVcsQUFBa0IsbUJBQUMsQUFBSyxBQUFDLEFBQUM7QUFDM0Qsb0JBQU0sQUFBZ0IsbUJBQVcsQUFBa0IsbUJBQUMsQUFBSyxBQUFDLEFBQUM7QUFDM0Qsb0JBQU0sQUFBZ0IsbUJBQVcsQUFBa0IsbUJBQUMsQUFBSyxBQUFDLEFBQUM7QUFFM0QsQUFBRSxtQkFBQyxBQUF1Qix5QkFBRTtBQUN4QiwyQkFBTSxPQUFDLEFBQUssTUFBQyxBQUFjLGdCQUFFLEFBQWdCLEFBQUMsQUFBQyxBQUNuRDtBQUFDLEFBQUMsQUFBQztBQUVILEFBQUUsbUJBQUMsQUFBdUIseUJBQUU7QUFDeEIsMkJBQU0sT0FBQyxBQUFLLE1BQUMsQUFBYyxnQkFBRSxBQUFnQixBQUFDLEFBQUMsQUFDbkQ7QUFBQyxBQUFDLEFBQUM7QUFFSCxBQUFFLG1CQUFDLEFBQXVCLHlCQUFFO0FBQ3hCLDJCQUFNLE9BQUMsQUFBSyxNQUFDLEFBQWMsZ0JBQUUsQUFBZ0IsQUFBQyxBQUFDLEFBQ25EO0FBQUMsQUFBQyxBQUFDO0FBRUgsQUFBRSxtQkFBQyxBQUF1Qix5QkFBRTtBQUN4QiwyQkFBTSxPQUFDLEFBQUssTUFBQyxBQUFjLGdCQUFFLEFBQWdCLEFBQUMsQUFBQyxBQUNuRDtBQUFDLEFBQUMsQUFBQztBQUVILEFBQUUsbUJBQUMsQUFBdUIseUJBQUU7QUFDeEIsMkJBQU0sT0FBQyxBQUFLLE1BQUMsQUFBYyxnQkFBRSxBQUFnQixBQUFDLEFBQUMsQUFDbkQ7QUFBQyxBQUFDLEFBQUMsQUFDUDtBQUFDLEFBQUMsQUFBQztBQUVILEFBQVEscUJBQUMsQUFBNEIsOEJBQUU7QUFDbkMsb0JBQU0sQUFBZ0IsbUJBQVcsQUFBOEQsQUFBQztBQUNoRyxvQkFBTSxBQUFzQix5QkFBVyxBQUErQyxBQUFDO0FBQ3ZGLG9CQUFNLEFBQXdCLDJCQUFXLEFBQUMsQUFBQztBQUUzQyxvQkFBSSxBQUF3QixBQUFDO0FBRTdCLEFBQU0sdUJBQUM7QUFDSCxBQUFnQix1Q0FBRyxBQUFjLGVBQUMsQUFBSyxNQUFDLEFBQXNCLEFBQUUsd0JBQUMsQUFBTSxBQUFDLEFBQzVFO0FBQUMsQUFBQyxBQUFDO0FBRUgsQUFBRSxtQkFBQyxBQUFpRSxtRUFBRTtBQUNsRSwyQkFBTSxPQUFDLEFBQUssTUFBQyxBQUFjLGdCQUFFLEFBQWdCLEFBQUMsQUFBQyxBQUNuRDtBQUFDLEFBQUMsQUFBQztBQUVILEFBQUUsbUJBQUMsQUFBMkQsNkRBQUU7QUFDNUQsMkJBQU0sT0FBQyxBQUFLLE1BQUMsQUFBZ0Isa0JBQUUsQUFBd0IsQUFBQyxBQUFDLEFBQzdEO0FBQUMsQUFBQyxBQUFDLEFBQ1A7QUFBQyxBQUFDLEFBQUM7QUFFSCxBQUFRLHFCQUFDLEFBQWlCLG1CQUFFO0FBQ3hCLG9CQUFNLEFBQTJCLDhCQUFXLEFBQStFLEFBQUM7QUFDNUgsb0JBQU0sQUFBeUIsNEJBQVcsQUFBb0QsQUFBQztBQUMvRixvQkFBTSxBQUEyQiw4QkFBYSxDQUFDLEFBQUcsS0FBRSxBQUFHLEtBQUUsQUFBRyxLQUFFLEFBQUcsS0FBRSxBQUFHLEFBQUMsQUFBQztBQUV4RSxvQkFBSSxBQUF1QixBQUFDO0FBRTVCLEFBQU0sdUJBQUM7QUFDSCx3QkFBTSxBQUFrQixxQkFBVyxpQkFBYyxlQUFDLEFBQWMsZ0JBQUUsQUFBeUIsQUFBQyxBQUFDO0FBRTdGLEFBQWEsb0NBQUcsQUFBa0IsbUJBQUMsQUFBSyxNQUFDLEFBQUcsQUFBQyxLQUFDLEFBQUksQUFBRSxBQUFDLEFBQ3pEO0FBQUMsQUFBQyxBQUFDO0FBRUgsQUFBRSxtQkFBQyxBQUF3QywwQ0FBRTtBQUN6QywyQkFBTSxPQUFDLEFBQUssTUFBQyxBQUFjLGdCQUFFLEFBQTJCLEFBQUMsQUFBQyxBQUM5RDtBQUFDLEFBQUMsQUFBQztBQUVILEFBQUUsbUJBQUMsQUFBa0Ysb0ZBQUU7QUFDbkYsMkJBQU0sT0FBQyxBQUFTLFVBQUMsQUFBYSxlQUFFLEFBQTJCLEFBQUMsQUFBQyxBQUNqRTtBQUFDLEFBQUMsQUFBQyxBQUNQO0FBQUMsQUFBQyxBQUFDLEFBQ1A7QUFBQyxBQUFDLEFBQUM7QUFFSCxBQUFRLGlCQUFDLEFBQXNELHdEQUFFO0FBQzdELGdCQUFNLEFBQWUsa0JBQVcsQUFBcUUsQUFBQztBQUV0RyxnQkFBSSxBQUFzQixBQUFDO0FBRTNCLEFBQU0sbUJBQUM7QUFDSCxvQkFBTSxBQUFJLE9BQVcsbUJBQWdCLGlCQUFDLEFBQVMsWUFBRyxBQUE0QixBQUFDLEFBQUM7QUFDaEYsb0JBQU0sQUFBaUIsb0JBQXVCLHVCQUFvQixxQkFBQyxBQUFTLFVBQ3hFLEFBQUksd0JBRUcsZ0JBQXNCLDBCQUN6QixBQUFxQix1QkFBRSxBQUFJLE1BQzNCLEFBQThCLGdDQUFFLEFBQUMsQUFFeEMsQUFBQztBQUVGLEFBQWMsaUNBQUcsQUFBaUIsa0JBQUMsQUFBaUIsQUFBRSxBQUFDLEFBQzNEO0FBQUMsQUFBQyxBQUFDO0FBRUgsQUFBRSxlQUFDLEFBQXNDLHdDQUFFO0FBQ3ZDLHVCQUFNLE9BQUMsQUFBSyxNQUFDLEFBQWMsZ0JBQUUsQUFBZSxBQUFDLEFBQUMsQUFDbEQ7QUFBQyxBQUFDLEFBQUMsQUFDUDtBQUFDLEFBQUMsQUFBQztBQUVILEFBQVEsaUJBQUMsQUFBNEUsOEVBQUU7QUFDbkYsZ0JBQU0sQUFBZSxrQkFBVyxBQUF1RixBQUFDO0FBRXhILGdCQUFJLEFBQXNCLEFBQUM7QUFFM0IsQUFBTSxtQkFBQztBQUNILG9CQUFNLEFBQUksT0FBVyxtQkFBZ0IsaUJBQUMsQUFBUyxZQUFHLEFBQWdDLEFBQUMsQUFBQztBQUNwRixvQkFBTSxBQUFpQixvQkFBdUIsdUJBQW9CLHFCQUFDLEFBQVMsVUFDeEUsQUFBSSx3QkFFRyxnQkFBc0IsMEJBQ3pCLEFBQXFCLHVCQUFFLEFBQUksTUFDM0IsQUFBOEIsZ0NBQUUsQUFBQyxBQUV4QyxBQUFDO0FBRUYsQUFBYyxpQ0FBRyxBQUFpQixrQkFBQyxBQUFpQixBQUFFLEFBQUMsQUFDM0Q7QUFBQyxBQUFDLEFBQUM7QUFFSCxBQUFFLGVBQUMsQUFBc0Msd0NBQUU7QUFDdkMsdUJBQU0sT0FBQyxBQUFLLE1BQUMsQUFBYyxnQkFBRSxBQUFlLEFBQUMsQUFBQyxBQUNsRDtBQUFDLEFBQUMsQUFBQyxBQUNQO0FBQUMsQUFBQyxBQUFDO0FBRUgsQUFBUSxpQkFBQyxBQUEwRSw0RUFBRTtBQUNqRixnQkFBTSxBQUFlLGtCQUFXLEFBQXFGLEFBQUM7QUFFdEgsZ0JBQUksQUFBc0IsQUFBQztBQUUzQixBQUFNLG1CQUFDO0FBQ0gsb0JBQU0sQUFBSSxPQUFXLG1CQUFnQixpQkFBQyxBQUFTLFlBQUcsQUFBOEIsQUFBQyxBQUFDO0FBQ2xGLG9CQUFNLEFBQWlCLG9CQUF1Qix1QkFBb0IscUJBQUMsQUFBUyxVQUN4RSxBQUFJLHdCQUVHLGdCQUFzQiwwQkFDekIsQUFBcUIsdUJBQUUsQUFBSSxNQUMzQixBQUE4QixnQ0FBRSxBQUFDLEFBRXhDLEFBQUM7QUFFRixBQUFjLGlDQUFHLEFBQWlCLGtCQUFDLEFBQWlCLEFBQUUsQUFBQyxBQUMzRDtBQUFDLEFBQUMsQUFBQztBQUVILEFBQUUsZUFBQyxBQUFzQyx3Q0FBRTtBQUN2Qyx1QkFBTSxPQUFDLEFBQUssTUFBQyxBQUFjLGdCQUFFLEFBQWUsQUFBQyxBQUFDLEFBQ2xEO0FBQUMsQUFBQyxBQUFDLEFBQ1A7QUFBQyxBQUFDLEFBQUM7QUFFSCxBQUFRLGlCQUFDLEFBQXFELHVEQUFFO0FBQzVELGdCQUFNLEFBQWUsa0JBQVcsQUFBa0YsQUFBQztBQUVuSCxnQkFBSSxBQUFzQixBQUFDO0FBRTNCLEFBQU0sbUJBQUM7QUFDSCxvQkFBTSxBQUFJLE9BQVcsbUJBQWdCLGlCQUFDLEFBQVMsWUFBRyxBQUE4QixBQUFDLEFBQUM7QUFDbEYsb0JBQU0sQUFBaUIsb0JBQXVCLHVCQUFvQixxQkFBQyxBQUFTLFVBQ3hFLEFBQUksd0JBRUcsZ0JBQXNCLDBCQUN6QixBQUFxQix1QkFBRSxBQUFJLE1BQzNCLEFBQThCLGdDQUFFLEFBQUMsQUFFeEMsQUFBQztBQUVGLEFBQWMsaUNBQUcsQUFBaUIsa0JBQUMsQUFBaUIsQUFBRSxBQUFDLEFBQzNEO0FBQUMsQUFBQyxBQUFDO0FBRUgsQUFBRSxlQUFDLEFBQXNDLHdDQUFFO0FBQ3ZDLHVCQUFNLE9BQUMsQUFBSyxNQUFDLEFBQWMsZ0JBQUUsQUFBZSxBQUFDLEFBQUMsQUFDbEQ7QUFBQyxBQUFDLEFBQUMsQUFDUDtBQUFDLEFBQUMsQUFBQztBQUVILEFBQVEsaUJBQUMsQUFBd0QsMERBQUU7QUFDL0QsZ0JBQU0sQUFBZSxrQkFBVyxBQUFxRixBQUFDO0FBRXRILGdCQUFJLEFBQXNCLEFBQUM7QUFFM0IsQUFBTSxtQkFBQztBQUNILG9CQUFNLEFBQUksT0FBVyxtQkFBZ0IsaUJBQUMsQUFBUyxZQUFHLEFBQWlDLEFBQUMsQUFBQztBQUNyRixvQkFBTSxBQUFpQixvQkFBdUIsdUJBQW9CLHFCQUFDLEFBQVMsVUFDeEUsQUFBSSx3QkFFRyxnQkFBc0IsMEJBQ3pCLEFBQXFCLHVCQUFFLEFBQUksTUFDM0IsQUFBOEIsZ0NBQUUsQUFBQyxBQUV4QyxBQUFDO0FBRUYsQUFBYyxpQ0FBRyxBQUFpQixrQkFBQyxBQUFpQixBQUFFLEFBQUMsQUFDM0Q7QUFBQyxBQUFDLEFBQUM7QUFFSCxBQUFFLGVBQUMsQUFBc0Msd0NBQUU7QUFDdkMsdUJBQU0sT0FBQyxBQUFLLE1BQUMsQUFBYyxnQkFBRSxBQUFlLEFBQUMsQUFBQyxBQUNsRDtBQUFDLEFBQUMsQUFBQyxBQUNQO0FBQUMsQUFBQyxBQUFDO0FBRUgsQUFBUSxpQkFBQyxBQUEwRCw0REFBRTtBQUNqRSxnQkFBTSxBQUFlLGtCQUFXLEFBQWlHO0FBRWpJLGdCQUFJLEFBQXNCLEFBQUM7QUFFM0IsQUFBTSxtQkFBQztBQUNILG9CQUFNLEFBQUksT0FBVyxtQkFBZ0IsaUJBQUMsQUFBUyxZQUFHLEFBQW1DLEFBQUMsQUFBQztBQUN2RixvQkFBTSxBQUFpQixvQkFBdUIsdUJBQW9CLHFCQUFDLEFBQVMsVUFDeEUsQUFBSSx3QkFFRyxnQkFBc0IsMEJBQ3pCLEFBQXFCLHVCQUFFLEFBQUksTUFDM0IsQUFBOEIsZ0NBQUUsQUFBQyxBQUV4QyxBQUFDO0FBRUYsQUFBYyxpQ0FBRyxBQUFpQixrQkFBQyxBQUFpQixBQUFFLEFBQUMsQUFDM0Q7QUFBQyxBQUFDLEFBQUM7QUFFSCxBQUFFLGVBQUMsQUFBc0Msd0NBQUU7QUFDdkMsdUJBQU0sT0FBQyxBQUFLLE1BQUMsQUFBYyxnQkFBRSxBQUFlLEFBQUMsQUFBQyxBQUNsRDtBQUFDLEFBQUMsQUFBQyxBQUNQO0FBQUMsQUFBQyxBQUFDO0FBRUgsQUFBUSxpQkFBQyxBQUFxRCx1REFBRTtBQUM1RCxnQkFBTSxBQUFPLFVBQVcsQUFBSSxBQUFDO0FBQzdCLGdCQUFNLEFBQUssUUFBVyxBQUFHLEFBQUM7QUFFMUIsZ0JBQU0sQUFBOEIsaUNBQVcsQUFBRyxBQUFDO0FBRW5ELGdCQUFNLEFBQU8sVUFBVyxBQUErRCxBQUFDO0FBQ3hGLGdCQUFNLEFBQU8sVUFBVyxBQUFtRCxBQUFDO0FBRTVFLGdCQUFJLEFBQXNDO2dCQUN0QyxBQUFvQyxBQUFDO0FBRXpDLEFBQU0sbUJBQUM7QUFDSCxvQkFBTSxBQUFJLE9BQVcsbUJBQWdCLGlCQUFDLEFBQVMsWUFBRyxBQUFzQixBQUFDLEFBQUM7QUFDMUUsb0JBQU0sQUFBaUIsb0JBQXVCLHVCQUFvQixxQkFBQyxBQUFTLFVBQ3hFLEFBQUksS0FBQyxBQUFNLE9BQUMsQUFBTyxBQUFDLDRCQUViLGdCQUFzQiwwQkFDekIsQUFBcUIsdUJBQUUsQUFBSSxNQUMzQixBQUE4QixnQ0FBRSxBQUE4QixBQUVyRSxBQUFDO0FBRUYsb0JBQU0sQUFBaUMsb0NBQVcsQUFBaUIsa0JBQzlELEFBQWlCLEFBQUUsb0JBQ25CLEFBQUssTUFBQyxBQUFPLEFBQUUsU0FDZixBQUFNLEFBQUM7QUFDWixvQkFBTSxBQUErQixrQ0FBVyxBQUFpQixrQkFDNUQsQUFBaUIsQUFBRSxvQkFDbkIsQUFBSyxNQUFDLEFBQU8sQUFBRSxTQUNmLEFBQU0sQUFBQztBQUVaLEFBQThCLGlEQUFHLEFBQWlDLG9DQUFHLEFBQU8sQUFBQztBQUM3RSxBQUE0QiwrQ0FBRyxBQUErQixrQ0FBRyxBQUFPLEFBQUMsQUFDN0U7QUFBQyxBQUFDLEFBQUM7QUFFSCxBQUFFLGVBQUMsQUFBK0UsaUZBQUU7QUFDaEYsdUJBQU0sT0FBQyxBQUFPLFFBQUMsQUFBOEIsZ0NBQUUsQUFBOEIsZ0NBQUUsQUFBSyxBQUFDLEFBQUMsQUFDMUY7QUFBQyxBQUFDLEFBQUM7QUFFSCxBQUFFLGVBQUMsQUFBZ0Ysa0ZBQUU7QUFDakYsdUJBQU0sT0FBQyxBQUFPLFFBQUMsQUFBNEIsOEJBQUUsQUFBOEIsZ0NBQUUsQUFBSyxBQUFDLEFBQUMsQUFDeEY7QUFBQyxBQUFDLEFBQUMsQUFDUDtBQUFDLEFBQUMsQUFBQyxBQUNQO0FBQUMsQUFBQyxBQUFDLEFBQ1A7QUFBQyxBQUFDLEFBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhc3NlcnQgfSBmcm9tICdjaGFpJztcblxuaW1wb3J0IHsgSU9iZnVzY2F0aW9uUmVzdWx0IH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vc3JjL2ludGVyZmFjZXMvSU9iZnVzY2F0aW9uUmVzdWx0JztcblxuaW1wb3J0IHsgTk9fQ1VTVE9NX05PREVTX1BSRVNFVCB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL3NyYy9vcHRpb25zL3ByZXNldHMvTm9DdXN0b21Ob2Rlcyc7XG5cbmltcG9ydCB7IGdldFJlZ0V4cE1hdGNoIH0gZnJvbSAnLi4vLi4vLi4vLi4vaGVscGVycy9nZXRSZWdFeHBNYXRjaCc7XG5pbXBvcnQgeyByZWFkRmlsZUFzU3RyaW5nIH0gZnJvbSAnLi4vLi4vLi4vLi4vaGVscGVycy9yZWFkRmlsZUFzU3RyaW5nJztcblxuaW1wb3J0IHsgSmF2YVNjcmlwdE9iZnVzY2F0b3IgfSBmcm9tICcuLi8uLi8uLi8uLi8uLi9zcmMvSmF2YVNjcmlwdE9iZnVzY2F0b3InO1xuXG4vKipcbiAqIEBwYXJhbSBoZXhOdW1iZXJcbiAqIEByZXR1cm4ge1JlZ0V4cH1cbiAqL1xuY29uc3QgZ2V0U3RhdGVtZW50UmVnRXhwOiAoaGV4TnVtYmVyOiBzdHJpbmcpID0+IFJlZ0V4cCA9IChoZXhOdW1iZXIpID0+IHtcbiAgICByZXR1cm4gbmV3IFJlZ0V4cChgY29uc29sZVxcXFxbJ2xvZydcXFxcXVxcXFwoJHtoZXhOdW1iZXJ9XFxcXCk7YCk7XG59O1xuXG5kZXNjcmliZSgnQmxvY2tTdGF0ZW1lbnRDb250cm9sRmxvd1RyYW5zZm9ybWVyJywgZnVuY3Rpb24gKCkge1xuICAgIHRoaXMudGltZW91dCgxMDAwMDApO1xuXG4gICAgZGVzY3JpYmUoJ3RyYW5zZm9ybU5vZGUgKGJsb2NrU3RhdGVtZW50Tm9kZTogRVNUcmVlLkJsb2NrU3RhdGVtZW50KTogRVNUcmVlLk5vZGUnLCAoKSA9PiB7XG4gICAgICAgIGRlc2NyaWJlKCd2YXJpYW50ICMxOiA1IHNpbXBsZSBzdGF0ZW1lbnRzJywgKCkgPT4ge1xuICAgICAgICAgICAgbGV0IG9iZnVzY2F0ZWRDb2RlOiBzdHJpbmc7XG5cbiAgICAgICAgICAgIGJlZm9yZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29kZTogc3RyaW5nID0gcmVhZEZpbGVBc1N0cmluZyhfX2Rpcm5hbWUgKyAnL2ZpeHR1cmVzL2lucHV0LTEuanMnKTtcbiAgICAgICAgICAgICAgICBjb25zdCBvYmZ1c2NhdGlvblJlc3VsdDogSU9iZnVzY2F0aW9uUmVzdWx0ID0gSmF2YVNjcmlwdE9iZnVzY2F0b3Iub2JmdXNjYXRlKFxuICAgICAgICAgICAgICAgICAgICBjb2RlLFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5OT19DVVNUT01fTk9ERVNfUFJFU0VULFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbEZsb3dGbGF0dGVuaW5nOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbEZsb3dGbGF0dGVuaW5nVGhyZXNob2xkOiAxXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgb2JmdXNjYXRlZENvZGUgPSBvYmZ1c2NhdGlvblJlc3VsdC5nZXRPYmZ1c2NhdGVkQ29kZSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGRlc2NyaWJlKCdgY29uc29sZS5sb2dgIHN0YXRlbWVudHMnLCAoKT0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzdGF0ZW1lbnRSZWdFeHAxOiBSZWdFeHAgPSBnZXRTdGF0ZW1lbnRSZWdFeHAoJzB4MScpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRlbWVudFJlZ0V4cDI6IFJlZ0V4cCA9IGdldFN0YXRlbWVudFJlZ0V4cCgnMHgyJyk7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3RhdGVtZW50UmVnRXhwMzogUmVnRXhwID0gZ2V0U3RhdGVtZW50UmVnRXhwKCcweDMnKTtcbiAgICAgICAgICAgICAgICBjb25zdCBzdGF0ZW1lbnRSZWdFeHA0OiBSZWdFeHAgPSBnZXRTdGF0ZW1lbnRSZWdFeHAoJzB4NCcpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRlbWVudFJlZ0V4cDU6IFJlZ0V4cCA9IGdldFN0YXRlbWVudFJlZ0V4cCgnMHg1Jyk7XG5cbiAgICAgICAgICAgICAgICBpdCgnc2hvdWxkIHNhdmUgc3RhdGVtZW50JywgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBhc3NlcnQubWF0Y2gob2JmdXNjYXRlZENvZGUsIHN0YXRlbWVudFJlZ0V4cDEpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaXQoJ3Nob3VsZCBzYXZlIHN0YXRlbWVudCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0Lm1hdGNoKG9iZnVzY2F0ZWRDb2RlLCBzdGF0ZW1lbnRSZWdFeHAyKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGl0KCdzaG91bGQgc2F2ZSBzdGF0ZW1lbnQnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGFzc2VydC5tYXRjaChvYmZ1c2NhdGVkQ29kZSwgc3RhdGVtZW50UmVnRXhwMyk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpdCgnc2hvdWxkIHNhdmUgc3RhdGVtZW50JywgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBhc3NlcnQubWF0Y2gob2JmdXNjYXRlZENvZGUsIHN0YXRlbWVudFJlZ0V4cDQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaXQoJ3Nob3VsZCBzYXZlIHN0YXRlbWVudCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0Lm1hdGNoKG9iZnVzY2F0ZWRDb2RlLCBzdGF0ZW1lbnRSZWdFeHA1KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBkZXNjcmliZSgnYmxvY2sgc3RhdGVtZW50IHN0YXRlbWVudHMnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3dpdGNoQ2FzZVJlZ0V4cDogUmVnRXhwID0gL3N3aXRjaCAqXFwoXzB4KFthLWYwLTldKXs0LDZ9XFxbXzB4KFthLWYwLTldKXs0LDZ9XFwrXFwrXFxdXFwpICpcXHsvO1xuICAgICAgICAgICAgICAgIGNvbnN0IHN3aXRjaENhc2VMZW5ndGhSZWdFeHA6IFJlZ0V4cCA9IC9jYXNlIConWzAtNV0nOiAqY29uc29sZVxcWydsb2cnXFxdXFwoMHhbMC02XVxcKTsvZztcbiAgICAgICAgICAgICAgICBjb25zdCBleHBlY3RlZFN3aXRjaENhc2VMZW5ndGg6IG51bWJlciA9IDU7XG5cbiAgICAgICAgICAgICAgICBsZXQgc3dpdGNoQ2FzZUxlbmd0aDogbnVtYmVyO1xuXG4gICAgICAgICAgICAgICAgYmVmb3JlKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoQ2FzZUxlbmd0aCA9IG9iZnVzY2F0ZWRDb2RlLm1hdGNoKHN3aXRjaENhc2VMZW5ndGhSZWdFeHApIS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpdCgnc2hvdWxkIHdyYXAgYmxvY2sgc3RhdGVtZW50IHN0YXRlbWVudHMgaW4gc3dpdGNoLWNhc2Ugc3RydWN0dXJlJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBhc3NlcnQubWF0Y2gob2JmdXNjYXRlZENvZGUsIHN3aXRjaENhc2VSZWdFeHApO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaXQoJ2VhY2ggc3RhdGVtZW50IHNob3VsZCBiZSB3cmFwcGVkIGJ5IHN3aXRjaC1jYXNlIHN0cnVjdHVyZScsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKHN3aXRjaENhc2VMZW5ndGgsIGV4cGVjdGVkU3dpdGNoQ2FzZUxlbmd0aCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZGVzY3JpYmUoJ3N3aXRjaC1jYXNlIG1hcCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzd2l0Y2hDYXNlTWFwVmFyaWFibGVSZWdFeHA6IFJlZ0V4cCA9IC92YXIgKl8weCg/OlthLWYwLTldKXs0LDZ9ICo9ICpfMHgoPzpbYS1mMC05XSl7NCw2fVxcWycuKidcXF1cXFsnc3BsaXQnXFxdXFwoJ1xcfCdcXCkvO1xuICAgICAgICAgICAgICAgIGNvbnN0IHN3aXRjaENhc2VNYXBTdHJpbmdSZWdFeHA6IFJlZ0V4cCA9IC92YXIgKl8weCg/OlthLWYwLTldKXs0LDZ9ICo9ICpcXHsnLionICo6IConKC4qKSdcXH07LztcbiAgICAgICAgICAgICAgICBjb25zdCBleHBlY3RlZFN3aXRjaENhc2VzU2VxdWVuY2U6IHN0cmluZ1tdID0gWycwJywgJzEnLCAnMicsICczJywgJzQnXTtcblxuICAgICAgICAgICAgICAgIGxldCBzd2l0Y2hDYXNlTWFwOiBzdHJpbmdbXTtcblxuICAgICAgICAgICAgICAgIGJlZm9yZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN3aXRjaENhc2VNYXBNYXRjaDogc3RyaW5nID0gZ2V0UmVnRXhwTWF0Y2gob2JmdXNjYXRlZENvZGUsIHN3aXRjaENhc2VNYXBTdHJpbmdSZWdFeHApO1xuXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaENhc2VNYXAgPSBzd2l0Y2hDYXNlTWFwTWF0Y2guc3BsaXQoJ3wnKS5zb3J0KCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBzd2l0Y2gtY2FzZSBtYXAgdmFyaWFibGUnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGFzc2VydC5tYXRjaChvYmZ1c2NhdGVkQ29kZSwgc3dpdGNoQ2FzZU1hcFZhcmlhYmxlUmVnRXhwKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIHZhbGlkIHN3aXRjaC1jYXNlIG1hcCB2YXJpYWJsZSB3aXRoIG9yZGVyIG9mIHN3aXRjaCBjYXNlcyBzZXF1ZW5jZScsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0LmRlZXBFcXVhbChzd2l0Y2hDYXNlTWFwLCBleHBlY3RlZFN3aXRjaENhc2VzU2VxdWVuY2UpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRlc2NyaWJlKCd2YXJpYW50ICMyOiA1IHNpbXBsZSBzdGF0ZW1lbnRzIGluc2lkZSB3aGlsZSBsb29wIHdpdGhvdXQgYnJlYWsgb3IgY29udGludWUgc3RhdGVtZW50JywgKCkgPT4ge1xuICAgICAgICAgICAgbGV0IG9iZnVzY2F0ZWRDb2RlOiBzdHJpbmc7XG5cbiAgICAgICAgICAgIGJlZm9yZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29kZTogc3RyaW5nID0gcmVhZEZpbGVBc1N0cmluZyhfX2Rpcm5hbWUgKyAnL2ZpeHR1cmVzL2lucHV0LTIuanMnKTtcbiAgICAgICAgICAgICAgICBjb25zdCBvYmZ1c2NhdGlvblJlc3VsdDogSU9iZnVzY2F0aW9uUmVzdWx0ID0gSmF2YVNjcmlwdE9iZnVzY2F0b3Iub2JmdXNjYXRlKFxuICAgICAgICAgICAgICAgICAgICBjb2RlLFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5OT19DVVNUT01fTk9ERVNfUFJFU0VULFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbEZsb3dGbGF0dGVuaW5nOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbEZsb3dGbGF0dGVuaW5nVGhyZXNob2xkOiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgdW5pY29kZUVzY2FwZVNlcXVlbmNlOiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgIG9iZnVzY2F0ZWRDb2RlID0gb2JmdXNjYXRpb25SZXN1bHQuZ2V0T2JmdXNjYXRlZENvZGUoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBkZXNjcmliZSgnYGNvbnNvbGUubG9nYCBzdGF0ZW1lbnRzJywgKCk9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3RhdGVtZW50UmVnRXhwMTogUmVnRXhwID0gZ2V0U3RhdGVtZW50UmVnRXhwKCcweDEnKTtcbiAgICAgICAgICAgICAgICBjb25zdCBzdGF0ZW1lbnRSZWdFeHAyOiBSZWdFeHAgPSBnZXRTdGF0ZW1lbnRSZWdFeHAoJzB4MicpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRlbWVudFJlZ0V4cDM6IFJlZ0V4cCA9IGdldFN0YXRlbWVudFJlZ0V4cCgnMHgzJyk7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3RhdGVtZW50UmVnRXhwNDogUmVnRXhwID0gZ2V0U3RhdGVtZW50UmVnRXhwKCcweDQnKTtcbiAgICAgICAgICAgICAgICBjb25zdCBzdGF0ZW1lbnRSZWdFeHA1OiBSZWdFeHAgPSBnZXRTdGF0ZW1lbnRSZWdFeHAoJzB4NScpO1xuXG4gICAgICAgICAgICAgICAgaXQoJ3Nob3VsZCBzYXZlIHN0YXRlbWVudCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0Lm1hdGNoKG9iZnVzY2F0ZWRDb2RlLCBzdGF0ZW1lbnRSZWdFeHAxKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGl0KCdzaG91bGQgc2F2ZSBzdGF0ZW1lbnQnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGFzc2VydC5tYXRjaChvYmZ1c2NhdGVkQ29kZSwgc3RhdGVtZW50UmVnRXhwMik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpdCgnc2hvdWxkIHNhdmUgc3RhdGVtZW50JywgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBhc3NlcnQubWF0Y2gob2JmdXNjYXRlZENvZGUsIHN0YXRlbWVudFJlZ0V4cDMpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaXQoJ3Nob3VsZCBzYXZlIHN0YXRlbWVudCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0Lm1hdGNoKG9iZnVzY2F0ZWRDb2RlLCBzdGF0ZW1lbnRSZWdFeHA0KTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGl0KCdzaG91bGQgc2F2ZSBzdGF0ZW1lbnQnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGFzc2VydC5tYXRjaChvYmZ1c2NhdGVkQ29kZSwgc3RhdGVtZW50UmVnRXhwNSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZGVzY3JpYmUoJ2Jsb2NrIHN0YXRlbWVudCBzdGF0ZW1lbnRzJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHN3aXRjaENhc2VSZWdFeHA6IFJlZ0V4cCA9IC9zd2l0Y2ggKlxcKF8weChbYS1mMC05XSl7NCw2fVxcW18weChbYS1mMC05XSl7NCw2fVxcK1xcK1xcXVxcKSAqXFx7LztcbiAgICAgICAgICAgICAgICBjb25zdCBzd2l0Y2hDYXNlTGVuZ3RoUmVnRXhwOiBSZWdFeHAgPSAvY2FzZSAqJ1swLTVdJzogKmNvbnNvbGVcXFsnbG9nJ1xcXVxcKDB4WzAtNl1cXCk7L2c7XG4gICAgICAgICAgICAgICAgY29uc3QgZXhwZWN0ZWRTd2l0Y2hDYXNlTGVuZ3RoOiBudW1iZXIgPSA1O1xuXG4gICAgICAgICAgICAgICAgbGV0IHN3aXRjaENhc2VMZW5ndGg6IG51bWJlcjtcblxuICAgICAgICAgICAgICAgIGJlZm9yZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaENhc2VMZW5ndGggPSBvYmZ1c2NhdGVkQ29kZS5tYXRjaChzd2l0Y2hDYXNlTGVuZ3RoUmVnRXhwKSEubGVuZ3RoO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaXQoJ3Nob3VsZCB3cmFwIGJsb2NrIHN0YXRlbWVudCBzdGF0ZW1lbnRzIGluIHN3aXRjaC1jYXNlIHN0cnVjdHVyZScsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0Lm1hdGNoKG9iZnVzY2F0ZWRDb2RlLCBzd2l0Y2hDYXNlUmVnRXhwKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGl0KCdlYWNoIHN0YXRlbWVudCBzaG91bGQgYmUgd3JhcHBlZCBieSBzd2l0Y2gtY2FzZSBzdHJ1Y3R1cmUnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGFzc2VydC5lcXVhbChzd2l0Y2hDYXNlTGVuZ3RoLCBleHBlY3RlZFN3aXRjaENhc2VMZW5ndGgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGRlc2NyaWJlKCdzd2l0Y2gtY2FzZSBtYXAnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3dpdGNoQ2FzZU1hcFZhcmlhYmxlUmVnRXhwOiBSZWdFeHAgPSAvdmFyICpfMHgoPzpbYS1mMC05XSl7NCw2fSAqPSAqXzB4KD86W2EtZjAtOV0pezQsNn1cXFsnLionXFxdXFxbJ3NwbGl0J1xcXVxcKCdcXHwnXFwpLztcbiAgICAgICAgICAgICAgICBjb25zdCBzd2l0Y2hDYXNlTWFwU3RyaW5nUmVnRXhwOiBSZWdFeHAgPSAvdmFyICpfMHgoPzpbYS1mMC05XSl7NCw2fSAqPSAqXFx7Jy4qJyAqOiAqJyguKiknXFx9Oy87XG4gICAgICAgICAgICAgICAgY29uc3QgZXhwZWN0ZWRTd2l0Y2hDYXNlc1NlcXVlbmNlOiBzdHJpbmdbXSA9IFsnMCcsICcxJywgJzInLCAnMycsICc0J107XG5cbiAgICAgICAgICAgICAgICBsZXQgc3dpdGNoQ2FzZU1hcDogc3RyaW5nW107XG5cbiAgICAgICAgICAgICAgICBiZWZvcmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzd2l0Y2hDYXNlTWFwTWF0Y2g6IHN0cmluZyA9IGdldFJlZ0V4cE1hdGNoKG9iZnVzY2F0ZWRDb2RlLCBzd2l0Y2hDYXNlTWFwU3RyaW5nUmVnRXhwKTtcblxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2hDYXNlTWFwID0gc3dpdGNoQ2FzZU1hcE1hdGNoLnNwbGl0KCd8Jykuc29ydCgpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgc3dpdGNoLWNhc2UgbWFwIHZhcmlhYmxlJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBhc3NlcnQubWF0Y2gob2JmdXNjYXRlZENvZGUsIHN3aXRjaENhc2VNYXBWYXJpYWJsZVJlZ0V4cCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSB2YWxpZCBzd2l0Y2gtY2FzZSBtYXAgdmFyaWFibGUgd2l0aCBvcmRlciBvZiBzd2l0Y2ggY2FzZXMgc2VxdWVuY2UnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGFzc2VydC5kZWVwRXF1YWwoc3dpdGNoQ2FzZU1hcCwgZXhwZWN0ZWRTd2l0Y2hDYXNlc1NlcXVlbmNlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBkZXNjcmliZSgndmFyaWFudCAjMzogc3RhdGVtZW50cyBsZW5ndGggbGVzcyB0aGVuIDUgc3RhdGVtZW50cycsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHN0YXRlbWVudFJlZ0V4cDogUmVnRXhwID0gL15cXChmdW5jdGlvbiAqXFwoICpcXCkgKlxceyAqY29uc29sZVxcWydsb2cnXFxdXFwoMHgxXFwpOyAqXFx9ICpcXCggKlxcKSAqXFwpOyQvO1xuXG4gICAgICAgICAgICBsZXQgb2JmdXNjYXRlZENvZGU6IHN0cmluZztcblxuICAgICAgICAgICAgYmVmb3JlKCgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb2RlOiBzdHJpbmcgPSByZWFkRmlsZUFzU3RyaW5nKF9fZGlybmFtZSArICcvZml4dHVyZXMvb25lLXN0YXRlbWVudC5qcycpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG9iZnVzY2F0aW9uUmVzdWx0OiBJT2JmdXNjYXRpb25SZXN1bHQgPSBKYXZhU2NyaXB0T2JmdXNjYXRvci5vYmZ1c2NhdGUoXG4gICAgICAgICAgICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLk5PX0NVU1RPTV9OT0RFU19QUkVTRVQsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sRmxvd0ZsYXR0ZW5pbmc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sRmxvd0ZsYXR0ZW5pbmdUaHJlc2hvbGQ6IDFcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICBvYmZ1c2NhdGVkQ29kZSA9IG9iZnVzY2F0aW9uUmVzdWx0LmdldE9iZnVzY2F0ZWRDb2RlKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaXQoJ3Nob3VsZG5cXCd0IHRyYW5zZm9ybSBibG9jayBzdGF0ZW1lbnQnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgYXNzZXJ0Lm1hdGNoKG9iZnVzY2F0ZWRDb2RlLCBzdGF0ZW1lbnRSZWdFeHApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRlc2NyaWJlKCd2YXJpYW50ICM0OiBibG9jayBzdGF0ZW1lbnQgY29udGFpbiB2YXJpYWJsZSBkZWNsYXJhdGlvbiB3aXRoIGBjb25zdGAga2luZCcsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHN0YXRlbWVudFJlZ0V4cDogUmVnRXhwID0gL15cXChmdW5jdGlvbiAqXFwoICpcXCkgKlxceyAqY29uc3QgKl8weChbYS1mMC05XSl7NCw2fSAqPSAqMHgxOyAqY29uc29sZVxcWydsb2cnXFxdXFwoMHgxXFwpOy87XG5cbiAgICAgICAgICAgIGxldCBvYmZ1c2NhdGVkQ29kZTogc3RyaW5nO1xuXG4gICAgICAgICAgICBiZWZvcmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvZGU6IHN0cmluZyA9IHJlYWRGaWxlQXNTdHJpbmcoX19kaXJuYW1lICsgJy9maXh0dXJlcy9jb25zdC1kZWNsYXJhdGlvbi5qcycpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG9iZnVzY2F0aW9uUmVzdWx0OiBJT2JmdXNjYXRpb25SZXN1bHQgPSBKYXZhU2NyaXB0T2JmdXNjYXRvci5vYmZ1c2NhdGUoXG4gICAgICAgICAgICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLk5PX0NVU1RPTV9OT0RFU19QUkVTRVQsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sRmxvd0ZsYXR0ZW5pbmc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sRmxvd0ZsYXR0ZW5pbmdUaHJlc2hvbGQ6IDFcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICBvYmZ1c2NhdGVkQ29kZSA9IG9iZnVzY2F0aW9uUmVzdWx0LmdldE9iZnVzY2F0ZWRDb2RlKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaXQoJ3Nob3VsZG5cXCd0IHRyYW5zZm9ybSBibG9jayBzdGF0ZW1lbnQnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgYXNzZXJ0Lm1hdGNoKG9iZnVzY2F0ZWRDb2RlLCBzdGF0ZW1lbnRSZWdFeHApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRlc2NyaWJlKCd2YXJpYW50ICM1OiBibG9jayBzdGF0ZW1lbnQgY29udGFpbiB2YXJpYWJsZSBkZWNsYXJhdGlvbiB3aXRoIGBsZXRgIGtpbmQnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzdGF0ZW1lbnRSZWdFeHA6IFJlZ0V4cCA9IC9eXFwoZnVuY3Rpb24gKlxcKCAqXFwpICpcXHsgKmxldCAqXzB4KFthLWYwLTldKXs0LDZ9ICo9ICoweDE7ICpjb25zb2xlXFxbJ2xvZydcXF1cXCgweDFcXCk7LztcblxuICAgICAgICAgICAgbGV0IG9iZnVzY2F0ZWRDb2RlOiBzdHJpbmc7XG5cbiAgICAgICAgICAgIGJlZm9yZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29kZTogc3RyaW5nID0gcmVhZEZpbGVBc1N0cmluZyhfX2Rpcm5hbWUgKyAnL2ZpeHR1cmVzL2xldC1kZWNsYXJhdGlvbi5qcycpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG9iZnVzY2F0aW9uUmVzdWx0OiBJT2JmdXNjYXRpb25SZXN1bHQgPSBKYXZhU2NyaXB0T2JmdXNjYXRvci5vYmZ1c2NhdGUoXG4gICAgICAgICAgICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLk5PX0NVU1RPTV9OT0RFU19QUkVTRVQsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sRmxvd0ZsYXR0ZW5pbmc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sRmxvd0ZsYXR0ZW5pbmdUaHJlc2hvbGQ6IDFcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICBvYmZ1c2NhdGVkQ29kZSA9IG9iZnVzY2F0aW9uUmVzdWx0LmdldE9iZnVzY2F0ZWRDb2RlKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaXQoJ3Nob3VsZG5cXCd0IHRyYW5zZm9ybSBibG9jayBzdGF0ZW1lbnQnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgYXNzZXJ0Lm1hdGNoKG9iZnVzY2F0ZWRDb2RlLCBzdGF0ZW1lbnRSZWdFeHApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRlc2NyaWJlKCd2YXJpYW50ICM2OiBibG9jayBzdGF0ZW1lbnQgY29udGFpbiBicmVhayBzdGF0ZW1lbnQnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzdGF0ZW1lbnRSZWdFeHA6IFJlZ0V4cCA9IC9eXFwoZnVuY3Rpb24gKlxcKCAqXFwpICpcXHsgKndoaWxlICpcXCghIVxcW1xcXVxcKSAqXFx7ICpicmVhazsgKmNvbnNvbGVcXFsnbG9nJ1xcXVxcKDB4MVxcKTsvO1xuXG4gICAgICAgICAgICBsZXQgb2JmdXNjYXRlZENvZGU6IHN0cmluZztcblxuICAgICAgICAgICAgYmVmb3JlKCgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb2RlOiBzdHJpbmcgPSByZWFkRmlsZUFzU3RyaW5nKF9fZGlybmFtZSArICcvZml4dHVyZXMvYnJlYWstc3RhdGVtZW50LmpzJyk7XG4gICAgICAgICAgICAgICAgY29uc3Qgb2JmdXNjYXRpb25SZXN1bHQ6IElPYmZ1c2NhdGlvblJlc3VsdCA9IEphdmFTY3JpcHRPYmZ1c2NhdG9yLm9iZnVzY2F0ZShcbiAgICAgICAgICAgICAgICAgICAgY29kZSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4uTk9fQ1VTVE9NX05PREVTX1BSRVNFVCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xGbG93RmxhdHRlbmluZzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xGbG93RmxhdHRlbmluZ1RocmVzaG9sZDogMVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgIG9iZnVzY2F0ZWRDb2RlID0gb2JmdXNjYXRpb25SZXN1bHQuZ2V0T2JmdXNjYXRlZENvZGUoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpdCgnc2hvdWxkblxcJ3QgdHJhbnNmb3JtIGJsb2NrIHN0YXRlbWVudCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICBhc3NlcnQubWF0Y2gob2JmdXNjYXRlZENvZGUsIHN0YXRlbWVudFJlZ0V4cCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZGVzY3JpYmUoJ3ZhcmlhbnQgIzc6IGJsb2NrIHN0YXRlbWVudCBjb250YWluIGNvbnRpbnVlIHN0YXRlbWVudCcsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHN0YXRlbWVudFJlZ0V4cDogUmVnRXhwID0gL15cXChmdW5jdGlvbiAqXFwoICpcXCkgKlxceyAqd2hpbGUgKlxcKCEhXFxbXFxdXFwpICpcXHsgKmNvbnRpbnVlOyAqY29uc29sZVxcWydsb2cnXFxdXFwoMHgxXFwpOy87XG5cbiAgICAgICAgICAgIGxldCBvYmZ1c2NhdGVkQ29kZTogc3RyaW5nO1xuXG4gICAgICAgICAgICBiZWZvcmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvZGU6IHN0cmluZyA9IHJlYWRGaWxlQXNTdHJpbmcoX19kaXJuYW1lICsgJy9maXh0dXJlcy9jb250aW51ZS1zdGF0ZW1lbnQuanMnKTtcbiAgICAgICAgICAgICAgICBjb25zdCBvYmZ1c2NhdGlvblJlc3VsdDogSU9iZnVzY2F0aW9uUmVzdWx0ID0gSmF2YVNjcmlwdE9iZnVzY2F0b3Iub2JmdXNjYXRlKFxuICAgICAgICAgICAgICAgICAgICBjb2RlLFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5OT19DVVNUT01fTk9ERVNfUFJFU0VULFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbEZsb3dGbGF0dGVuaW5nOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbEZsb3dGbGF0dGVuaW5nVGhyZXNob2xkOiAxXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgb2JmdXNjYXRlZENvZGUgPSBvYmZ1c2NhdGlvblJlc3VsdC5nZXRPYmZ1c2NhdGVkQ29kZSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGl0KCdzaG91bGRuXFwndCB0cmFuc2Zvcm0gYmxvY2sgc3RhdGVtZW50JywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGFzc2VydC5tYXRjaChvYmZ1c2NhdGVkQ29kZSwgc3RhdGVtZW50UmVnRXhwKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBkZXNjcmliZSgndmFyaWFudCAjODogYmxvY2sgc3RhdGVtZW50IGNvbnRhaW4gZnVuY3Rpb24gZGVjbGFyYXRpb24nLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzdGF0ZW1lbnRSZWdFeHA6IFJlZ0V4cCA9IC9eXFwoZnVuY3Rpb24gKlxcKCAqXFwpICpcXHsgKmZ1bmN0aW9uICpfMHgoW2EtZjAtOV0pezQsNn0gKlxcKCAqXFwpICpcXHsgKlxcfSAqY29uc29sZVxcWydsb2cnXFxdXFwoMHgxXFwpOy9cblxuICAgICAgICAgICAgbGV0IG9iZnVzY2F0ZWRDb2RlOiBzdHJpbmc7XG5cbiAgICAgICAgICAgIGJlZm9yZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29kZTogc3RyaW5nID0gcmVhZEZpbGVBc1N0cmluZyhfX2Rpcm5hbWUgKyAnL2ZpeHR1cmVzL2Z1bmN0aW9uLWRlY2xhcmF0aW9uLmpzJyk7XG4gICAgICAgICAgICAgICAgY29uc3Qgb2JmdXNjYXRpb25SZXN1bHQ6IElPYmZ1c2NhdGlvblJlc3VsdCA9IEphdmFTY3JpcHRPYmZ1c2NhdG9yLm9iZnVzY2F0ZShcbiAgICAgICAgICAgICAgICAgICAgY29kZSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4uTk9fQ1VTVE9NX05PREVTX1BSRVNFVCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xGbG93RmxhdHRlbmluZzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xGbG93RmxhdHRlbmluZ1RocmVzaG9sZDogMVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgIG9iZnVzY2F0ZWRDb2RlID0gb2JmdXNjYXRpb25SZXN1bHQuZ2V0T2JmdXNjYXRlZENvZGUoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpdCgnc2hvdWxkblxcJ3QgdHJhbnNmb3JtIGJsb2NrIHN0YXRlbWVudCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICBhc3NlcnQubWF0Y2gob2JmdXNjYXRlZENvZGUsIHN0YXRlbWVudFJlZ0V4cCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZGVzY3JpYmUoJ3ZhcmlhbnQgIzk6IGBjb250cm9sRmxvd0ZsYXR0ZW5pbmdUaHJlc2hvbGRgIGNoYW5jZScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHNhbXBsZXM6IG51bWJlciA9IDEwMDA7XG4gICAgICAgICAgICBjb25zdCBkZWx0YTogbnVtYmVyID0gMC4xO1xuXG4gICAgICAgICAgICBjb25zdCBjb250cm9sRmxvd0ZsYXR0ZW5pbmdUaHJlc2hvbGQ6IG51bWJlciA9IDAuNTtcblxuICAgICAgICAgICAgY29uc3QgcmVnRXhwMTogUmVnRXhwID0gL3N3aXRjaCAqXFwoXzB4KFthLWYwLTldKXs0LDZ9XFxbXzB4KFthLWYwLTldKXs0LDZ9XFwrXFwrXFxdXFwpICpcXHsvZztcbiAgICAgICAgICAgIGNvbnN0IHJlZ0V4cDI6IFJlZ0V4cCA9IC9cXChmdW5jdGlvbiAqXFwoICpcXCkgKlxceyAqY29uc29sZVxcWydsb2cnXFxdXFwoMHgxXFwpOy9nO1xuXG4gICAgICAgICAgICBsZXQgdHJhbnNmb3JtZWRTdGF0ZW1lbnRQZXJjZW50YWdlOiBudW1iZXIsXG4gICAgICAgICAgICAgICAgdW50b3VjaGVkU3RhdGVtZW50UGVyY2VudGFnZTogbnVtYmVyO1xuXG4gICAgICAgICAgICBiZWZvcmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvZGU6IHN0cmluZyA9IHJlYWRGaWxlQXNTdHJpbmcoX19kaXJuYW1lICsgJy9maXh0dXJlcy9pbnB1dC0xLmpzJyk7XG4gICAgICAgICAgICAgICAgY29uc3Qgb2JmdXNjYXRpb25SZXN1bHQ6IElPYmZ1c2NhdGlvblJlc3VsdCA9IEphdmFTY3JpcHRPYmZ1c2NhdG9yLm9iZnVzY2F0ZShcbiAgICAgICAgICAgICAgICAgICAgY29kZS5yZXBlYXQoc2FtcGxlcyksXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLk5PX0NVU1RPTV9OT0RFU19QUkVTRVQsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sRmxvd0ZsYXR0ZW5pbmc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sRmxvd0ZsYXR0ZW5pbmdUaHJlc2hvbGQ6IGNvbnRyb2xGbG93RmxhdHRlbmluZ1RocmVzaG9sZCxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCB0cmFuc2Zvcm1lZFN0YXRlbWVudE1hdGNoZXNMZW5ndGg6IG51bWJlciA9IG9iZnVzY2F0aW9uUmVzdWx0XG4gICAgICAgICAgICAgICAgICAgIC5nZXRPYmZ1c2NhdGVkQ29kZSgpXG4gICAgICAgICAgICAgICAgICAgIC5tYXRjaChyZWdFeHAxKSFcbiAgICAgICAgICAgICAgICAgICAgLmxlbmd0aDtcbiAgICAgICAgICAgICAgICBjb25zdCB1bnRvdWNoZWRTdGF0ZW1lbnRNYXRjaGVzTGVuZ3RoOiBudW1iZXIgPSBvYmZ1c2NhdGlvblJlc3VsdFxuICAgICAgICAgICAgICAgICAgICAuZ2V0T2JmdXNjYXRlZENvZGUoKVxuICAgICAgICAgICAgICAgICAgICAubWF0Y2gocmVnRXhwMikhXG4gICAgICAgICAgICAgICAgICAgIC5sZW5ndGg7XG5cbiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1lZFN0YXRlbWVudFBlcmNlbnRhZ2UgPSB0cmFuc2Zvcm1lZFN0YXRlbWVudE1hdGNoZXNMZW5ndGggLyBzYW1wbGVzO1xuICAgICAgICAgICAgICAgIHVudG91Y2hlZFN0YXRlbWVudFBlcmNlbnRhZ2UgPSB1bnRvdWNoZWRTdGF0ZW1lbnRNYXRjaGVzTGVuZ3RoIC8gc2FtcGxlcztcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpdCgnc2hvdWxkIHRyYW5zZm9ybSBibG9jayBzdGF0ZW1lbnQgd2l0aCBgY29udHJvbEZsb3dGbGF0dGVuaW5nVGhyZXNob2xkYCBjaGFuY2UnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgYXNzZXJ0LmNsb3NlVG8odHJhbnNmb3JtZWRTdGF0ZW1lbnRQZXJjZW50YWdlLCBjb250cm9sRmxvd0ZsYXR0ZW5pbmdUaHJlc2hvbGQsIGRlbHRhKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpdCgnc2hvdWxkIGtlZXAgYmxvY2sgc3RhdGVtZW50IHdpdGggKDEgLSBgY29udHJvbEZsb3dGbGF0dGVuaW5nVGhyZXNob2xkYCkgY2hhbmNlJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGFzc2VydC5jbG9zZVRvKHVudG91Y2hlZFN0YXRlbWVudFBlcmNlbnRhZ2UsIGNvbnRyb2xGbG93RmxhdHRlbmluZ1RocmVzaG9sZCwgZGVsdGEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG4iXX0=
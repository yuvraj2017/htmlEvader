"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

Object.defineProperty(exports, "__esModule", { value: true });
var chai_1 = require("chai");
var ServiceIdentifiers_1 = require("../../../src/container/ServiceIdentifiers");
var InversifyContainerFacade_1 = require("../../../src/container/InversifyContainerFacade");
var MapStorage_1 = require("../../../src/storages/MapStorage");

var ConcreteStorage = function (_MapStorage_1$MapStor) {
    _inherits(ConcreteStorage, _MapStorage_1$MapStor);

    function ConcreteStorage() {
        _classCallCheck(this, ConcreteStorage);

        var inversifyContainerFacade = new InversifyContainerFacade_1.InversifyContainerFacade();
        inversifyContainerFacade.load('', {});
        return _possibleConstructorReturn(this, (ConcreteStorage.__proto__ || Object.getPrototypeOf(ConcreteStorage)).call(this, inversifyContainerFacade.get(ServiceIdentifiers_1.ServiceIdentifiers.IRandomGenerator)));
    }

    return ConcreteStorage;
}(MapStorage_1.MapStorage);

var getStorageInstance = function getStorageInstance() {
    var storage = new ConcreteStorage();
    storage.initialize();
    return storage;
};
describe('MapStorage', function () {
    var storageKey = 'foo';
    var storageValue = 'bar';
    var storage = void 0;
    describe('initialize (...args: any[]): void', function () {
        var expectedError = Error;
        var testFunc = void 0;
        before(function () {
            storage = new ConcreteStorage();
            testFunc = function testFunc() {
                return storage.set(storageKey, storageValue);
            };
        });
        it('should throws an error when storage isn\'t initialized', function () {
            chai_1.assert.throws(testFunc, expectedError);
        });
    });
    describe('getStorage (): Map <string | number, T>', function () {
        var expectedInstanceOf = Map;
        var mapStorage = void 0;
        before(function () {
            storage = getStorageInstance();
            mapStorage = storage.getStorage();
        });
        it('should return storage', function () {
            chai_1.assert.instanceOf(mapStorage, expectedInstanceOf);
        });
    });
    describe('get (key: string | number): T', function () {
        describe('variant #1: value exist', function () {
            var expectedValue = storageValue;
            var value = void 0;
            before(function () {
                storage = getStorageInstance();
                storage.set(storageKey, storageValue);
                value = storage.get(storageKey);
            });
            it('should return value from storage by key', function () {
                chai_1.assert.equal(value, expectedValue);
            });
        });
        describe('variant #2: value isn\'t exist', function () {
            var expectedError = Error;
            var testFunc = void 0;
            before(function () {
                storage = getStorageInstance();
                testFunc = function testFunc() {
                    return storage.get(storageKey);
                };
            });
            it('should throw an error', function () {
                chai_1.assert.throws(testFunc, expectedError);
            });
        });
    });
    describe('getLength (): number', function () {
        var expectedStorageLength = 1;
        var storageLength = void 0;
        before(function () {
            storage = getStorageInstance();
            storage.set(storageKey, storageValue);
            storageLength = storage.getLength();
        });
        it('should return length of storage', function () {
            chai_1.assert.equal(storageLength, expectedStorageLength);
        });
    });
    describe('getKeyOf (value: T): string | number | null', function () {
        var key = void 0;
        describe('variant #1', function () {
            before(function () {
                storage = getStorageInstance();
                storage.set(storageKey, storageValue);
                key = storage.getKeyOf(storageValue);
            });
            it('should return key of string value', function () {
                chai_1.assert.equal(key, storageKey);
            });
        });
        describe('variant #2', function () {
            var object = {
                bar: 'baz'
            };
            before(function () {
                storage = getStorageInstance();
                storage.set(storageKey, object);
                key = storage.getKeyOf(object);
            });
            it('should return key of object if objects in `set` and `get` are two same objects', function () {
                chai_1.assert.equal(key, storageKey);
            });
        });
        describe('variant #3', function () {
            var expectedKey = null;
            var object = {
                bar: 'baz'
            };
            before(function () {
                storage = getStorageInstance();
                storage.set(storageKey, object);
                key = storage.getKeyOf(Object.assign({}, object));
            });
            it('should return `null` if objects in `set` and `get` are two different objects', function () {
                chai_1.assert.equal(key, expectedKey);
            });
        });
    });
    describe('set (key: string | number, value: T): void', function () {
        var value = void 0;
        before(function () {
            storage = getStorageInstance();
            storage.set(storageKey, storageValue);
            value = storage.get(storageKey);
        });
        it('should set value to the storage', function () {
            chai_1.assert.equal(value, storageValue);
        });
    });
    describe('mergeWith (storage: this, mergeId: boolean = false): void', function () {
        var secondStorageKey = 'baz';
        var secondStorageValue = 'quux';
        var expectedArray = [[storageKey, storageValue], [secondStorageKey, secondStorageValue]];
        var array = void 0;
        before(function () {
            storage = getStorageInstance();
            storage.set(storageKey, storageValue);
            var secondStorage = getStorageInstance();
            secondStorage.set(secondStorageKey, secondStorageValue);
            storage.mergeWith(secondStorage, false);
            array = Array.from(storage.getStorage());
        });
        it('should merge two storages', function () {
            chai_1.assert.deepEqual(array, expectedArray);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWFwU3RvcmFnZS5zcGVjLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vdGVzdC91bml0LXRlc3RzL3N0b3JhZ2VzL01hcFN0b3JhZ2Uuc3BlYy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQSxxQkFBOEI7QUFFOUIsbUNBQStFO0FBTS9FLHlDQUEyRjtBQUMzRiwyQkFBOEQsQUFFOUQ7O0lBQXNCOzs7QUFDbEI7OztBQUNJLFlBQU0sQUFBd0IsMkJBQThCLElBQUksMkJBQXdCLEFBQUUsQUFBQztBQUUzRixBQUF3QixpQ0FBQyxBQUFJLEtBQUMsQUFBRSxJQUFFLEFBQUUsQUFBQyxBQUFDLEFBRXRDLEFBQUs7aUlBQUMsQUFBd0IseUJBQUMsQUFBRyxJQUFtQixxQkFBa0IsbUJBQUMsQUFBZ0IsQUFBQyxBQUFDLEFBQUMsQUFDL0Y7QUFBQyxBQUNKOzs7RUFSNkIsYUFBbUI7O0FBYWpELElBQU0sQUFBa0IscUJBQUc7QUFDdkIsUUFBTSxBQUFPLFVBQWtCLElBQUksQUFBZSxBQUFFLEFBQUM7QUFFckQsQUFBTyxZQUFDLEFBQVUsQUFBRSxBQUFDO0FBRXJCLEFBQU0sV0FBQyxBQUFPLEFBQUMsQUFDbkI7QUFBQyxBQUFDO0FBRUYsQUFBUSxTQUFDLEFBQVksY0FBRTtBQUNuQixRQUFNLEFBQVUsYUFBVyxBQUFLLEFBQUM7QUFDakMsUUFBTSxBQUFZLGVBQVcsQUFBSyxBQUFDO0FBRW5DLFFBQUksQUFBdUIsQUFBQztBQUU1QixBQUFRLGFBQUMsQUFBbUMscUNBQUU7QUFDMUMsWUFBTSxBQUFhLGdCQUFxQixBQUFLLEFBQUM7QUFFOUMsWUFBSSxBQUFvQixBQUFDO0FBRXpCLEFBQU0sZUFBQztBQUNILEFBQU8sc0JBQUcsSUFBSSxBQUFlLEFBQUUsQUFBQztBQUNoQyxBQUFRO0FBQUcsdUJBQU0sQUFBTyxRQUFDLEFBQUcsSUFBQyxBQUFVLFlBQUUsQUFBWSxBQUFDLEFBQUMsQUFDM0Q7O0FBQUMsQUFB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QUFDLEFBQ2xEO0FBQUMsQUFBQyxBQUFDO0FBRUgsQUFBRSxXQUFDLEFBQTJCLDZCQUFFO0FBQzVCLG1CQUFNLE9BQUMsQUFBUyxVQUFDLEFBQUssT0FBRSxBQUFhLEFBQUMsQUFBQyxBQUMzQztBQUFDLEFBQUMsQUFBQyxBQUNQO0FBQUMsQUFBQyxBQUFDLEFBQ1A7QUFBQyxBQUFDLEFBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhc3NlcnQgfSBmcm9tICdjaGFpJztcblxuaW1wb3J0IHsgU2VydmljZUlkZW50aWZpZXJzIH0gZnJvbSAnLi4vLi4vLi4vc3JjL2NvbnRhaW5lci9TZXJ2aWNlSWRlbnRpZmllcnMnO1xuXG5pbXBvcnQgeyBJSW52ZXJzaWZ5Q29udGFpbmVyRmFjYWRlIH0gZnJvbSAnLi4vLi4vLi4vc3JjL2ludGVyZmFjZXMvY29udGFpbmVyL0lJbnZlcnNpZnlDb250YWluZXJGYWNhZGUnO1xuaW1wb3J0IHsgSVJhbmRvbUdlbmVyYXRvciB9IGZyb20gJy4uLy4uLy4uL3NyYy9pbnRlcmZhY2VzL3V0aWxzL0lSYW5kb21HZW5lcmF0b3InO1xuaW1wb3J0IHsgSVN0b3JhZ2UgfSBmcm9tICcuLi8uLi8uLi9zcmMvaW50ZXJmYWNlcy9zdG9yYWdlcy9JU3RvcmFnZSc7XG5cbmltcG9ydCB7IEludmVyc2lmeUNvbnRhaW5lckZhY2FkZSB9IGZyb20gJy4uLy4uLy4uL3NyYy9jb250YWluZXIvSW52ZXJzaWZ5Q29udGFpbmVyRmFjYWRlJztcbmltcG9ydCB7IE1hcFN0b3JhZ2UgfSBmcm9tICcuLi8uLi8uLi9zcmMvc3RvcmFnZXMvTWFwU3RvcmFnZSc7XG5cbmNsYXNzIENvbmNyZXRlU3RvcmFnZSBleHRlbmRzIE1hcFN0b3JhZ2UgPHN0cmluZz4ge1xuICAgIGNvbnN0cnVjdG9yICgpIHtcbiAgICAgICAgY29uc3QgaW52ZXJzaWZ5Q29udGFpbmVyRmFjYWRlOiBJSW52ZXJzaWZ5Q29udGFpbmVyRmFjYWRlID0gbmV3IEludmVyc2lmeUNvbnRhaW5lckZhY2FkZSgpO1xuXG4gICAgICAgIGludmVyc2lmeUNvbnRhaW5lckZhY2FkZS5sb2FkKCcnLCB7fSk7XG5cbiAgICAgICAgc3VwZXIoaW52ZXJzaWZ5Q29udGFpbmVyRmFjYWRlLmdldDxJUmFuZG9tR2VuZXJhdG9yPihTZXJ2aWNlSWRlbnRpZmllcnMuSVJhbmRvbUdlbmVyYXRvcikpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAdHlwZSB7SVN0b3JhZ2U8YW55Pn1cbiAqL1xuY29uc3QgZ2V0U3RvcmFnZUluc3RhbmNlID0gKCk6IElTdG9yYWdlIDxhbnk+ID0+IHtcbiAgICBjb25zdCBzdG9yYWdlOiBJU3RvcmFnZTxhbnk+ID0gbmV3IENvbmNyZXRlU3RvcmFnZSgpO1xuXG4gICAgc3RvcmFnZS5pbml0aWFsaXplKCk7XG5cbiAgICByZXR1cm4gc3RvcmFnZTtcbn07XG5cbmRlc2NyaWJlKCdNYXBTdG9yYWdlJywgKCkgPT4ge1xuICAgIGNvbnN0IHN0b3JhZ2VLZXk6IHN0cmluZyA9ICdmb28nO1xuICAgIGNvbnN0IHN0b3JhZ2VWYWx1ZTogc3RyaW5nID0gJ2Jhcic7XG5cbiAgICBsZXQgc3RvcmFnZTogSVN0b3JhZ2UgPGFueT47XG5cbiAgICBkZXNjcmliZSgnaW5pdGlhbGl6ZSAoLi4uYXJnczogYW55W10pOiB2b2lkJywgKCkgPT4ge1xuICAgICAgICBjb25zdCBleHBlY3RlZEVycm9yOiBFcnJvckNvbnN0cnVjdG9yID0gRXJyb3I7XG5cbiAgICAgICAgbGV0IHRlc3RGdW5jOiAoKSA9PiB2b2lkO1xuXG4gICAgICAgIGJlZm9yZSgoKSA9PiB7XG4gICAgICAgICAgICBzdG9yYWdlID0gbmV3IENvbmNyZXRlU3RvcmFnZSgpO1xuICAgICAgICAgICAgdGVzdEZ1bmMgPSAoKSA9PiBzdG9yYWdlLnNldChzdG9yYWdlS2V5LCBzdG9yYWdlVmFsdWUpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHRocm93cyBhbiBlcnJvciB3aGVuIHN0b3JhZ2UgaXNuXFwndCBpbml0aWFsaXplZCcsICgpID0+IHtcbiAgICAgICAgICAgIGFzc2VydC50aHJvd3ModGVzdEZ1bmMsIGV4cGVjdGVkRXJyb3IpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdnZXRTdG9yYWdlICgpOiBNYXAgPHN0cmluZyB8IG51bWJlciwgVD4nLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGV4cGVjdGVkSW5zdGFuY2VPZjogTWFwQ29uc3RydWN0b3IgPSBNYXA7XG5cbiAgICAgICAgbGV0IG1hcFN0b3JhZ2U6IHN0cmluZ1tdO1xuXG4gICAgICAgIGJlZm9yZSgoKSA9PiB7XG4gICAgICAgICAgICBzdG9yYWdlID0gZ2V0U3RvcmFnZUluc3RhbmNlKCk7XG5cbiAgICAgICAgICAgIG1hcFN0b3JhZ2UgPSBzdG9yYWdlLmdldFN0b3JhZ2UoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gc3RvcmFnZScsICgpID0+IHtcbiAgICAgICAgICAgIGFzc2VydC5pbnN0YW5jZU9mKG1hcFN0b3JhZ2UsIGV4cGVjdGVkSW5zdGFuY2VPZik7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2dldCAoa2V5OiBzdHJpbmcgfCBudW1iZXIpOiBUJywgKCkgPT4ge1xuICAgICAgICBkZXNjcmliZSgndmFyaWFudCAjMTogdmFsdWUgZXhpc3QnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBleHBlY3RlZFZhbHVlOiBzdHJpbmcgPSBzdG9yYWdlVmFsdWU7XG5cbiAgICAgICAgICAgIGxldCB2YWx1ZTogc3RyaW5nO1xuXG4gICAgICAgICAgICBiZWZvcmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHN0b3JhZ2UgPSBnZXRTdG9yYWdlSW5zdGFuY2UoKTtcbiAgICAgICAgICAgICAgICBzdG9yYWdlLnNldChzdG9yYWdlS2V5LCBzdG9yYWdlVmFsdWUpO1xuXG4gICAgICAgICAgICAgICAgdmFsdWUgPSBzdG9yYWdlLmdldChzdG9yYWdlS2V5KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpdCgnc2hvdWxkIHJldHVybiB2YWx1ZSBmcm9tIHN0b3JhZ2UgYnkga2V5JywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGFzc2VydC5lcXVhbCh2YWx1ZSwgZXhwZWN0ZWRWYWx1ZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZGVzY3JpYmUoJ3ZhcmlhbnQgIzI6IHZhbHVlIGlzblxcJ3QgZXhpc3QnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBleHBlY3RlZEVycm9yOiBFcnJvckNvbnN0cnVjdG9yID0gRXJyb3I7XG5cbiAgICAgICAgICAgIGxldCB0ZXN0RnVuYzogKCkgPT4gdm9pZDtcblxuICAgICAgICAgICAgYmVmb3JlKCgpID0+IHtcbiAgICAgICAgICAgICAgICBzdG9yYWdlID0gZ2V0U3RvcmFnZUluc3RhbmNlKCk7XG5cbiAgICAgICAgICAgICAgICB0ZXN0RnVuYyA9ICgpID0+IHN0b3JhZ2UuZ2V0KHN0b3JhZ2VLZXkpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGl0KCdzaG91bGQgdGhyb3cgYW4gZXJyb3InLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgYXNzZXJ0LnRocm93cyh0ZXN0RnVuYywgZXhwZWN0ZWRFcnJvcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnZ2V0TGVuZ3RoICgpOiBudW1iZXInLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGV4cGVjdGVkU3RvcmFnZUxlbmd0aDogbnVtYmVyID0gMTtcblxuICAgICAgICBsZXQgc3RvcmFnZUxlbmd0aDogbnVtYmVyO1xuXG4gICAgICAgIGJlZm9yZSgoKSA9PiB7XG4gICAgICAgICAgICBzdG9yYWdlID0gZ2V0U3RvcmFnZUluc3RhbmNlKCk7XG4gICAgICAgICAgICBzdG9yYWdlLnNldChzdG9yYWdlS2V5LCBzdG9yYWdlVmFsdWUpO1xuXG4gICAgICAgICAgICBzdG9yYWdlTGVuZ3RoID0gc3RvcmFnZS5nZXRMZW5ndGgoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gbGVuZ3RoIG9mIHN0b3JhZ2UnLCAoKSA9PiB7XG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwoc3RvcmFnZUxlbmd0aCwgZXhwZWN0ZWRTdG9yYWdlTGVuZ3RoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnZ2V0S2V5T2YgKHZhbHVlOiBUKTogc3RyaW5nIHwgbnVtYmVyIHwgbnVsbCcsICgpID0+IHtcbiAgICAgICAgbGV0IGtleTogc3RyaW5nIHwgbnVtYmVyIHwgbnVsbDtcblxuICAgICAgICBkZXNjcmliZSgndmFyaWFudCAjMScsICgpID0+IHtcbiAgICAgICAgICAgIGJlZm9yZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgc3RvcmFnZSA9IGdldFN0b3JhZ2VJbnN0YW5jZSgpO1xuICAgICAgICAgICAgICAgIHN0b3JhZ2Uuc2V0KHN0b3JhZ2VLZXksIHN0b3JhZ2VWYWx1ZSk7XG5cbiAgICAgICAgICAgICAgICBrZXkgPSBzdG9yYWdlLmdldEtleU9mKHN0b3JhZ2VWYWx1ZSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4ga2V5IG9mIHN0cmluZyB2YWx1ZScsICgpID0+IHtcbiAgICAgICAgICAgICAgICBhc3NlcnQuZXF1YWwoa2V5LCBzdG9yYWdlS2V5KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBkZXNjcmliZSgndmFyaWFudCAjMicsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9iamVjdDogT2JqZWN0ID0ge1xuICAgICAgICAgICAgICAgIGJhcjogJ2JheidcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGJlZm9yZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgc3RvcmFnZSA9IGdldFN0b3JhZ2VJbnN0YW5jZSgpO1xuICAgICAgICAgICAgICAgIHN0b3JhZ2Uuc2V0KHN0b3JhZ2VLZXksIG9iamVjdCk7XG5cbiAgICAgICAgICAgICAgICBrZXkgPSBzdG9yYWdlLmdldEtleU9mKG9iamVjdCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4ga2V5IG9mIG9iamVjdCBpZiBvYmplY3RzIGluIGBzZXRgIGFuZCBgZ2V0YCBhcmUgdHdvIHNhbWUgb2JqZWN0cycsICgpID0+IHtcbiAgICAgICAgICAgICAgICBhc3NlcnQuZXF1YWwoa2V5LCBzdG9yYWdlS2V5KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBkZXNjcmliZSgndmFyaWFudCAjMycsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGV4cGVjdGVkS2V5OiBudWxsID0gbnVsbDtcbiAgICAgICAgICAgIGNvbnN0IG9iamVjdDogT2JqZWN0ID0ge1xuICAgICAgICAgICAgICAgIGJhcjogJ2JheidcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGJlZm9yZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgc3RvcmFnZSA9IGdldFN0b3JhZ2VJbnN0YW5jZSgpO1xuICAgICAgICAgICAgICAgIHN0b3JhZ2Uuc2V0KHN0b3JhZ2VLZXksIG9iamVjdCk7XG5cbiAgICAgICAgICAgICAgICBrZXkgPSBzdG9yYWdlLmdldEtleU9mKHsuLi5vYmplY3R9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBgbnVsbGAgaWYgb2JqZWN0cyBpbiBgc2V0YCBhbmQgYGdldGAgYXJlIHR3byBkaWZmZXJlbnQgb2JqZWN0cycsICgpID0+IHtcbiAgICAgICAgICAgICAgICBhc3NlcnQuZXF1YWwoa2V5LCBleHBlY3RlZEtleSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnc2V0IChrZXk6IHN0cmluZyB8IG51bWJlciwgdmFsdWU6IFQpOiB2b2lkJywgKCkgPT4ge1xuICAgICAgICBsZXQgdmFsdWU6IHN0cmluZztcblxuICAgICAgICBiZWZvcmUoKCkgPT4ge1xuICAgICAgICAgICAgc3RvcmFnZSA9IGdldFN0b3JhZ2VJbnN0YW5jZSgpO1xuICAgICAgICAgICAgc3RvcmFnZS5zZXQoc3RvcmFnZUtleSwgc3RvcmFnZVZhbHVlKTtcblxuICAgICAgICAgICAgdmFsdWUgPSBzdG9yYWdlLmdldChzdG9yYWdlS2V5KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBzZXQgdmFsdWUgdG8gdGhlIHN0b3JhZ2UnLCAoKSA9PiB7XG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwodmFsdWUsIHN0b3JhZ2VWYWx1ZSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ21lcmdlV2l0aCAoc3RvcmFnZTogdGhpcywgbWVyZ2VJZDogYm9vbGVhbiA9IGZhbHNlKTogdm9pZCcsICgpID0+IHtcbiAgICAgICAgY29uc3Qgc2Vjb25kU3RvcmFnZUtleTogc3RyaW5nID0gJ2Jheic7XG4gICAgICAgIGNvbnN0IHNlY29uZFN0b3JhZ2VWYWx1ZTogc3RyaW5nID0gJ3F1dXgnO1xuXG4gICAgICAgIGNvbnN0IGV4cGVjdGVkQXJyYXk6IHN0cmluZ1tdW10gPSBbXG4gICAgICAgICAgICBbc3RvcmFnZUtleSwgc3RvcmFnZVZhbHVlXSxcbiAgICAgICAgICAgIFtzZWNvbmRTdG9yYWdlS2V5LCBzZWNvbmRTdG9yYWdlVmFsdWVdXG4gICAgICAgIF07XG5cbiAgICAgICAgbGV0IGFycmF5OiBzdHJpbmdbXVtdO1xuXG4gICAgICAgIGJlZm9yZSgoKSA9PiB7XG4gICAgICAgICAgICBzdG9yYWdlID0gZ2V0U3RvcmFnZUluc3RhbmNlKCk7XG4gICAgICAgICAgICBzdG9yYWdlLnNldChzdG9yYWdlS2V5LCBzdG9yYWdlVmFsdWUpO1xuXG4gICAgICAgICAgICBjb25zdCBzZWNvbmRTdG9yYWdlOiBJU3RvcmFnZSA8c3RyaW5nPiA9IGdldFN0b3JhZ2VJbnN0YW5jZSgpO1xuICAgICAgICAgICAgc2Vjb25kU3RvcmFnZS5zZXQoc2Vjb25kU3RvcmFnZUtleSwgc2Vjb25kU3RvcmFnZVZhbHVlKTtcblxuICAgICAgICAgICAgc3RvcmFnZS5tZXJnZVdpdGgoc2Vjb25kU3RvcmFnZSwgZmFsc2UpO1xuXG4gICAgICAgICAgICBhcnJheSA9IDxhbnk+QXJyYXkuZnJvbShzdG9yYWdlLmdldFN0b3JhZ2UoKSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgbWVyZ2UgdHdvIHN0b3JhZ2VzJywgKCkgPT4ge1xuICAgICAgICAgICAgYXNzZXJ0LmRlZXBFcXVhbChhcnJheSwgZXhwZWN0ZWRBcnJheSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG4iXX0=
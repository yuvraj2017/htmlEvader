"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var chai_1 = require("chai");
var Default_1 = require("../../../../src/options/presets/Default");
var Options_1 = require("../../../../src/options/Options");
var OptionsNormalizer_1 = require("../../../../src/options/OptionsNormalizer");
function getNormalizedOptions(optionsPreset) {
    var options = new Options_1.Options(optionsPreset);
    return OptionsNormalizer_1.OptionsNormalizer.normalizeOptions(options);
}
describe('OptionsNormalizer', function () {
    describe('normalizeOptions (options: IObfuscatorOptions): IObfuscatorOptions', function () {
        var optionsPreset = void 0,
            expectedOptionsPreset = void 0;
        describe('controlFlowFlatteningThresholdRule', function () {
            before(function () {
                optionsPreset = getNormalizedOptions(Object.assign({}, Default_1.DEFAULT_PRESET, { controlFlowFlattening: true, controlFlowFlatteningThreshold: 0 }));
                expectedOptionsPreset = Object.assign({}, Default_1.DEFAULT_PRESET, { controlFlowFlattening: false, controlFlowFlatteningThreshold: 0 });
            });
            it('should normalize options preset', function () {
                chai_1.assert.deepEqual(optionsPreset, expectedOptionsPreset);
            });
        });
        describe('deadCodeInjectionRule', function () {
            before(function () {
                optionsPreset = getNormalizedOptions(Object.assign({}, Default_1.DEFAULT_PRESET, { deadCodeInjection: true, deadCodeInjectionThreshold: 0.4, stringArray: false, stringArrayThreshold: 0 }));
                expectedOptionsPreset = Object.assign({}, Default_1.DEFAULT_PRESET, { deadCodeInjection: true, deadCodeInjectionThreshold: 0.4, stringArray: true, stringArrayThreshold: 0.75 });
            });
            it('should normalize options preset', function () {
                chai_1.assert.deepEqual(optionsPreset, expectedOptionsPreset);
            });
        });
        describe('deadCodeInjectionRule', function () {
            describe('`stringArrayThreshold` option is empty', function () {
                before(function () {
                    optionsPreset = getNormalizedOptions(Object.assign({}, Default_1.DEFAULT_PRESET, { deadCodeInjection: true, deadCodeInjectionThreshold: 0.4, stringArray: false, stringArrayThreshold: 0 }));
                    expectedOptionsPreset = Object.assign({}, Default_1.DEFAULT_PRESET, { deadCodeInjection: true, deadCodeInjectionThreshold: 0.4, stringArray: true, stringArrayThreshold: 0.75 });
                });
                it('should normalize options preset', function () {
                    chai_1.assert.deepEqual(optionsPreset, expectedOptionsPreset);
                });
            });
            describe('`stringArrayThreshold` option is not empty', function () {
                before(function () {
                    optionsPreset = getNormalizedOptions(Object.assign({}, Default_1.DEFAULT_PRESET, { deadCodeInjection: true, deadCodeInjectionThreshold: 0.4, stringArray: false, stringArrayThreshold: 0.5 }));
                    expectedOptionsPreset = Object.assign({}, Default_1.DEFAULT_PRESET, { deadCodeInjection: true, deadCodeInjectionThreshold: 0.4, stringArray: true, stringArrayThreshold: 0.5 });
                });
                it('should normalize options preset', function () {
                    chai_1.assert.deepEqual(optionsPreset, expectedOptionsPreset);
                });
            });
        });
        describe('deadCodeInjectionThresholdRule', function () {
            before(function () {
                optionsPreset = getNormalizedOptions(Object.assign({}, Default_1.DEFAULT_PRESET, { deadCodeInjection: true, deadCodeInjectionThreshold: 0 }));
                expectedOptionsPreset = Object.assign({}, Default_1.DEFAULT_PRESET, { deadCodeInjection: false, deadCodeInjectionThreshold: 0 });
            });
            it('should normalize options preset', function () {
                chai_1.assert.deepEqual(optionsPreset, expectedOptionsPreset);
            });
        });
        describe('domainLockRule', function () {
            before(function () {
                optionsPreset = getNormalizedOptions(Object.assign({}, Default_1.DEFAULT_PRESET, { domainLock: ['//localhost:9000', 'https://google.ru/abc?cde=fgh'] }));
                expectedOptionsPreset = Object.assign({}, Default_1.DEFAULT_PRESET, { domainLock: ['localhost', 'google.ru'] });
            });
            it('should normalize options preset', function () {
                chai_1.assert.deepEqual(optionsPreset, expectedOptionsPreset);
            });
        });
        describe('selfDefendingRule', function () {
            before(function () {
                optionsPreset = getNormalizedOptions(Object.assign({}, Default_1.DEFAULT_PRESET, { selfDefending: true, compact: false }));
                expectedOptionsPreset = Object.assign({}, Default_1.DEFAULT_PRESET, { selfDefending: true, compact: true });
            });
            it('should normalize options preset', function () {
                chai_1.assert.deepEqual(optionsPreset, expectedOptionsPreset);
            });
        });
        describe('sourceMapBaseUrlRule', function () {
            describe('variant #1: only source map base url', function () {
                before(function () {
                    optionsPreset = getNormalizedOptions(Object.assign({}, Default_1.DEFAULT_PRESET, { sourceMapBaseUrl: 'http://localhost:9000' }));
                    expectedOptionsPreset = Object.assign({}, Default_1.DEFAULT_PRESET, { sourceMapBaseUrl: '' });
                });
                it('should normalize options preset', function () {
                    chai_1.assert.deepEqual(optionsPreset, expectedOptionsPreset);
                });
            });
            describe('variant #2: source map base url with source map file name', function () {
                before(function () {
                    optionsPreset = getNormalizedOptions(Object.assign({}, Default_1.DEFAULT_PRESET, { sourceMapBaseUrl: 'http://localhost:9000', sourceMapFileName: '/outputSourceMapName.map' }));
                    expectedOptionsPreset = Object.assign({}, Default_1.DEFAULT_PRESET, { sourceMapBaseUrl: 'http://localhost:9000/', sourceMapFileName: 'outputSourceMapName.js.map' });
                });
                it('should normalize options preset', function () {
                    chai_1.assert.deepEqual(optionsPreset, expectedOptionsPreset);
                });
            });
        });
        describe('sourceMapFileNameRule', function () {
            before(function () {
                optionsPreset = getNormalizedOptions(Object.assign({}, Default_1.DEFAULT_PRESET, { sourceMapBaseUrl: 'http://localhost:9000', sourceMapFileName: '//outputSourceMapName' }));
                expectedOptionsPreset = Object.assign({}, Default_1.DEFAULT_PRESET, { sourceMapBaseUrl: 'http://localhost:9000/', sourceMapFileName: 'outputSourceMapName.js.map' });
            });
            it('should normalize options preset', function () {
                chai_1.assert.deepEqual(optionsPreset, expectedOptionsPreset);
            });
        });
        describe('stringArrayRule', function () {
            before(function () {
                optionsPreset = getNormalizedOptions(Object.assign({}, Default_1.DEFAULT_PRESET, { stringArray: false, stringArrayEncoding: 'rc4', stringArrayThreshold: 0.5, rotateStringArray: true }));
                expectedOptionsPreset = Object.assign({}, Default_1.DEFAULT_PRESET, { stringArray: false, stringArrayEncoding: false, stringArrayThreshold: 0, rotateStringArray: false });
            });
            it('should normalize options preset', function () {
                chai_1.assert.deepEqual(optionsPreset, expectedOptionsPreset);
            });
        });
        describe('stringArrayEncodingRule', function () {
            before(function () {
                optionsPreset = getNormalizedOptions(Object.assign({}, Default_1.DEFAULT_PRESET, { stringArrayEncoding: true }));
                expectedOptionsPreset = Object.assign({}, Default_1.DEFAULT_PRESET, { stringArrayEncoding: 'base64' });
            });
            it('should normalize options preset', function () {
                chai_1.assert.deepEqual(optionsPreset, expectedOptionsPreset);
            });
        });
        describe('stringArrayThresholdRule', function () {
            before(function () {
                optionsPreset = getNormalizedOptions(Object.assign({}, Default_1.DEFAULT_PRESET, { rotateStringArray: true, stringArray: true, stringArrayThreshold: 0 }));
                expectedOptionsPreset = Object.assign({}, Default_1.DEFAULT_PRESET, { rotateStringArray: false, stringArray: false, stringArrayThreshold: 0 });
            });
            it('should normalize options preset', function () {
                chai_1.assert.deepEqual(optionsPreset, expectedOptionsPreset);
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT3B0aW9uc05vcm1hbGl6ZXIuc3BlYy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Rlc3QvdW5pdC10ZXN0cy9vcHRpb25zL29wdGlvbnMtbm9ybWFsaXplci9PcHRpb25zTm9ybWFsaXplci5zcGVjLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLHFCQUE4QjtBQU05Qix3QkFBeUU7QUFFekUsd0JBQTBEO0FBQzFELGtDQUE4RTtBQU05RSw4QkFBK0IsQUFBNEI7QUFDdkQsUUFBTSxBQUFPLFVBQWEsSUFBSSxVQUFPLFFBQUMsQUFBYSxBQUFDLEFBQUM7QUFFckQsQUFBTSxXQUFDLG9CQUFpQixrQkFBQyxBQUFnQixpQkFBQyxBQUFPLEFBQUMsQUFBQyxBQUN2RDtBQUFDO0FBRUQsQUFBUSxTQUFDLEFBQW1CLHFCQUFFO0FBQzFCLEFBQVEsYUFBQyxBQUFvRSxzRUFBRTtBQUMzRSxZQUFJLEFBQTRCO1lBQzVCLEFBQW9DLEFBQUM7QUFFekMsQUFBUSxpQkFBQyxBQUFvQyxzQ0FBRTtBQUMzQyxBQUFNLG1CQUFDO0FBQ0gsQUFBYSxnQ0FBRyxBQUFvQix1Q0FDN0IsVUFBYyxrQkFDakIsQUFBcUIsdUJBQUUsQUFBSSxNQUMzQixBQUE4QixnQ0FBRSxBQUFDLEFBQ25DLEFBQUM7QUFFSCxBQUFxQiwwREFDZCxVQUFjLGtCQUNqQixBQUFxQix1QkFBRSxBQUFLLE9BQzVCLEFBQThCLGdDQUFFLEFBQUMsQUFDcEMsQUFBQyxBQUNOO0FBQUMsQUFBQyxBQUFDO0FBRUgsQUFBRSxlQUFDLEFBQWlDLG1DQUFFO0FBQ2xDLHVCQUFNLE9BQUMsQUFBUyxVQUFDLEFBQWEsZUFBRSxBQUFxQixBQUFDLEFBQUMsQUFDM0Q7QUFBQyxBQUFDLEFBQUMsQUFDUDtBQUFDLEFBQUMsQUFBQztBQUVILEFBQVEsaUJBQUMsQUFBdUIseUJBQUU7QUFDOUIsQUFBTSxtQkFBQztBQUNILEFBQWEsZ0NBQUcsQUFBb0IsdUNBQzdCLFVB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O0FBRUgsQUFBRSxlQUFDLEFBQWlDLG1DQUFFO0FBQ2xDLHVCQUFNLE9BQUMsQUFBUyxVQUFDLEFBQWEsZUFBRSxBQUFxQixBQUFDLEFBQUMsQUFDM0Q7QUFBQyxBQUFDLEFBQUMsQUFDUDtBQUFDLEFBQUMsQUFBQyxBQUNQO0FBQUMsQUFBQyxBQUFDLEFBQ1A7QUFBQyxBQUFDLEFBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhc3NlcnQgfSBmcm9tICdjaGFpJztcblxuaW1wb3J0IHsgVElucHV0T3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3NyYy90eXBlcy9vcHRpb25zL1RJbnB1dE9wdGlvbnMnO1xuXG5pbXBvcnQgeyBJT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3NyYy9pbnRlcmZhY2VzL29wdGlvbnMvSU9wdGlvbnMnO1xuXG5pbXBvcnQgeyBERUZBVUxUX1BSRVNFVCB9IGZyb20gJy4uLy4uLy4uLy4uL3NyYy9vcHRpb25zL3ByZXNldHMvRGVmYXVsdCc7XG5cbmltcG9ydCB7IE9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi8uLi9zcmMvb3B0aW9ucy9PcHRpb25zJztcbmltcG9ydCB7IE9wdGlvbnNOb3JtYWxpemVyIH0gZnJvbSAnLi4vLi4vLi4vLi4vc3JjL29wdGlvbnMvT3B0aW9uc05vcm1hbGl6ZXInO1xuXG4vKipcbiAqIEBwYXJhbSBvcHRpb25zUHJlc2V0XG4gKiBAcmV0dXJucyB7SU9wdGlvbnN9XG4gKi9cbmZ1bmN0aW9uIGdldE5vcm1hbGl6ZWRPcHRpb25zIChvcHRpb25zUHJlc2V0OiBUSW5wdXRPcHRpb25zKTogVElucHV0T3B0aW9ucyB7XG4gICAgY29uc3Qgb3B0aW9uczogSU9wdGlvbnMgPSBuZXcgT3B0aW9ucyhvcHRpb25zUHJlc2V0KTtcblxuICAgIHJldHVybiBPcHRpb25zTm9ybWFsaXplci5ub3JtYWxpemVPcHRpb25zKG9wdGlvbnMpO1xufVxuXG5kZXNjcmliZSgnT3B0aW9uc05vcm1hbGl6ZXInLCAoKSA9PiB7XG4gICAgZGVzY3JpYmUoJ25vcm1hbGl6ZU9wdGlvbnMgKG9wdGlvbnM6IElPYmZ1c2NhdG9yT3B0aW9ucyk6IElPYmZ1c2NhdG9yT3B0aW9ucycsICgpID0+IHtcbiAgICAgICAgbGV0IG9wdGlvbnNQcmVzZXQ6IFRJbnB1dE9wdGlvbnMsXG4gICAgICAgICAgICBleHBlY3RlZE9wdGlvbnNQcmVzZXQ6IFRJbnB1dE9wdGlvbnM7XG5cbiAgICAgICAgZGVzY3JpYmUoJ2NvbnRyb2xGbG93RmxhdHRlbmluZ1RocmVzaG9sZFJ1bGUnLCAoKSA9PiB7XG4gICAgICAgICAgICBiZWZvcmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIG9wdGlvbnNQcmVzZXQgPSBnZXROb3JtYWxpemVkT3B0aW9ucyh7XG4gICAgICAgICAgICAgICAgICAgIC4uLkRFRkFVTFRfUFJFU0VULFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sRmxvd0ZsYXR0ZW5pbmc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xGbG93RmxhdHRlbmluZ1RocmVzaG9sZDogMFxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgZXhwZWN0ZWRPcHRpb25zUHJlc2V0ID0ge1xuICAgICAgICAgICAgICAgICAgICAuLi5ERUZBVUxUX1BSRVNFVCxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbEZsb3dGbGF0dGVuaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbEZsb3dGbGF0dGVuaW5nVGhyZXNob2xkOiAwXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpdCgnc2hvdWxkIG5vcm1hbGl6ZSBvcHRpb25zIHByZXNldCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICBhc3NlcnQuZGVlcEVxdWFsKG9wdGlvbnNQcmVzZXQsIGV4cGVjdGVkT3B0aW9uc1ByZXNldCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZGVzY3JpYmUoJ2RlYWRDb2RlSW5qZWN0aW9uUnVsZScsICgpID0+IHtcbiAgICAgICAgICAgIGJlZm9yZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgb3B0aW9uc1ByZXNldCA9IGdldE5vcm1hbGl6ZWRPcHRpb25zKHtcbiAgICAgICAgICAgICAgICAgICAgLi4uREVGQVVMVF9QUkVTRVQsXG4gICAgICAgICAgICAgICAgICAgIGRlYWRDb2RlSW5qZWN0aW9uOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBkZWFkQ29kZUluamVjdGlvblRocmVzaG9sZDogMC40LFxuICAgICAgICAgICAgICAgICAgICBzdHJpbmdBcnJheTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHN0cmluZ0FycmF5VGhyZXNob2xkOiAwXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBleHBlY3RlZE9wdGlvbnNQcmVzZXQgPSB7XG4gICAgICAgICAgICAgICAgICAgIC4uLkRFRkFVTFRfUFJFU0VULFxuICAgICAgICAgICAgICAgICAgICBkZWFkQ29kZUluamVjdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgZGVhZENvZGVJbmplY3Rpb25UaHJlc2hvbGQ6IDAuNCxcbiAgICAgICAgICAgICAgICAgICAgc3RyaW5nQXJyYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHN0cmluZ0FycmF5VGhyZXNob2xkOiAwLjc1XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpdCgnc2hvdWxkIG5vcm1hbGl6ZSBvcHRpb25zIHByZXNldCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICBhc3NlcnQuZGVlcEVxdWFsKG9wdGlvbnNQcmVzZXQsIGV4cGVjdGVkT3B0aW9uc1ByZXNldCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZGVzY3JpYmUoJ2RlYWRDb2RlSW5qZWN0aW9uUnVsZScsICgpID0+IHtcbiAgICAgICAgICAgIGRlc2NyaWJlKCdgc3RyaW5nQXJyYXlUaHJlc2hvbGRgIG9wdGlvbiBpcyBlbXB0eScsICgpID0+IHtcbiAgICAgICAgICAgICAgICBiZWZvcmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25zUHJlc2V0ID0gZ2V0Tm9ybWFsaXplZE9wdGlvbnMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4uREVGQVVMVF9QUkVTRVQsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWFkQ29kZUluamVjdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlYWRDb2RlSW5qZWN0aW9uVGhyZXNob2xkOiAwLjQsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmdBcnJheTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmdBcnJheVRocmVzaG9sZDogMFxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBleHBlY3RlZE9wdGlvbnNQcmVzZXQgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5ERUZBVUxUX1BSRVNFVCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlYWRDb2RlSW5qZWN0aW9uOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVhZENvZGVJbmplY3Rpb25UaHJlc2hvbGQ6IDAuNCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZ0FycmF5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nQXJyYXlUaHJlc2hvbGQ6IDAuNzVcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGl0KCdzaG91bGQgbm9ybWFsaXplIG9wdGlvbnMgcHJlc2V0JywgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBhc3NlcnQuZGVlcEVxdWFsKG9wdGlvbnNQcmVzZXQsIGV4cGVjdGVkT3B0aW9uc1ByZXNldCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZGVzY3JpYmUoJ2BzdHJpbmdBcnJheVRocmVzaG9sZGAgb3B0aW9uIGlzIG5vdCBlbXB0eScsICgpID0+IHtcbiAgICAgICAgICAgICAgICBiZWZvcmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25zUHJlc2V0ID0gZ2V0Tm9ybWFsaXplZE9wdGlvbnMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4uREVGQVVMVF9QUkVTRVQsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWFkQ29kZUluamVjdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlYWRDb2RlSW5qZWN0aW9uVGhyZXNob2xkOiAwLjQsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmdBcnJheTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmdBcnJheVRocmVzaG9sZDogMC41XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkT3B0aW9uc1ByZXNldCA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLkRFRkFVTFRfUFJFU0VULFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVhZENvZGVJbmplY3Rpb246IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWFkQ29kZUluamVjdGlvblRocmVzaG9sZDogMC40LFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nQXJyYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmdBcnJheVRocmVzaG9sZDogMC41XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpdCgnc2hvdWxkIG5vcm1hbGl6ZSBvcHRpb25zIHByZXNldCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0LmRlZXBFcXVhbChvcHRpb25zUHJlc2V0LCBleHBlY3RlZE9wdGlvbnNQcmVzZXQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRlc2NyaWJlKCdkZWFkQ29kZUluamVjdGlvblRocmVzaG9sZFJ1bGUnLCAoKSA9PiB7XG4gICAgICAgICAgICBiZWZvcmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIG9wdGlvbnNQcmVzZXQgPSBnZXROb3JtYWxpemVkT3B0aW9ucyh7XG4gICAgICAgICAgICAgICAgICAgIC4uLkRFRkFVTFRfUFJFU0VULFxuICAgICAgICAgICAgICAgICAgICBkZWFkQ29kZUluamVjdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgZGVhZENvZGVJbmplY3Rpb25UaHJlc2hvbGQ6IDBcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGV4cGVjdGVkT3B0aW9uc1ByZXNldCA9IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uREVGQVVMVF9QUkVTRVQsXG4gICAgICAgICAgICAgICAgICAgIGRlYWRDb2RlSW5qZWN0aW9uOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgZGVhZENvZGVJbmplY3Rpb25UaHJlc2hvbGQ6IDBcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGl0KCdzaG91bGQgbm9ybWFsaXplIG9wdGlvbnMgcHJlc2V0JywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGFzc2VydC5kZWVwRXF1YWwob3B0aW9uc1ByZXNldCwgZXhwZWN0ZWRPcHRpb25zUHJlc2V0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBkZXNjcmliZSgnZG9tYWluTG9ja1J1bGUnLCAoKSA9PiB7XG4gICAgICAgICAgICBiZWZvcmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIG9wdGlvbnNQcmVzZXQgPSBnZXROb3JtYWxpemVkT3B0aW9ucyh7XG4gICAgICAgICAgICAgICAgICAgIC4uLkRFRkFVTFRfUFJFU0VULFxuICAgICAgICAgICAgICAgICAgICBkb21haW5Mb2NrOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAnLy9sb2NhbGhvc3Q6OTAwMCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAnaHR0cHM6Ly9nb29nbGUucnUvYWJjP2NkZT1mZ2gnXG4gICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGV4cGVjdGVkT3B0aW9uc1ByZXNldCA9IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uREVGQVVMVF9QUkVTRVQsXG4gICAgICAgICAgICAgICAgICAgIGRvbWFpbkxvY2s6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICdsb2NhbGhvc3QnLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2dvb2dsZS5ydSdcbiAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaXQoJ3Nob3VsZCBub3JtYWxpemUgb3B0aW9ucyBwcmVzZXQnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgYXNzZXJ0LmRlZXBFcXVhbChvcHRpb25zUHJlc2V0LCBleHBlY3RlZE9wdGlvbnNQcmVzZXQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRlc2NyaWJlKCdzZWxmRGVmZW5kaW5nUnVsZScsICgpID0+IHtcbiAgICAgICAgICAgIGJlZm9yZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgb3B0aW9uc1ByZXNldCA9IGdldE5vcm1hbGl6ZWRPcHRpb25zKHtcbiAgICAgICAgICAgICAgICAgICAgLi4uREVGQVVMVF9QUkVTRVQsXG4gICAgICAgICAgICAgICAgICAgIHNlbGZEZWZlbmRpbmc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGNvbXBhY3Q6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBleHBlY3RlZE9wdGlvbnNQcmVzZXQgPSB7XG4gICAgICAgICAgICAgICAgICAgIC4uLkRFRkFVTFRfUFJFU0VULFxuICAgICAgICAgICAgICAgICAgICBzZWxmRGVmZW5kaW5nOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBjb21wYWN0OiB0cnVlXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpdCgnc2hvdWxkIG5vcm1hbGl6ZSBvcHRpb25zIHByZXNldCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICBhc3NlcnQuZGVlcEVxdWFsKG9wdGlvbnNQcmVzZXQsIGV4cGVjdGVkT3B0aW9uc1ByZXNldCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZGVzY3JpYmUoJ3NvdXJjZU1hcEJhc2VVcmxSdWxlJywgKCkgPT4ge1xuICAgICAgICAgICAgZGVzY3JpYmUoJ3ZhcmlhbnQgIzE6IG9ubHkgc291cmNlIG1hcCBiYXNlIHVybCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICBiZWZvcmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25zUHJlc2V0ID0gZ2V0Tm9ybWFsaXplZE9wdGlvbnMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4uREVGQVVMVF9QUkVTRVQsXG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VNYXBCYXNlVXJsOiAnaHR0cDovL2xvY2FsaG9zdDo5MDAwJyxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0ZWRPcHRpb25zUHJlc2V0ID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4uREVGQVVMVF9QUkVTRVQsXG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VNYXBCYXNlVXJsOiAnJ1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaXQoJ3Nob3VsZCBub3JtYWxpemUgb3B0aW9ucyBwcmVzZXQnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGFzc2VydC5kZWVwRXF1YWwob3B0aW9uc1ByZXNldCwgZXhwZWN0ZWRPcHRpb25zUHJlc2V0KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBkZXNjcmliZSgndmFyaWFudCAjMjogc291cmNlIG1hcCBiYXNlIHVybCB3aXRoIHNvdXJjZSBtYXAgZmlsZSBuYW1lJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGJlZm9yZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnNQcmVzZXQgPSBnZXROb3JtYWxpemVkT3B0aW9ucyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5ERUZBVUxUX1BSRVNFVCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZU1hcEJhc2VVcmw6ICdodHRwOi8vbG9jYWxob3N0OjkwMDAnLFxuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlTWFwRmlsZU5hbWU6ICcvb3V0cHV0U291cmNlTWFwTmFtZS5tYXAnXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkT3B0aW9uc1ByZXNldCA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLkRFRkFVTFRfUFJFU0VULFxuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlTWFwQmFzZVVybDogJ2h0dHA6Ly9sb2NhbGhvc3Q6OTAwMC8nLFxuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlTWFwRmlsZU5hbWU6ICdvdXRwdXRTb3VyY2VNYXBOYW1lLmpzLm1hcCdcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGl0KCdzaG91bGQgbm9ybWFsaXplIG9wdGlvbnMgcHJlc2V0JywgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBhc3NlcnQuZGVlcEVxdWFsKG9wdGlvbnNQcmVzZXQsIGV4cGVjdGVkT3B0aW9uc1ByZXNldCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZGVzY3JpYmUoJ3NvdXJjZU1hcEZpbGVOYW1lUnVsZScsICgpID0+IHtcbiAgICAgICAgICAgIGJlZm9yZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgb3B0aW9uc1ByZXNldCA9IGdldE5vcm1hbGl6ZWRPcHRpb25zKHtcbiAgICAgICAgICAgICAgICAgICAgLi4uREVGQVVMVF9QUkVTRVQsXG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZU1hcEJhc2VVcmw6ICdodHRwOi8vbG9jYWxob3N0OjkwMDAnLFxuICAgICAgICAgICAgICAgICAgICBzb3VyY2VNYXBGaWxlTmFtZTogJy8vb3V0cHV0U291cmNlTWFwTmFtZSdcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGV4cGVjdGVkT3B0aW9uc1ByZXNldCA9IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uREVGQVVMVF9QUkVTRVQsXG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZU1hcEJhc2VVcmw6ICdodHRwOi8vbG9jYWxob3N0OjkwMDAvJyxcbiAgICAgICAgICAgICAgICAgICAgc291cmNlTWFwRmlsZU5hbWU6ICdvdXRwdXRTb3VyY2VNYXBOYW1lLmpzLm1hcCdcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGl0KCdzaG91bGQgbm9ybWFsaXplIG9wdGlvbnMgcHJlc2V0JywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGFzc2VydC5kZWVwRXF1YWwob3B0aW9uc1ByZXNldCwgZXhwZWN0ZWRPcHRpb25zUHJlc2V0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBkZXNjcmliZSgnc3RyaW5nQXJyYXlSdWxlJywgKCkgPT4ge1xuICAgICAgICAgICAgYmVmb3JlKCgpID0+IHtcbiAgICAgICAgICAgICAgICBvcHRpb25zUHJlc2V0ID0gZ2V0Tm9ybWFsaXplZE9wdGlvbnMoe1xuICAgICAgICAgICAgICAgICAgICAuLi5ERUZBVUxUX1BSRVNFVCxcbiAgICAgICAgICAgICAgICAgICAgc3RyaW5nQXJyYXk6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBzdHJpbmdBcnJheUVuY29kaW5nOiAncmM0JyxcbiAgICAgICAgICAgICAgICAgICAgc3RyaW5nQXJyYXlUaHJlc2hvbGQ6IDAuNSxcbiAgICAgICAgICAgICAgICAgICAgcm90YXRlU3RyaW5nQXJyYXk6IHRydWVcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGV4cGVjdGVkT3B0aW9uc1ByZXNldCA9IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uREVGQVVMVF9QUkVTRVQsXG4gICAgICAgICAgICAgICAgICAgIHN0cmluZ0FycmF5OiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgc3RyaW5nQXJyYXlFbmNvZGluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHN0cmluZ0FycmF5VGhyZXNob2xkOiAwLFxuICAgICAgICAgICAgICAgICAgICByb3RhdGVTdHJpbmdBcnJheTogZmFsc2VcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGl0KCdzaG91bGQgbm9ybWFsaXplIG9wdGlvbnMgcHJlc2V0JywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGFzc2VydC5kZWVwRXF1YWwob3B0aW9uc1ByZXNldCwgZXhwZWN0ZWRPcHRpb25zUHJlc2V0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBkZXNjcmliZSgnc3RyaW5nQXJyYXlFbmNvZGluZ1J1bGUnLCAoKSA9PiB7XG4gICAgICAgICAgICBiZWZvcmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIG9wdGlvbnNQcmVzZXQgPSBnZXROb3JtYWxpemVkT3B0aW9ucyh7XG4gICAgICAgICAgICAgICAgICAgIC4uLkRFRkFVTFRfUFJFU0VULFxuICAgICAgICAgICAgICAgICAgICBzdHJpbmdBcnJheUVuY29kaW5nOiB0cnVlXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBleHBlY3RlZE9wdGlvbnNQcmVzZXQgPSB7XG4gICAgICAgICAgICAgICAgICAgIC4uLkRFRkFVTFRfUFJFU0VULFxuICAgICAgICAgICAgICAgICAgICBzdHJpbmdBcnJheUVuY29kaW5nOiAnYmFzZTY0J1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaXQoJ3Nob3VsZCBub3JtYWxpemUgb3B0aW9ucyBwcmVzZXQnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgYXNzZXJ0LmRlZXBFcXVhbChvcHRpb25zUHJlc2V0LCBleHBlY3RlZE9wdGlvbnNQcmVzZXQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRlc2NyaWJlKCdzdHJpbmdBcnJheVRocmVzaG9sZFJ1bGUnLCAoKSA9PiB7XG4gICAgICAgICAgICBiZWZvcmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIG9wdGlvbnNQcmVzZXQgPSBnZXROb3JtYWxpemVkT3B0aW9ucyh7XG4gICAgICAgICAgICAgICAgICAgIC4uLkRFRkFVTFRfUFJFU0VULFxuICAgICAgICAgICAgICAgICAgICByb3RhdGVTdHJpbmdBcnJheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgc3RyaW5nQXJyYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHN0cmluZ0FycmF5VGhyZXNob2xkOiAwXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBleHBlY3RlZE9wdGlvbnNQcmVzZXQgPSB7XG4gICAgICAgICAgICAgICAgICAgIC4uLkRFRkFVTFRfUFJFU0VULFxuICAgICAgICAgICAgICAgICAgICByb3RhdGVTdHJpbmdBcnJheTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHN0cmluZ0FycmF5OiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgc3RyaW5nQXJyYXlUaHJlc2hvbGQ6IDBcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGl0KCdzaG91bGQgbm9ybWFsaXplIG9wdGlvbnMgcHJlc2V0JywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGFzc2VydC5kZWVwRXF1YWwob3B0aW9uc1ByZXNldCwgZXhwZWN0ZWRPcHRpb25zUHJlc2V0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuIl19